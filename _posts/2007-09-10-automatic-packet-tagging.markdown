---

title: Automatic packet tagging
abstract: A network device is arranged for coupling to a first network segment () to a second network segment (), and has a transfer unit () for transferring data packets between the first and second network segments. The device has a determining unit () for determining a service requirement for a received data packet for accommodating the service requirement in the second network segment. A source of the received data packet in the first network segment is detected. Based on priority criteria and content type criteria a type of service is tagged to the data packet in dependence of the source. The transfer unit is arranged for accommodating the type of service in the second network segment. Advantageously a bridge is formed for transferring data packets that are unaware of quality of service to a network segment that operates according to quality of service requirements.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08305891&OS=08305891&RS=08305891
owner: Koninklijke Philips Electronics N.V.
number: 08305891
owner_city: Eindhoven
owner_country: NL
publication_date: 20070910
---
The invention relates to a network device comprising a first interface unit for coupling to a first network segment a second interface unit for coupling to a second network segment transfer means for transferring data packets between the first and second network segments and determining means for determining a service requirement for a received data packet that is to be transferred from the first network to the second network segment for accommodating the service requirement in the second network segment.

The invention further relates to a method of determining a service requirement while transferring data packets between a first network segment and a second network segment the method comprising the steps of determining a service requirement for a received data packet that is to be transferred from the first network to the second network segment for accommodating the service requirement in the second network segment.

The invention relates to the field of network communication in a segmented network. The network may include a wireless part and a wired part. A network device for example a switch router gateway or an access point in a wireless network segment constitutes a bridge between the segments. An access point communicates with wireless devices and transfers messages between the wired and wireless segments.

The document US 2006 0013129 describes resource utilization in networks. A network device called an overlapping scheduler receives data packets from various applications. The data packets are to be transmitted to the network. Some applications provide Quality of Service QoS parameters for transmission via the network whereas others especially the older ones are not able to provide such parameters. For services where the QoS parameters are not available the scheduler may determine QoS parameters for example based on bandwidth measurements. Additional QoS parameters may be determined from analyzing the contents of arriving packets.

The document US 2006 0013129 provides an example of a method that receives data packets from applications and transmits the data packets to a network segment. Some data packets have known QoS parameters whereas others have no such parameters. Where no QoS parameters are provided the method determines the QoS parameters based on the contents of the data packets. On the output the network performance is improved by transmitting the data packets according to the QoS parameters. However a problem of the known method occurs when a large number of packets arrive from a further network segment for example from the internet. There is a need for transferring packets from a network segment where QoS parameters are usually absent to a segments where service parameters can be controlled and used to improve the performance. However detecting QoS parameters directly from the contents of the packets or performing bandwidth measurements for that purpose is not viable.

It is an object of the invention to provide a network solution to bridge a gap between a first and second segment of a network where service parameters in the first segment are not controlled whereas in the second segment data packets may be accommodated based on service parameters.

For this purpose according to a first aspect of the invention in the network device as described in the opening paragraph the determining means are arranged for determining the service requirement by detecting a source of the received data packet in the first network segment and assigning to the received data packet a type of service in dependence of the source and the transfer means are arranged for accommodating the type of service in the second network segment for the received data packet.

For this purpose according to a second aspect of the invention in the method as described in the opening paragraph the step of determining comprises detecting a source of the received data packet in the first network segment and assigning to the received data packet a type of service in dependence of the source and the transferring comprises accommodating the type of service in the second network segment for the received data packet.

The measures have the effect that data packets arriving from the first network segment which segment is not aware of type of service or quality of service requirements are automatically assigned the type of service i.e. a respective priority is applied in the second network segment suitably selected for the respective data packet. The assignment is based on detecting the source of the data packet in the first network segment. Advantageously the device constitutes a bridge between two network segments the first segment being unaware of type of service and the second operating according to the type of service for improved performance and effective use of the network resources.

The invention is also based on the following recognition. It has been noted that other systems exist that translate quality of service QoS criteria from one networking protocol to another protocol. For example U.S. Pat. No. 6 859 438 describes a policy based mechanism for monitoring and prioritizing traffic within a network and allocating bandwidth to achieve true quality of service. The device receives QoS policy information e.g. information indicative of a set of traffic groups and related QoS settings an IEEE 802.1p priority indicator or an IEEE 802.1q frame tag or information about the QoS based on the topology of the network. Based on the QoS information received as input parameters data packets are scheduled for output according to QoS policy for an identified traffic group to which the packet is associated. The inventors have seen that whereas such devices translate input QoS information received according to one protocol for use in a further network segment the known devices do not provide a solution when no QoS information is available. The current invention provides a true bridge for coupling QoS unaware traffic to a QoS aware network segment. When no QoS information is available the source of the data packets is detected and used to set a type of service for use in the second network segment e.g. by a mapping of the detected source to a content type.

In an embodiment of the network device the determining means are arranged for detecting the source of the received data packet based on at least one of a network address indicator a network port indicator a media access indicator and in the event of the first network segment being part of the Internet an Internet Protocol IP address a Uniform Resource Locator URL . This has the advantage that the source can be easily detected during the setup of a link via the device and or from control data associated to the data packets like packet headers.

In an embodiment of the network device the determining means are arranged for said assigning the type of service by applying predefined criteria the criteria including at least one of a mapping of a content type to a source and priority criteria for a source. This has the advantage that such criteria can be easily provided by a user who does not need to be an expert in the field of data communication or by setting such criteria by an external source.

In an embodiment of the network device the transfer means are arranged for accommodating the type of service by adapting a control portion of the received data packet according to a predefined protocol. The control portion is set according to the protocol requirements in the second network segment. This has the advantage that in the second network segment a standard QoS mechanism can be accommodated. In particular said adapting may comprise adapting a header by setting a type of service field. Advantageously the data packet will subsequently be send via the second network segment according to the adapted header.

Further preferred embodiments of the device and method according to the invention are given in the appended claims disclosure of which is incorporated herein by reference.

In the Figures elements which correspond to elements already described have the same reference numerals.

Priority based Quality of Service QoS data communication is starting to be deployed in home networks through access points gateways bridges and network cards. To work effectively QoS requires both the server source of the stream and the networking infrastructure wireless access points gateways to be QoS aware . In many cases however this is not the case and the consumer is unable to upgrade the non QoS aware devices for example because the source device is actually a server on the Internet. A solution is provided by the network device which constitutes a bridge from parts of the delivery chain that are not QoS aware to a network segment that is QoS aware.

The network device has a first interface unit for coupling to the first network segment a second interface unit for coupling to the second network segment a transfer unit for transferring data packets between the first and second network segments and a determining unit for determining a service requirement for a received data packet that is to be transferred from the first network to the second network segment. The determining unit may be coupled to a control interface e.g. a user interface. The second interface unit may have an antenna for accessing a wireless network segment as shown. The second interface unit may alternatively be a further wired interface e.g. coupled to a local area network LAN . The determining unit is coupled to the first and second interface units and to the transfer unit for accommodating the service requirement in the second network segment. Thereto the determining unit is arranged for determining the service requirement by detecting a source of the received data packet in the first network segment and assigning to the received data packet a type of service in dependence of the source. Furthermore the transfer unit is arranged for accommodating in the second network segment the type of service as determined for the received data packet.

A stream of data packets e.g. a video or audio stream is to be transported from the source to the target also called sink . Note that several streams may be accommodated in the network at the same time between various sources and one target or vice versa. The streams pass via the network device which constitutes a bridge between two network segments. The network device may for example be a wireless access point WAP a wireless bridge a gateway router or switch or a media server.

The determining unit is arranged to determine a type of service requirement for network packets that do not have this type of service when arriving from the first network segment. Subsequently these packets are processed and forwarded to the second network segment as if the type of service was present. This improves the end to end communication between the source and sink of a stream where packets often travel different network segments e.g. from WAN to LAN .

The device will automatically inspect incoming packets and determine whether packets fall into the priority categories used in the network by determining the source of the packets. To improve classification accuracy additional content type rules can be defined which define the content type for all traffic coming from one or more specific sources. For unspecified sources the device may revert back to the automatic analysis. For accommodating the service type in the second network segment the device can assign Layer 2 and or Layer 3 priority tags as explained below in detail.

Alternatively or additionally the network device may be interfacing to a further network segment e.g. a wired home Ethernet which receives packets tagged by the device with QoS priority according to IEEE 802.1q.

The upper section of indicates the mechanism for determining the type of service representing the function of the determining unit as shown in . The leftmost unit shows direct priority criteria for particular sources e.g. based on the user s preferences for example assigning the priority VO coded 0x48 to the URL philips.com. The next unit has a mapping of sources based on internet URL to a type of service so called content type rules. The mapping may be preset may be entered or edited by the user or may be provided via the internet as a service e.g. via an automatic download. The next unit displaying a table further discussed with reference to provides a mapping of content type to Priorities. The rightmost unit provides content criteria for packet analysis. In particular a few protocols are listed and the respective control fields to be detected for determining the type of service are indicated. After determining the appropriate protocol respective analysis of the fields provides a content type as input for assigning the type of service to the data packet.

In an embodiment the classification of data packets of a specific source are supported by analyzing the packets. Thereto the determining unit is arranged for said assigning the type of service based on analyzing a control portion of the received data packet according to a predefined protocol. For example the header of the packet although intended for a different protocol layer may reveal the service type. For example the control portion of data packets may have a Multipurpose Internet Mail Extensions MIME type according to a hypertext transfer protocol HTTP protocol an audio video AV profile according to a real time protocol RTP or a code indicating an encoder used for encoding the content of the data packet. A profile or media format may be indicated in the packets e.g. the AVI FourCC code. A FOURCC literally four character code is a sequence of four bytes used to uniquely identify data formats. Originally used in the Amiga IFF file format the idea was reused to identify data types in Apple s AIFF format and Microsoft s RIFF format and later in QuickTime and DirectShow. One of the most well known uses of FourCCs is to identify the video codec used in AVI files. Common identifiers include DIVX XVID and H264. For audio codecs AVI and WAV files use a two byte identifier usually written in hexadecimal such as 0055 for MP3 .

Further examples of protocols and references for further information that can be used for adding criteria for analysis are 

RTSP Real Time Streaming Protocol . Protocol used to stream Audio or Video over the Internet see RFC2326 

SIP Session Initiation Protocol . Protocol used for Voice or Video telephony over the Internet see http www.cs.columbia.edu sip drafts.html 

SDP Session Description Protocol. Format for describing setup parameter of internet stream. Mostly used as part of a RTSP session or SIP session see RFC 2327 

In an embodiment of the network device the determining means have a control interface for setting the above criteria e.g. entering adapting or removing the mapping of sources and content types. For example the control interface may be a user interface or an application programming interface API . Such interfaces for setting properties options and criteria are well known as such. The control interface improves the classification accuracy by allowing a consumer or another computer program to define content type rules that define the content type for all traffic coming from a set of specific sources e.g. based on IP addresses ports URLs or Media Access Protocol MAC addresses . Also the consumer or another computer program may be allowed to override automatic content classification by explicitly defining the priority for all traffic coming from a specific source using priority rules .

Via the control interface configuration of rules could be entirely manual user typing in all info or based on an import bookmarks favorites mechanisms. For well known URLs popular video stores etc the device could automatically suggest a content category e.g. download.com is always background priority 0 and Itunes.com is always audio AV priority 2 .

In an embodiment of the network device the source determining unit is arranged for detecting the source of the received data packet as follows. The incoming data packets are analyzed to determine the source. The analyzing may take place when a specific link is established between a source coupled to the first network interface and a target coupled to the second network interface and or when an individual packet arrives. In particular the source may be found based on at least one of a network address indicator a network port indicator a media access indicator usually called MAC address. Moreover when data packets are received from the Internet one of the following elements may be used Internet Protocol IP address a Uniform Resource Locator URL .

In en embodiment the network device the determining unit may be arranged for said assigning the type of service by applying predefined criteria the criteria including a mapping of a content type to a source. The mapping may include a table that maps a particular source e.g. based on URL to a particular content type e.g. video voice audio . Alternatively the mapping may include a direct mapping of a source to a selected priority.

In an embodiment the transfer unit is arranged for accommodating the type of service according to a priority as derived by adapting a control portion of the received data packet according to a predefined protocol. For example the header or other control fields of the packet may be adapted usually in the L3 protocol. In particular said adapting may comprise adapting a header by setting a type of service field. Thereto a L3 tag may be inserted or given a specific value. In the IP protocol a suitable field to be set the Differentiated Services Code Point DSCP field which indicates the type of service. The DSCP having 64 possible values is a field in the header of IP packets for packet classification purposes that indicates the packet priority similar to WMM . As the header is used at IP level it can be used for wired or wireless network segments.

In an embodiment of the device the network interfaces have different buffer queues for packets of different type of service for interfacing to a wireless second network segment. The different buffer queues are selected based on a L2 priority for transferring the packets via a wireless network segment in a preferred order. The transfer unit is arranged for accommodating the type of service according to the priority as derived by transferring the received packet via a selected one of the buffer queues based on the type of service.

In an embodiment of the network device the transfer means are coupled to a mass storage unit for storing data packets received from the first network segment and retrieving data packets to be transmitted to the second network segment e.g. for constituting a media server. Incoming streams of QoS unaware data packets may be stored and outgoing stream of QoS aware data packets may be retrieved and transmitted to users. In the embodiment the determining means are arranged for said assigning the type of service before said storing or after said retrieving. Determining the type of service before storing requires that the detected type of service is stored also and used while retrieving the respective stream of data packets. The respective data packets may be adapted after retrieving according to the stored or detected type of service.

In practice the most used mechanism at layer 3 is DSCP which uses 6 bits 64 values lowest priority is 0 highest 63 . The DSCP value is often interpreted in groups 0 7 is treated the same 8 15 etc for details see http www.techworld.com features index.cfm fuseaction displayfeature featureid 394 .

It is to be noted that the invention may be implemented in hardware and or software using programmable components. A method for implementing the invention has the following steps. First the method inspects incoming packets. When a packet is received first the source is of the packet is determined e.g. based on IP address port or MAC address. If the source has been detected and matches a priority rule the priority as specified in the rule is used for this packet. Otherwise if the source has a content type rule identify the content type of the packet as specified by the rule. Otherwise if no rule exists determine the content type by analysing the protocol header file format header and content format headers as follows. For HTTP inspect the MIME type header for RTP inspect AV profile used in the session setup by RTSP SIP H323 etc. for AVI files inspect the FourCC code for unknown files try to match to popular compression format MPEG WMV MP3 JPEG . . . . Subsequently map the identified content type to a QoS priority for example map video mpeg to the Video QoS priority level. On the output process the packet as if is were received with the determine QoS priority. Mapping may be applied on both layer 2 and layer 3 packets if the device has appropriate outgoing network interfaces .

Priority Rule a stream coming from www.philips.com will be always be classified as WMM priority VO meaning highest 

Automatic HTTP analysis an incoming HTTP stream has MIME type header video mpeg . The method will tag packets belonging to this HTTP stream with IP DSCP priority field. On its Wifi output the packet will be queued according to WMM priority level VI video . On its Ethernet output priority level 5 will be used in the 802.1p priority field of the 802.1q layer 2 tag 

Automatic RTP analysis for RTSP H323 SIP sessions setup using RTP and SDP. the m field in the SDP file identifies the content type for a particular TCP UDP connection. For MPEG2 video RTP AV profile content type MPV is used. In this case the method will tag packet as in the previous example.

Although the invention has been mainly explained by embodiments using the internet en home network segments the invention is also suitable for any bridge between network segments for transferring data streams that are QoS unaware to other network segments that are QoS aware. Various network segments may physically share the same resources.

It is noted that in this document the word comprising does not exclude the presence of other elements or steps than those listed and the word a or an preceding an element does not exclude the presence of a plurality of such elements that any reference signs do not limit the scope of the claims that the invention may be implemented by means of both hardware and software and that several means or units may be represented by the same item of hardware or software and a processor may fulfill the function of one or more units possibly in cooperation with hardware elements. Further the invention is not limited to the embodiments and the invention lies in each and every novel feature or combination of features described above.

