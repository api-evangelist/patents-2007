---

title: Method and system for call routing
abstract: Systems and methods for call routing are provided. Certain aspects disclose a system and method for call routing, where the call can originate from a hybrid mobile device capable of operating on either the traditional core mobile network or on a voice over Internet Protocol network. Regardless of which network is being accessed, the call can be routed to its intended destination. Other aspects disclose a system for providing a location of a hybrid mobile device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08767689&OS=08767689&RS=08767689
owner: Redknee Inc.
number: 08767689
owner_city: Mississauga
owner_country: CA
publication_date: 20071115
---
This specification claims priority from U.S. provisional patent application 60 957 086 filed Aug. 21 2008 the contents of which are incorporated herein by reference.

The present application relation generally to telecommunications and more particularly relates to a method and system for call routing.

As circuit switched networks are replaced with packet switched networks call routing methodologies are becoming more complex. Indeed there is additional complexity in the case of mobile networks and still further complexity in hybrid mobile networks.

Emergency 911 services are one example where call routing can be complex. In the circuit switched paradigm 911 services were complicated given that a single telephone number 911 was used from all telephone handsets to reach multiple emergency service centers technically known as public safety answering points PSAP . In traditional mobile networks e.g. Global System for Mobile communications GSM Code Division Multiple Access CDMA provision of 911 services were even more complicated as a mobile handset would need to access a different PSAP depending on the location of the handset. More recently hybrid mobile paradigms have arisen where a mobile handset can access either a traditional mobile network or access a voice over internet protocol VOIP network via access technologies that use unlicensed spectrum such as a wireless local area network WLAN implemented via Bluetooth or Institute of Electrical and Electronic Engineers IEEE Standard 802.11. Collectively these unlicensed access technologies are also known as Unlicensed Mobile Access UMA technologies. In these hybrid mobile paradigms the selection of the appropriate PSAP based on the location of the caller is even more complex as the routing of the 911 call can be performed either through the WLAN or via the traditional mobile network and in either event the location of the calling device needs to be ascertained in order to locate the appropriate PSAP.

U.S. Pat. Nos. 5 805 689 RE36 111 and 5 805 689 provide a routing methodology for 1 800 telephone calls. 1 800 patents The patentees of the 1 800 patents assert that the 1 800 patents can be used for 911 services. However the 1 800 patents require the use of latitude and longitude information for call routing. Yet this can be overly cumbersome particularly in the case of WLAN hotspots where the individual or entity deploying the WLAN hotspot may not know their particular latitude and longitude. This is a problem that is exacerbated by the fact that the WLAN hotspot may be moved on a frequent basis. Another problem with using the 1 800 patents for 911 services is that in general the 1 800 patents were constructed for a circuit switched paradigm and are not generally suitable for calls under a packet switched paradigm.

Although call routing in the event of an Emergency Services Call is of paramount importance a means to route calls originated from a UMA capable mobile device to a given service provider that provides geographically oriented services e.g. a delivery service florist restaurant is also required.

In addition an asynchronous mechanism to access the location of the UMA capable mobile device independent of a call routing request is also required for the provision of both physical services e.g. delivery of goods and virtual services e.g. delivery of weather reports .

An aspect of this specification provides a method for responding to a request for a routing parameter from a network entity for a communication originated from a communication device comprising 

if the communication originates from a first network type allocating the routing parameter on the basis of a first node identifier associated with a first node being accessed by the calling device and

if the communication from originates from a second node that has been previously associated with the communication device then allocating the routing parameter based on either a second node identifier associated with the second node or a communication device identifier 

if the communication from originates from a third node that has not been previously associated with the communication device and where the third node has been previously identified then allocating the routing parameter based on a third node identifier associated with the third node and

if the communication from originates from a fourth node that has not been previously associated with the communication device and where the fourth node has been previously identified then allocating the routing parameter based on a network address identifying the fourth node.

The first network type can be a mobile network such as a GSM GPRS CDMA or WiMAX network. The second network type can be a UMA network. The UMA network can be a WLAN network.

The second node can be a UMA hotspot located in a subscriber s business or home and the communication device is associated with that subscriber s business or home.

The third node can be a UMA hotspot located in a business or home not associated with the subscriber.

The fourth node can be a UMA hotspot located in a business or home not associated with the subscriber.

Another aspect of this specification provides a method for responding to a request for a location from a network entity of a communication device comprising 

if the request originates from a first network type interacting with a plurality of network entities in order to retrieve location information using a communication device identifier and triangulation of the communication device 

if the request originates from a second network type retrieving a known street address associated with the location of a node being accessed by the communication device.

Another aspect of this specification provides a method for responding to a request for location information from a network entity for a communication device comprising 

if the communications device is linked to a first network type allocating the location information on the basis of a first node identifier associated with a first node being accessed by the communications device and

if the communications device is linked to a second node that has been previously associated with the communication device then determining the location information based on either a second node identifier associated with the second node or a communication device identifier

if the communications device is linked to a third node that has not been previously associated with the communication device and where the third node has been previously identified then determining the location information based on a third node identifier associated with the third node and

if the communications device is linked to a fourth node that has not been previously associated with the communication device and where the fourth node has been previously identified then determining the location information based on a network address identifying the fourth node.

Another aspect of this specification provides an apparatus for responding to a request for location information from at least one network entity for a communication device comprising an interface for connecting to the network entity. The apparatus also comprises a processor connected to the interface. The processor is configured to determine if the communications device is linked to at least one of a first network type and a second network type and if the processor determines the communication device is linked to the first network type then the processor further configured to allocate the location information on the basis of a first node identifier associated with a first node being accessed by the communications device. However if the processor determines the communication device is linked to a second network type then the processor is further configured to determine if the communications device is linked to a second node that has been previously associated with the communication device in which case the processor is configured to determine the location information based on either a second node identifier associated with the second node or a communication device identifier. The processor is further configured to determine if the communications device is linked to a third node that has not been previously associated with the communication device and where the third node has been previously identified the processor is configured to determine the location information based on a third node identifier associated with the third node. The processor is further configured to determine if the communications device is linked to a fourth node that has not been previously associated with the communication device and where the fourth node has been previously identified the processor is configured to determine the location information based on a network address identifying the fourth node.

Systems and methods for call routing are provided. Certain aspects disclose a system and method for call routing where the call can originate from a hybrid mobile device capable of operating on either the traditional core mobile network or on a voice over Internet Protocol network. Regardless of which network is being accessed the call can be routed to its intended destination. Other aspects disclose a system for providing a location of a hybrid mobile device.

Various terms and definitions are used herein. For understanding of the use of these terms and the structure and function of any associated elements in the Figures the entirety of the specification should be carefully consulted.

Referring now to a system for call routing is indicated generally at . System comprises a first mobile station MS . MS can be any known or future conceived mobile handset such as a mobile telephone wireless paging device with telephony capabilities or the like. MS can conduct voice calls either via core mobile network technologies or via voice over Internet Protocol VOIP using wireless local area network WLAN technologies.

While in the present embodiment MS is a mobile station it should be understood that in modified embodiments the teachings herein can be applied to fixed or nomadic wireless. MS is configured to initiate a telephone call. In a present exemplary embodiment which will be discussed further below MS is configured to initiate a telephone call in the form of an Emergency Services Call and can be involved in determining the position of MS depending on the nature of the location technology utilized.

An Emergency Services Call is a call requiring connection to a Public Safety Access Point PSAP . The digits 9 1 1 require this treatment in the United States of America. Note that other digits sequences may be used to invoke an Emergency Services Call.

System also comprises a Location Measurement Unit LMU that is configured to make radio measurements to support the determination of a position of MS in conjunction with at least one Serving Mobile Location Center SMLC that connects to LMU . For non UMA e.g. GSM calls SMLC is configured to manage the overall coordination and scheduling of the resources of LMU that are required to determine the position of MS . The mechanism and signalling methods are unique to a given triangulation technology and vendor respective to LMU . For some position methods LMU is also configured to calculate the final position estimate and accuracy. In one Public Land Mobile Network PLMN there can be more a plurality of SMLCs. Position and assistance measurements obtained by LMU are supplied to a particular SMLC associated with LMU . Signaling to LMU can be performed over a link . Those skilled in the art will recognize that System may be modified to accommodate alternative access and core network technologies such as CDMA as well as future evolutionary architectural modifications such as the Internet Multimedia Subsystem IMS architecture.

System also comprises a Base Station System BSS . BSS is configured to receive calls from MS via a wireless link . BSS is also connected to SMLC and configured to communicate therewith in order to obtain location information about MS . In a present non limiting embodiment BSS is based on the Global System for Mobile communication GSM standard for core mobile network calls and non VOIP calls originating from MS . In a present non limiting embodiment BSS can also accommodate various VOIP calls using standards and specifications associated with Unlicensed Mobile Access UMA technologies. UMA is also known as Generic Access Network GAN and can provides a means of providing telecommunication services and roaming via an access technology that uses unlicensed spectrum technologies such as Bluetooth or 802.11. 

For both core mobile network calls and VOIP calls from MS BSS is also configured to handle of certain positioning procedures used to determine the position of MS discussed further below.

System also comprises at least one Switching Center SC that connects to BSS via a link that is supported by the configuration of each SC and BSS . Switching center can be based on the environment of either a mobile switching center MSC in the case of core mobile network calls or an UMA Network Controller UNC in the case of VOIP calls.

Where SC is an MSC then such an MSC is based on known core mobile network technologies and likewise BSS would be based on known core mobile network technologies and MS would be configured to conduct voice calls via known core mobile network technologies.

Where SC is a UNC then the UNC can be configured to connect to a private or public internet protocol IP network not shown and to the core mobile network using known gateways and or interfaces. Such a UNC manages subscriber access to mobile voice and data services from various Wireless Local Area Network WLAN locations. Where SC is based on UMA then BSS would be based on a WLAN router such as an IEEE 802.11g standard router or a Bluetooth router and MS would be configured to conduct voice over internet VOIP calls via WLAN.

System also comprises a Visited Mobile Switching Center VMSC that connects to SC and SLMC . The link between the SC and VMSC is based on known core mobile network technologies.

For UMA Emergency Services Calls from MS the UNC capable SC is configured to initiate a request for an Emergency Services Routing Key or ESRK defined below by sending a query to a GMLC discussed further below that can include the following or comparable parameters based on the functionality of the corresponding UMA capable BSS Mobile Station International Integrated Services Digital Network ISDN Number MSISDN International Mobile Station Identity IMSI Uncertainty Parameter and Cell Global Identifier CGI information. Those skilled in the art will recognize that the GMLC may communicate other parameters and attributes depending on the nature of the access technology or core network technology.

The Mobile Station ISDN or MSISDN is a digit string that normally consists of a dialable sequence that can be used by the PSAP to reach a given mobile subscriber. To the extent that a MSISDN is not available e.g. for a non activated phone a non dialable MSISDN may be generated by the MSC based on the IMEI or some other attribute.

The International Mobile Equipment Identity or IMEI is a digit string that uniquely identifies a given GSM Mobile Station. The IMEI is a 15 or 17 digit number which includes information on the origin model and serial number of the device. The structure of the IMEI is specified in 3GPP TS 23.003.

The International Mobile Station Identity or IMSI is a digit string that uniquely identifies a Subscriber Identification Module SIM . The SIM is a smart card containing the telephone number MSISDN of the subscriber encoded network identification details the PIN and other user data such as the phone book. A user s SIM card can be moved from Mobile Station to Mobile Station as it contains all the key information required to activate the Mobile Station.

The Uncertainty Parameter is a digit string that provides an indication of the resolution of the triangulation estimate or approximate radius of a coverage area associated with a Base Station System.

The Cell Global Identity or CGI is a digit string that identifies a cell and sector as applicable of a Base Station System BSS that serving a subscriber s Mobile Station during an Emergency Services Call. The CGI can be encoded in order to identify the request as being associated with an UMA call.

An Emergency Services Routing Key or ESRK is a digit string that uniquely identifies an ongoing Emergency Services Call. The ESRK is used by the ESNE to direct the call to the appropriate PSAP as well as to correlate location requests from the PSAP to a given Emergency Services Call. Any ESRK so provided has the following properties 

An Emergency Services Zone or ESZ is a geographic area to which is assigned a primary PSAP a secondary PSAP and a set of emergency response agencies e.g. fire police ambulance . The ESZs are non overlapping and every point in the emergency services area is within one ESZ.

System also comprises at least one Emergency Services Network Entity ESNE that connects to VMSC . ESNE is a known entity in an emergency services network which serves as the point of interface to an MSC such as MSC for voice or Telecommunications Device for the Deaf TDD Teletypewriter TTY services. ESNE is configured to route and process the voice band portion of an Emergency Services Call. ESNE comprises selective routers also known as Routing Bridging and Transfer switches .

System also comprises at least one Public Safety Answering Point PSAP . Typically system includes a plurality of PSAPs but for simplicity and ease of explanation only a single PSAP is shown . PSAP is a known emergency services network element that is responsible for answering Emergency Services Calls. PSAP is a call center to which Emergency Services Calls are directed. PSAP invokes emergency services as required e.g. fire ambulance as required in response to an Emergency Services Call.

ESNE is configured to route and process the voice band also referred to in the art as the bearer path portion of an Emergency Services Call from MS . In the present embodiment ESNE is configured to direct an Emergency Services Call received from MSC to an appropriate PSAP in this embodiment PSAP on the basis of an emergency services routing key ESRK the details of which will be discussed further below.

System also comprises an Emergency Services Message Entity ESME . ESME is another entity in the emergency services network which serves as the point of interface to MSC for common channel emergency services messaging. ESME routes and processes the out of band messages related to Emergency Services Calls. ESME can be incorporated into selective routers also known as Routing Bridging and Transfer switches and Automatic Location Information ALI database engines. ESME is configured to process and direct out of band non bearer path messages related to Emergency Services Calls. In the present embodiment ESME initiates requests to locate a given mobile subscriber that is identified via an ESRK.

System also comprises at least one Gateway Mobile Location Center GMLC . GMLC is configured to support delivery of the position of MS to ESME . GMLC is also configured to handles requests an initial updated current or last known position of MS from ESME . In a typical Public Land Mobile Network PLMN implementation there can be more than one GMLC.

The GMLC may request the location of a given MS from the VMSC . The location received at the GMLC can be stored for subsequent retrieval by the PSAP via the ESME . GMLC is discussed further below.

System also comprises a Reverse IP Address Service that is accessible to GMLC and which is based on any service that is configured to identify the region or other geodetic information for a given IP address. Example of Reverse IP Address Services include http www.ip2location.com free.asp or http www.geobytes.com IpLocator.htm. Other mechanisms to access Reverse IP Address services Application Programming Interfaces APIs may also be used.

For Emergency Services Call origination MS is configured to interact with a local serving SC and in some cases with a separate VMSC . Only a single SC is involved visited and serving MSC for an Emergency Services Call that is not in MSC MSC handover state. Two separate MSCs are involved serving MSC and visited or anchor MSC for an Emergency Services Call in MSC MSC handover state. The handover state scenario is represented in FIG. and so it should be understood that in non handover state scenarios VMSC and SC can be abstracted into a single entity as SC . Expressed in other words VMSC is responsible for setting up the Emergency Services Call from MS to the correct PSAP being PSAP in with the other PSAPs in the emergency network not being shown. In this embodiment SC which in this case is distinct relays all Emergency Services Call signaling messages between BSS and VMSC using the signalling procedures associated with the core network. To the extent that the MS is in a hand over state as shown in SC which is associated with BSS serving MS is referred to as the Serving MSC and the MSC that was associated with the BSS that originally served the Mobile Station at the initiation of the call is called the Visited MSC. Recall that in a non hand over scenario the VMSC and SC are one and the same.

 i SC receives Emergency Services Calls via BSS and interacts with GMLC for the purpose of retrieving an ESRK for a given Emergency Services Call. For emergency calls the VMSC will initiate a request for an ESRK by providing a number of parameters that may include the MSISDN IMSI and CGI information or comparable parameters associated with MS . Upon receiving the response from GMLC which includes an ESRK value VMSC will direct the call to ESNE .

For UMA the UMA capable BSS will be deployed and provide coverage at a fixed location such as a commercial establishment e.g. a caf or a residential home. A UMA capable BSS is essentially a wireless access point that uses unlicensed spectrum technologies such as Bluetooth or IEEE 802.11 in order to communicate with a UMA capable MS .

 ii The GMLC also responds to requests to provide location information for mobile subscribers received from the ESME. The GMLC handles requests for a mobile subscriber s initial updated current or last known position from the ESME. A given Emergency Services Call is identified via an ESRK.

Referring now to a system for call routing is indicated generally at . System is a variation on system and therefore like elements in system bear like references to elements in system except that in system references are followed by the suffix a . Of note however is that in system VMSC is omitted and abstracted into a single SC . This variation was discussed above in relation to and is now shown expressly here in .

Referring now to a method for call routing is depicted in the form of a call flow diagram and indicated generally at . Method is presented for operation in conjunction with system and system can be better understood by the following discussion of method and vice versa. It should be understood however that both system and method can be modified. Method in particular presents a call flow diagram for routing of E911 Traffic. Various processing blocks are identified in within boxes denoted by dotted lines. Those blocks are discussed further below.

For calls relative to block the MSC capable SC will initiate a request to GMLC to provide an ESRK for the Emergency Services Call. The request will include the MSISDN IMSI and CGI or comparable parameters. GMLC allocates an ESRK on the basis of the received CGI or comparable parameter.

For UMA Calls relative block the UNC capable SC initiates a request to GMLC to provide an ESRK for the Emergency Services Call. The request will include the MSISDN IMSI Uncertainty Value and CGI or comparable parameters. GMLC will identify the query as being associated with a UMA call on the basis of the received CGI or comparable parameter. For example the received CGI parameter may be within a prescribed range of values that will identify the query as being associated with a UMA call. Alternatively the query may receive information that is unique to a UMA call such as an IP address or MAC address. GMLC will allocate an ESRK as a function of the received information in the query as follows 

Annex D of J STD 036 Enhanced Wireless 9 1 1 Phase 2 Standard governs one way in which how SC can send the call to ESNE . According to the Standard when SC sends the call to ESNE there are several ways that SC can populate the Signaling System Number 7 SS7 parameters with the ESRK. For example the SS7 parameters are typically populated as follows the destination address the Called Party Number parameter will be populated with 911 11 or 1 may also be used while the ESRK will populate one or more of the Calling Party Number parameter Charge Number parameter or Generic Digits parameter depending on the capabilities of PSAP as well as the availability of other information such as the MSISDN. As another less common example in the Standard the SS7 parameters are populated as follows the Called Party Number parameter is populated with the ESRK while the Calling Party Number parameter is populated with the MSISDN and the other SS7 parameters are populated in the usual manner. The choices that are made regarding populating the SS7 parameters are based on a variety of needs of the specific infrastructure carrying the call including the capabilities of the other elements in the infrastructure including SC ESME ESNE and PSAP as well as the availability of other information such as the MSISDN.

At block ESNE upon receiving an Emergency Services Call will direct the call to the appropriate PSAP PSAP being the exemplary provided in on the basis of the received ESRK. The Emergency Services Call between the MS and PSAP is now connected and the subscriber of MS can speak with the emergency response personnel at PSAP

At block location information for MS is obtained. For non UMA e.g. GSM calls relative to block GMLC initiates a request to the MSC capable SC in order to retrieve location information for MS associated with the Emergency Services Call. GMLC uses the MSISDN and or IMSI previously provided in the request message to the MSC capable SC . In turn MSC capable SC requests the location information from SMLC . Once MSC capable SC receives the location information from SMLC the MSC capable SC provides that location information to GMLC

For UMA calls relative to block in certain configurations GMLC may attempt to triangulate the MS using the procedures described in J STD 036 Enhanced Wireless 9 1 1 Phase 2 for example if the MS is both UMA capable and GSM capable .

At block PSAP via ESME requests location data for MS from GMLC by using the ESRK associated with the Emergency Services Call. GMLC passes along the location information obtained from the SC from block or to ESME . For UMA calls relative to block GMLC may retrieve the street address associated with the location of any known UMA capable BSS e.g. the residential or business address associated with a given subscriber of course assuming that such address is in fact known.

At block during the course of the Emergency Services Call PSAP may invoke additional location retrieval requests via ESME . These location requests are processed by GMLC in substantially the same manner as block .

Referring now to a system for call routing is indicated generally at . System is a variation on system and therefore like elements in system bear like references to elements in system except that in system references are followed by the suffix b . Of note however is that in system the various emergency services elements are omitted and replaced by a single reference to a service provider . System is thus directed to routing of VOIP calls in a generic context non specific to emergency services.

Also of note is that in system is that GMLC is replaced by a location server . Location server is configured to determine the optimal route for a UMA originated call in response to a query from the UNC capable SC . The query can be encoded in various formats. Those skilled in that art will recognize that the query can be encoded in a format consistent with the Customized Applications for Mobile enhanced Logic CAMEL protocol as specified by the 3GPP or Wireless Intelligent Network WIN protocol as specified by the 3GPP2 as well as other variants.

For UMA calls in addition to the called party number location server will receive a CGI or comparable parameter that will identify the query as being associated with an UMA call. For example the received CGI parameter may be within a prescribed range of values that will identify the query as being associated with a UMA call. Alternatively the query may receive information that is unique to a UMA call such as an IP address or MAC address. Location server will allocate a destination address which is a digit string that identifies a termination point that can be accessed via the Public Switched Telephone Network. The Destination Address is typically encoded in E.164 format as prescribed by the International Telecommunication Union ITU The destination address is associated with the service provider as a function of the received information in the query as follows 

Those skilled in the art will recognize that the allocation of the destination address can be made on other attributes including the originating address MSISDN the time of day or day of the week. Those skilled in the art will recognize that the allocation of the destination address can be made by algorithmic means in order to allocate the calls among several terminating numbers associated with Service provider . The response to UNC capable SC will include the destination address of the Service provider

Those skilled in the art will now appreciate that system is an embodiment focused on VOIP technology. It is to be understood that system can be combined wither other embodiments herein that are focused on core mobile network technology to provide a hybrid system that is capable of serving an MS having capable of both core mobile network connectivity and VOIP connectivity.

Referring now to a method for call routing is depicted in the form of a call flow diagram and indicated generally at . Method is presented for operation in conjunction with system and system can be better understood by the following discussion of method and vice versa. It should be understood however that both system and method can be modified. Method in particular presents a call flow diagram for routing UMA calls. Various processing blocks are identified in within boxes denoted by dotted lines. Those blocks are discussed further below.

At block the call is received by the UNC capable SC via BSS . The UNC capable SC will initiate via in this embodiment VMSC a request to location server to provide a destination address for the call. In this exemplary embodiment it is assumed that the UNC capable SC cannot query location server and therefore the UNC capable SC will route the call to VMSC which can query location server . The query can be encoded in various formats. Those skilled in that art will recognize that the query can be encoded in a format consistent with the Customized Applications for Mobile enhanced Logic CAMEL protocol as specified by the 3GPP or Wireless Intelligent Network WIN protocol as specified by the 3GPP2 as well as other variants. The request will include the MSISDN Called Number IMSI Uncertainty Value and CGI or comparable parameters.

In addition to the called party number location server will receive a CGI or comparable parameter that will identify the query as being associated with an UMA call. For example the received CGI parameter may be within a prescribed range of values that will identify the query as being associated with a UMA call. Alternatively the query may receive information that is unique to a UMA call such as an IP address or MAC address. Location server will allocate a destination address associated with service provider as a function of the received information in the query as follows 

Those skilled in the art will recognize that the allocation of the destination address can be made on other attributes including the originating address MSISDN time of day or day of the week. Those skilled in the art will recognize that the allocation of the destination address can be made by algorithmic means in order to allocate the calls among several terminating numbers associated with the Service Provider. The response to the SC will include the destination address of service provider

At block SC upon receiving the response from the Location Server will direct the call to the appropriate service provider on the basis of the received destination address.

Referring now to a system for providing location services is indicated generally at . System is a variation on system and therefore like elements in system bear like references to elements in system except that in system references are followed by the suffix c . Of note however is that where system is directed to call routing system is more principally directed to providing location services though upon providing such location it is possible to effect call routing. Also of note is that unlike system system includes an application server . Application server is source of location requests whereby the location of MS is requested. Application server hosts a location based service that requires location information. An example of such a service includes a restaurant locating service which is configured to locate a restaurant that is near the present location of MS . Application server thus is also connected to a database which includes relevant data to support the location service. Continuing with the exemplary service database would include restaurant listings and locations therefor such listings being accessible by application server

Also of note is that system includes a home location register HLR that connects to VMSC . Those skilled in the art will recognize that HLR is a central database that contains details of each mobile subscriber that is authorized to use the mobile network. For each subscriber that may be identified via an identifier such as an International Station Mobile Identity IMSI or comparable parameter HLR retains subscription information including the MSISDN as well as subscribed features e.g. call forwarding . The VMSC interact with HLR in order to authenticate and register a given Mobile Station such as MS as it is activated.

System also includes at least one Serving GPRS Support Node Gateway GPRS Support Node SGSN GGSN . A Serving GPRS Support Node SGSN delivers data packets from and to the mobile devices within its geographical service area. Its tasks include packet routing and transfer mobility management attach detach and location management logical link management and authentication and charging functions. The location register of the SGSN stores location information e.g. current cell current VLR and user profiles e.g. IMSI address es used in the packet data network of all GPRS users registered with this SGSN. A gateway GPRS support node GGSN acts as an interface between the GPRS backbone network and the external packet data networks radio network and the IP network . It converts the GPRS packets coming from the SGSN into the appropriate packet data protocol PDP format e.g. IP or X.25 and sends them out on the corresponding packet data network. In the other direction PDP addresses of incoming data packets are converted to the address of the destination. The readdressed packets are sent to the responsible SGSN. For this purpose the GGSN stores the current SGSN address of the user and his or her profile in its location register. Those skilled in the art will recognize that comparable IP network nodes associated with comparable mobile network architectures would include Packet Data Serving Nodes PDSN associated with CDMA networks or Access Service Network Gateways associated with WiMAX networks as well as future evolutionary architectural modifications such as the Internet Multimedia Subsystem IMS architecture.

System also includes a Wireless Application Protocol WAP gateway that may optionally be used to relay traffic between a given Mobile Station and the application server via an IP network not shown . A WAP gateway optionally proxies and translates traffic between mobile devices using the WAP or Wireless Markup Language WML protocol and HTTP or comparable IP protocols.

The Serving MSC or UNC SGSN GGSN or WAP Gateway will communicate with the Application Server via an intranet or internet IP based network not shown for the purpose of enabling IP connectivity with the Mobile Station

BSS is substantially the same as one or more of BSS and or as previously described. In general BSS provides radio based connectivity to MS

GMLC for system is configured to respond to location queries received via supported Application Programming Interfaces APIs which in turn are usable by application server . GMLC specifically interacts with the network operator s infrastructure HLR and VMSC in order to retrieve location information with the requested accuracy level. The mechanisms and signalling procedures that are used by GLMC in order to retrieve location information are described in 3GPP TS03.71 and 3GPP TS 09.02.

Referring now to a method for call routing is depicted in the form of a call flow diagram and indicated generally at . Method is presented for operation in conjunction with system and system can be better understood by the following discussion of method and vice versa. It should be understood however that both system and method can be modified. Method in particular presents a call flow diagram for providing location services. Various processing blocks are identified in within boxes denoted by dotted lines. Those blocks are discussed further below. Method assumes that application server runs the exemplary restaurant finder application as previously discussed but it is to be reemphasized that this is merely an example.

At block restaurant finder application server sends a request to GMLC to provide the location of the MS

At block GMLC initiates a request to VMSC in order to retrieve information location about MS . The GMLC will use the MSISDN and or IMSI or comparable previously provided in the request message to the VMSC . In turn VMSC will request the location information from SMLC . Once VMSC receives the location information from SMLC the VMSC will provide that location information to GMLC

At block GMLC will pass along the location information obtained from the VMSC from block to restaurant finder application server

At block restaurant finder application server accesses restaurant location database to locate a restaurant pursuant to the request from MS and the location information obtained at step .

At block restaurant information application server returns the restaurant obtained at block to WAP gateway

Referring now to a system for providing location services is indicated generally at . System is also a variation on foregoing embodiments of system and therefore like elements in system bear like references except that in system references are followed by the suffix d . Of note however is that where system is directed to call routing system like system is more principally directed to providing location services though upon providing such location it is possible to effect call routing. Also of note is that unlike system system includes an application server . Also of note is that where system is direct to core mobile network technologies system is directed to UMA technologies. Application server is a source of location requests whereby the location of MS is requested. Application server hosts a location based service that requires location information. An example of such a service includes a restaurant locating service which is configured to locate a restaurant that is near the present location of MS . Application server thus is also connected to a database which includes relevant data to support the location service. Continuing with the exemplary service database would include restaurant listings and locations therefor such listings being accessible by application server

The Serving MSC or UNC SGSN GGSN or WAP Gateway will communicate with the Application Server via an intranet or internet IP based network not shown for the purpose of enabling IP connectivity with the Mobile Station

As previously discussed system is an embodiment focused on core mobile network technology such as GSM technology whereas system is an embodiment focused on VOIP technology. But it is to be understood that system and system can be combined to provide a hybrid system that is capable of serving an MS having capable of both core mobile network connectivity and VOIP connectivity. Indeed it should be understood that systems can all be modified and or combined to provide desired hybrid functionality.

Referring now to a method for call routing is depicted in the form of a call flow diagram and indicated generally at . Method is presented for operation in conjunction with system and system can be better understood by the following discussion of method and vice versa. It should be understood however that both system and method can be modified. Method in particular presents a call flow diagram for providing location services in a UMA context. Various processing blocks are identified in within boxes denoted by dotted lines. Those blocks are discussed further below. Method assumes that application server runs the exemplary restaurant finder application as previously discussed but it is to be reemphasized that this is merely an example.

At block restaurant server sends a request to location server to provide a location for MS . The request will include the MSISDN and or IMSI or comparable parameter of MS . Restaurant server may also send an indicator in the request that the MS is accessing the network using UMA technologies.

At block if restaurant server does not provide an indication of whether MS is being served from via UMA technologies then location server can be configured to determine if MS is using UMA technologies via a query. Such a query may be sent to HLR using protocols and procedures prescribed by the 3GPP or 3GPP2 such as the Any Time Interrogation or POSREQ query for GSM and CMDA based networks respectively. Note that HLR can interact with the network not shown including SC in order to retrieve the requested information. HLR will respond to the location sever with location and other information that will include a CGI or a comparable parameter.

At location server determines the location of MS based on the received information in the query as follows 

At block location server provides the location information obtained from block to the restaurant finder server

At block restaurant finder server accesses the restaurant location database to locate a restaurant pursuant to the request from MS and the location information obtained at block .

It is to be understood that the various network elements described in relation to system and can be based on known computing or hardware environments. Indeed the structure and features of each network element can and typically do vary as between each other according to the functional specifications of each. However to provide an example shows a block diagram representing exemplary components of GGSN . Such components in in a general sense can also apply to other network elements even though no figures for those elements are shown. GGSN thus includes a processor which interconnects input devices if present e.g. a mouse and keyboard and output devices if present e.g. a display . Again such input device and output devices are optional and can be present to permit a system administrator to perform maintenance operations. Processor is also connected to a persistent storage device . Persistent storage device can be implemented using a hard disc drive or a redundant array of inexpensive discs RAID or the like and or can include other programmable read only memory PROM technology and or can include read only memory ROM technology and or can include a removable smart card and or can comprised combinations of the foregoing.

GGSN also includes at least one network interface that connects processor to the links shown in the Figures as part of a networking pathway between GGSN and the other network elements. GGSN also includes volatile storage which can be implemented as random access memory RAM which can be used to temporarily store applications and data as they are being used by processor . Collectively one can view processor persistent storage and volatile storage device and as a microcomputer. It is now apparent that GGSN can be based on the structure and functionality of a commercial server such as a Sun Fire X4450 Server from Sun Microsystems Inc. of Palo Alto USA but it is to be stressed that this is a purely exemplary server as GGSN and other elements of system and its variants could also be based on any type of server computing device including from other manufacturers.

The microcomputer implemented on GGSN is thus configured to store and execute the requisite BIOS operating system and applications to provide the desired functionality of GGSN including by way of non limiting example the storage and execution of programming to perform the functions described in relation to .

It is to be understood that variations subsets and or combinations of the foregoing are contemplated. For example the embodiments herein can be implemented as a programming instructions stored on a computer readable medium. As another example as previously discussed system is an embodiment focused on core mobile network technology such as GSM technology whereas system is an embodiment focused on VOIP technology. But it is to be understood that system and system can be combined to provide a hybrid system that is capable of serving an MS having capable of both core mobile network connectivity and VOIP connectivity. Indeed it should be understood that systems can all be modified and or combined to provide desired hybrid functionality and that such modifications combinations are at least one advantage provided herein.

