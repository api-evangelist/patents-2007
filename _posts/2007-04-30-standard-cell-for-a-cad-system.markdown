---

title: Standard cell for a CAD system
abstract: In a low power consumption mode in which prior data is retained upon power shutdown, the return speed thereof is increased. While use of an existent data retaining flip-flop may be considered, this is not preferred since it increases area overhead such as enlargement of the size of a cell. A power line for data retention for power shutdown is formed with wirings finer than a usual main power line. Preferably, power lines for a data retention circuit are considered as signal lines and wired by automatic placing and mounting. For this purpose, terminals for the power line for data retention are previously designed by providing the terminals therefor for the cell in the same manner as in the existent signal lines. Additional layout for power lines is no longer necessary for the cell, which enables a decrease in the area and design by an existent placing and routing tool.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07428720&OS=07428720&RS=07428720
owner: Renesas Technology Corp.
number: 07428720
owner_city: Tokyo
owner_country: JP
publication_date: 20070430
---
This application is a continuation of U.S. application Ser. No. 11 320 751 filed Dec. 30 2005 now U.S. Pat. No. 7 217 963 which in turn is a continuation of U.S. application Ser. No. 10 921 854 filed Aug. 20 2004 now U.S. Pat. No. 7 023 058 the entire contents of which are incorporated herein by reference.

The present application claims priority from Japanese application JP 2003 384237 filed on Nov. 13 2003 and Japanese application JP 2004 185475 filed on Jun. 23 2004 the contents of which are hereby incorporated by reference into this application.

The present invention concerns a semiconductor integrated circuit device which is particularly useful when applied to system LSIs or micro processors.

In system LSIs used for a gizmo personal digital assistant PDA hand held device typically represented by mobile telephones there has been an increasing demand for long time operation by a battery of restricted capacity. Particularly in a mobile telephone it is extremely important to reduce the power consumption during a long waiting time a state in which the power source is turned on but processing under high load is not conducted in order to satisfy the requirement for long time operation. One of the methods includes stopping all clocks of the system LSI in the standby mode referred to as a software standby state which is called a standby mode with gating of the system clock distribution . In the software standby state since clocks in the system LSI are stopped upon entering the standby mode the consumption of current by the circuit operation in the system LSI is reduced to substantially zero. Accordingly the standby current in the standby mode consists only of the consumption of current due to leakage current.

However in a case of using an insulated gate type field effect transistor using a modern fine process in the present application the insulated gate type field effect transistor is referred to as a MISFET various kinds of leakage current are extremely large being typically represented by a subthreshold leakage current caused by lowering of the threshold voltage of transistors in accordance with the voltage lowering of the power voltage or gate tunneling leakage current caused by reduction of the thickness of the gate insulation film in a MISFET. Since the standby current consumes power a long waiting time cannot be attained.

With the situations described above a method for effecting shut down of the power for the system LSI during the standby mode referred to as the U standby mode has been proposed by T. Yamada et al. A 133 MHz 170 mW 10 A Standby Application Processor for 3G Cellular Phones . ISSCC 2002 February pp. 370 371 Non Patent Document 1 . In the U standby mode the supply of power is shut down except for circuits of a minimal number required for returning when it enters into the waiting state. As a result not only the consumption of current by the circuit operation but also the consumption of current due to leakage current are reduced substantially to zero and the standby current can be reduced to substantially zero.

Then when both of them are compared in view of the returning time from the standby mode they are as described below. At first in the software standby state since the internal status of the system LSI such as a register value can be retained also in the standby mode it is possible to return from the standby mode by interruption. Accordingly the time required for returning is about equal to the time necessary for restarting the clocks and so it can be returned at high speed. On the contrary in the U standby mode since the internal status of the system LSI is destroyed by the power shutdown it cannot be returned from the standby mode only by interruption and so resetting is necessary for the return to operation. The resetting includes booting of the software necessary for the initialization and operation of the system LSI and needs a long time. Since software booting needs a number of instructions to be conducted the processing time is particularly long. In a the case of returning from the U standby mode the interruption is not conducted for the interruption request as it is but resetting is first applied and then processing corresponding to the interruption request is conducted after booting of the software.

Further as disclosed in S. Mutoh et al. A 1 V Multi Threshold Voltage CMOS DSP with an Efficient Power Management Technique for Mobile Phone Application ISSCC 1996 February pp. 168 169 Non Patent Document 2 and V. Zyuban et al. Low Power Integrates Scan Retention Mechanism ISLPED 2002 August pp. 98 102 Non Patent Document 3 it has been proposed to supply power to a portion of the data retention circuits in the circuit block under power shutdown in the standby mode to retain the data also in the standby mode. Specifically a latch circuit supplied with power even in a standby mode is disposed to the flip flop in the circuit block and it operates to retain the internal data also during power shutdown by the latch circuit thereby enabling a return to the original state at high speed.

The present inventors have studied the data retention circuits as described above and have found that they involve the following considerations. shows the circuit arrangement of a flip flop with data retention in a power down mode as disclosed in Non Patent Document 3. This circuit has a constitution in which power for the main latch part master latch is shut down during the standby mode and data is retained during the standby mode by the sub latch part scan retention latch which is usually supplied with power. The power supply for the main latch part and combinational circuits connected therewith is connected by way of a power switch to an unillustrated virtual power line and it shows the necessity for a virtual power line directly connected with the main latch part and combinational circuits connected therewith in addition to the power line VDD GND . Accordingly it has been found that for the layout of the circuit constitution shown in at least three power lines i.e. VDD VSS and a virtual power line are necessary in a case of providing a power switch on one side of VDD or VSS and at least three power lines have to be laid out for one cell.

This is attributable to the fact that a general system LSI is laid out by arranging standard cells hereinafter simply referred to as cells by automatic placing and routing using CAD. is a view showing a layout for an integrated circuit constituted by placing the cells. However only the cells and the main power lines are illustrated with signal wirings etc. being omitted. The cells are represented by rectangles and . Each cell is mounted with circuits for attaining basic logic such inverters NANDs or the like. A desired logic circuit is obtained by laying out the cells and wiring them to each other. While the scale of the circuits is different depending on the basic logic attained by the cells it is typical to align the cell height direction y and vary the cell width direction x in accordance with the circuit. This is attributable to conducting the layout for main power lines in a mesh like form. That is since power lines to extending in the direction x are placed in the first metal layer substantially at an equal distance relative to each other to supply power necessary for circuit operation the layout for the main power lines and the layout for the cells are aligned.

Under the design environment for the layout even when only a portion of the cells require wirings both for the power line and the virtual power line flip flop such power lines and virtual power lines have to be wired also for other cells not requiring data retention during power shutdown for example an inverter NAND circuit etc. . Accordingly if a power line identical with the virtual power line is further laid out relative to the first metal layer the cell height will be increased and the effect on the entire layout is no longer negligible. On the other hand if it is intended to further layout the main power line while fixing the height of the cell as it is by utilizing the wiring channel for signal lines there may be a worry that the degree of freedom for the signal line is extremely restricted.

As described above no consideration has been given to the layout for retaining data in flip flop cells that are distributed and placed as described above also during power shutdown and for suppressing the overhead of the circuit area under the existent design environment for layout.

In accordance with the present invention notice has been taken of the fact on that the data retention circuit for retaining data during power shutdown requires no such large current supply performance as required for normal operation and it has been determined to supply an operation voltage by a power line that is smaller in size than the usual main power line. Preferably the power line for the data retention circuit is considered as a signal line and is wired upon placing and routing by using CAD. This is adaptable for the CAD assisted design environment for a layout. In this case the power terminals for the data retention circuit are previously disposed to the cell in the same manner as for the usual signal line terminals. This no longer requires an additional layout for the power lines in the cell to enable area saving and in addition design by existent placing and routing tools is enabled.

The returning time from the power shutdown can be shortened drastically and therefor the overhead to the circuit area can be decreased.

By wiring the power line VSS SIG as described above since a layout can be produced by placing and routing by using CAD while replacing existent flip flop cells with nonvolatile FF cells without changing the layout dimension of each of the functional circuits cells such as inverter circuits or NAND circuits the design can be facilitated.

Now the wiring widths in a predetermined wiring layer first metal layer M in the drawing will be compared. Assuming that the wiring width for the main power line is W the wiring width for the power line for data retention VSS SIG is W and the wiring width for a signal line not illustrated wiring connected with the input output terminal of the cell is W a relation W W W is established. Taking the process scattering for the wiring width into consideration a relation W W W W is established.

The reason why the power line for data retention of a nonvolatile FF NVFF can be wired by a method different from that of the existent main power line will be described more specifically. Generally it is necessary that the resistance of the main power line should be lowered in order to maintain the speed of a MISFET constituting a functional block. For this purpose the main power lines are wired in a mesh as shown in . However since it may suffice that the power supplied during the power shutdown state of the nonvolatile FF NVFF may be such that the leakage current during the standby mode can be supplied an increase in the resistance of the wiring gives no significant problem. For example assuming that the size of a MISFET necessary for retaining data of one nonvolatile FF NVFF during standby mode is 1 m by the gate width and that the gate voltage for flowing 1 nA per unit width 1 m at a normal temperature 25 C. of constituting MISFET is 0.15 V the leakage current during the standby mode per one nonvolatile FF NVFF is about 30 pA. Assuming that the rate of the flip flops in a chip is about 4000 N mmand considering a chip of 7 mm 7 mm in size the total number of the all nonvolatile FF NVFF is 196 000 and the leakage current is about 6 A. Even when it is assumed that the number is larger by a factor of 1.5 considering the scattering in the manufacture threshold value variation 100 mV and high temperature 45 C. the leakage current is about 180 A. Since the current only at such a level is necessary the power line for data retention during power shutdown for a nonvolatile FF NVFF does not need the use of a general main power line structure.

However at a high temperature such as 80 C. since the DC current increases there may be a worry of electro migration for fine wirings. Also in such a case since the current necessary for individual cells is still small this can be coped with by enlargement of the wiring width for wiring at the base for branching on the side of the controlled circuit in the standby mode STBYC through which a great amount of current flows or by increasing the number of through holes at the portion. In the layout shown in it can be coped with by increasing the width of the power line existing in the longitudinal direction.

Now connection between each of the circuit elements will be described. shows an example of power shut down from the ground side during the standby mode corresponding to the layout in and this is a circuit diagram also including the control system therefor. It shows a functional block AE put under power shut down control during the standby mode a power switching circuit SW for controlling the power supply to the function block AE and a control circuit in standby mode STBYC for controlling the nonvolatile FF NVFF and the power switching circuit SW of the function block AE. As will be described later in conjunction with a central processing unit CPU hereinafter referred to simply as a CPU a digital signal processor hereinafter referred to simply as a DSP and embedded circuit modules such as an MPEG accelerator are integrated for example in the function block AE. Power is normally supplied to the control circuit in the standby mode STBYC and the power is supplied continuously unless the power is shut down from the outside of the chip. The function block AE has a feature in that logic circuits are integrated and the nonvolatile FF NVFF of the invention is used for the flip flop thereof. In a case where the function block AE is placed under power shut down control the control circuit in the standby mode STBYC conducts shutdown control for the power switching circuit SW by a control signal SW C and controls the nonvolatile FF NVFF by an NVFF control signal group NVCTL. Further the power line for data retention VSS SIG during power shut down for the nonvolatile FF NVFF is also supplied with power from the control circuit in the standby mode STBYC and is connected by way of an optional route to the nonvolatile FF NVFF in the function block AE. The connection may be in the form of a daisy chain or it may be connected in a tree type. It may also be wired freely using a placing and routing method by placing and routing using CAD. In the circuit is drawn such that the power line for data retention VSS SIG is connected from one terminal of the control circuit in standby mode STBYC to all of the nonvolatile FF NVFF but it may be connected from two or more of the terminals of the control circuit in the standby mode STBYC to the nonvolatile FF NVFF. Such a constitution can decrease the number of nonvolatile FF NVFF connected per one terminal of the control circuit in the standby mode STBYC to provide the advantage of lowering the current supply performance required for the power line for data retention VSS SIG. However since it is necessary to previously group the nonvolatile FF NVFF on every terminal in a case of wiring using a placing and routing tool this complicates the layout step.

As described above the invention is applicable for shutting down on any of the low potential side and the high potential side. An example of shutting down the power on the low potential side will be described. That is unless otherwise specified a global grounded power supplied to each of the cells in the chip is provided by a virtual power line VSSM by way of the N type MISFET for power switching from a real grounded VSS and the ground power supplied to the nonvolatile part is provided by a power line VSS SIG. While there is no particular restriction the power shutdown N type MISFET is constituted with a MISFET having a large gate dielectric film thickness and a high threshold voltage for example an I O circuit etc. The subthreshold leakage current flowing through the circuit in the standby mode can be decreased effectively by using this type of N type MISFET which has large threshold voltage and a so called gate tunneling leakage current flowing through the circuit can also be reduced effectively by means of the thick gate dielectric film. In this case the control signal SW C has an amplitude in accordance with a high voltage for an I O for example 3.3 V .

As one of the features the invention has a mechanism of retaining the internal data for a CPU and embedded circuit modules by a nonvolatile FF NVFF present in the modules and desirably it adopts a design method of wiring the power line for data retention to the nonvolatile FF NVFF as a signal line. The difference between the signal power line used for the nonvolatile FF NVFF and a general main power line in view of the apparatus is that since the signal power line is connected ad hoc in the design stage of placing and routing the cells the wiring does not have a neat geometrical pattern and takes a random connection as shown in . It has an advantageous effect of increasing the degree of design freedom due to free wiring by the placing and routing tool and so it is capable of providing an efficient layout.

On the other hand shows an example of using two signals lines RSTR and RESTRb as a data retention control signal group NVCTL of the nonvolatile FF NVFF. The NVFF cell comprises each of input pins for D data input pin CLK clock pin RSTR and RSTRb nonvolatile FF control pin and VSS SIG signal power line input pin and output pins for Q data output pin .

The cell symbols illustrated here are only examples and the cells may be constituted such that the group of output signal lines output inverted signals.

Now a concrete example of the nonvolatile FF will be described. shows a master slave latch flip flop circuit not having a data retention function upon power shutdown. Combinational circuits are connected before and after the master slave latch to constitute a synchronous circuit.

In the circuit shown in a transmission gate TG of the master latch is closed to latch data upon the rising edge of a clock CLK L H while a transmission gate TG of the slave latch opens to output the data taken in the master latch to the output Q. On the other hand at the falling edge of the clock CLK H L the transmission gate TG of the master latch opens while the transmission gate TG of the slave latch is closed to retain the data in the slave latch.

Time T shows a clock rising state during normal operation. At the level of the control signal RSTR LO since the transistors MP and MN are turned OFF and the transistors MP and MN are turned ON in the function of a slave latch is logically identical with that of the circuit in . Therefore the input data is outputted to output Q in accordance with the rising of the clock CLK. In this case since the clocked inverter CINV inserted between the node ND and the node NVb in the nonvolatile circuit NVC is open the level at the node ND is transferred to the nonvolatile circuit NVC and the data is written into the node NV. In this stage however since MP and MN in are OFF the loop which is connecting NV and NVb for the nonvolatile circuit NVC is opened.

Now the operation of the data storing to the nonvolatile circuit NVC of the nonvolatile FF NVFF in the power shut down mode will be described. At time T the control signal RSTR is at first turned to the level HI. In this case the loop of the nonvolatile circuit NVC is closed by the turning ON of the transistors MP and MN. At the same time the clocked inverter CINV is shut down by the turning OFF of the transistors MP and MN by which the route from the slave latch to the nonvolatile circuit NVC is disconnected. In this case the transistors MP and MN are turned OFF while the transistors MP and MN are turned ON by which the level at the NVb is fed back from the nonvolatile circuit NVC instead of the level at the node ND in the slave latch. Since the transmission gate TG in the master latch is closed if the input value at the input node D becomes the intermediate level there is no current flow in the powered circuit generally.

Then power shutdown control is conducted at T. It is assumed here that the power on the ground side is shut down by the N type MISFET. The PSWGATE signal which corresponds to the control signal SW C controls power switching by asserting LO. In a case of a using thick gate oxide MISFET which often is used in I O circuitry for example the voltage amplitude of the PSWGATE is the same as that of the I O circuit for example 3.3 V . By such control the virtual power line VSSM is shut down from the actual ground and the potential of the virtual power line VSSM is caused to rise toward a high potential side VDD by the leakage current of the internal circuit. While the example of shows just an intermediate level between VDD and 0 V it actually rises to a level infinitely nearer to VDD due to conditions such as the scale of the circuits to be integrated the temperature and the MISFET threshold voltage. Accordingly the usual circuit can no longer retain the data.

The time interval between the times T and T has to be decided by taking into account the time which the whole data of the nonvolatile FFs in the chip evacuate their own NVC. Therefore a method may be considered for example of using a driver having a small driving capability for driving the RSTR signal line measuring the time until the driver output level exceeds a certain threshold value and starting power shut down control after waiting for a period several times as long as the measured time.

When power shut down control is conducted the potential for the virtual power line VSSM increases and other retained data than in the nonvolatile circuit NVC disappears. Also in this case since the power for the nonvolatile circuit NVC and the inverter INV inputted with the control signal RSTR is supplied by the power line for data retention VSS SIG the internal node NV of the nonvolatile circuit NVC can retain a desired value.

On the other hand in the power on control the PSWGATE signal is driven to the level HI at time T. Then the potential on the virtual power line VSSM is gradually driven to 0 V and the master slave latch is put into a state capable of retaining data. The data from the nonvolatile circuit NVC is at first written back by way of the transistors MP and MN to the slave latch. Since the control signal RSTR is HI level VDD and the inversion signal thereof is also kept at Lo level 0 V by INV the data of the nonvolatile circuit NVC is undisturbed during the operation of the master slave latch in the power on sequence. In the standby mode since the power for the driving circuit of the clock signal CLK is also shut down the LO level of the clock CLK cannot be kept exactly at the ground level 0 V . However it is no problem that the clock signal is controlled such that the level LO is rapidly outputted after the application of power.

After complete the turning ON of the power switch the control signal RSTR is dropped to LO at time T after confirming that the potential for the vertical ground line VSSM has been dropped to 0 V. Thus the transistors MP and MN in are turned OFF and therefore the feedback loop from the nonvolatile circuit NVC is opened. At the same time the transistors MP and MN are turned ON to establish a feedback loop from the node ND. Further the transistors MP and MN are turned ON to form a signal path from the slave latch to the nonvolatile circuit NVC and the transistors MP and MN are turned OFF to open the loop of the latch in the nonvolatile circuit NVC. Thus the nonvolatile master slave latch in can perform the normal function in the usual operation. That is the normal operation of the master slave latch of capturing data at the rising edge of the clock as shown at time T T is attained.

With the constitution described above a data retention mechanism in the power shutdown state is provided without substantial degradation of the characteristics of the conventional master slave latch. Therefore data retention in the power shutdown state can be obtained easily and at reduced cost in case of applying this nonvolatile master slave latch to a system LSI.

In the control signal RSTR generates an inverted signal by way of the inverter INV at the inside of the nonvolatile FF NVFF. This is because the OFF operation of the clocked inverter and the latch formation of the nonvolatile circuit NVC cannot be conducted effectively in a case where a large difference is present for the arrival time between the RSTR signal and the inverted signal thereof with the result that this causes destruction of data. As in this constitution in a case where the inverted signal for the RSTR signal is generated in the nonvolatile FF NVFF therefore the difference of the arrival time between these two signals can be minimized and the problem described above is overcome. Further since the number of the pins is smaller compared with the constitution in which both the control signal RSTR and its inverted signal are received it also provides the effect of decreasing the number of wirings for routing thereby facilitating the wiring.

Now the operation of storing the data by the nonvolatile circuit NVC in the nonvolatile FF NVFF when the power shut down is conducted will be described. At time T the RSTR signal is at first put to the level HI. In this case the loop of the nonvolatile circuit NVC shown in is closed by the turning ON of the transistors MP and MN and the path of the clocked inverters CINV and CINV between the slave latch and the nonvolatile circuit NVC to the ground level is shut down by the turning OFF of transistors MN and MN. In this case since the transistor MN is turned ON and the transistor MP is turned OFF the path of the slave latch to the high potential side power line in the usual operation is disconnected and the current path of the driver MN for feedback on the ground side of MN is formed such that feedback from the nonvolatile circuit NVC can be inputted. Then when the RSTRb signal is put to the level LO at time T switching MISFETs MP and MP on the high potential side power line for the clocked inverters CINV and CINV are shut down to isolate the slave latch and the nonvolatile circuit NVC. At the same time the transistor MP is turned ON and the transistor MN is turned OFF by which the feedback loop for the slave latch in the normal operation is opened and the feedback loop from the nonvolatile circuit NVC is completely closed. Thus even when each node of the slave latch takes any value during normal operation this has no effect on the nonvolatile circuit NVC. Since the transmission gate TG of the master latch is closed in this case there is no effect when the defined value for the input D may be changed. Further it is necessary for the time interval between T and T that it allows the RSTR signal to reach the level HI in the entire chip. This can be attained by using a driver of small driving capability as the driver for driving the RSTR signal measuring the time until the output of the driver reaches a predetermined threshold value or higher and putting the RSTRb signal to the level LO after a period several times as long as the measured time. This is because the wiring route is generally different between the RSTR signal and the RSTRb signal and the difference of delay between these two signals cannot be assured on the premise of using the placing and routing tool. In a case where each of the RSTR signal and the RSTRb signal reaches an identical cell at an identical delay that is where wirings can be conducted in a substantially equal path the interval between times T and T may also be controlled depending on the level of the RSTR signal returned to the control circuit in standby mode STBYC by providing a route for turning the RSTR signal from a predetermined position of the RSTR signal line to the control circuit in standby mode STBYC.

Then power shut down control is conducted at time T like that in . A case of shut down for the ground power line by the N type MISFET is assumed. For this purpose control for putting the control signal PSWGATE SW C of the N type MISFET to the level LO is conducted.

When power shutdown control is conducted the potential of the virtual power line VSSM increases and retention data other than in the nonvolatile circuit NVC is eliminated. Since the power for the nonvolatile circuit NVC is supplied by the power line for data retention VSS SIG the internal node NV of the nonvolatile circuit NVC continues to hold a valid value.

On the other hand in case of a power on sequence the PSWGATE signal is driven to the level HI at time T. Then the level of the virtual power line VSSM is gradually driven to 0V and the master slave latch can hold data. The data from the nonvolatile circuit NVC is written back to the slave latch by way of MP and MN. Since the RSTR signal is at HI level VDD and the RSTRb signal is also at Lo level 0 V the data of the nonvolatile circuit NVC is undisturbed during the operation of the master slave latch in the power on sequence. Also in this case as described with reference to since the power for the driving circuit of the clock signal CLK is also shut down the LO level of the clock CLK cannot be kept exactly at the ground level 0 V . However it is no problem that the clock signal is controlled such that the level LO is rapidly outputted after the application of power.

Then after confirming that the power switch has been turned completely to ON and the potential of the virtual power line VSSM is put to 0 V the RSTR signal is put to LO at time T. Thus the transistor MN in is turned OFF the current path on the ground side of the feedback loop from the nonvolatile circuit NVC is shut down and the transistor MP is turned ON to form a high potential side current path for the feedback loop of the slave latch in a normal operation. At the same time the transistors MP and MP are turned ON to form a high potential side current path in the signal loop from the slave latch to the nonvolatile circuit NVC and the transistors MN and MN are turned OFF by which the loop for the latch in the nonvolatile circuit NVC is opened.

Then when the RSTRb signal is put to the level HI at the time T switching transistors MN and MN on the low potential side of the clocked inverters CINV and CINV are turned ON to connect the slave latch with the nonvolatile circuit NVC the transistor MP is turned OFF and the transistor MN is turned ON to completely close the feedback loop of the slave latch and open the feedback loop from the nonvolatile circuit NVC. Subsequently the invented nonvolatile master slave latch works as a normal Master Slave latch.

Further it is necessary that the time interval between the times T and T is long enough to allow the RSTR signal transmitted to the entire chip to reach the level LO. To realize this control there is one method for example of using a driver having a small driving capability to drive the RSTR signal to LO measuring the period until the driver output decreases to a certain threshold level or lower and putting the RSTRb signal to the level HI after the period several times as long as the measured time.

At the rising edge of the clock signal CLK CLK L H the transmission gate TG of the master latch is closed to latch the data and the transmission gate TG of the slave latch is opened to output the data taken into the master latch to the output Q. On the other hand at the falling edge of the clock signal CLK CLK H L the transmission gate TG of the master latch is opened and the transmission gate TG of the slave latch is closed to retain the data in the slave latch. In the series of clock operations the scan output signal SO changes in synchronization with the clock signal depending on the value of the scan input signal SI where the SE signal is at HI whereas it always outputs LO even when the value for the data input signal takes any value where the SE signal is at LO. Further the basic operation is identical with that in and quite the same operation is attained so long as the SE signal is at LO.

Further when the data taking route to the nonvolatile circuit NVC is changed from the node ND to the node ND the load on the DQ pass can be reduced to provide an effect of increasing the speed. In this case as shown in it is necessary to put the SE signal to the level HI at the time T before putting the RSTR signal to the level HI for reflecting the data of the slave latch on the NOR output. Then the SE signal is desirably put to LO before the RSTR signal is put to the level LO. shows a control example where the SE signal is put to the level LO at time T before the RSTR signal is put to level LO time T . In this case the data is reflected to the master slave latch in the next stage through a normal pass data pass . In a case where the setting of the data through a scan pass is more effective control for putting the SE signal to LO may be conducted after the RSTR signal has been put to the level LO.

Although not illustrated the scan function can be applied also in a case of control by the complementary signal due to the RSTR signal and the RSTRb signal as in . In this case the scanning circuit as described above may be added to the part for the input D and the part for the output Q.

While to show constitutional examples of the master slave latch the invention is applicable also to latch circuits having other forms. is an example of a pulsed latch circuit. The pulsed latch circuit is a circuit in which a clock signal CLK and a delayed clock signal formed from passing the clock signal CLK through a delay circuit comprising three stages of inverters are inputted to an NAND circuit thereby generating a pulse upon rising of the clock signal opening the transmission gate TG by using the pulse CLKI and the inverted pulse CLKIb inverted through the inverters and transmitting the input D to the output Qb in the succeeding stage. Since the transmission gate TG is closed upon completion of the pulse the pulsed latch circuit retains the data taken in the latch comprising the two stages of inverters disposed to the node ND.

A constitutional example of applying the nonvolatile data retention function to a pulsed latch circuit is shown in and . shows a first constitutional example. This is different from the constitution shown in at first in that the data is retained in the latch LT for data retention also during the power shutdown state by supplying the power from the power line for data retention VSS SIG and further by the fact that the pulse generator is constituted as an illustrated AND NOR type circuit for controlling the pulse generator by the control signal RSTR and by the fact that the power line for data retention VSS SIG is used at least for the low potential power on the side of NOR and the power line for data retention VSS SIG is used for the low potential side power of the inverter that drives the pulse CLK. In the example of the output Q is adapted as positive logic by providing an inverter to the input D. While this causes a delay for one stage of the logic gate the positive logic can be transmitted to the succeeding stage and further more stable operation is possible for the fluctuation of the input data. For example it provides high immunity for input signal fluctuation even when the input D is at a higher potential than the high potential side power VDD due to noise. In this case without this inverter since the source gate voltage difference of the transmission gate TG which should normally be in the OFF state exceeds its threshold voltage an invalid signal can be transferred to the succeeding stage. A constitution in which the input D is outputted after inversion as shown in without provision of the inverter is also possible. By using the power line for data retention VSS SIG for the low potential side power of the driver NOR for driving the transmission gate TG and INV since the power can be applied also during power shut down it provides an effect capable of exact control. In this constitution since the control signal can be constituted only with the RSTR signal it provides an effect of facilitating the placing and routing by using CAD.

Now a description will be made of the operation of conducting power shut down and retaining data in the nonvolatile circuit NVC. At time T the RSTR signal is at first put to the level HI. Then NOR gate NOR outputs the level LO irrespective of the level of the pulse NDCKI.

Subsequently power shut down control is conducted at time T. Like the example in it is assumed herein that the potential of the virtual power line VSSM rises to a higher potential due to a leakage current in the internal circuit under the control of putting the PSWGATE signal to LO. The interval between the times T and T is set as a time sufficient to retract whole data of the nonvolatile FF NVFF in the chip. The timing control can be conducted by the same method as the timing control disclosed with reference to .

When power shutdown control is conducted the potential of the virtual power line VSSM increases and other retained data than in the nonvolatile circuit NVC is eliminated. On the other hand since the power for the nonvolatile circuit NVC is supplied from the power line for data retention VSS SIG the node NV in the nonvolatile circuit NVC can be retained continuously at a desired value.

Next power on sequence by turning on the power switch will be described. In this case the PSWGATE signal is driven to the level HI at time T. Then the level for the virtual power line VSSM is gradually driven to 0 V and the data is transferred from the nonvolatile circuit NVC to the output Q. Since the power supply for the driving circuits of the clock signal CLK is also shut down the level LO for the clock signal CLK cannot be kept exactly at the ground level 0 V . However it is desired to control the clock signal CLK so as to rapidly output the level LO after the power is supplied.

Subsequently after confirming that the power switch has been turned ON completely and the level of the virtual power line VSSM has been put to 0 V the RSTR signal is put to LO at time T. Thus the NOR gate NOR outputs under inversion the NDCK as it is. Since it is necessary for a sufficient interval between times T and T to completely turn ON the power switch it can be controlled by using for example an acknowledge signal from a power switch controller. Then the normal operation of the pulsed latch circuit of intaking data at the rising edge of the clock as shown at time T and T can be attained.

This can provide a data retention mechanism upon power shut down without substantial deterioration for the characteristics of the pulsed latch circuit and this can provide the advantage of data retention upon power shut down at a reduced cost by the application of the pulsed latch circuit to the system LSI.

Although not illustrated the scan function may be attained also by replacing the selector circuit capable of selecting the scan input SI and the usual data input D by the SE signal as shown in with the input part shown in or FIG. B and further by applying an additional circuit outputting the output Q and the scan output SO as shown in in the output part in or .

Now description will be made of a case in which power shutdown is conducted. At first the clock signal CLKC is put to the level LO such that the data of the input D of the sense amplifier based flip flop circuit is not captured. The control signal CLKB is put to the level HI at time T to intake the level data at the node Qb to the nonvolatile circuit NVC and then the control signal CLKB is put to the level LO. This electrically disconnects the nonvolatile circuit NVC from the flip flop main body. Also in this case the control signal CLKA is controlled to the level LO. Then the control signal RSTR is put to the level HI and the control signal RSTRb is put to the level LO for providing a feedback route from the nonvolatile circuit NVC at time T. This state means that the electrical route of the node Q and the node Qb to the ground is controlled by the feedback route from the nonvolatile circuit NVC. While shows an example of controlling the control signal RSTR and the control signal RSTRb substantially simultaneously the control order of asserting these control signals has no particular restriction. This is because the data necessary for the nonvolatile circuit NVC has already been retained. Further as shown in and it is possible to be controlled by two signal lines from the outside or the RSTRb signal may be generated in the flip flop by using an inverter circuit.

Subsequently power shutdown control is conducted at time T. Like the example in it is assumed that the potential of the virtual power line VSSM rises toward the high potential side due to the leakage current in the internal circuit by the control of putting the PSWGATE signal to LO. A sufficient period is set for the internal operation between times T and T sufficient to retract the data of the nonvolatile FF in the chip. The timing control can be conducted by the same method as the control used for .

When the power shutdown control is conducted the potential for the virtual power line VSSM rises and other retention data than in the nonvolatile circuit NVC are eliminated. In this case since the power for the nonvolatile circuit NVC and the control signal CLKB is supplied from data retention circuit VSS SIG the internal nodes SO and SOb in the nonvolatile circuit NVC can be retained continuously at a desired value.

On the other hand in the power on state the PSWGATE signal is driven to the level HI at time T firstly. As a result the potential of the virtual power line VSSM is gradually driven to 0 V and the data is transferred from the nonvolatile circuit NVC to the output Q. Further since the power is shut down also for the driving circuit of the clock signal the LO level for the clock signal CLKC cannot be kept exactly at the ground level 0 V . However it is desired to control the clock CLKC such that the level LO is outputted rapidly after the re supplying of the power.

Then after confirming that the power switch has been turned ON completely and therefore that the potential of the virtual power line VSSM has been driven to 0 V the control signal CLKA is put to the level HI at time T. Since the data in the nonvolatile circuit NVC is written back to the nodes Q and Qb the output is determined. After putting the control signal CLKA to the level LO the RSTR signal is put to the level LO and the RSTRb signal is put to the level HI at time T. The state where the RSTR signal is at LO and the RSTRb signal is at HI indicates that scan inputs and are selected upon writing to the nodes Q and Qb. Therefore it is possible that these signals are controlled as follows the RSTR signal is put to LO and the RSTRb signal is put to HI for the case of scanning and the RSTR signal is put to HI and the RSTRb signal is put to LO in other cases. A sufficient period is necessary for the interval between times T and T sufficient to turn ON the power switch completely. For this purpose control may be conducted by using for example an acknowledge signal from the power switching controller.

Subsequently the normal operation of the conventional sense amplifier based flip flop which captures the data at the rising edge of the clock as shown in time T T is attained.

This constitution provides a data retention mechanism during power shut down without substantial deterioration of the characteristics of the sense amplifier based flip flop and provides the advantage of attaining data retention during power shut down at a reduced cost by applying the sense amplifier based flip flop to a system LSI.

While the two modified examples show the case of control by the RSTR signal and the RSTRb signal control may be conducted by an independent signal line separately from the signals. In this case an independent signal line is added by the number of one in a cell image shown in . In a case of control by the independent control line although the number of pins is increased since the current can be controlled independently of the RSTR signal the power can be shut down on the side of the power line for data retention VSS SIG and can be kept at a substantially high impedance state during operation. This provides an effect capable of attaining further reduced power consumption.

Further in accordance with the invention an increase in the speed and a reduction in the power consumption can be attained further by using two kinds or more of transistors. shows a modified example of a master slave latch as shown in . The constitutional example has a feature in using a MISFET having a low threshold voltage for a master slave latch that operates during normal operation and a logic gate LVTINV and a transmission gate LVTTMG using the same low threshold voltage MISFETs. This can increase the speed of the normal operation. On the other hand for the circuits necessary during the standby mode the leakage current can be suppressed by using a MISFET having a high threshold voltage and a logic gate HVTINV and a transmission gate HVTTMG which consist of high threshold voltage MISFETs. Further in a case where the gate dielectric film thickness of a MISFET constituting a circuit necessary in the standby mode INV CINV NVC is made thicker it also provides an effect capable of saving the gate leakage current.

In this case it is desired that the selection of the gate dielectric film thickness is based on that of a SRAM. It is expected that gate leakage currents for the memory cell in a SRAM will result in problems in the future. For example in a case where the EOT equivalent gate dielectric thickness for the MISFET used in the core is about 1.5 nm the gate leakage current flowing through the SRAM can be decreased drastically by increasing the thickness of the dielectric film of the SRAM gate to about 2.0 nm to 2.2 nm by EOT. This is because the gate leakage current decreases by one digit on every increase in the thickness of 0.2 nm for EOT. In view of the above in a system LSI fabricated by a multi gate insulative film process multi TOX process which realizes such a SRAM when the data retention part INV CINV NVC of a nonvolatile FF is constituted by using a MISFET having large thickness such as used for a SRAM memory cell the nonvolatile FF with less leakage can be attained advantageously without additional process steps.

Such a modification is applicable also to a pulsed latch circuit as shown in or the sense amplifier based flip flop circuit as shown in . Also in this case a MISFET of low threshold voltage may be used in circuits other than a storage element for data retention SEC or the gate dielectric thickness of the transistor of the storage element for data retention SEC may be made identical with that of a SRAM.

In a case of shut down of the power line for data retention VSS SIG the capacitance element may be disposed so as to avoid coupling to the virtual power line VDDM wired in the cell.

For explaining the wiring structure of the transistors in the cell two inverters are shown in the drawing. One of them is a normal inverter which is supplied with power from the virtual power line VSSM. This inverter has an input terminal i and an output terminal o. The other of them is a nonvolatile inverter which is supplied with power by using a power line for data retention VSS SIG. This inverter has an input terminal i and an output terminal o. The normal inverter is connected from the power supply metal M in which two power sources VDD and VSSM are wired in the cell by way of an M wiring layer to a diffusion layer L . This corresponds to the view seen along line A A in the figure and a cross sectional view thereof is shown in . As is apparent from the figure the two power sources are connected with power wiring. The drawing shows an example of leading from the second metal M and the substrate power supply is used in common with the normal inverter and the nonvolatile inverter. While the substrate power sources can be constituted separately for the normal inverter and the nonvolatile inverter this needs well isolation for the isolation of the substrate power sources to lower the area efficiency.

The cross sectional structure will be described simply. This example consists of a triple well structure in which an N type well DNW is prepared to a deep depth on a P type substrate PSUB on which a P type well PW for forming an N type MISFET and an N type well NW for forming a P type MISFET are formed. In a case of adopting such a substrate structure it is possible for a substrate bias control to control the substrate potential thereby decreasing the leakage current. When the substrate bias control is used the absolute value of the threshold voltage is effectively increased. Therefore the leakage current can be decreased by controlling the substrate voltage lower than the source voltage of the N type MISFET in a case of the N type MISFET and by controlling the substrate voltage higher than the power source voltage of the P type MISFET in a case of the P type MISFET. Also in accordance with the invention the power consumption can be further reduced by conducting such substrate bias control during the standby mode. Although not illustrated it is also applicable to a so called double well structure not provided with the N well DNW.

The output O is connected to metal wirings M and M by way of via holes after connecting the diffusion layers of the P type MISFET and the N type MISFET together. This corresponds to the view seen along line B B in and the cross section is shown in .

On the other hand the nonvolatile inverter has a feature in that the power source on the side of VDD is connected from the VDD power wiring by way of metal layer M and the ground side is wired from the pin of VSS SIG which situated about at the center of the cell height. This connection corresponds to the view seen along line C C in the and the cross section is shown in . As apparent from the drawing the source of the N type MISFET is not connected with the virtual power line VSSM. The output O is connected by way of the via hole VIA to the metal wirings M and M after connecting both of the diffusion layers of the P type MISFET and N type MISFET together. This corresponds to the view seen along line D D in and the cross sectional view is shown in .

Further shows an example in which power line MW to power line MW at the second metal layer for power reinforcing are laid out in the longitudinal direction. In the drawing there are three power lines power line VDD and VSS and virtual power line VSSM as a group of power main lines extending in the direction Y of the drawing referred to as group of longitudinal main line but they are not restricted to three. Further in an actual layout various power supply lines can be laid out using multiple layers or such power supply lines can be laid out only with one wiring layer for example M layer .

In placing and routing by using a CAD layout is facilitated by the constitution of arranging by using cells CEL in which only the longitudinal main lines are laid out each at an equal interval. Generally MISFETs are not prepared but only the power wirings are laid out in the cells CEL.

In a case where the control signal NVCTL of a number of nonvolatile FF are driven only by a single driver of the control circuit in the standby mode CTBYC the driving force cannot sometimes be obtained sufficiently. In this case a repeater cell is advantageously disposed in the cell CEL. Since the power line VSS which is always supplied with power can be wired in the cell CEL it is possible to dispose a driver capable of operating also in the standby mode. For the layout of the driver wiring may be conducted as the wiring of the nonvolatile inverter on the source of NMOS in the layout of .

The system LSI has a first region AE a second region AE and a third region AE as regions capable of controlling the power supply independently. The first region AE comprises a processor CPU embedded circuit modules IP and IP a system bus SYSBUS and a clock generator CPG. The power supply of this region is controlled by a power switch SW. It is preferable that all flip flops or latches in the first region AE are constituted with a nonvolatile FF. But it is also possible to constitute only a minimal number of the flip flops or latches necessary for retaining the status with the nonvolatile FF. The second region AE contains a built in user memory URAM. The power supply of this region is controlled by a power switch SW. Finally the third region AE contains a control circuit for standby mode STBYC. This region is always supplied with power so long as power is supplied to the system LSI. In this case the power switches SW and SW are supposed to be put between the ground potential VSS and the virtual ground potential VSSM for each of the regions. But of course they may be put between the power supply VDD and virtual power supply VDDM for each of the regions. Particularly in a case of providing a voltage regulator the voltage regulator can also be used in place of the power switch. Further it may be disposed both between the ground potential VSS and the virtual ground potential for each of the regions and between the power supply VDD and the virtual power supply VDDM for each of the regions.

The CPU controls the entire system LSI. The embedded circuit module IP is not necessary when the CPU fetches the instruction for example an accelerator for MPEG. The embedded circuit module IP is necessary when the CPU fetches the instruction for example a bus state controller. The system bus SYSBUS is connected with each of the circuit modules including the CPU and it includes a not illustrated data bus and address bus. The clock generator CPG receives the clock signal RCLK and generates an internal clock signal ICLK. The internal clock signal ICLK is supplied to each of the circuit modules and the system LSI operates in accordance with the internal clock signal ICLK. The built in user memory URAM has a large capacity and retains necessary data such as data under processing. In the constitutional example of each of the circuit modules contained in the first region AE is collectively arranged and each of the circuit modules contained in the second region AE is collectively arranged. With such an arrangement since the power switches SW and SW can be provided in common with plural circuit modules the area can be decreased. Further in the embedded circuit modules disposed in the first region AE can also be arranged in different regions independently for enabling power shutdown relative to each other. In this case since the power shut down control can be conducted on every module if they are not in use power shut down for the embedded circuit modules not in operation can be conducted even during operation of the CPU to provide an effect capable of saving the leakage current during operation.

In the standby mode utilizing the nonvolatile FF of the invention referred to as first standby mode STBY the power switch SW is put to the off state and the power switch SW is kept in the ON state. Since this shuts down the power supply to the processor CPU the embedded modules IP and IP and the clock pulse generator CPG the current consumption can be decreased. Also in this case since the power can be supplied to all of the nonvolatile FF in the first region AE the data can be retained continuously.

The transition operation will be described. The internal data in the first region AE is retained by the nonvolatile FF. Further cash data etc. are retracted to the built in user memory URAM as required. The nonvolatile FF is supplied with power and the control signal by the control circuit in the standby mode STBYC in the third region AE. Then the power switch control signal SW C puts the power switch SW to the OFF state to stop the supply of current to each of the circuit modules contained in the first region AE. Since the main power switch SW is kept ON current is supplied to the circuit modules to the nonvolatile FF in the first region AE and the circuit modules in the second region AE and the internal data of the system LSI is retained. Thus the interruption upon returning from the first standby mode can be conducted by returning the data of the nonvolatile FF or the data retained in the internal built in user memory URAM to a predetermined circuit in the first region AE by the interruption request from the outside. In a case where the interrupt request is given the control circuit in the standby mode STBYC turns the power switch SW to ON as explained for example with reference to and . After the power is supplied to the first region AE the data retained in the nonvolatile circuit NVC of the nonvolatile FF is reflected to the output of the nonvolatile FF. Therefore all states of the random logic of the first region AE are recovered to the state before power shutdown. In a case where the data retracted to the built in user memory URAM is present the retracted internal data of the system LSI is returned to the first region AE.

Since the operation is conducted in a shorter time compared with the resetting sequence which requires booting of software such as an OS it can be returned at a higher speed compared with U standby losing internal data where the internal data is eliminated. While a description has been made with respect to an example in which the internal data is retracted to the build in user memory URAM it can also be retracted to an external memory.

Further in the system LSI another standby mode for example an existent software standby refer to as second standby mode STBY or U standby refer to as third standby mode STBY mode can be used together. This can set a low current mode flexibly depending on the state of the system LSI being used. shows a table for each of the modes.

The first standby mode STBY is a state where the power for the first region AE is shut down and power is supplied but the clock is stopped in the second region AE. Since the internal data in the first region AE can be retained by the nonvolatile FF the internal data is retained and can be returned by an external interrupt. Accordingly for the returning time only the time up to the restarting of the clock which is done in parallel with the operation time of the power switch may be taken into consideration and it can be returned in about several hundred seconds. Transition to the first standby mode can be attained by setting a mode setting register STBCR of the control circuit in the standby mode STBYC. In the first standby mode since the power for most of the circuits in the first region AE is shut down by the power switch the current consumption is suppressed to about 100 A.

In the second standby mode STBY while the power is supplied to all of the first region AE the second region AE and the third region AE distribution of the clock signal to the first region AE and the second region AE is stopped. Accordingly since the circuit modules in the first region AE and the second region AE are not operated the system can stand by with a consumption power of about the transistor leakage current. Also in this case since the internal data can be retained continuously the internal data is nonvolatile. Further for the returning time since returning can be conducted by the interruption processing described above it may be only about the time for restarting the clock and it can be returned in about several hundred seconds. The transition to this mode can also be attained by setting the mode setting register STBCR of the control circuit in the standby mode STBYC.

The third standby mode STBY is a mode for shutting down the power for all regions other than the third region AE and while the consumption current is about 10 A since the internal data is evaporated it can be returned only by resetting and it needs about several hundred milliseconds for returning. The transition to this mode can also be attained by setting the mode setting register STBCR of the control circuit in the standby mode STBYC.

As can be seen from the table in since the first standby mode STBY and the second standby mode STBY are different only with respect to the current consumption the first standby mode and the second standby mode can be collected into one low current mode. Further power and clock signals are supplied to all of the first region AE the second region AE and the third region AE during normal operation and supply of the power is shut down to all of the circuits upon turning OFF of the power.

Various combinations of mode shown are possible herein for the standby mode. In this case the constitution of the system LSI is also modified to such an extent as necessary for the combination. For example in a system LSI not having a third standby mode the second region AE in is eliminated and the circuit module in the second region AE is disposed in the third region AE. Further instead of the power switch in the system LSI the power may also be shut down by a power control circuit external to the system LSI. Further instead of controlling all nonvolatile FF in the first region AE with one control circuit in the standby mode STBYC a standby control circuit may also be provided on every module.

The normal operation mode transits to the third standby mode STBY by setting the register STGCR. Conversely the third standby mode STBY returns to the normal operation mode by resetting. The third standby mode STBY transits to the power off mode by turning OFF the power.

The normal operation mode transits to the first standby mode STBY by setting the register STBCR. Conversely the first standby mode STBY transits to the normal operation mode by external interruption or resetting. The first standby mode STBY transits to the power OFF mode by turning OFF the power.

The normal operation mode transits to the second standby mode STBY by setting the register STBCR. Conversely the second standby mode STBY transits to the normal operation mode by external interruption or resetting. The second standby mode STBY transits to the power OFF mode by turning OFF the power.

The control circuit in the standby mode STBYC has a standby mode control register STBCR and a boot address register BAR as registers capable of reading and writing from and to the system bus SYSBUS. Reading and writing from the system bus SYSBUS are controlled by a decoder. The standby mode control register STBCR retains a value corresponding to the current standby mode. Further writing from the system bus STSBUS to the standby mode control register STBCR forms a transition request to each of the corresponding low current modes. In this example the control circuit in the standby mode STBYC is constituted so as to control transition to the first standby mode the second standby mode and the third standby mode or for returning from each of the modes. Further transition to or returning from the first standby mode can be conducted also by directly sending a clock stop command from the CPU to the clock pulse generator CPG.

Upon returning from the second standby mode and releasing a reset state the boot address register BAR retains the address of the instruction that the CPU should execute first. In this example the transition request to the second standby mode is given by writing to the standby mode control register STBCR but the transition can be requested also by using a special command such as sleep or standby or a combination of the standby mode control register STBCR and the special instruction. In this case the CPU can instruct by sending the transition request by way of an acknowledge signal for a sleep request which is not illustrated here to the control circuit in the standby mode STBYC.

A synchronizer SYNC included in the control circuit for the standby mode STBYC synchronizes the interrupt request IRQ from the outside of the chip with the external clock signal RCLK. A current mode control sequence circuit STBYC FSM judges the necessity for the transition and return of the standby mode and outputs the sequence for transition and return as required. The input is a value of the standby mode register SBCR the interrupt request IRQ the status register STATE indicative of the step under execution in the sequence during transition and return and the output is an output of the control circuit in the standby mode STBYC and a second standby mode signal STBY MODE that indicates whether the current state is the second standby mode or not.

Upon returning from the second standby mode when receiving the interrupt request signal IRQ from the outside it is necessary to conduct an interruption corresponding to the interrupt request signal IRQ after returning the data retracted to the built in user memory URAM or the external memory to each of the circuit modules in the first region AE. The interruption is conducted by executing a predetermined instruction. Accordingly upon returning from the second standby mode it is necessary to retain the address of the memory which stores an instruction to be conducted at first after returning. Thus the boot address register BAR is disposed for retaining the address of the memory storing an instruction to be executed at first upon returning from the second standby mode and an execution starting address is set to the boot address register BAR upon transition to the second standby mode. It is also possible to set the execution starting address upon returning from the second standby mode so that it is always identical. In this case it is possible to constitute with a hard wired structure while saving setting of the execution address upon transition to the second standby mode. According to the constitution shown in a software designer can freely set the execution start address after a return by the provision of the boot address BAR and can locate the program necessary for the return of the second standby mode at an optional position in a memory space.

On the contrary since the return from the third standby mode always involves a resetting the boot address INIT VEC is executed at first. In the constitution of a selector SELL is provided a second standby mode signal STBY MODE is outputted from the current mode control sequence circuit STBYC FSM to select either the address stored in the boot address register BAR or the boot address INIT VEC upon normal resetting for the first address for beginning the process when the CPU resumes. This can attain the function of outputting the boot address INIT VEC upon resetting for returning from the third standby mode and executing the instruction from the address retained in the boot address register BAR only upon returning from the second standby mode. In the return from the first standby mode after starting the supply of the internal block signal an instruction is read out from the address corresponding to the kind of interrupt request IRQ in the same manner as in the interruption processing which occurs during normal operation mode.

In the constitution of the execution start address upon return from the second standby mode or the third standby mode is decided by the control circuit in the standby mode STBYC and it is inputted to the CPU. On the other hand it is also possible to provide a register for retaining the execution start address after returning to the CPU and conduct retraction and a return for the register by the hardware using the nonvolatile FF.

While the description has been directed to a control circuit in the standby mode STBYC in a case of adopting a nonvolatile FF partially all FF and registers included in the first region AE may be replaced with a nonvolatile FF. In the system described above since data in the CPU circuit modules are entirely retained upon return by interruption it is no longer necessary to write the value by the CPU execution start address RST VEC. Accordingly such a system can be constituted while saving the boot address register BAR and the selector SELL.

The sequence of transition to the second standby mode STBY and the return to the normal operation mode will be described with reference to and . At first shows a sequence transiting from the normal operation mode to the second standby mode STBY. In cycle C a value STY meaning the second standby mode is written from the system bus STYBUS to the standby mode control register STBCR. In the cycle C the control circuit in the standby mode STBYC reads the value and puts the module stop signal MSTP 1 through the system SYSBUS to stop the supply of clocks to the first region AE in the cycle C . Then in the cycle C it puts the second standby mode signal STBY MODE and the nonvolatile FF control signal NVCTL to 1 and retracts the data of the flip flop in the modules in the first region AE to the data retention part of the nonvolatile FF. Subsequently it informs the current mode control sequence circuit STBYC FSM a finite state machine for selecting standby current consumption mode that the control signal NVCTL of the nonvolatile FF has completed control to all the nonvolatile FF by putting the acknowledge signal NVACK to 1 . In the cycle C it detects that the acknowledge signal NVACK is at 1 and in the cycle C the current mode control sequence circuit STBYC FSM conducts control by putting the control signal SW C of the power switch SW to 0 . As a result the power for the first region AE is shut down and the ground level VSSM of the first region AE increases gradually. Complete shutdown of the power switch SW is detected by the fact that the control signal SW C is completely 0 and this is indicated by the ACK signal to the current mode control sequence circuit STBYC FSM. In the cycle C the current mode control sequence circuit STBYC FSM detects that the ACK signal has turned to 0 and subsequently the current mode control sequence circuit STBYC FSM conducts voltage control for decreasing leakage in the nonvolatile circuit for the power line for the data retention VSS SIG of the nonvolatile FF. In this case due to transmission of the voltage controlled state for the current mode control sequence circuit VSS SIG to the current mode sequence control circuit STBYC FSM by the ACK VSIG signal the current mode control sequence circuit STBYC FSM can recognize the state of the nonvolatile FF. Thus transition from the power on state for power shutdown has been completed while retaining the data in the nonvolatile FF.

In the constitution of a built in user memory URAM is present in the second region AE which does not undergo power shutdown even upon transition to the second standby mode and the data stored in the build in user memory URAM is retained also in the second standby mode. Accordingly in a case of mounting the nonvolatile FF by the minimum required number the registers in the embedded circuit modules without retracting and returning by the non volatile FF can be retracted and returned by using the build in user memory URAM. At first the data of the registers are retracted by executing the program which makes it possible to retract return the data to from the build in user memory URAM before writing to the standby mode control register STBCR that indicates the transition to the second standby mode. In this case for recovery of the register value upon returning to the normal operation mode it needs a program of transferring the data corresponding to the address indicated by the boot address register BAR which are stored in the built in user memory URAM to the register. The retracting and returning are not necessary for the registers with no requirement of retaining the value in the second standby mode. Accordingly in a case of returning from the second standby mode at a higher speed the number of the registers can be restricted.

The operation of the nonvolatile FF in will be described with reference to . The normal operation is possible in a case where both the control signal STR and the control signal RSTR are at LO and the virtual power line VSSM is at the ground level 0 V . In this step in the master slave type latch circuit the input data D is taken into the master latch at the rising edge of the clock CLK and is transmitted to the output Q in the subsequent stage. When the control signal STR is at LO since the precharge controlling transistor MN is turned OFF and the equalizer transistor MP is turned ON and further either the transistor MP or MP is turned ON in accordance with the value for the complementary node n n of the master latch the node nv nv is precharged to the power level VDD. When the clock CLK is at LO the slave latch retains the data to retain the output Q to the succeeding stage. The graph shows an example where the input D changes at time T and the input data is outputted at the rising edge at time T. The solid line shows a case in which the input changes from LO to HI while the broken line shows the case where the input changes from HI to LO.

Subsequently a sequence provided for power shut down is conducted. At first the clock is stopped at time T. In this case the clock CLK is stopped at HI in order to place the master latch in a latched state. That is this is in a phase opposite to the case of providing the nonvolatile circuit NVC to the slave latch. Then the latched data is retracted to the nonvolatile circuit NVC at time T. This can be conducted by turning the control signal STR to the level HI. When the control signal STR is at the level HI precharge is completed at time T either the transistor MP or MP in turns ON and the other of them turns OFF and in this state the data is retracted to the latch comprising two stages of inverters. For example in a case where the input D is at HI since the transistor MP turns ON and the transistor MP turns OFF the node nv is at HI while the node nv is at LO. Subsequently power shut down control is conducted at time T. In this case the power on the ground side is disconnected. Further for decreasing the leakage current the voltage level for the data retention circuit power VSS SIG at time T is controlled for example the voltage level is raised to a voltage value of higher than 0 V and about 0.6 V or lower when the power VDD is at 1.2 V . This can provide an effect of further decreasing the leakage current during the standby mode. The waveform shown by the broken line in the graph represents a case where the input data D is at LO.

Now a description will be made regarding a sequence for returning the power. At time T control of returning the level for the power line for data retention VSS SIG to 0 V is conducted and control for returning the data of the nonvolatile circuit NVC to the original master latch corresponding to the turning of the power line for data retention VSS SIG to 0 V is conducted. At first a writing preparation for the data of the nonvolatile circuit NVC to the master latch is conducted. That is this can be attained by turning the control signal RSTR to HI at time T thereby turning the writing control transistors MN MN in to ON. Since either the writing transistor MN or MN is turned ON corresponding to the retained data in the nonvolatile circuit NVC either one of the complementary node n or n of the master latch is driven to LO to attain a returning of data.

The data writing back to the master latch is attained by driving the virtual power line VSSM to the level LO. At time T control of the virtual power line VSSM to 0 V is started and the latch data is written back in accordance with the data of the nonvolatile circuit NVC. Then correspond to the driving of the virtual power line VSSM to 0 V the control signal RSTR is put to LO at time T and the control signal RSTR is put to LO at time T thereby precharging the nonvolatile circuit NVC. Then when the clock CLK is operated operation is attained as usual.

Description will be made with respect to the merit of retaining data during power shutdown on the master latch. Generally the size of transistors constituting the master latch is smaller than the transistors constituting the slave latch. Since the slave latch has to drive the load in the succeeding stage the size of the transistor corresponding to the load is necessary. While the circuit portion for retaining the data during power shut down data retaining portion is desirably constituted with transistors of a smaller size for decreasing the leakage current the size for the data retention portion also has to be enlarged sometimes as the transistor size increases in the latch of the main body. Accordingly in a case where the LSI system can transit to the standby mode by the clock CLK at HI the size of transistors in the data retention portion can be made smaller by providing the data retention portion on the side of the master latch in which the transistor size is relatively small thereby increasing the effect of saving the leakage current.

Also in a case of providing the nonvolatile circuit NVC to the slave latch or the like it is possible to use a differential amplifier for the writing to the nonvolatile circuit NVC. In this case the clock upon power shutdown may be clock CLK LO.

The feature of the example shown in is that the number of control signals is reduced by one. Generally since wirings tend to be complicated in a place where the latch is inserted the layout can be facilitated by providing latches with a lesser number of signal lines to provide an advantageous effect in view of the operation speed and the area efficiency. Further since the retraction and return of data while the control signal STR is at HI is interlocked with the control for the power source shut down that is control for the VSSM level it also provides an effect of facilitating the control.

The present invention concerns a semiconductor integrated circuit device and more in particular it is applied to a system LSI or a microprocessor requiring low power consumption.

