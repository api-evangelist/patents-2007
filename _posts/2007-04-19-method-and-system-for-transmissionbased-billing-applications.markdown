---

title: Method and system for transmission-based billing applications
abstract: Computer- and network-based methods and systems for transmission-based billing are provided. Example embodiments provide a Packet-Based Billing System (“PBBS”), which enables application providers, such as carriers and content providers, to bill subscribers for the use of content on mobile subscriber devices, such as wireless devices, on a per-application, per-user basis based upon the extent of the usage. Embodiments of the present invention can also be used to bill subscribers for the use of content on a per-application, per-user basis for wired subscriber devices as well, using the same techniques. In operation, the PBBS provides modified content by inserting billing and tracking code into content returned to a requesting device. The modified content, when executed, tracks the amount of data sent and received between the content and a network and posts the accumulated data to a proxy/billing server according to business rules for an interval/frequency to post such data. The proxy/billing server stores the raw billing data and an accounting program retrieves the billing data to generate customer (call) data records. Business rules that specific different charges for different content or users can be incorporated into the system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08310943&OS=08310943&RS=08310943
owner: Motorola Mobility LLC
number: 08310943
owner_city: Libertyville
owner_country: US
publication_date: 20070419
---
The present invention relates to a method and system for transmission based billing and in particular to methods and systems for billing the use of wireless and wired applications based upon data transmitted over a network.

Today wireless devices have become prolific in many communities of the world. Devices such as wireless phones handsets personal information managers electronic organizers personal digital assistants portable e mail machines game machines and other devices are used by subscribers of telephone carriers to add convenience to our lives. However the software used on such devices and the mechanisms for deploying and billing for the use such software to these devices are arcane. Typically applications or other services are billing when they are loaded onto a wireless device a one time flat fee charge on a subscription basis such as a charge for the overall use of a set of applications and services or for total airtime. In newer third generation wireless networks such as GPRs carriers are able to identify a total number of physical packets or the amount of data used by a device. Thus billing models for a typical network carrier reflect flat fee or subscription based billing and do not necessarily accurately reflect use of applications and services. For example wireless applications that access a network while running on the device for example a calendar a browser or an email client typically utilize different carrier resources than applications that do not access a network for example a calculator or a text editor. A carrier or content provider is unable to accurately charge for the amount of carrier resources a particular application consumes because current billing systems provided at the wireless carrier level are unable to provide differentiated billing on an application level except at the time of download.

Embodiments of the present invention provide computer and network based methods and systems for transmission based billing which provides the tracking of billing information based upon the volume of data transmitted between applications or other types of content and a network. Example embodiments provide a Packet Based Billing System PBBS which enables application providers such as carriers and third party content providers to bill clients or subscribers generically users for the use of applications services generically content on mobile subscriber devices such as wireless devices on a per application per user basis based upon the extent of the usage. Embodiments of the present invention can also be used to bill subscribers on a per application per user basis for wired subscriber devices as well using the same techniques.

The PBBS determines and provides billing and tracking code and associated communication support generally referred to collectively herein as billing tracking code to enable application and service providers or other content providers typically carriers to automatically track billing information on a configurable logical packet level based upon the amount of data sent and or received by the application or service over the network. In the case of wireless devices and a wireless network this billing data tracks usage of the network on a per application basis instead of traditional total airtime use models. The data tracked is associated with a particular user thus allowing the application or service provider to bill on a per user per application basis based upon actual volume of use. In one embodiment the billing data tracked and posted includes an amount of data sent received across the network a timestamp an application identifier a security key a transaction identifier and a retry expiration indicator. In other embodiments the billing data may include a subset of these data or may include different or additional data. The application service provider can subsequently implement a variety of billing policies at the application or user level which can change over time.

In one embodiment the PBBS instruments packet based billing tracking code into the content to track and accumulate billing data on the client device and to post the data to a server such as a proxy server or a billing server. For some content such as Java applications .NET applications and other binary applications instrumentation is accomplished at the byte code level. In one such embodiment the instrumentation is performed by a content code modifier that analyzes the content to determine data structures calling sequence and location and identity of any network calls and replaces these calls by proxy network calls that contain the billing tracking code.

In another embodiment the billing tracking code is incorporated into the content by modifying the content according to a written specification. In yet another embodiment the billing tracking code is incorporated into the content through calls to an Application Programming Interface library. In yet another embodiment the billing tracking code is placed in the network driver software on the client device and interfaces directly to a proxy billing server.

In yet another embodiment a security key is inserted into the content to enable the billing tracking code to identify itself to a proxy server when billing data is posted from a client device. In one such embodiment the security key is a number uniquely associated with each content user combination and is stored in a secure data repository to prevent misappropriation and false billing data. In another embodiment the security key is a unique random number.

In one embodiment the PBBS comprises a content code modifier one or more data repositories containing associations of network calls to different proxy network calls containing billing tracking code business rules for billing data raw billing data and security keys a proxy server a billing server and an accounting program. In accordance with this embodiment the PBBS functions may be integrated into and dispersed over different components in an application provisioning system. These components then interact to determine and insert billing tracking code into the content receive data from the billing tracking code and process the tracked data in conjunction with indicated billing policies to generate billing records. In one embodiment the billing tracking code is inserted in response to a request from a client device for an application and a modified application is automatically returned. The billing data is then posted when the modified application is executed on the client device. In another embodiment the billing data is generated directly in response to a request from a client device for streaming content such as streaming audio and video since the requests are for a particular number of bytes or amount of data. In one of these embodiments the application provisioning system provisions applications for wireless devices. In another embodiment the application provisioning system provisions applications for wired devices.

In another embodiment the transmission based data is used to route network packets from applications to other servers network traffic . According to this embodiment the transmission based billing data is used to determine the extent of resources an application is consuming so that a proxy server can direct network traffic to promote greater efficiency or for example to provide guarantee better response time for heavily used or popular applications or applications based upon some other criteria.

Embodiments of the present invention provide computer and network based methods and systems for transmission based billing which provides the tracking of billing information based upon the volume of data transmitted between applications or other types of content and a network. Example embodiments provide a Packet Based Billing System PBBS which enables application providers such as carriers and third party content providers to bill clients or subscribers generically users for the use of applications services generically content on mobile subscriber devices such as wireless devices on a per application per user basis based upon the extent of the usage. Embodiments of the present invention can also be used to bill subscribers on a per application per user basis for wired subscriber devices as well using the same techniques. Although this description primarily refers to applications one skilled in the art will recognize that the methods and systems described herein are applicable to any other type of content that can be transmitted at a packet level across a network such as services and resources and that is capable of communicating billing data to a server when it is executed on a client device. For example an engine for playing audio or video etc. can be modified for transmission based billing according to these methods. In addition the methods and systems described herein are extendable to content that can be streamed such as text video audio graphics etc.

The PBBS dynamically provides billing tracking code and associated communication support referred to collectively herein as billing tracking code to enable application and service providers or other content providers typically carriers to automatically track billing information on a configurable logical packet level based upon the amount of data sent and or received by the application or service. The data tracked is associated with a particular user thus allowing the content provider to bill on a per user per application basis based upon actual volume of use. The content provider used herein to refer generally to any type of content provider can subsequently implement a variety of billing policies at the application or user level which can change over time. For example an application provider may desire to charge lower fees for popular applications when they are heavily used by a subscriber for example as measured by the quantity of packet data received sent by those applications for the particular subscriber. As another example a service provider may desire to implement a promotion for a new application charging less per transmission volume for that particular application in comparison to a normal fee.

Example billing data includes the number of bytes sent and or received a time stamp an application identifier user identifier sent automatically by the carrier infrastructure when billing data is sent over a wireless network a security key a transaction identifier and a retry expiration indicator. The transaction identifier is typically used to identify individual different billing tracking events. The retry expiration indicator indicates how long a client device should continue to re post the same billing data when the client device realizes a post operation has failed. Similarly a proxy billing server uses the retry expiration indicator to determine how long a transaction identifier is valid in order to detect duplicate received postings.

In one embodiment the PBBS content modifier e.g. content code modifier of instruments packet based billing tracking code into the requested content to accomplish the techniques of the present invention. Instrumentation as used herein is a non intrusive means for modifying content e.g. an application to include additional code which in this case is billing tracking and transmission code. In one embodiment network calls resident in the content are detected by the PBBS code modifier and replaced by transmission based billing specific billing tracking code which computes and collects the packet based billing data and invokes the originally specified network calls. Instrumentation in this sense is used as a hook before or after a network call as a method for intercepting the network call. Because different content in different environments will use a variety of network calls and because different providers having different billing policies the PBBS code modifier uses a configuration data repository such as configuration data repository in to determine which replacement network call to instrument into the content. The replacement calls may store the collected billing data locally in temporary storage on the target device and then post the collected data when the content finishes execution for example when an application exits . Alternatively the collected data may be posted upon each network call. In addition the collected data may be stored in permanent storage on the client device so that it may be posted after cycling power on the device. One skilled in the art will recognize that different scenarios for when data is posted are possible and contemplated to work with these techniques.

In other embodiments as described in detail in U.S. Provisional Application No. 60 271 661 filed on Feb. 26 2001 which is herein incorporated by reference in entirety the billing tracking code is incorporated into content by other means including intrusive and non intrusive means. For example a specification for packet based billing tracking code can be provided to content providers which can modify their content to explicitly include such tracking. In a second example an Application Programming Interface an API can provide library of functions that can be invoked by content providers at appropriate points in the content to provide packet based billing tracking and communication. In yet a third example the network driver software of the target device such as a wireless device can be modified to include the packet based billing tracking code through specification or library mechanisms . In all of these other embodiments either the content provider or the device driver manufacturer needs to be made aware of the billing tracking code and communication techniques thus providing a more intrusive means of incorporating the billing support.

The PBBS components and functionality may be integrated into and dispersed over different components in a network environment such as an application provisioning system. In that scenario provisioning components then interact to determine and insert billing tracking code into the content receive data from the billing tracking code and process the tracked data in conjunction with indicated billing policies to generate billing records. More specifically when an application is requested by a subscriber the application is provisioned by the application provisioning system for the requesting device and is downloaded to the requesting device with the appropriate billing code instrumented into the application. Provisioning as used herein is the customizing and distributing of content for a particular use for example for use on a particular kind of subscriber device by a particular customer. An example application provisioning system referred to as the Mobile Application System MAS can be used with the PBBS discussed herein. Co pending U.S. patent application Ser. No. 09 997 402 filed on Nov. 28 2001 and entitled Method and System for Maintaining and Distributing Wireless Applications which is herein incorporated by reference in its entirety describes such a system in detail including techniques for instrumenting code into applications customizing such applications and distributed them to especially wireless devices. The MAS is a collection of interoperating server components that work individually and together in a secure fashion to provide applications resources and other content to mobile and wired subscriber devices.

Although the techniques of the PBBS are generally applicable to any type of client wireless device one skilled in the art will recognize that terms such as subscriber device client device phone handheld etc. are used interchangeably to indicate any type of subscriber device that is capable of operating with the PBBS. Also terms may have alternate spellings which may or may not be explicitly mentioned. For example byte code may be also indicated as bytecode or Bytecode and one skilled in the art will recognize that all such variations of terms are intended to be included. In addition example embodiments described herein provide applications tools data structures and other support to implement a transmission based billing system over one or more networks. One skilled in the art will recognize that other embodiments of the methods and systems of the present invention may be used for many other purposes including instrumenting transmission based billing support into software and other content over non wireless networks such as the Internet to non wireless subscriber devices such as a personal computer a docked wireless handset telephones with Internet connectivity or customer kiosks for example within airports or shopping malls. In addition although this description primarily refers to content in the form of applications services and resources one skilled in the art will recognize that the content may contain text graphics audio and video. Also in the following description numerous specific details are set forth such as data formats and code flows etc. in order to provide a thorough understanding of the techniques of the methods and systems of the present invention. One skilled in the art will recognize however that the present invention also can be practiced without some of the specific details described herein or with other specific details such as changes with respect to the ordering of the code flow.

In addition the techniques of the PBBS can be extended to operate with streaming content. Specifically when streaming content such as text audio video graphics etc. is requested by a client device the request indicates an amount of content to download. The content modifier instead of inserting billing and tracking code into the content generates billing events directly and sends them to a proxy billing server.

Also one skilled in the art will recognize that the techniques of the present invention can be used for other uses in which determining and tracking the amount of data sent and received is valuable other than for generating billing data. For example an additional use for the techniques of the present invention relates to the routing of network packets and requests. Specifically the same techniques for tracking billing data based upon the amount of data sent and received between content and the network can be used by a proxy server or other component or system to decide how and where to route network packets based upon a routing policy. The billing data posted includes information that identifies the user the application and the amount of data being transmitted which can be used by a routing system to route traffic. For example an application server may wish to distribute network traffic in a particular manner or reserve particular servers for application user combinations that are heavily trafficked thus providing a type of load balancing.

The client device comprises a computer memory memory a display Input Output Devices and a Central Processing Unit CPU . Modified Content for example an executable application is shown residing in memory with other downloaded applications and a data repository for temporary storage of billing data . The Modified Content preferably executes on CPU and executes the inserted billing tracking code as described in previous figures to track transmission data and to communicate the billing data to a proxy billing server across the network .

The general purpose computer system may comprise one or more server and or client computing systems and may span distributed locations. In one embodiment wherein the PBBS is integrated into an application provisioning system such as a MAS the MAS is implemented using Java 2 Enterprise Edition J2EE and executes on a general purpose computer system that provides a J2EE compliant application server. According this embodiment the MAS is designed and coded using a J2EE multi tier application architecture which supports a web tier business tier and a database tier on the server side. Thus general purpose computer system represents one or more servers capable of running one or more components and or data repositories of the MAS and the PBBS.

As shown general purpose computer system comprises a CPU a memory and optionally a display and Input Output Devices . The components of the PBBS are shown residing in memory and preferably execute on one or more CPUs Other data repositories and other programs not shown also reside in memory and preferably execute on one or more CPUs . In a typical embodiment the PBBS includes a Content Modifier Data Repositories and for storing transmission and billing tracking code billing data and business rules Billing Server which is shown acting as the proxy and billing server and Accounting Program . As described earlier the PBBS may include other data repositories and components depending upon the needs of and integration with the carrier or other host systems. Other components which are part of the application provisioning system are also present in the memory but not shown such as the provisioning and deployment components and a local applications store. As mentioned applications are provisioned and instrumented with the billing tracking code by the Content Modifier before downloading to the client device .

One skilled in the art will recognize that the PBBS may be implemented in a distributed environment that is comprised of multiple even heterogeneous computer systems and networks. For example in one embodiment the Content Modifier and the Billing Server are located in physically different computer systems. In another embodiment various components of the PBBS are hosted each on separate server machines and may be remotely located from the data repositories and . In addition under some scenarios the Accounting Program may be hosted within a carrier s infrastructure and be completely separated from the PBBS. Different configurations and locations of programs and data are contemplated for use with techniques of the present invention.

In an example embodiment components of the PBBS are implemented as part of the MAS using a J2EE multi tier application platform as described in detail in 2 1.2 Sun Microsystems 1999 herein incorporated by reference in its entirety. The Content Modifier is typically part of the MAS Provisioning and Deployment Managers as shown in . The Billing Manager is a component of the MAS enhanced to perform the various capabilities associated with transmission based billing. The data repositories and for storing the code to be instrumented business rules and billing data may be part of the Configuration Manager of the MAS see Configuration Data Repository of or may be implemented as separate data repositories depending upon security needs the location of the Accounting Program etc. describe various example embodiments of the specific routines implemented by each of these components to achieve the functionality described with reference to . In example embodiments these components may execute concurrently and asynchronously thus the components may communicate using well known message passing techniques. One skilled in the art will recognize that equivalent synchronous embodiments are also supportable by a PBBS implementation. Also one skilled in the art will recognize that other steps could be implemented for each routine and in different orders and in different routines yet still achieve the functions of the PBBS.

As described with respect to client subscriber devices can request an application from an application provisioning system such as a Mobile Application System. Using the MAS the application may be pre provisioned for the device and subscriber and stored locally within the MAS termed walled garden provisioning or may be provisioned on the fly when an application is requested for example by browsing a site over the Internet termed open provisioning . is a block diagram of an example procedure for submitting an application to a Mobile Application System for use with transmission based billing. In a content provider such as a third party application provider or a carrier submits an application to the provisioning system here shown as MAS . The MAS stores the application either as raw data or pre provisioned in local storage . The content provider also provides billing related business rules which are stored appropriately by the MAS in Billing Data Repository . These rules indicate billing related information such as the frequency or interval for posting the billing data the address of the proxy server to send the billing data to the size of a logical packet and billing charge information associated with the logical packet size. One skilled in the art will recognize that other billing related business rules that are application or user specific may also be stored as needed.

As described with respect to when modified content is executed processed on a client device the billing tracking code is activated collects the data and automatically posts it to a proxy billing server associated with the PBBS. is an example block diagram that illustrates an overall process for communicating billing data based upon network transmission data on a per application basis. Although for the purposes of example the components are presumed to be part of an application provisioning system one skilled in the art will recognize that as described earlier they can be integrated into any content delivery system capable of performing the functions of the PBBS. In a client device posts billing data through network packets to a proxy server as a result of the posting code previously instrumented into the application see . Two different types of proxy servers may be implemented depending upon the capabilities of the devices. In particular some devices can send network packets directly to more than one server. In that case packets destined for other servers can be sent directly to them while billing data can be sent directly to the proxy server . Such a setup is sometimes referred to as a compute and log approach. Other devices are able to send network packets to only one server. In this scenario the proxy server acts as a store and forward proxy server and distributes network packets to their intended destinations processing only the packets with the posted billing data. The proxy server if a separate server collects the posted data and forwards it as appropriate to a billing server . In some embodiments the proxy server and billing server are combined. In some situations however for example due to security concerns it may be desirable to separate the proxy and billing servers. As another example the billing server may already exist and have particular data collection protocol to which the proxy server interfaces. Once the collected billing data is received the billing server determines whether the security key sent with the billing data is legitimate by comparing it with the expected security key in security data repository for that particular application and that user. If the security key is legitimate the billing server stores the raw billing data in a data repository . The billing server may optionally post process the billing data according to business rules stored for example in repository . One skilled in the art will recognize that the data repositories are separated as shown for mere illustration and that other combinations can be used such as a single data repository. In addition the proxy server may store the raw billing data directly to be processed asynchronously by the billing server . The accounting program retrieves the billing data raw or post processed from the data repository and optionally uses overriding business rules for example as stored in data repository to further process the billing data and to generate call customer data records . Overriding business rules may include for example specific application or subscriber overrides promotions etc.

From the foregoing it will be appreciated that although specific embodiments of the invention have been described herein for purposes of illustration various modifications may be made without deviating from the spirit and scope of the invention. For example one skilled in the art will recognize that the methods and systems discussed herein are applicable to content provisioning systems and transmission based billing system across any network wired or wireless or even a plurality of such networks. One skilled in the art will also recognize that the methods and systems discussed herein are applicable to differing protocols communication media optical wireless cable etc. and subscriber devices such as wireless handsets electronic organizers personal digital assistants portable email machines game machines pagers navigation devices such as GPS receivers etc. . Also all of the above U.S. patents U.S. patent application publications U.S. patent applications foreign patents foreign patent applications and non patent publications referred to in this specification and or listed in the Application Data Sheet including but not limited to U.S. patent application Ser. No. 09 997 402 filed on Nov. 28 2001 and entitled Method and System for Maintaining and Distributing Wireless Applications and U.S. Provisional Application No. 60 271 661 filed on Feb. 26 2001 and entitled Method and System for Packet Level Billing in Wireless Application Environments are incorporated herein by reference in their entirety. Aspects of the invention can be modified if necessary to employ methods systems and concepts of these various patents applications and publications to provide yet further embodiments of the invention. In addition those skilled in the art will understand how to make changes and modifications to the methods and systems described to meet their specific requirements or conditions.

