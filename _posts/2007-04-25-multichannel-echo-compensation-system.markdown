---

title: Multi-channel echo compensation system
abstract: A system reduces echoes in an audio system by de-correlating audio signals. Adaptive filters provide compensation based on the de-correlated signals. A controller controls the de-correlation based upon the adaptation state of the adaptive filters.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08085947&OS=08085947&RS=08085947
owner: Nuance Communications, Inc.
number: 08085947
owner_city: Burlington
owner_country: US
publication_date: 20070425
---
This application claims the benefit of priority from European Patent Application No. 06 009692.2 filed May 10 2006 which is incorporated by reference.

This disclosure relates to echo reduction. In particular this disclosure relates to echo reduction and suppression of residual echo signals in communication systems.

Echo reduction or suppression may be needed in communication systems such as hands free sets and speech recognition systems. Communication systems may include a microphone that detects a desired signal such as a speech signal from a user. The microphone may also detect undesirable signals such as echoes produced by a loudspeaker.

Echoes may occur through the repetition of sound carried by the reflection of sound. Such signals may be detected by the near end microphone and re transmitted back to the remote party.

Multi channel systems may have performance problems when individual channels have a correlation which may occur when multiple microphones detect the speech from a speaker. When the individual channels are correlated the adaptive filters may not converge to the desired impulse response. This may occur because portions of signals output by one loudspeaker may be compensated by a filter that processes the output of a different loudspeaker.

Optimization of echo compensation filters may depend upon the position of a speaker. Movement of the speaker may require recalculation of the filter coefficients. Filter convergence problems may result from the non uniqueness of the adaptation calculations. Some approaches may delay the signals in individual channels and may introduce a non linearity in the channel paths. These methods may introduce audible artifacts that reduce the quality of the speech signal. A need exists for an echo reduction system to reduce echoes in a multi channel environment.

A multi channel echo compensation system may receive first and second audio input signals from a first channel and a second channel of a multi channel source device. A de correlation processor may process the first and second audio input signals and generate first and second de correlated audio signals. Loudspeakers may transmit the first and second de correlated audio signals. A microphone may receive a desired and undesired signal. Adaptive echo compensation filters may filter the received signal on a channel by channel basis to generate an echo compensated signal. Adaptive echo compensation filters may remove the undesired signals.

Other systems methods features and advantages of the invention will be or will become apparent to one with skill in the art upon examination of the following figures and detailed description. It is intended that all such additional systems methods features and advantages be included within this description be within the scope of the invention and be protected by the following claims.

The de correlation processor may provide the de correlated output signals tilde over x n and tilde over x n to devices that convert electric signals into sound. In the devices include first and second channel loudspeakers and . The first and second channel loudspeakers and and a device that converts sound into electrical signals may be part of a loudspeaker room microphone LRM system or environment . The first and second channel loudspeakers and may generate acoustic signals based on the de correlated output signals tilde over x n and tilde over x n . A microphone may receive the signals generated by the first and second channel loudspeakers and and may produce a microphone output signal y n . The first and second channels may be two stereo channels or may be separate channels of a multi channel system. Each channel may include one or more loudspeakers. The microphone may acquire a desired speech signal from the speaker and may also acquire undesirable signals from the loudspeakers and .

The echo compensation filters and may include hardware and or software and may include a digital signal processor DSP . The DSP may execute instructions that delay an input signal one or more additional times track frequency components of a signal filter a signal and or attenuate or boost an amplitude of a signal. Alternatively the echo compensation filters and or DSP may be implemented as discrete logic or circuitry a mix of discrete logic and integrated logic or may be implemented through multiple processors or software programs.

The coefficients for the first and second channel echo compensation filters and may be dynamically adjusted separately for each channel. This may improve the quality of the microphone output signal y n and may improve the intelligibility of a speech signal detected by the microphone .

The de correlation processor may de correlate the first and second channel acoustic input signals x n and x n based on the performance or the adaptation state of the echo compensation filters and . If the controller determines that the echo compensation filters and are not adequately adapting the controller may control the de correlation processor to de correlate the first and second channel acoustic input signals x n and x n . If the controller determines that the echo compensation filters and are adapting at an acceptable rate the controller may instruct the de correlation processor to maintain or reduce an amount of de correlation.

The quality and reliability of the echo compensated microphone signal e n may be enhanced by de correlating the first and second channel acoustic input signals x n and x n dynamically in response to the adaptation state of the echo compensation filters and . Artifacts that may have been introduced by de correlation may be reduced to ensure intelligibility of echo compensated speech signals e n . The echo compensated speech signals e n may be transmitted to a remote party .

A first summing or combining circuit may sum the estimated output signals circumflex over d n and circumflex over d n to produce a summed estimated output signal circumflex over d n . A second summing or combining circuit shown in may combine the summed estimated output signal circumflex over d n and the microphone output signal y n to generate the echo compensated signal e n . The summed estimated output signal circumflex over d n may be subtracted from the microphone output signal y n .

The controller may analyze the first and second channel acoustic input signals x n and x n to determine a correlation between the signals. If the correlation is below a predetermined threshold the controller may inhibit or deactivate the de correlation processor . If the de correlation processor is deactivated it may be programmed to function in a pass through mode so that the de correlated output signals tilde over x n and tilde over x n may be identical to the respective first and second acoustic input signals x n and x n . If the correlation exceeds the predetermined threshold the de correlation processor may continue or may begin to de correlate the respective acoustic input signals x n and x n .

The controller may receive information regarding the adaptation state of the first and second channel echo compensation filters and through first and second communication signals and . The controller may also receive the echo compensated signal e n . The controller may determine the adaptation performance of the echo compensation filters and based on a system distance measurement. The controller may control the amount of de correlation provided by the de correlation processor based on the adaptation performance of the first and second channel echo compensation filters and .

The degree of correlation between first and second channel acoustic input signals x n and x n may be calculated using the short time correlation of the signals. The degree of correlation may also be determined based on the short time coherence of the signals. De correlating may be performed if the short time correlation or short time coherence or their respective mean value exceed a pre determined threshold value. Such values may range for example between about 0.96 and about 0.99.

The mean short time coherence may be calculated by averaging over frequency and time after performing a discrete Fourier transformation in a sub band according to the following equations 

Speech uttered by the speaker may be detected by the microphone . The undesirable de correlated output signals tilde over x n and tilde over x n reproduced by the loudspeakers and may also be detected by the microphone . The first and second channel echo compensation filters and may generate an echo compensated signal e n representing speech uttered by the speaker . A telephone or other communication device may receive the echo compensated signal e n . The multi channel echo compensation system may remove the signals generated by the loudspeakers and .

A first channel de correlation circuit and a second channel de correlation circuit may de correlate the first and second channel acoustic input signals x n and x n . The first and second channel de correlation circuit and may provide the de correlated signals to the loudspeakers and . Each channel may include one or more loudspeakers but each loudspeaker may output signals from only one channel.

The second channel de correlation circuit may include a second time varying filter such as an all pass filter and may also include a second non linear processing circuit such as a half wave rectifier. The second time varying filter may include a finite impulse response delay filter which may have multiple filter coefficients. The controller may control calculating the second filter coefficients n of the all pass filters through a second control signal . The second filter coefficients n may be based on the performance of the second channel echo compensation filter and by the value of the system distance D n . The second non linear processing circuit or half wave rectifier may receive second filtered signals x n from an output of the all pass filter . A second summing circuit may add or combine the output of the all pass filter with the output of the half wave rectifier to provide the second channel de correlated output signal tilde over x n .

The first and second de correlation circuits and may de correlate the first and second channel acoustic input signals x n and x n using the all pass filters and and the half wave rectifiers and respectively. The first and second filtered signals n received by the respective half wave rectifiers and may operate according to following equation 

The parameters and may be different for the respective first and second channel acoustic input signals x n and x n . The time varying filters and may provide a delay in the signal path. The non linear processing circuits and may provide non linearity in the signal path of the first and the second acoustic input signals x n and x n according to the following equations 

The de correlated output signals tilde over x n and tilde over x n ay be robust in terms of convergence. The time varying filtering may be performed by the all pass filters and according to the following equation 1 1 where is a time varying parameter n is the discrete time index x is an audio signal of one channel and the prime denotes the filtered audio signal. The coefficient may be a different value for each channel and may be varied slowly in time with 0.1 0.1 .

The mean short time coherence of the first and second acoustic signals x n and x n may be calculated Act by averaging over frequency and time according to the following equations 

If the amount of correlation between the signals is not above a predetermined threshold Act the first and second de correlation circuits and may be deactivated Act or the degree of de correlation may be reduced. The parameter n may remain substantially constant over multiple sampling periods. For example n may be about 0.1 over a period of about one second. The parameter n may assume a value of about 0.1 through linear interpolation over about 200 sampling periods. Such modeling may result in unperceivable artifacts in the first and second channel loudspeaker output signals.

The amount of de correlation may need to be increased. The time varying filtering may be complemented by non linear processing of the filtered signals n . Previous all pass filtering may have obtained a minimum convergence velocity for the overall adaptation of the first and second echo compensation filters. Non linear processing may be performed according to the following equation 

The non linear processing or all pass processing Act may initially be performed using a value for of about 0.7. The degree of the non linearity a may be adapted. The system distance D n may be periodically calculated Act according to the following equation 

The strength or amount of de correlation using non linear processing and or time varying filtering may depend on the adaptation state or performance of the echo compensation filters. The system distance may measure the performance of the first and second channel echo compensation filters and . By controlling n based on the system distance D n artifacts in the processed audio signals may be minimized. A mapping of the system distance D n to a value for n for the non linear processing may be performed using a table or other structure. The system difference D n may be recalculated after the parameter has been varied for about one second. The parameter n of the non linear processing e.g. half wave rectification may be set according to the following criteria 

If D n exceeds a predetermined value the controller may control the de correlation circuits and to minimally de correlate the acoustic input signals x n and x n . Alternatively the controller may deactivate the de correlation circuits and . The measured distance D n may fall below the predetermined value due to changes in the LRM system and the controller may reactivate the de correlation circuits and . The system distance D n and the filter coefficients of the time varying filters and may not necessarily be calculated for each sampling instant and may be calculated for example about once per second.

The amount of de correlation may be varied after a predetermined period of time. Non linearity may be reduced to avoid generating audible artifacts. If the LRM environment changes the value of n may be modified in response thus providing adequate echo compensation. Further de correlating may become less important at the near end if audio signals provided by the remote party do not show an increased correlation. If echo compensation fails to sufficiently enhance the quality of the microphone signal due to an abrupt movement of the speaker de correlating may be re activated or enforced. Non linear parameters may also be adjusted Act . If additional samples are available Act the next sample may be processed .

The overall quality of the echo compensated signal e n may be enhanced by using one or more directional microphones to provide a plurality of microphone signals. An optional beam forming circuit may be used. The beam forming circuit may provide directivity for the microphone array by utilizing delay compensation and summing of the individual microphone signals.

The logic circuitry and processing described above may be encoded in a computer readable medium such as a CD ROM disk flash memory RAM or ROM an electromagnetic signal or other machine readable medium as instructions for execution by a processor. Alternatively or additionally the logic may be implemented as analog or digital logic using hardware such as one or more integrated circuits including amplifiers adders delays and filters or one or more processors executing amplification adding delaying and filtering instructions or in software in an application programming interface API or in a Dynamic Link Library DLL functions available in a shared memory or defined as local or remote procedure calls or as a combination of hardware and software.

The logic may be represented in e.g. stored on or in a computer readable medium machine readable medium propagated signal medium and or signal bearing medium. The media may comprise any device that contains stores communicates propagates or transports executable instructions for use by or in connection with an instruction executable system apparatus or device. The machine readable medium may selectively be but is not limited to an electronic magnetic optical electromagnetic or infrared signal or a semiconductor system apparatus device or propagation medium. A non exhaustive list of examples of a machine readable medium includes a magnetic or optical disk a volatile memory such as a Random Access Memory RAM a Read Only Memory ROM an Erasable Programmable Read Only Memory i.e. EPROM or Flash memory or an optical fiber. A machine readable medium may also include a tangible medium upon which executable instructions are printed as the logic may be electronically stored as an image or in another format e.g. through an optical scan then compiled and or interpreted or otherwise processed. The processed medium may then be stored in a computer and or machine memory.

The systems may include additional or different logic and may be implemented in many different ways. A controller may be implemented as a microprocessor microcontroller application specific integrated circuit ASIC discrete logic or a combination of other types of circuits or logic. Similarly memories may be DRAM SRAM Flash or other types of memory. Parameters e.g. conditions and thresholds and other data structures may be separately stored and managed may be incorporated into a single memory or database or may be logically and physically organized in many different ways. Programs and instruction sets may be parts of a single program separate programs or distributed across several memories and processors. The systems may be included in a wide variety of electronic devices including a cellular phone a headset a hands free set a speakerphone communication interface or an infotainment system.

While various embodiments of the invention have been described it will be apparent to those of ordinary skill in the art that many more embodiments and implementations are possible within the scope of the invention. Accordingly the invention is not to be restricted except in light of the attached claims and their equivalents.

