---

title: Systems and methods for location management and emergency support for a voice over internet protocol device
abstract: Example systems and methods to manage location information for emergency services support of an internet protocol (“IP”) communication device are disclosed. A disclosed example method involves storing first and second geographic location information in a first list of geographic location information associated with an internet protocol device. The first list is stored at a service provider server. At least a partial copy of the first list is communicated from the service provider server to the internet protocol device for storing as a second list of geographic location information in the internet protocol device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08620257&OS=08620257&RS=08620257
owner: AT&T Intellectual Property I, L.P.
number: 08620257
owner_city: Atlanta
owner_country: US
publication_date: 20070220
---
The present disclosure relates generally to communication systems and more particularly to systems and methods for location management and emergency support for a voice over internet protocol device.

Internet protocol enabled telecommunication providers in the United States are required by the Federal Communications Commission FCC to support enhanced 911 E911 emergency call services. That is when a telephone user dials 9 1 1 the telecommunication carrier must be able to process the call to determine the geographic location from where the call is originated to enable dispatching emergency personnel to the location of the 911 caller. Enhanced 911 service differs from traditional non enhanced 911 service in that E911 service routes an emergency call to a 911 dispatcher and provides the dispatcher with the geographic location e.g. street address from which the call originated while traditional 911 service routes an emergency call to a 911 dispatcher without providing the dispatcher with geographic location information indicating where the call originated.

In traditional public switched telephony networks PSTN the geographic information retrieval support for E911 is implemented by fixing associations between wireline telephone numbers and geographic street addresses. Telecommunication providers usually store a subscriber s location e.g. a street address in a database associated with an assigned telephone number e.g. a call back number CBN during the service activation. When a PSTN user makes a 911 call the calling telephone number i.e. the CBN of the incoming 911 call can be used to look up the geographic location of the caller and the retrieved location information can be used to dispatch emergency personnel to the caller.

The introduction of voice over IP VoIP technology introduces various challenges to service providers seeking to support E911 services. In particular under a nomadic service i.e. a service allowing subscribers to connect VoIP telephones at various network locations a VoIP subscriber can easily disconnect a VoIP telephone from one location e.g. the subscriber s home or workplace connect the VoIP telephone in another location e.g. a visited local area network LAN a coffee shop a vacation spot etc. and register the VoIP telephone with the VoIP service provider to place telephone calls from the other location. This nomadic capability of VoIP phones introduces the potential for inaccurate associations between telephone numbers and physical or geographic locations.

The example methods and apparatus described herein may be used to manage location information associated with voice over internet protocol VoIP devices to support E911 services for those VoIP devices. Traditional E911 services based on the plain old telephone system POTS provide POTS telephone service subscribers with emergency assistance service that is capable of pinpointing the geographic calling location of a caller for emergency personnel e.g. firemen policemen paramedics etc. . In this manner although a caller may be unable to speak into the telephone due to for example illness or injury the receiving 911 dispatcher can obtain a physical address or geographic location from which the caller is calling and dispatch emergency personnel to that location. Unlike traditional POTS telephone service which is implemented in connection with traditional wireline telephone numbers that are associated with corresponding fixed geographic locations e.g. a subscriber s home street address IP enabled communication services e.g. VoIP services do not always restrict an IP telephone number to being permanently associated with or assigned to e.g. located at connected at etc. a particular geographic location. Instead some VoIP service providers enable a VoIP device associated with a particular telephone number to nomadically move or roam through a service provider network or through various service provider networks. That is a subscriber may disconnect a VoIP device from a service provider network at a first location e.g. the subscriber s home and reconnect the VoIP device into the same service provider network or a different service provider network at a second location e.g. a work place . The example systems and methods described herein enable service provider networks to provide E911 services to subscribers even though these subscribers move their VoIP devices between various locations. As described in greater detail below the example systems and methods determine when a VoIP device has been moved between two network locations and prompt a user of the moved VoIP device to confirm a geographic location change and or provide updated geographic location information e.g. a current street address associated with the current network location of the VoIP device. Some example implementations determine when a VoIP device is not eligible for nomadic use and deny VoIP services to nomadic disabled devices when they identify an attempt to operate the VoIP device in a network location different from the VoIP devices registered location. Alternatively or additionally the example systems and methods can be used to deny service to VoIP devices connected to networks or portions of a network for which a VoIP service provider cannot provide E911 service. A VoIP service provider may be a telephone company a cable company a satellite company an Internet service provider a utility e.g. electricity service provider etc.

Some disclosed example methods of managing location information for emergency support of a VoIP communication device involve determining a geographic location change status associated with the internet protocol device. A message e.g. an audio message a text message a video message etc. is then presented via the VoIP device based on the geographic location change status requesting a user to confirm whether a registered geographic location e.g. a street address associated with the VoIP device is a current geographic location of the VoIP device.

In some example implementations a current IP address associated with the VoIP device e.g. a registration public IP address used by the VoIP device to register with a VoIP network is used to determine the geographic location change status of the VoIP device. For example the current IP address can be compared to a previous IP address e.g. a registered IP address registered in associated with the VoIP device. If the current IP address and the previous IP address differ the geographic location change status is updated to indicate that the geographic location of the VoIP device may have changed from a geographic location previously registered in association with the VoIP device. A network server e.g. a dynamic host configuration protocol DHCP server may assign the current IP address to the VoIP device or to a network access device e.g. a residential gateway connected to the VoIP device and through which the VoIP device accesses network services.

A service provider network may use the geographic location change status to set an operating mode of the VoIP device. In an example implementation a geographic location change status indicating that the VoIP device has not moved to another geographic location corresponds to an unrestricted operating mode S mode that enables the VoIP device to access substantially all subscribed to communication services provided by a service provider associated with the VoIP device. Another geographic location change status of the illustrated example indicating that the VoIP device may have moved to another geographic location corresponds to a suspended operating mode S mode that restricts the VoIP device to accessing a subset of all otherwise available communication services provided by a service provider. For example in the suspended operating mode the VoIP device may be allowed to receive VoIP calls and make VoIP calls to one or more telephone numbers e.g. a customer service telephone number a 911 operator pre selected by a VoIP service provider. Yet another geographic location change status of the illustrated example indicating that the IP device is located within a geographic location at which a VoIP service provider cannot provide emergency service e.g. E911 service corresponds to a restricted operating mode S that may allow access to the same or less e.g. none services than the suspended S operating mode.

In some example implementations the operating mode may be selected by a service provider network based on a user s response to a message presented via the VoIP device. For example the service provider network may select a particular operating mode if the user confirms that the registered geographic location is the same as the currently logged geographic location. Additionally or alternatively the service provider network may determine whether the IP device is eligible to roam i.e. the VoIP device is nomadic enabled between different network locations of the service provider network. The service provider network can then select an operating mode that denies access to at least some services if the VoIP device is not eligible to roam. i.e. the VoIP device is nomadic blocked . After setting the operating mode of the VoIP device another message e.g. an audio message a text message a video message etc. may be presented via the VoIP device to inform a user of the operating mode change and or the reason for the change.

Some disclosed example systems to manage location information for emergency support of a VoIP communication device include an interface configured to receive a current IP address i.e. a registration IP address associated with the VoIP device. These example systems also include a comparator configured to compare the current IP address with a registered IP address. The comparison indicates that the VoIP device may have been moved e.g. a suspected location change or that the VoIP device has not been moved. If a suspected location change is indicated the system may interact with the user to confirm and or update records to reflect the current geographic location. For instance the example system includes a user interface e.g. an interactive voice response IVR interface configured to present a message e.g. an audio message a text message a video message etc. via the VoIP device based on the comparison requesting a user to confirm whether a registered geographic location e.g. a street address associated with the VoIP device is the same as a current geographic location of the VoIP device and or to identify the current geographic location of the VoIP device.

The response may indicate that the VoIP device has been moved or has not been moved from a first geographic location to a second geographic location. The user interface may be further configured to instruct the user to navigate to an internet location e.g. a webpage to update the registered geographic location when for example the response indicates that the VoIP device has been moved from a first geographic location to a second geographic location.

The current IP address i.e. the registration IP address may be assigned to the VoIP device or to a network access device e.g. a residential gateway a site gateway etc. connected to the VoIP device and through which the VoIP device accesses network services. In some example implementations the current IP address is different from the registered IP address. For example the registered IP address may be associated with a geographic location within which the VoIP device was located prior to being associated with the current IP address. In some example implementations the system includes a data structure configured to store the registered IP address associated the VoIP device.

To select an operating mode associated with the VoIP device based on the comparison of the current IP address and the registered IP address some example systems are provided with a mode selector. The mode selector may also select the operating mode based the user s response to the message. In an example implementation the mode selector is configured to set the operating mode to restrict the VoIP device to access a subset of all communication services associated with a service subscription corresponding to the VoIP device. The system may also be provided with a services interface configured to determine whether the VoIP device is eligible for nomadic use and configured to cause the mode selector to set the operating mode to deny access to at least some services if the VoIP device is not eligible for nomadic use.

To facilitate the process of obtaining current geographic addresses from users example methods and systems described below are configured to store an address list of geographic addresses for each subscriber at a network storage location and copies of the address lists for the corresponding subscribers at respective subscriber VoIP devices. The address lists are advantageously useful to subscribers that move their VoIP devices often between the same locations such as for example between a subscriber s home and one or more office locations. For example some VoIP subscribers often move between office and home locations on a regular basis. Other VoIP subscribers may move to the same temporary location e.g. a vacation home a hotel or an apartment when traveling or commuting for business. As described above when a network detects that a VoIP device has moved the network requests the subscriber of the VoIP device to provide the current geographic address at which the VoIP device is being used. In some instances it is relatively inefficient and costly for VoIP service providers to collect current geographic addresses and to validate those addresses each time a subscriber moves to a different location. To reduce the amount of work required by a VoIP service provider to receive and validate a current geographic address and the amount of work required by a subscriber to provide a current geographic address the example methods and systems described below can be used to store an address list of previously submitted geographic addresses in a subscriber s VoIP device so that the subscriber can select a current address from the list of available geographic addresses each time the subscriber moves to a different location.

To implement geographic address lists for VoIP service subscribers a VoIP service provider network is provided with a goegraphic address database or data structure referred to herein as a Location Assistant for VoIP Mobility LAM database. The LAM database stores geographic address data records for each VoIP subscriber. The LAM database is configured to compile geographic addresses into geographic address lists corresponding to respective VoIP subscribers and to communicate the geographic address lists for storage in a device configuration server e.g. a network management system of a VoIP service provider. The device configuration server can then communicate the geographic address lists to the respective VoIP devices of their subscribers. The LAM database can also subsequently provide updates e.g. address additions address deletions address modifications etc. to the address lists stored at the device configuration server and or the address lists stored at the VoIP devices. In this manner a given VoIP device can present geographic addresses from an address list to a subscriber as selectable choices that the subscriber can select to indicate a current geographic address when the subscriber moves the VoIP device between different locations.

An example method for implementing geographic address lists involves storing first and second geographic location information e.g. geographic street addresses in a first list of geographic location information associated with a VoIP device to enable provisioning of location based emergency services to the VoIP device. The first list is stored at a service provider storage location. In the illustrated discussion below at least a partial copy of the first list is communicated from the service provider storage location to the VoIP device for storing as a second list of geographic location information in the VoIP device.

In some example implementations the LAM database enables subscribers to select current geographic addresses in the LAM database via a web page or by calling a VoIP service provider customer service number. For example the LAM database may be communicatively coupled to a web page via a secure communication path e.g. a hypertext transfer protocol over secure socket layer HTTPS communication path . The web page can present a list of geographic addresses stored in the LAM database in association with the subscriber s account number to enable the subscriber to select one of the geographic addresses as the current geographic address. A subscriber may alternatively elect to call a customer service number and speak to a customer service agent or interact with an interactive voice response IVR system to select a current geographic address. The customer service agent or the IVR can then update the current geographic address in the LAM database.

Although the LAM database is described below in connection with providing location based emergency services e.g. E911 services to users of VoIP devices the LAM database can be used in connection with other location based services provided by VoIP service providers. For example based on a current geographic address set in the LAM database for a particular subscriber a VoIP service provider can communicate location specific advertisement information or other information of interest e.g. nearby points of interest location specific weather information or any other location specific information to the VoIP device of the subscriber. As discussed below the LAM database is provided with one or more secure access interfaces e.g. HTTPS interfaces to enable subscribers VoIP customer service agents or network operators to access information in the LAM database. Such access interfaces can be configured for use in connection with location management for emergency services support or for use in connection with other location based VoIP provider services. In some example implementations the LAM database can be configured to include other interfaces that enable network entities devices or systems to access the LAM database to implement the other VoIP provider services.

As will be readily apparent to persons of ordinary skill in the art the example methods apparatus and systems described herein may be implemented using instructions stored on one or more machine accessible media e.g. a CD ROM a magnetic storage device an optical storage device a solid state storage device etc. associated with one or more network system devices. In this manner the machine accessible media may be used to enable network system devices to retrieve and execute the instructions to implement the example methods apparatus and systems described herein.

An example network system is shown in . The example system of includes subscriber sites and . Each of the subscriber sites and includes a respective subscriber site gateway and e.g. a residential gateway . The subscriber sites may be residential dwellings and or business sites e.g. a coffee shop an education facility an office an industrial building etc. and may have separate respective LAN s and or PBX s located therein which are communicatively coupled to a respective one of the site gateways . In the illustrated example the site gateways and are used to provide user equipment e.g. VoIP devices computers etc. network access to the example network system and may be implemented using wire interface gateways e.g. wired Ethernet IEEE 802.3 Universal Serial Bus USB etc. or wireless gateways e.g. wireless Ethernet IEEE 802.11 Wi Fi Bluetooth etc. .

In the illustrated example a VoIP device e.g. a wired or wireless VoIP telephone a plain old telephone system POTS analog telephone connected to an analog telephone adapter ATA a wired or wireless IP data voice communicator a personal desktop laptop or tablet computer having VoIP capabilities etc. is communicatively coupled to the subscriber site gateway . The site gateway provides the VoIP device network access to an Internet protocol IP network which may include one or more Internet service provider ISP networks. The VoIP device is capable of making VoIP calls via the example IP network . The IP network includes a function that assigns public IP addresses to the site gateways . In the illustrated example the function to assign public IP addresses may be implemented using for example a dynamic host configuration protocol DHCP server . As shown in the illustrated example of the first site gateway is assigned a public IP address A and the second site gateway is assigned a public IP address B. Although two subscriber sites i.e. the subscriber sites and two site gateways i.e. the site gateways are shown in any number of subscriber sites and site gateways may be used in connection with the examples described herein.

In the illustrated example the VoIP device can be associated with a non nomadic service i.e. a nomadic blocked service or a nomadic service i.e. a nomadic enabled service . A non nomadic service limits the VoIP device to making VoIP calls from only a pre selected network location e.g. from only the subscriber site . Under a non nomadic service the VoIP device may be used to make VoIP calls from for example the subscriber site but not from the subscriber site . In contrast a nomadic service allows the VoIP device to make calls from a plurality of network locations. That is in the illustrated example the VoIP device can be used to make VoIP calls from both of the subscriber sites . A subscriber or user can change the nomadic option for the VoIP device via the user s account. In some example implementations the VoIP device may be associated with a plurality of telephone numbers. For each telephone number a user can select a different nomadic option. In this manner when the VoIP device is used from a home location e.g. the subscriber site any of a plurality of telephone numbers associated with the VoIP device can be used to make VoIP calls. However when the VoIP device is connected to a visiting site e.g. the subscriber site only those telephone numbers associated with a nomadic option can be used to make VoIP calls.

To enable VoIP services the example network system is provided with an internet protocol multimedia subsystem IMS . The IMS enables different communication technologies e.g. features services communication software and equipment etc. to work together to deliver enriched communications e.g. VoIP communications to subscribers. The IMS of the illustrated example is implemented according to one or more industry standard specifications. Although the IMS is used in the illustrated example the example systems and methods described herein may be used in connection with IP multimedia and telephony core network architectures other than the IMS . For example IP multimedia and telephony core network architectures other than the IMS may be used to enable VoIP services in the example network system .

To manage subscriber services the IMS is provided with a network management system NMS that is communicatively coupled to a home subscriber services HSS database . In the illustrated example the NMS is used to manage and track which subscribers have subscribed to which features or services and to enable access to those features by subscribers. The NMS stores records in the HSS database having VoIP device configuration information indicative of subscriber s respective features and services. To implement a service change e.g. provisioning a device registration an upgrade an update etc. the NMS is notified of the service change and the NMS stores information in the HSS database indicative of the service change. In the illustrated example the NMS is also configured to receive and process the initial geographic location information e.g. street addresses associated with a VoIP device e.g. the VoIP device when VoIP service is initially provisioned. Also the NMS is configured to store geographic address lists e.g. the geographic address list of corresponding to different VoIP devices.

In the illustrated example the NMS is configured to communicate configuration updates including address list updates to VoIP devices. For example if the NMS receives a notification that a new service feature has been enabled for the subscriber account associated with the VoIP device the NMS can communicate a configuration update e.g. transmit an updated configuration file to the VoIP device . Additionally when a user provides a new geographic address for storage in an address list e.g. the geographic address list of associated with the VoIP device the NMS communicates the updated geographic address information to the VoIP device .

To allow subscribers to interact with customer service representatives the NMS is coupled to a customer service center . In the illustrated example a subscriber can interact with a customer service representative at the customer service center to change a nomadic option associated with the VoIP device . In addition when the VoIP device is moved to a different geographic location the subscriber can interact with the customer service representative to provide the street address of the new geographic location. In addition to enable a subscriber to access a web page to change nomadic options and or to provide the street address of current geographic location the IMS is provided with a web server . In the illustrated example the web server is implemented in connection with a web portal that can be accessed by subscribers an or customer service agents to update subscriber information such as for example geographic address information.

To inform a subscriber of a suspected geographic location change the IMS is provided with an interactive voice response IVR system . When a subscriber initiates a VoIP call via the VoIP device the IVR system is configured to playback an audio message via the VoIP device when a VoIP service provider detects that the VoIP device may have been moved to a different geographic location e.g. moved from the subscriber site to the subscriber site . The IVR system may include a sound file player and or a text to speech converter e.g. a speech synthesizer to present one or more audio messages.

In the illustrated example the IVR message plays back a previously registered street address or last known registered street address of the VoIP device and requests the subscriber of the VoIP device to confirm whether the registered street address is the same as the current street address at which the VoIP device is located. The subscriber can then confirm that the street addresses are the same or if the street addresses are different the subscriber can change the registered street address via the IVR a customer service representative or an account web page served by the web server . Additionally or alternatively the subscriber can contact the customer service center to change the registered street address.

To control and process call sessions of VoIP devices e.g. the VoIP device the IMS is provided with a call session controller CSC . The call session controller implements a call session control function CSCF that determines whether a call should be established and which features or services should be used to establish the call based on subscribed features or services e.g. nomadic enabled service calls to a PSTN allowed etc. of a subscriber. In the illustrated example to register VoIP devices e.g. the VoIP device with the IMS the CSC is provided with a registration request interface to receive registration requests from VoIP devices and a device registrar to register the VoIP devices with the IMS . In the illustrated example the device registrar is configured to perform SIP registrations when VoIP devices communicate registration requests to the IMS . As described below in connection with the flowchart of the device registrar of the CSC is configured to communicate a current geographic address selection associated with the VoIP device e.g. a current geographic address indicative of the location of the VoIP device to the LAM database during a SIP registration process. In some example implementations the device registrar may or may not allow the VoIP device to register depending on whether it is eligible for nomadic use.

The IMS is also provided with a feature server . The feature server stores the registration current public IP addresses e.g. the public IP address A of the site gateway used by VoIP devices e.g. the VoIP device to register with the IMS . That is when the VoIP device registers with the IMS the HSS receives the public IP address A i.e. a registration public IP address used by the VoIP device to register. The HSS then forwards a notification including the public IP address A to the feature server and the feature server stores the public IP address A for future comparisons with other registration IP addresses that the VoIP device may use to register. In addition to storing the public IP address A the feature server also associates itself with the VoIP device for the duration of its registration. In the illustrated example the feature server also compares each registration public IP address with a corresponding registered public IP address i.e. a public IP address used previously by the VoIP device to register with the IMS to determine a location change status e.g. determine whether the VoIP device may have moved from one geographic location to another .

The feature server also stores the current operating mode e.g. the unrestricted operating mode S mode the suspended operating mode S mode or the restricted mode S mode associated with each VoIP device registered with the IMS . In the illustrated example the feature server is configured to change operating modes from the unrestricted operating mode S mode to the suspended operating mode S mode based on comparisons of registration public IP addresses with registered public IP addresses. For example if the feature server determines that the registration public IP address A associated with the VoIP device is different from a registered public IP address associated with the VoIP device the feature server determines that the VoIP device may have been moved from one geographic location to another. In response the feature server changes the operating mode associated with the VoIP device to the suspended operating mode S mode to allow the VoIP device to receive calls and or to make calls to phone numbers pre selected by a VoIP service provider such as for example a customer service phone number but to block calls to other non preselected phone numbers.

The feature server is also configured to change operating modes to the suspended operating mode S mode or the restricted mode S mode at the direction of the NMS . For example if the user of the VoIP device registers a geographic address that is in a location for which E911 services cannot be provided the NMS can instruct the feature server to change the operating mode associated with the VoIP device to the restricted mode S mode . The NMS can also instruct the feature server to change the operating mode associated with a VoIP device from the restricted operating mode S to the suspended operating mode S .

The feature server is configured to determine the type of message to be presented to a user by the IVR based on for example the operating mode associated with the VoIP device . In the illustrated example when the IMS processes a call from the VoIP device while the operating mode of the VoIP device is set to the S mode or the S mode the feature server routes the call to the IVR and instructs the IVR to present a message e.g. playback an audio announcement and or obtain a confirmation response e.g. a response confirming the correctness of a registered geographic address from a user. For example the feature server may instruct the IVR to present a message requesting a user to confirm whether the registered geographic location of the VoIP device is correct and if not requesting the user to provide an updated geographic street address of the new location. In the illustrated example the feature server is also configured to change operating modes associated with the VoIP device from the restricted operating mode S to the unrestricted operating mode S based on the confirmation response. For example the feature server can change the operating mode of the VoIP device from S to S when the user confirms that the registered geographic location presented by the IVR is correct.

Also the feature server informs the IVR from where to obtain the registered geographic address of the VoIP device . In example implementations in which audio files e.g. .wav files are used by the IVR to playback registered geographic addresses to users the feature server is configured to store uniform resource locator URL addresses corresponding to network locations e.g. servers network directories etc. in which the audio files are stored.

To route emergency calls the IMS is provided with an emergency services gateway ESGW . The emergency services gateway uses information received via an emergency call s call setup signaling to determine a path e.g. a trunk via which to route the emergency call for E911 handling.

To handle emergency calls the example network system is provided with a public safety answering point PSAP . The PSAP corresponds to a particular geographic area and dispatchers at the PSAP handle emergency calls originating from VoIP devices within that geographic area. In this manner dispatchers can dispatch emergency services personnel from a location nearest the geographic location of a 911 caller. Although one PSAP is shown the example network system may be implemented using any number of PSAP s each corresponding to one or more respective geographic area s .

To route emergency calls to the PSAP the example network system is provided with a 911 selective router . The 911 selective router routes emergency calls to the correct PSAP based on information received from the emergency services gateway and a selective routing database SRDB . For example during an emergency call the emergency services gateway communicates an emergency services query key ESQK to the 911 selective router . The ESQK is a call identifier that represents an emergency call for the duration of the call and is used by the selective router to route an emergency call to the correct PSAP e.g. the PSAP .

After the 911 selective router receives the ESQK from the emergency services gateway the 911 selective router forwards the ESQK to the SRDB to obtain an emergency service number ESN identifying a PSAP to which to route the emergency call. The SRDB stores ESQK s in association with respective ESN S. An ESN is a number used to indicate a particular group of emergency service agencies e.g. police department fire department medical agency that serves a particular geographic area and facilitates routing an emergency call to the PSAP that serves that geographic area.

To enable the example network system to implement operations associated with receiving and processing emergency calls made from VoIP devices e.g. the VoIP device the example network system is provided with an i2 E911 system . To store street addresses in association with respective telephone numbers of VoIP devices and to determine whether a call is originating from a geographic area in which a corresponding VoIP service provider can provide E911 services the i2 E911 system is provided with a location identification server LIS database . In the illustrated example the LIS database stores a record for each telephone number of the VoIP device and each record is used to store the geographic location e.g. the street address of the subscriber site in association with the telephone number in that record. The NMS communicates initial geographic location information e.g. initial street addresses to the LIS database during initial VoIP subscription enrollments. In addition any time the VoIP device moves to another geographic location and a corresponding subscriber provides an updated street address via for example the customer service center or the web server the IMS communicates the updated street address to the LIS database .

The i2 E911 system is also provided with an emergency services zone ESZ routing database ERDB . Each ESZ corresponds to a particular emergency service number ESN that uniquely identifies the ESZ. For each ESZ the ERDB stores an emergency services routing number ESRN corresponding to an E911 selective router that serves that ESZ and a respective ESN. In the illustrated example an ESRN is used to route an emergency call to an E911 selective router serving the ESZ corresponding to the geographic area within which the emergency call originated.

During registration of a street address or when a subscriber provides an updated street address the LIS database uses the ESRN s stored in the ERDB to determine whether the provided street address is located within an area in which a corresponding VoIP service provider can provide E911 service. For example the LIS database accesses the ERDB to retrieve an ESRN corresponding to the provided street address and determines whether the VoIP service provider can provide E911 service to the provided street address based on the ESRN. Regardless of whether the LIS database determines that the VoIP service provider can or cannot provide E911 service to the provided street address the LIS database updates the registered geographic location of the VoIP device with the provided street address. However if the LIS database determines that the VoIP service provider cannot provide E911 service to the provided street address the LIS database informs the NMS that the VoIP device is in a location at which E911 service is not available. In this manner the NMS can instruct the feature server to set the operating mode associated with the VoIP device to a restricted mode S mode so that the VoIP device can access only a subset of services e.g. receive calls only connect to a 911 dispatcher without the location identification services of E911 that are for example associated with a service subscription corresponding to the VoIP device .

To validate geographic location information street addresses to be stored in the LIS database the i2 E911 system is provided with a validation database VDB . The VDB stores a plurality of street addresses in a format compliant with the master street address guide MSAG standard. In the illustrated example when a subscriber provides a street address and before the street address is stored in the LIS database the i2 E911 system compares the user provided street addresses with known street addresses in the VDB to determine whether the provided street address is MSAG valid. If the provided street address is MSAG valid then the i2 E911 system validates the provided street address and updates a corresponding registered street address in the LIS database . Otherwise if the provided street address is not MSAG valid e.g. the address includes a typographical error an incorrect zip code etc. the i2 E911 system indicates that the provided street address is invalid and the IMS informs the subscriber of the invalidity and requests the user to provide a MSAG valid street address.

To retrieve emergency call routing information from the ERDB and street addresses from the LIS database to process an emergency call the i2 E911 system is provided with a VoIP positioning center VPC communicatively coupled to the CSC . When the CSC receives an emergency call the CSC queries the VPC to determine the E911 selective router to which the emergency services gateway should route the emergency call.

The PSAP is coupled to an automatic location identification ALI database to enable the PSAP to retrieve geographic street addresses from which emergency calls originate. The ALI database stores geographic street addresses corresponding to the locations of telephones connected to a traditional publicly switched telephone network PSTN . The VPC stores geographic street addresses associated with VoIP devices that it retrieves from the LIS database . When the PSAP requires a street address of a VoIP device the ALI queries the VPC for the street address. In response the VPC forwards the street address associated with the VoIP device to the ALI database . The ALI database then provides the street address to the PSAP .

To store data records of geographic location information including geographic addresses corresponding to locations that subscribers have visited or may visit in the future the IMS is provided with a Location Assistant for VoIP Mobility LAM database . The LAM database is configured to store one or more geographic address data records for each VoIP subscriber. Some subscribers may choose to submit geographic addresses corresponding to the places that they most frequently visit such as for example a home address an office address a coffee shop address etc. and or the list of addresses may be compiled over time.

In the illustrated example the LAM database is provided with a hypertext transfer protocol over secure socket layer HTTPS interface to enable subscribers or customer service representatives to access and modify geographic addresses securely via the Internet. A subscriber may provide geographic addresses to the LAM database and or set a current geographic address in the LAM database via a website or a VoIP device user interface. Additionally or alternatively the subscriber may contact a customer service agent at the customer service center and speak a geographic address to be added to the LAM database and or speak a current geographic address selection. The customer service agent in turn can add the new geographic address in the LAM database and or set the selected current geographic address in the LAM database via a customer service agent interface e.g. a database interface an intranet website an internet website a subscriber account information interface etc. .

The LAM database is configured to communicate geographic addresses to the NMS to enable the NMS to store address lists of respective users. In this manner the NMS can communicate the address lists and any updates e.g. address additions address deletions address modifications etc. thereto to respective VoIP devices e.g. the VoIP device . The VoIP devices store their respective address lists and are configured to present the geographic addresses in the address lists to their corresponding users as selectable choices that the user can select to indicate a current geographic address. In some example implementations a VoIP device may be configured to request an address list update during a boot up process prior to requesting to be registered with the IMS . In other example implementations after registration the VoIP device may periodically or aperiodically query the NMS for updates to the configuration file and or the address list.

In some example implementations the LAM database is configured to receive geographic address information from a user before the user operates the respective VoIP device at the provided geographic address. For example a user may proactively provide geographic addresses of the locations at which the user foresees using his her VoIP device . Additionally or alternatively the LAM database may be configured to store geographic addresses automatically when subscribers provide current geographic address information each time they operate their VoIP device at a new location. For example a user may provide a current geographic address when the network prompts the user and the LAM database can record or store the provided current geographic address in a geographic address data record corresponding to that subscriber. In this manner the quantity of geographic address entries in the subscriber s address list increases each time the subscriber uses his her VoIP device at a new location and provides a current geographic address. When the user moves the VoIP device from one location to another and powers on the VoIP device the VoIP device can present the list of automatically compiled geographic addresses. If the current location of the VoIP device is one in which the user previously used the VoIP device the geographic address of the current location will appear in the list of addresses presented by the VoIP device and will be capable of being selected as the current geographic address. However if the current location of the VoIP device is one in which the user has not previously used the VoIP device and the user has not otherwise provided the geographic address of the current location to the LAM database via for example a website the user will need to provide the geographic address of the current location via for example a website a customer service agent the IVR a VoIP device user interface etc.

To validate geographic location information street addresses to be stored in the LAM database the IMS is provided with a master street address guide MSAG database . The MSAG database is configured to store a plurality of street addresses in a format compliant with the master street address guide MSAG standard. In the illustrated example when a subscriber provides a street address and the street address is stored in the LAM database the LAM database compares the user provided street addresses with known street addresses in the MSAG database to determine whether the provided street address is MSAG valid. If the provided street address is MSAG valid then the LAM database indicates the provided street address as validated and updates an address list for the corresponding user to include the validated street address. Otherwise if the provided street address is not MSAG valid e.g. the address includes a typographical error an incorrect zip code etc. the LAM database indicates that the provided street address is not validated. The user is then able to access the provided street address via the web server to correct delete or replace the invalid street address.

To enable each of the analog telephones to communicate information via a session initiation protocol SIP each of the ATA s integrated in the gateway is provided with a gateway integrated SIP user agent SIP UA . When the site gateway is powered the SIP UA s register with the IMS to enable the analog telephones to make VoIP calls. Each time the site gateway is booted e.g. each time power is cycled the SIP UA s re register with the IMS . Also each time the site gateway is booted the DHCP server of the IP network may assign the same or a different public IP address to the site gateway

In the illustrated example the VoIP device includes a SIP UA and is capable of exchanging digital information network packets with the site gateway . Accordingly it is not necessary to use another SIP UA e.g. one of the SIP UA s or an ATA e.g. the ATA in the site gateway for communications with the VoIP device . As shown the site gateway is provided with an RJ 45 port to which the VoIP device is communicatively coupled. In addition the site gateway is provided with a router for routing the network traffic corresponding to the VoIP device . In the illustrated example the site gateway assigns a unique private IP address to the SIP UA of the VoIP device . After the site gateway is powered and the VoIP device is connected to the RJ 45 port the SIP UA registers the VoIP device with the IMS to enable the VoIP device to make VoIP calls. Each time the VoIP device is re connected to the site gateway or is connected to a different site gateway e.g. the site gateway of the SIP UA re registers with the IMS .

The VoIP device can be associated with one or more telephone numbers used to implement public user ID s PUID s . In the illustrated example a PUID is used to establish a VoIP call with a VoIP device . A conventional XXX YYY ZZZZ type phone number can be used as the PUID. Alternatively or additionally the PUID may be implemented using any other format instead of a telephone number format e.g. an e mail address format . When a user subscribes to a VoIP telephony service or adds a VoIP telephone line the NMS of a VoIP service provider allocates a PUID e.g. a telephone number to the user and stores geographic location information e.g. a street address in the LIS database in association with the PUID. In addition the NMS identifies a plurality of features e.g. nomadic enabled or nomadic blocked associated with the PUID and stores the features in the HSS database . For example if the user expects to operate the VoIP device at a single location e.g. the subscriber site the user may elect to block nomadic operation of the VoIP device. If the VoIP device is moved to another geographic location the VoIP service provider will deny the VoIP device access to VoIP services because it is designated as nomadic blocked. However if the user expects to move the VoIP device between different sites e.g. between the subscriber sites the user may elect to allow nomadic operation of the VoIP device . In this manner when the VoIP device is moved to a different location the VoIP service provider will allow operation of the VoIP device because it is designated as nomadic allowed.

As shown in the data structure includes a site gateway ID column that is used to store site gateway identification numbers that uniquely identify the site gateway of . To indicate whether an ATA e.g. one of the ATA s is implemented within a gateway e.g. the gateway of the data structure includes a gateway internal ATA column . In the illustrated example the gateway internal ATA column can be used to indicate that the ATA s of are gateway internal ATA s.

The data structure is provided with a public user ID PUID column that is used to store a plurality of PUID s e.g. telephone numbers assigned to a subscriber account. The PUID s may be used with gateway internal ATA s e.g. the ATA s of and or with VoIP telephones e.g. the VoIP device . To associate a public IP address e.g. the public IP addresses A and B of with respective PUID s the data structure is provided with a registered public IP address column having a plurality of registered public IP addresses . In the illustrated example the registered public IP addresses are used to detect when a VoIP device associated with one of the PUID s may have been moved to another geographic location.

To indicate whether telephone numbers have been assigned a nomadic allowed or a nomadic blocked feature the data structure is provided with a nomadic block column that stores a plurality of nomadic service designators . Each of the nomadic service designators corresponds to one of the PUID s and indicates whether the corresponding PUID s is nomadic blocked Y or nomadic enabled N . A nomadic enabled N designator indicates a PUID and its associated VoIP device e.g. the VoIP device are allowed to access VoIP services when the associated VoIP device is moved away from a primary or pre designated geographic location.

To store operating modes associated with the PUID s used in combination with VoIP devices the data structure is provided with an operating mode column that stores operating mode designators e.g. the operating mode designators S S and S . In the illustrated example the operating mode designators in the operating mode column are stored in the feature server of . In the example of the S operating mode is an unrestricted operating mode in which a VoIP device can access substantially all VoIP services associated with a service subscription corresponding to the VoIP device or corresponding to the PUID s used with that VoIP device . In contrast the S operating mode is a suspended operating mode that restricts the VoIP device to use of a subset of the VoIP services associated with a service subscription corresponding to the VoIP device or PUID s used with the VoIP device . The S operating mode of the illustrated example allows the VoIP device to access the same or less VoIP services as those allowed in the S suspended operating mode. In some example implementations additional operating modes may be implemented e.g. an operating mode that disallows any incoming or outgoing calls .

Turning in detail to the example system to retrieve and store IP addresses e.g. the public IP address A and B of the public IP addresses of etc. the example system is provided with an IP address interface . In the illustrated example the IP address interface is implemented using the feature server of . The IP address interface is configured to receive public IP addresses e.g. registration public IP addresses via notifications from the HSS database when VoIP devices register with the IMS . The IP address interface also stores the public IP addresses in the feature server . In this manner the feature server can compare the received public IP addresses with future registration public IP addresses.

To compare registration public IP addresses used by VoIP devices with registered public IP address stored in association with VoIP devices or PUID s used in combination with the VoIP devices within the feature server of the example system is provided with an IP address comparator . The example system compares registration public IP addresses e.g. the public IP addresses A and B of with registered public IP addresses e.g. the registered public IP addresses of to determine whether VoIP devices may have been moved between geographic locations. In the illustrated example the IP address comparator may be implemented using the HSS database and an IP address comparator substantially similar or identical to the IP address comparator may be implemented using the feature server . In this manner when the VoIP device registers with the IMS the IP address comparator in the HSS database can compare the public IP address A a registration public IP address of the site gateway with a registered public IP address that was previously registered in association with the VoIP device . The HSS database can then determine a geographic location change status based on the comparison and allow the VoIP device to register based on the geographic location change status. In addition an IP address comparator in the feature server can compare registration and registered public IP addresses to determine if the feature server should change VoIP device operating modes from the S mode to the S mode.

To present messages to a user via the VoIP device the example system is provided with a user interface . In the illustrated example the user interface is implemented using the IVR system of and is configured to playback audio messages to a user via the VoIP device . For example the user interface may have an audio file player or a text to speech converter e.g. a speech synthesizer . Example audio messages include registered street addresses associated with the VoIP device and requests for user to confirm whether a registered street address is the same as a current street address of the VoIP device . Other example audio messages include informing a user via the VoIP device of operating modes of the VoIP device and information on how to update registered street addresses. In other example implementations the user interface may also be configured to communicate and or exchange text messages and or other messages e.g. video messages with the VoIP device so that some or all messages described above can be presented via a display of the VoIP device . In some example implementations the functionality described in connection with the user interface may be implemented using an external media server having a standard control interface and the user interface can be provided with a media server control interface to exchange information with the external media server.

To retrieve and or store registered and or user provided geographic location information e.g. registered street addresses the example system is provided with a geographic location interface . In the illustrated example the geographic location interface is implemented using the IVR of and is configured to access the LIS database to retrieve registered geographic location information associated with corresponding PUID s of VoIP devices. As discussed above a user may provide geographic location information via a web page served by the web server or via a customer service representative in the customer service center . The web server or the customer service center then communicate the user provided geographic location information to the LIS database . The LIS database then updates registered geographic location information stored therein using the user provided geographic location information if the validation database VDB of determines that the user provided geographic location information is valid e.g. valid based on the master street address guide MSAG standard .

To validate user provided geographic location information the example system is provided with a validator . In the illustrated example the validator is implemented using the VDB of and is configured to determine whether user provided geographic location information is MSAG valid. For example if the validator finds a street address stored in the VDB to match the user provided geographic location information then the validator indicates the user provided geographic location information is valid.

To update geographic location change statuses associated with VoIP devices e.g. the VoIP device of and their respective PUID s e.g. the PUID s of the example system is provided with a geographic location change status updater . In the illustrated example the geographic location change status updater is implemented using the feature server of and is configured to update the location change status e.g. geographic location has not changed geographic location may have changed etc. associated with a VoIP device when the IP address comparator determines that a registered public IP address associated with the VoIP device and a current public IP address used by the VoIP device during for example registration do not match.

To retrieve and store operating modes associated with VoIP devices the example system is provided with an operating mode interface . In the illustrated example the operating mode interface is implemented using the feature server of and is configured to store operating mode designators e.g. the operating mode designators of in the feature server and retrieve operating mode designators from the feature server .

To select operating modes for association with VoIP devices the example system of is provided with an operating mode selector . In the illustrated example the operating mode selector is implemented using the feature server of and is configured to select operating modes e.g. the operating modes S S or S based on location change statuses associated with VoIP devices based on whether registered geographic location information is up to date and or based on whether VoIP devices are in locations for which VoIP service providers can provide E911 service. To detect which operating modes are associated with VoIP devices the example system of is provided with an operating mode identifier . In the illustrated example the operating mode identifier is implemented using the feature server of .

To identify the type of calls initiated by VoIP devices the example system is provided with a call type identifier . In the illustrated example the call type identifier is implemented using the feature server and is configured to determine whether calls are being made to 911 or to a PUID authorized by a VoIP service provider. For example when the VoIP device is associated with the S suspended mode a VoIP service provider allows the VoIP device to make calls only to 911 or to pre selected authorized numbers e.g. a customer service number . To enable the allowed calls the call type identifier extracts information from a call initiation signal communicated by the VoIP device and identifies the call type.

To determine whether a VoIP service provider of the VoIP device can provide E911 service at a location within which the VoIP device is located the example system is provided with an E911 service verifier . In the illustrated example the E911 service verifier is implemented using the LIS database of . Also in the illustrated example if the E911 service verifier determines that the VoIP service provider of the VoIP device cannot offer E911 service the feature server is configured to forward any 911 calls made from the VoIP device to a 911 operator that will handle or process the 911 call without the location identifying features of E911 service.

To determine the service subscriptions associated with a particular VoIP device the example system is provided with a subscription services interface . In the illustrated example the subscription services interface is implemented using the HSS database of and is configured to retrieve service options e.g. the nomadic service designators of from subscriber accounts stored in the HSS database to determine the services to which users are subscribed.

To compare geographic addresses the example system is provided with a geographic address comparator . In the example illustrated in the geographic address comparator can be implemented using the device registrar of the CSC . The geographic address comparator is configured to compare a geographic address received during a SIP registration process from the VoIP device to a geographic address registered as a current geographic address for the VoIP device .

During the registration process of block the IP address interface stores the registration public IP address of the VoIP device in the feature server . At block to determine whether the registration public IP address associated with the VoIP device is different from the registered public IP address associated with the VoIP device the IP address comparator retrieves the registered public IP address and the registration public IP address from the feature server and compares the IP addresses to determine whether they are identical block . In the illustrated example the public IP addresses can be identical if the VoIP device registers or attempts to register from the same network location e.g. the subscriber site of two or more consecutive times because the public IP address of the network location gateway e.g. the public IP address A of the site gateway of is stored in the feature server during each registration process. In some cases during a first registration process the VoIP operating mode may be set to the S suspended mode if the user of the VoIP device does not confirm or update the registered geographic location information. Thus during subsequent registration attempts although the registered public IP address and the public IP address used to register the VoIP device may be the same the example system will limit operation of the VoIP device to the S suspended mode until the user confirms or updates the registered geographic location information.

If the public IP addresses are the same i.e. no IP address change has occurred block the operating mode identifier determines whether the operating mode associated with the VoIP device is set to the S unrestricted mode block . In the illustrated example the operating mode interface retrieves the current operating mode designator e.g. one of the operating mode designators of associated with the VoIP device from the feature server of and the operating mode identifier determines whether the operating mode designator indicates the S unrestricted operating mode block . If the operating mode identifier determines that the VoIP device operating mode is not set to the S unrestricted operating mode the operating mode identifier determines if the VoIP device operating mode is set to the S restricted operating mode block .

If the operating mode identifier determines that the operating mode is not set to the S restricted mode block or if the IP address comparator determines that the public IP address associated with the VoIP device has changed block the geographic location change status updater updates the location change status associated with the VoIP device to suspected location change block to indicate that the VoIP device may have been moved to a different geographic location. Also the operating mode selector sets the operating mode associated with the VoIP device to the S suspended mode block . For cases in which the operating mode selector has previously set the operating mode associated with the VoIP device to the S suspended mode the operating mode selector may be configured to confirm at block that the operating mode associated with the VoIP device is set to the S suspended mode.

The operating mode interface then stores the current operating mode associated with the VoIP device block in for example the feature server of e.g. in the operating mode column of . Also the IP address interface updates the registered public IP address associated with the VoIP device block in for example the feature server of e.g. in the public IP address column of by replacing the previously registered public IP address with the registration public IP address received at block .

The example system then determines whether it should continue monitoring VoIP device registration events block . For example the example system may determine not to continue monitoring if the monitoring operation of the example system is disabled by a VoIP service provider or if the monitoring operation of the example system is interrupt driven and monitors only upon detection of particular events e.g. a VoIP device plugged into the network . In an example implementation the example system is preferably but not necessarily configured to continuously monitor VoIP device registration events and block always returns control to block .

If the example system determines that it should continue monitoring for an IP address change block or if the operating mode identifier determines that the VoIP device is associated with the S restricted mode block or the S unrestricted mode block control returns to block for a subsequent registration of the VoIP device or any other VoIP device. Otherwise if the example system determines that it should not continue monitoring for an IP address change block then the process of is ended and or control is returned to a calling function or process.

Although the example process of uses the registered public IP address and the current public IP address the registration public IP address associated with the VoIP device to determine whether the VoIP device may have changed geographic locations in alternative example implementations other example methods may be used to detect geographic location changes of the VoIP device .

If the call type identifier determines that the call is not to 911 or to another authorized telephone number block the operating mode identifier determines whether the VoIP device operating mode is set to an S suspended operating mode block . If the operating mode identifier determines that the VoIP device operating mode is not set to an S suspended operating mode block i.e. the operating mode is instead set to the S restricted mode the user interface presents a message via the VoIP device to inform a user of the VoIP device that the VoIP device is within a location in which the VoIP service provider of the VoIP device cannot provide E911 service block . In the illustrated example the message is an audio message presented by for example the IVR system of but any other desired messaging medium may be employed.

If the operating mode identifier determines that the VoIP device operating mode is set to an S suspended operating mode block the geographic location information interface retrieves registered geographic location information e.g. a street address associated with the VoIP device block . In the illustrated example the geographic location information interface accesses the LIS database to retrieve the registered street address stored in association with the PUID of the VoIP device . The user interface then presents the registered geographic location information via the VoIP device block and requests the user of the VoIP device to confirm whether the registered geographic location is the same as the current geographic location of the VoIP device block . In the illustrated example the IVR system of implements the user interface and performs a text to speech conversion of the registered street address to present an audio message via the VoIP device . In other example implementations the LIS database may store audio files e.g. WAV files of registered street addresses and the IVR system may play back the audio files via the VoIP device . In addition in other example implementations the registered geographic location information may be presented block via text or video on a display screen of the VoIP device and or other user interface screens may be used to request the user to confirm the location of the VoIP device block . The NMS then stores the user response regarding whether the registered geographic location is the same as the current geographic location of the VoIP device block . In the illustrated example the user interface communicates the user response to the NMS along with the user s PUID and a date and time stamp of when the user responded and the NMS stores the user s PUID in association with the date and time stamp. In this manner the VoIP service provider can keep records of whether and when users confirmed their geographic location.

After the NMS stores the user response block the geographic location change status updater determines whether the user confirmed that the registered geographic location of the VoIP device is the same as the current geographic location of the VoIP device block based on for example the user response requested at block . For example the geographic location change status updater determines that the registered geographic location of the VoIP device is the same as the current geographic location if the user response confirmed e.g. Yes that the registered geographic location of the VoIP device is the same as the current geographic location. If the geographic location change status updater determines that the geographic locations are not the same or after the user interface informs the user that the VoIP device is within a location in which the VoIP service provider cannot provide E911 service block the user interface presents a website uniform resource locator URL address via the VoIP device block that the user can visit to provide updated geographic location information and or to obtain more information on the messages presented by the user interface . Additionally or alternatively the user interface offers to connect the user to a customer service agent block at the customer service center of . If the user elects to be connected to a customer service agent block then the user interface connects the call to a customer service agent block .

If at block the geographic location change status updater determines that the user confirmed that the geographic locations are the same the operating mode selector changes the VoIP device operating mode to the S unrestricted mode and the operating mode interface stores the operating mode block in for example the feature server of . The CSC of then completes the call block . The example process of then returns control to a calling function or process and or ends.

If the user of the VoIP device does not update the registered geographic location via a web page block and a customer service representative at the customer service center receives the user provided geographic location information block from the user of the VoIP device the customer service representative communicates the user provided geographic location information to the LIS database block .

After the LIS database receives the user provided geographic location information block or block the validator determines whether the user provided geographic location information is MSAG valid i.e. valid block . In the illustrated example the user provided geographic location information is a street address that the validator compares with addresses stored in the validation database VDB of to determine if the user provided street address is MSAG valid. If the user provided geographic location information is MSAG valid block the geographic location information interface updates the registered geographic location information in the LIS database with the user provided geographic location information block .

The E911 service verifier then determines whether the VoIP service provider of the VoIP device can provide E911 service at the user provided geographic location block . If the VoIP service provider cannot provide E911 service at the user provided geographic location block the NMS instructs the operating mode selector to change the operating mode associated with the VoIP device to the S restricted mode and stores the restricted mode designator block in for example the feature server .

If the validator determines that the user provided geographic location information is not MSAG valid block the web server or the customer service representative assisting the user of the VoIP device informs the user that the user provided geographic location information e.g. the street address is not valid block . The user must then provide another geographic location. In some cases the geographic location information may not be MSAG valid due to a typographical error a missing zip code or some other trivial mistake and the user need merely re type the geographic location information.

After informing the user that the user provided geographic location information is invalid or after changing the operating mode associated with the VoIP device to the S restricted mode and storing the restricted mode designator block or if the VoIP service provider can provide E911 service at the user provided geographic location block the web server or the customer service representative assisting the user of the VoIP device then determines whether to end the geographic address update process block . For example the web server may determine that it should end the process if the user of the VoIP device has closed or logged out of the web page used to update the geographic location information and or the customer service representative may determine to end the process if the user has elected to end the call with the customer service representative. If the web server or the customer service representative determines that the geographic location information update process should not end then control is passed back to block . Otherwise the process of ends.

As shown in the processor system includes a processor that is coupled to an interconnection bus . The processor includes a register set or register space which is depicted in as being entirely on chip but which could alternatively be located entirely or partially off chip and directly coupled to the processor via dedicated electrical connections and or via the interconnection bus . The processor may be any suitable processor processing unit or microprocessor. Although not shown in the system may be a multi processor system and thus may include one or more additional processors that are identical or similar to the processor and that are communicatively coupled to the interconnection bus .

The processor of is coupled to a chipset which includes a memory controller and an input output I O controller . A chipset provides I O and memory management functions as well as a plurality of general purpose and or special purpose registers timers etc. that are accessible or used by one or more processors coupled to the chipset . The memory controller performs functions that enable the processor or processors if there are multiple processors to access a system memory and a mass storage memory .

The system memory may include any desired type of volatile and or non volatile memory such as for example static random access memory SRAM dynamic random access memory DRAM flash memory read only memory ROM etc. The mass storage memory may include any desired type of mass storage device including hard disk drives optical drives tape storage devices etc.

The I O controller performs functions that enable the processor to communicate with peripheral input output I O devices and and a network interface via an I O bus . The I O devices and may be any desired type of I O device such as for example a keyboard a video display or monitor a mouse etc. The network interface may be for example an Ethernet device an asynchronous transfer mode ATM device an 802.11 device a digital subscriber line DSL modem a cable modem a cellular modem etc. that enables the processor system to communicate with another processor system.

While the memory controller and the I O controller are depicted in as separate functional blocks within the chipset the functions performed by these blocks may be integrated within a single semiconductor circuit or may be implemented using two or more separate integrated circuits.

Of course persons of ordinary skill in the art will recognize that the order size and proportions of the memory illustrated in the example systems may vary. Additionally although this patent discloses example systems including among other components software or firmware executed on hardware it will be noted that such systems are merely illustrative and should not be considered as limiting. For example it is contemplated that any or all of these hardware and software components could be embodied exclusively in hardware exclusively in software exclusively in firmware or in some combination of hardware firmware and or software. Accordingly persons of ordinary skill in the art will readily appreciate that the above described examples are not the only way to implement such systems.

The VoIP device includes the SIP UA described above in connection with to implement a SIP registration process. The VoIP device also includes a memory in which the VoIP device stores the geographic addresses in the geographic address list . The LAM database is configured to communicate the geographic addresses corresponding to different subscribers to the NMS after the geographic addresses are provided to the LAM database and validated as MSAG valid. The NMS is configured to communicate geographic address update information to the VoIP device when a geographic address corresponding to the account of the VoIP device is changed deleted from or added in the LAM database . In some example implementations the geographic address list is stored in a device configuration file not shown in the memory of the VoIP device . In the illustrated example a device configuration file is used in connection with registering the VoIP device with the IMS using for example a session initiation protocol SIP registration process. Alternatively the geographic address list can be stored in a file separate from the device configuration file.

In the illustrated example the VoIP device includes an update interface configured to request geographic address updates from the NMS . For example the update interface is configured to periodically or aperiodically request geographic address updates from the NMS . The NMS responds by communicating one or more if any geographic addresses from the list to the VoIP device .

After the VoIP device receives and stores one or more geographic addresses in the geographic address list and the VoIP device has been moved to a different location the VoIP device can present the one or more geographic addresses from the geographic address list to a user. For example as shown in the VoIP device includes a display configured to display information. In the illustrated example the VoIP device is configured to present an address selection screen having a plurality of geographic addresses from the geographic address list that are available for selection by a user as the current geographic address at which the VoIP device is being used. The user may provide a user selection via a user interface which may be implemented using one or more buttons one or more dials a touchscreen interface and or any other interface.

To communicate a current address selection to the LAM database the VoIP device is provided with a network interface . The network interface may be implemented using a hypertext transfer protocol over secure socket layer HTTPS interface to enable the VoIP device to access the LAM database securely via the Internet and or the NMS . After the network interface communicates the selected geographic address to the LAM database the LAM database can set the geographic address stored therein as the current address for the VoIP device .

In the illustrated example the record ID column indicates the record number for a particular data record in the data structure . The subscriber account ID column indicates the account ID of the subscriber to which a particular entry corresponds. The plurality of address lists stored in the data structure are identified by the subscriber account ID s. That is an address list corresponding to a particular subscriber includes the geographic addresses stored in the data structure in association with the account ID of that particular subscriber.

The VoIP public user ID column stores PUID s e.g. PUID s such as the PUID s of assigned to subscriber accounts. The VoIP private user ID column stores VoIP private user ID s. A VoIP user ID is a private identifier that is assigned to a user subscription associated with a VoIP device by a home network operator that provides VoIP services. The VoIP user ID can be used for registration authorization administration and accounting purposes. The geographic address column stores geographic addresses provided by subscribers. In the illustrated example one geographic address is stored in each data record of the data structure .

The current address column stores YES NO flag values to indicate whether geographic addresses stored in the geographic address column are set as a current address. In the illustrated example setting a flag value in the current address column to YES for a particular data record triggers an update process to update the current address for a corresponding VoIP device in the LIS database of . In this manner the LIS database has the current geographic address at which a VoIP device is being used and the LIS database can use the geographic address to provide current address information for use with E911 emergency services.

For each data record the last date used column stores a most recent date on which a corresponding geographic address was set as the current address. For each data record the status validated column stores a YES NO flag value to indicate whether a corresponding geographic address has been validated to be MSAG valid. As shown some data records contain a NO flag value in the status validated column to indicate that the corresponding addresses have not been validated or are not valid. The data structure is configured to store the invalid data records to allow users to access the addresses to correct replace or delete the addresses.

In the illustrated example the schedule column stores schedule information that indicates subscriber provided days and or times on which corresponding geographic addresses should be automatically set to current addresses. That is the schedule column enables a subscriber to configure the LAM database to automatically select a geographic address as a current address for the VoIP device of that subscriber. For example if the subscriber has a recurring traveling schedule to the same geographic locations instead of manually selecting a current geographic address each time the subscriber registers the VoIP device at one of the different geographic locations the subscriber can provide scheduled dates and or date ranges that are stored in the schedule column and elect to have the LAM database automatically select current addresses based on the provided schedule information.

In the illustrated example of when a subscriber provides a new geographic address a new data record is created in the data structure and the account ID of that subscriber is stored in the subscriber account ID column for the new data record. To generate the geographic address list the LAM database is configured to search the data structure for data records associated with the subscriber account ID corresponding to the VoIP device and compile the geographic address entries from those data records into the geographic address list

To store data records substantially similar to the data records described above in connection with the example apparatus is provided with the memory . The memory is configured to store data records including the geographic addresses of . The memory may be implemented using for example any magnetic optical or solid state mass storage device.

To enable subscribers to access the information stored in the memory the example apparatus is provided with the subscriber access interface . In the illustrated example the subscriber access interface is configured to enable subscribers to add remove and or modify geographic addresses select geographic addresses as current addresses and or set scheduling information. The subscriber access interface can be implemented using a hypertext transfer protocol over secure socket layer HTTPS interface to enable subscribers to access the LAM database securely via the Internet. In some example implementations the subscriber access interface is implemented in connection with the web server of to provide access to the LAM database via a web page interface. In the illustrated example the subscriber access interface is also configured to provide customer service agents with access to the LAM database .

To enable VoIP service provider personnel or customer service agents to access the information stored in the memory the example apparatus is provided with the service provider access interface . In the illustrated example the service provider access interface is configured to enable VoIP service provider personnel or customer service agents to add remove and or modify geographic addresses select geographic addresses as current addresses set scheduling information and or to change any other information in the LAM database . In the illustrated example the service provider access interface is configured to provide access to the LAM database from within a private network e.g. an intranet a secure network etc. of the VoIP service provider. The service provider access interface may be implemented in connection with for example an intranet web server to provide access via an intranet web page. In some example implementations the service provider access interface may also be configured to enable network operators to access the LAM database to perform routine system administration tasks.

To enable the device registrar of the CSC to access the information stored in the memory during a SIP registration process the example apparatus is provided with the device registrar interface . In the illustrated example the device registrar interface is configured to enable subscribers to select geographic addresses as current addresses during a SIP registration process. A SIP registration process is configured to complete registration or deny registration within a particular amount of time so that a user is not made to wait an excessive amount of time before knowing whether the VoIP device has or has not been registered. In the illustrated example the device registrar interface is configured to exchange information related to updating current addresses with the CSC in real time to meet the time requirements and constraints of a SIP registration process. The device registrar interface can be implemented using a Java application programming interface API or any other API.

To validate user provided geographic addresses the example apparatus is provided with the validator . In the illustrated example the validator is configured to determine whether user provided geographic addresses are MSAG valid based on for example address information stored in the MSAG database of . For example if the validator finds a street address stored in the MSAG database to match a user provided geographic address then the validator indicates the user provided geographic address is valid by setting a YES value in the status validated column for a corresponding data record. In the illustrated example if a geographic address has not been validated it cannot be used as a current address in the LIS database for use with E911 service.

To enable the LAM database to communicate validated geographic addresses for subscribers to the NMS the example apparatus is provided with the device configuration interface . In the illustrated example the device configuration interface can search the data structure s stored in the LAM database for data records associated with the subscriber account ID corresponding to a VoIP device of interest compile the geographic address entries from those data records into a geographic address list and communicate the geographic address list to the NMS . Alternatively the device configuration interface can communicate the geographic address entries to the NMS and the NMS can generate the geographic address list . The NMS can communicate updates to the geographic address list to the VoIP device . In the illustrated example when the VoIP device is booted up it checks with the NMS for any configuration updates and to determine whether the geographic address list has changed relative to a geographic address list stored in the VoIP device . If the geographic address list stored in the NMS is different from the geographic address list stored in the VoIP device the NMS communicates the updated geographic addresses to the VoIP device . In this manner the VoIP device can ensure that it has the latest configuration file and geographic address list that includes all of the updated geographic address records from LAM database .

To trigger a current address update process to update a current address in the LIS database the example apparatus of is provided with a current address update interface . In the illustrated example the current address update interface is configured to detect when a geographic address entry is set to a current address in the current address column of the data structure . In response to detecting a setting of a current address the current address update interface is configured to automatically trigger an address update process to update the geographic address entry associated with a corresponding VoIP device and or subscriber account in the LIS database . In this manner the LIS database is automatically updated to include the current geographic address at which a VoIP device is being used and the LIS database can use the geographic address to provide current address information for use with for example E911 emergency services.

To automatically set a geographic address in the LAM database as a current address the example apparatus is provided with a scheduler . The scheduler is configured to retrieve scheduling information stored in the schedule column of the data structure and automatically set a geographic address in the data structure as the current address for a given VoIP device based on the corresponding schedule information.

To remove geographic address records from the LAM database the example apparatus is provided with a data record remover . In the illustrated example the data record remover is configured to search the data structure for data record s that have not recently been used as a current address and to delete those data records as stale. For example the data record remover can be provided with a threshold value specifying a quantity of days within which a data record must have been set as a current address. Any records that have not been set as a current address within the quantity of days threshold are removed by the data record remover . In this manner memory space in the LAM database can be reallocated to store new data records by deleting old data records which may have contained geographic addresses that were only visited once by a subscriber or that a subscriber is not likely to visit again or to visit in the near future.

To enable one or more application servers of a VoIP service provider to access the LAM database the example apparatus is provided with one or more application server interfaces . In addition to being used in connection with providing location based emergency services e.g. E911 services to users of VoIP devices the LAM database can also be used in connection with other location based services provided by VoIP service providers. For example based on a current geographic address set in the LAM database for a particular subscriber a VoIP service provider can communicate location specific information of interest to the VoIP device of the subscriber including for example location specific advertisements nearby points of interest location specific weather information or any other location based information. The application server interface s can be implemented using a secure access interface e.g. an HTTPS interface to enable application servers to access the information in the LAM database securely.

The VoIP device can then determine whether updates are available block for the device configuration file and or the geographic address list stored in the VoIP device by comparing the timestamp received from the NMS to the timestamp of the device configuration file and or the address list stored in the VoIP device . If the VoIP device determines that the configuration file and or the geographic address list require updates block the VoIP device requests the updates from the NMS block . The NMS then communicates the updates to the VoIP device block for the configuration file and or the geographic address list . For example to communicate one or more updates to the geographic address list the NMS communicates one or more geographic addresses from the geographic list to the VoIP device that the NMS received from the device configuration interface of the LAM database and that are not already stored in the geographic address list in the VoIP device . In this manner during an update the NMS is configured to communicate at least a partial copy of the geographic address list for storage in the geographic address list . The transmitted copy includes one or more geographic addresses that are not already stored in the geographic address list . In some example implementations the NMS may also communicate instructions or commands to the update interface of the VoIP device to delete one or more geographic addresses from the geographic address list that have been removed from the LAM database and or the geographic address list in the NMS .

After the VoIP device receives the update from the NMS the update interface updates one or more geographic addresses in the locally stored geographic address list block . For example the update interface can add a geographic address received from the NMS delete a geographic address indicated by the NMS or change a geographic addresses indicated by the NMS . Alternatively the update interface can overwrite the locally stored geographic address list with a new geographic address list received from the NMS .

After the VoIP device updates the geographic address list block or if the NMS determines that the VoIP device does not require an update to the configuration file and or the geographic address list block the VoIP device prompts a user to indicate whether to change a current address designation block . For example the VoIP device can present a text message via the display requesting the user to indicate whether the user would like to set a different current address.

The VoIP device then determines whether the user would like to change a current address designation block based on a user provided response to the question presented in connection with block . If the user provided response indicates the user would like to change a current address block the VoIP device presents one or more selectable geographic addresses from the locally stored geographic address list block . For example the VoIP device can present the list of geographic addresses via the display using a screen substantially similar or identical to the address selection screen of .

The VoIP device then receives a user selection block and determines whether the user selection includes a selection of a geographic address block . For example if the user selected one of the presented geographic addresses then the user selection will include a selection specifying the selected geographic address. On the other hand if the geographic address of the location at which the user is located is not stored in the geographic address list the user may elect not to select one of the presented geographic addresses and instead cancel the address selection screen . If the user does not select a geographic address the user can update the current geographic address designation via other methods including the example techniques described above in connection with the flowcharts of B and .

If the VoIP device determines that the received user selection includes a selection of a geographic address block the network interface communicates the current address selection to the LAM database block and the LAM database sets the current address in the data structure of block . For example the LAM database can set the current address for the VoIP device by setting the flag value to YES in the current address column for the data record corresponding to the selected geographic address and the subscriber account for the VoIP device . The LAM database also sets the flag value of a previous current address to NO.

When the current address update interface of the LAM database detects that the current address has changed the current address update interface triggers a current address update in the LIS database block . In this manner the LIS database is updated to store a current geographic address associated with the VoIP device for use with E911 emergency services.

After the current address update interface of the LAM database triggers the current address update in the LIS database block or if the VoIP device determines that the user selection does not include a geographic address selection block or if the user elected not to change a current address selection block the VoIP device registers with the IMS block by for example initiating a SIP registration process. After the VoIP device registers with the IMS the process of ends. In addition when the user places a call using the VoIP device the processes described above in connection with the flowcharts of A and B can be implemented to detect whether the VoIP device has changed locations and or to confirm that the geographic address designated as the current address in the LAM database and the LIS database is the geographic address of the location at which the user is using the VoIP device .

Picking up the discussion at block of after the VoIP device receives the user selection block the VoIP device determines whether the user selection includes a selection of a geographic address block from the address selection screen . If the VoIP device determines that the received user selection includes a selection of a geographic address the SIP UA of the VoIP device writes the selected geographic address into a registration header block . An example SIP registration header is shown in . In the illustrated example the SIP registration header includes a plurality of fields configured to store information associated with registering the VoIP device with the IMS . In addition the SIP registration header includes a geographic address field configured to store a current geographic address selected by a user and that the SIP UA writes into the geographic address field . The SIP registration header also includes an object ID that is used to store a record ID associated with the selected current geographic address in the geographic address field . Specifically the object ID corresponds to a record ID in the record ID column of stored in the LAM database for the geographic address written in the geographic address field . If the VoIP device determines that the user selection does not include a selection of a geographic address block control advances directly from block to block without passing through block such that the VoIP device does not write a geographic address into the geographic address field and the SIP registration of the VoIP device continues with a blank geographic address field .

After the SIP UA writes the selected geographic address into the registration header block or if the VoIP device determines that the user selection does not include a selection of a geographic address block or if the user elected not to change a current address selection block the VoIP device communicates a registration request and the registration header to the device registrar of the CSC block . When the device registrar of the CSC receives the registration request and the registration header block via for example a registration request interface the CSC determines whether the information received from the geographic address field is blank block by for example comparing the geographic address field information with a null value using the comparator .

If the CSC determines that the geographic address field is not blank block the device registrar in the CSC communicates the geographic address from the geographic address field and a nomadic service designator corresponding to the subscriber of the VoIP device to the device registrar interface of the LAM database block . A comparator of the device registrar interface compares the user selected geographic address specified in the geographic address field with a geographic address designated as a current location for the VoIP device in the LAM database block and determines whether these two geographic addresses match block . If the device registrar interface determines that the geographic addresses do not match block the device registrar interface determines whether the VoIP device is nomadic enabled block by for example checking the value of the nomadic service designator corresponding to the VoIP device . If the device registrar interface determines that the VoIP device is not eligible for nomadic use block the device registrar interface communicates a notification to the CSC directing the device registrar of the CSC to deny registration of the VoIP device and the device registrar of the CSC communicates a service denial message to the VoIP device block . The process of then ends.

If the device registrar interface determines that the VoIP device is eligible for nomadic use block the device registrar interface communicates the user selected geographic address from the geographic address field to the LAM database block . The LAM database then sets the current address in the data structure block . For example the LAM database can set the current address for the VoIP device by setting the flag value to YES in the current address column for the data record corresponding to the selected geographic address of the subscriber account for the VoIP device . The LAM database also sets the flag value of a previous current address to NO.

When the current address update interface of the LAM database detects that the current address has changed the current address update interface triggers a current address update in the LIS database block . In this manner the LIS database is updated to store a current geographic address associated with the VoIP device for use with E911 emergency services.

After the current address update interface of the LAM database triggers the current address update in the LIS database block or if the device registrar interface determines that the geographic address from the registration header matches the current address in the LAM database block or if the geographic address comparator determines that the geographic address field of the registration header is blank block the registration of the VoIP device with the IMS continues block so that the SIP registration of the VoIP device can be completed. After the VoIP device registers with the IMS the process of ends. In addition when the user places a call using the VoIP device the processes described above in connection with the flowcharts of A and B can be implemented to detect whether the VoIP device has changed locations and to confirm that the geographic address designated as the current address in the LAM database and the LIS database is the geographic address of the location at which the user is currently using the VoIP device .

The customer service representative or the web page then communicates the user provided geographic address es to the web server block and the web server communicates the user provided geographic address es to the LAM database block . After the subscriber access interface or the service provider access interface of the LAM database receive the geographic address es from the web server the LAM database stores the geographic address es in data records block of for example the data structure . The validator of the LAM database then determines whether the geographic address es are MSAG valid block by for example comparing the address es to geographic address es in the MSAG database . The validator then sets the status validated flags of the geographic address es block under the status validated column of the LAM database . For example the validator can set a status validated flag to YES for each geographic address that is MSAG valid and set a status validated flag to NO for each geographic address that is not MSAG valid.

The LAM database then commits the address updates block and the LAM database determines whether the user specified a current address block by for example selecting one of the user provided geographic addresses or another geographic address in the LAM database as a current address. If the LAM database determines that the user specified a current address block the LAM database sets the current address in the data structure block . For example the LAM database can set the current address for the VoIP device by setting the flag value to YES in the current address column for the data record corresponding to the selected current geographic address and the subscriber account for the VoIP device . The LAM database also sets the flag value of a previous current address to NO.

When the current address update interface of the LAM database detects that the current address has changed the current address update interface triggers a current address update in the LIS database block . In this manner the LIS database is updated to store a current geographic address associated with the VoIP device for use with for example E911 emergency services.

After the current address update interface of the LAM database triggers the current address update in the LIS database block or if the user did not specify a current address block the device configuration interface updates the geographic address list in the NMS block . For example the device configuration interface can search the data structure for data records associated with the subscriber account ID corresponding to the VoIP device compile the geographic address entries from those data records into the geographic address list and communicate the geographic address list to the NMS .

The NMS then notifies the VoIP device to update the geographic address list locally stored in the VoIP device block . The update interface of the VoIP device then receives the updated geographic address information e.g. additions deletions changes etc. from the NMS and updates the locally stored geographic address list block . The process of then ends.

At least some of the above described example methods and or apparatus are implemented by one or more software and or firmware programs running on a computer processor. However dedicated hardware implementations including but not limited to an ASIC programmable logic arrays and other hardware devices can likewise be constructed to implement some or all of the example methods and or apparatus described herein either in whole or in part. Furthermore alternative software implementations including but not limited to distributed processing or component object distributed processing parallel processing or virtual machine processing can also be constructed to implement the example methods and or apparatus described herein.

It should also be noted that the example software and or firmware implementations described herein are optionally stored on a tangible storage medium such as a magnetic medium e.g. a disk or tape a magneto optical or optical medium such as a disk or a solid state medium such as a memory card or other package that houses one or more read only non volatile memories random access memories or other re writable volatile memories or a signal containing computer instructions. A digital file attachment to e mail or other self contained information archive or set of archives is considered a distribution medium equivalent to a tangible storage medium. Accordingly the example software and or firmware described herein can be stored on a tangible storage medium or distribution medium such as those described above or equivalents and successor media.

To the extent the above specification describes example components and functions with reference to particular devices standards and or protocols it is understood that the teachings of the invention are not limited to such devices standards and or protocols. Such devices are periodically superseded by different faster and or more efficient systems having the same general purpose. Accordingly replacement devices standards and or protocols having the same general functions are equivalents which are intended to be included within the scope of the accompanying claims.

Further although certain methods apparatus systems and articles of manufacture have been described herein the scope of coverage of this patent is not limited thereto. To the contrary this patent covers all methods apparatus systems and articles of manufacture fairly falling within the scope of the appended claims either literally or under the doctrine of equivalents.

