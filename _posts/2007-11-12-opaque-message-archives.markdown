---

title: Opaque message archives
abstract: A system includes a server equipped to generate a split encryption key having at least a first key portion and a second key portion, that is used by the server to encrypt at least a portion of a message. Additionally, the first key portion of the split encryption key is retained by the server, while the second key portion of the split encryption key is delivered to a sending client and is discarded from the server. The sending client in turn provides the second key portion to one or more recipients of the message to facilitate recipient access to the message.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08230517&OS=08230517&RS=08230517
owner: Kryptiq Corporation
number: 08230517
owner_city: Beaverton
owner_country: US
publication_date: 20071112
---
The present application is a continuation of U.S. patent application Ser. No. 10 394 441 filed Mar. 20 2003 entitled OPAQUE MESSAGE ARCHIVES and issued as U.S. Pat. No. 7 299 357 which claims to the benefit of provisional U.S. Patent Application No. 60 401 945 entitled SYSTEM FOR TRANSMITTING RULE BASED STRUCTURES SEMI STRUCTURED AND UNSTRUCTURED DOCUMENTS filed on Aug. 7 2002. Both applications are hereby fully incorporated by reference.

The present invention relates generally to the field of data processing. More specifically the present invention relates to a system and method for secure data storage through opaque message archives.

With advances in integrated circuit microprocessor networking and communication technologies an increasing number of devices in particular digital computing devices are being interconnected. This increased interconnectivity of computing devices has laid the groundwork for a communication infrastructure particularly well suited for electronic communications between such computing devices. More specifically the increased interconnectivity of computing devices has led to the near ubiquitous adoption of electronic mail email as a standard mode of communication.

In the past electronic mail communications were limited to the exchange of text based messages between a relatively small populous. Over time however email applications and associated communications protocols have become increasingly sophisticated enabling more complex messages to be exchanged between larger numbers of individuals. For example in addition to enabling the exchange of simple text messages many modern day email clients allow users to exchange complex multipart MIME Multipurpose Internet Mail Extensions encoded files as well as a wide variety of binary attachments. Furthermore with the introduction of web based email clients that utilize World Wide Web protocols such as the hypertext transmission protocol HTTP for the exchange of messages access to email has become even more prolific.

Unfortunately however with increased email accessibility has come the need for improved security with respect to transmission and storage of messages and data. For example although many existing email servers attempt to store email messages in a secure manner through techniques such as encryption the access information needed to decrypt encrypted messages is typically co located on the same server as the stored messages. Accordingly anyone who is able to gain access to the storage server whether it may be a system administrator or an unscrupulous hacker will have access to the encrypted messages as well as access to the information needed to decrypt those messages. Thus it should be readily apparent that by storing the access information necessary to gain access to encrypted data on the same device as the encrypted data itself the data may be susceptible to unauthorized viewing by anyone who is able to gain access to the storage server whether sanctioned or otherwise. Furthermore although many mail servers store secure messages on behalf of senders even a larger number of mail servers store unsecured messages and data on behalf of senders. Accordingly in the event that an unauthorized access did occur on a message storage server it may be very difficult for the server operator to prove that a particular message or file was not accessed without authorization.

In the description to follow various aspects of the present invention will be described and specific configurations will be set forth. However the present invention may be practiced with only some or all aspects and or without some of these specific details. In other instances well known features are omitted or simplified in order not to obscure the present invention.

The description will be presented in terms of operations performed by a processor based device using terms such as receiving determining rendering displaying and the like consistent with the manner commonly employed by those skilled in the art to convey the substance of their work to others skilled in the art. As is well understood by those skilled in the art the quantities take the form of electrical magnetic or optical signals capable of being stored transferred combined and otherwise manipulated through mechanical electrical and or optical components of the processor based device.

Various operations will be described as multiple discrete steps in turn in a manner that is most helpful in understanding the present invention however the order of description should not be construed as to imply that these operations are necessarily order dependent. In particular these operations need not be performed in the order of presentation.

The description repeatedly uses the phrase in one embodiment which ordinarily does not refer to the same embodiment although it may. Furthermore the terms comprising including having and the like as used in the present application are synonymous.

In one embodiment a storage server incorporated with the teachings of the present invention is employed to facilitate users of client devices in sending partially or fully secure email messages to one or more recipients. Similarly a user i.e. sender of an email client i.e. sending client incorporated with the teachings of the present invention is able to compose an email message to be delivered to one or more recipients in either a fully secured or partially secured manner. Furthermore the sender may employ one or more predefined or custom generated forms as a basis for the email message and or a message delivery notification designed to alert the recipient s of the availability of the email message and any possible attachments. In one embodiment a sender may require certain inputs to be entered by an intended recipient of a secure message whether fully or partially secure such as passwords or answers to survey questions before the recipient may be provided with the secure email message. In one embodiment the sender may elect to have the content of the delivered email be dependent upon the inputs provided by the recipient prior to delivery of the message. In a further embodiment a split encryption key methodology is utilized in which secure messages or portions of messages are stored in an encrypted form on the storage server in conjunction with only a portion of the access information necessary to access a given secure message.

In the following description including the claims unless further particularized or otherwise noted the term message is intended to broadly refer to electronic mail messages attachments and or data files in whole or in part whether or not they comprise a text binary or otherwise encoded form and whether or not they are transmitted via the Simple Mail Transport Protocol SMTP HTTP file transfer protocol FTP trivial file transfer protocol TFTP or otherwise.

Storage server represents a computing device equipped to receive communication requests from a sending client and securely store one or more messages and or data received from or identified by the sending client. In one embodiment storage server includes secure messaging services to encrypt messages data on behalf of sending client and to generate one or more encryption keys to facilitate recipient access to the encrypted messages data. In one embodiment storage server includes message notification and form generation logic to generate message notifications designed to notify recipients of a message as to the existence of the message on storage server .

Recipients represent one or more computing devices equipped with a generic user agent to receive and transmit network messages. In one embodiment recipients are equipped to receive SMTP based messages and to both receive and transmit HTTP based requests.

In the illustrated embodiment sending client transmits a request to storage server to store an identified message or portion of a message in a secure manner . In one embodiment the identified message is transmitted to storage server in association with the request whereas in another embodiment sending client merely indicates a message that has been previously stored by storage server . In one embodiment in response to the sending client s request storage server securely stores the identified message and generates access data associated with the securely stored message in the form of an access token. In one embodiment storage server securely stores the message by encrypting the message using a split encryption key having two or more key portions. In one embodiment storage server retains a first key portion and transmits a second key portion to the sending client. In other embodiments however storage server may employ other means of securely storing the message besides encryption.

Once generated the access token is returned to sending client by storage server . In one embodiment storage server integrates the access token with a message notification before transmitting the integrated notification to sending client . In another embodiment storage server transmits the access token to sending client where the access token is then integrated with a message notification by sending client . In various embodiments the message notification may be selected from one or more predefined notifications or it may be dynamically or manually generated by storage server and or sending client .

Sending client then transmits the integrated notification to one or more of recipients to facilitate recipient access to the message . In one embodiment message notifications are delivered from sending client to one or more recipients in the form of electronic mail messages using an email based communications protocol such as SMTP or X.400. Once a recipient has received a message notification in e.g. their email inbox the recipient may open and view the message notification as they would with any other email message. In one embodiment the recipient may utilize a user input device such as a mouse to select a hyperlink or one or more controls incorporated within the notification to initiate retrieval of one or more corresponding secure messages stored by storage server . In one embodiment the access token is submitted to storage server by one or more of recipients in response to recipient input .

In response to receiving the access token from the one or more recipient s storage server transmits the corresponding secure message or a portion thereof to recipient s . In one embodiment communications between sending client and storage server as well as communications between recipients and storage server occur in accordance with a first communication protocol such as HTTP whereas communications between sending client and recipients occur in accordance with a second communication protocol such as SMTP.

In the process described in the message notification was described as being generated and integrated with the access token by the server. In an alternative embodiment the sending client integrates the server generated access token with a message notification whether it be pre existing or dynamically generated . is a flow diagram illustrating an operational flow for secure message storage and sender based notification generation in accordance with one embodiment of the invention. In the illustrated embodiment a message that is to be securely stored and delivered in accordance with the teachings of the present invention is first identified to storage server block . In one embodiment sending client transmits the identified message to storage server whereas in another embodiment sending client identifies the message from amongst one or more messages previously stored by storage server . Once the message has been identified by storage server storage server encrypts the message block and generates one or more access tokens corresponding to the encrypted message block . In one embodiment the one or more access tokens include at least a portion of the access data needed to access the message. Once an access token is generated storage server transmits the token back to sending client block where the token is integrated with a message notification by sending client block . Thereafter sending client transmits the integrated message notification to one or more designated recipients block illustrates a graphical representation of one embodiment of a secure message delivery dialog through which a sender may initiate delivery of a secure message to one or more recipients. The sender may manifest their intent to have a particular message or attachment delivered in a secure manner through one or more graphical icons or controls such as Send Secure button as shown in . In the illustrated embodiment the sender may provide one or more addresses corresponding to one or more of message recipients in the To data entry field as well as the subject matter of the message in the Subject data entry field . In one embodiment the sender may enter free form text in message window that may be stored by storage server as part of a secure message or that may be incorporated as part of a message notification. Additionally the sender may identify one or more attachments e.g. via attachment field that are to be securely stored and delivered by storage server in association with the secure message.

In one embodiment as a result of the sender opting to deliver a message in a secure manner sending client transmits an HTTP based request to storage server that includes the body of the message and optionally any attachments that might accompany the message. The request may be characterized by a single exchange between sending client where the message is transmitted to storage server along with the request or by a series of exchanges between sending client and storage server where the message is transmitted by sending client at some point after an initial connection is established with storage server .

In one embodiment of the invention storage server generates message notifications to notify indicated recipients as to the presence of a secure message awaiting delivery to the recipients. illustrates a graphical representation of an example message notification designed for delivery to a recipient of a secure message in accordance with one embodiment of the invention. As shown message notification includes notification window having a text based notification displayed therein. In the illustrated embodiment the text based notification includes hyperlink which when selected by a recipient causes an access token associated with the corresponding secure message to be transmitted to storage server .

In accordance with one embodiment of the invention secure message notifications may be selected by e.g. a sender from a group of predefined message notifications or dynamically generated based upon one or more properties or characteristics associated with the corresponding secure message or based upon metadata that may accompany the message. In one embodiment a message notification may be based on characteristics such as the identity of the sender or recipients network domains associated with the sender or recipients the message subject the time that the message was sent length of the message and so forth. For example storage server might generate a message notification containing a particular branded logo for each secure message that is transmitted by an employee of a corresponding company subsidiary. Similarly storage server might generate a message notification conveying a patriotic look and feel that is to be used in conjunction with secure messages transmitted e.g. on July fourth.

In one embodiment of the invention storage server contains predefined forms that may be identified for secure delivery to one or more recipients. illustrates a graphical representation of a secure message delivery dialog in which a sender can identify a predefined form to be delivered as a secure message to one or more recipients in accordance with one embodiment of the invention. The secure message delivery dialog illustrated in is similar to the secure message delivery dialog depicted in except the secure message delivery dialog of includes form identification facilities such as pull down control that includes the names of available forms stored on storage server . In one embodiment the sender may select a predefined form and optionally provide supplemental information such as text or graphics via e.g. message window to be associated with the form. In one embodiment storage server may intersperse the supplemental information with the selected form to create a combined secure message to be stored by storage server . In another embodiment of the invention storage server may utilize the supplemental information to generate all or a portion of the message notification associated with the secure message.

In addition to predefined forms a sender can cause a custom form or notification to be generated whether by the storage server or by the sending client in order to facilitate post delivery solicitation of data from one or more message recipients. In one embodiment a sending client submits metadata to the storage server to facilitate generation of the form by the server.

In one embodiment form data provided by the sender such as that provided via table is transmitted to storage server which in turn utilizes the data to generate a corresponding form. In one embodiment storage server may update or supplement the generated form or form data based upon one or more rules dependencies or heuristics for example. After the form has been generated storage server stores the form in a secure manner and returns at least a portion of the access data corresponding to the form to sending client as described above. Sending client then delivers the access data to one or more recipients in association with a message notification generated by the sending client or the server. The recipient s may then retrieve the form using the access data and provide the solicited information accordingly. In one embodiment upon provision by the recipients of the solicited for data the form data is submitted to the server for processing.

In an alternative embodiment the sending client rather than server uses the form data provided by the sender such as via table to generate the custom form. The sending client then returns all or a portion of the form to the server for secure storage and the server returns access information associated with the stored form to the sending client. In one embodiment the sending client then packages the remaining i.e. non secure portion of the form along with the non secure information and delivers the package to the recipients. In one embodiment portions of a message or document that are going to be encrypted or otherwise stored in a secure manner are stored on the server whereas messages or portions of a message or document that are to remain non secure are retained on the sending client.

In one embodiment of the invention a sender may solicit pre delivery information i.e. data that is solicited from a recipient before delivery of an associated message from one or more recipients. In one embodiment a sender may require that certain inputs such as passwords or answers to survey questions be entered by an intended recipient of a secure message before the recipient may be provided with the secure email message. Moreover in one embodiment the sender may elect to have the content of the delivered email be dependent upon the inputs provided by the recipient prior to delivery of the message. In one embodiment the storage server utilizes one or more scripting technologies such as active server pages ASP or common gateway interface CGI scripting to dynamically determine a message or portion of a message to be delivered to one or more identified recipients based upon the inputs provided.

As was previously mentioned above with respect to various embodiments of the invention the storage server of the present invention stores messages and data in a secure manner on behalf of a sender for delivery to one or more recipients. In prior message storage arrangements where encryption techniques are used to store data on a central server it was often the case that the access information such as an encryption key necessary to access the stored data was stored on the same server as the data. These secure storage schemes are premised on the idea that the storage server itself is secure notwithstanding the fact that server administrators are typically granted full access to the data stored on a managed server and the fact that server is always susceptible to an attack by a hacker. Because the encrypted files and the access information such as the encryption keys necessary to access the files have historically been stored together on the same server the files stored on such a server are inherently at risk to unauthorized access.

In another aspect of the present invention a split or partial encryption key methodology is utilized in which a first encryption key portion is retained by the server and a second encryption key portion is delivered to a recipient to facilitate access by the recipient to a corresponding message or other electronic document. In one embodiment of the invention the server transmits the second encryption key portion to the sending client of the message which in turn delivers the second encryption key portion to a recipient in association with a message notification. Although for the purpose of clarity the following description focuses primarily on an embodiment of the present invention in which two encryption key portions are utilized the teachings herein may be extended to the use of multiple i.e. more than two key portions without departing from the intended spirit and scope of the invention.

After receiving the request the server generates a message identifier to be associated with and to uniquely identify the message. Additionally the server generates a split encryption key including at least a first key portion and a second key portion to be used to encrypt the message block . In one embodiment the message identifier represents a randomized seed value received in association with the sending client s request. In one embodiment the storage server generates one recipient individualized token for each recipient identified or enumerated to the storage server by the sending client. In one embodiment each individualized token is associated with the message identifier and includes an obfuscated combination of the first encryption key portion and a recipient individualized identifier in which the recipient individualized identifier may e.g. represent an email address or other means of differentiating one recipient from another.

The storage server then returns the message identifier and the first encryption key portion to the sending client and removes the first encryption key portion from the storage server block . In one embodiment the storage server also returns the one or more recipient individualized tokens to the sending client. In response the sending client transmits the message to the storage server in association with the message identifier and the first encryption key portion block . The storage server then compares the message identifier received from the sending client with one or more message identifiers known to the storage server in order to identify determine the second encryption key portion associated with the message identifier s and in turn the message block . The storage server then uses the first and second encryption key portions to encrypt and store the message block . Additionally the sending client delivers a message notification including at least the first encryption key portion to one or more intended recipients to facilitate recipient access to the stored message block . In one embodiment the message notification whether generated in whole or in part by the sending client or the storage server includes a recipient individualized token.

In one embodiment each recipient access is logged by the storage server and associated with the message identifier. In one embodiment the sending client deposits the message identifier and the first encryption key portion into one or more of the sending client s mail folders such as a sent mail folder for use e.g. in obtaining log information about the associated message such as whether a recipient has read the message or forwarded to message to another recipient.

Except for the teachings of the present invention as incorporated herein each of these elements may represent a wide range of these devices known in the art and otherwise performs its conventional functions. For example processor may be a processor of the Pentium family available from Intel Corporation of Santa Clara Calif. which performs its conventional function of executing programming instructions of operating system and secure messaging services including those implementing the teachings of the present invention. ROM may be EEPROM Flash and the like and memory may be SDRAM DRAM and the like from semiconductor manufacturers such as Micron Technology of Boise Id. Bus may be a single bus or a multiple bus implementation. In other words bus may include multiple properly bridged buses of identical or different kinds such as Local Bus VESA ISA EISA PCI and the like.

Mass storage may represent disk drives CDROMs DVD ROMs DVD RAMs and the like. Typically mass storage includes the permanent copy of operating system and secure messaging services . The permanent copy may be downloaded from a distribution server through a data network such as the Internet or installed in the factory or in the field. For field installation the permanent copy may be distributed using one or more articles of manufacture such as diskettes CDROM DVD and the like having a recordable medium including but not limited to magnetic optical and other mediums of the like.

Display device may represent any of a variety of display types including but not limited to a CRT and active passive matrix LCD display while cursor control may represent a mouse a touch pad a track ball a keyboard and the like to facilitate user input. Communication interface may represent a modem interface an ISDN adapter a DSL interface an Ethernet or Token ring network interface and the like.

In accordance with a further aspect of the invention an enterprise based secure messaging system will now be described. illustrates an enterprise based secure messaging system including various logical device interactions in accordance with one embodiment of the invention. The enterprise based messaging system of is similar in form to the messaging system of except that message routing server and local mail server have been inserted between sending client and and storage server . In accordance with one embodiment of the invention local mail server represents a server equipped with electronic mail services such as those provided by Exchange from Microsoft Corporation or Domino from IBM Corporation to receive outgoing message transmission requests from clients and to receive incoming messages to be delivered to clients and and to temporarily store or queue both the outgoing and incoming messages until such time that the message destination domains devices can be determined and contacted.

Message routing server represents a server that routes mail traffic from local mail server and sending clients and to storage server and recipients much like a mail gateway. In one embodiment outgoing messages from local mail server are first directed to message routing server before they are delivered to storage server or recipients . In one embodiment message routing server proxies the functionality of sending client of .

In one embodiment of the invention a sender corresponding to either sending client or composes an SMTP based electronic mail message addressed to one or more recipients that is first delivered to local mail server . In one embodiment local mail server unconditionally transmits e.g. via redirection or forwarding messages it receives to message routing server whereas in another embodiment mail server may transmit messages to message routing server based upon whether or not the message is to be stored and delivered in a secure manner by storage server . In another embodiment of the invention sending client transmits an HTTP based request directly e.g. via a browser application to message routing server identifying the message to be securely stored and delivered effectively bypassing local mail server .

In one embodiment of the invention message routing server determines based e.g. upon a variety of criteria such as source or destination address content of the message size of the message . . . etc. whether a particular message is to be stored and delivered by storage server in a secure manner. In one embodiment the SMTP or HTTP based message includes an identifier e.g. in an associated header field that indicates to message routing server whether the message is to be securely stored and delivered in accordance with the teachings of the present invention.

If it is determined that an identified message is to be securely stored and delivered message routing server transmits a request to storage server to store the identified message or portion of a message securely . In one embodiment in response to the request of message routing server storage server securely stores the identified message and generates access data associated with the securely stored message. In one embodiment the access data is represented by an access token that may include just the access data or supplemental information in addition to the access data. In one embodiment storage server encrypts the message using a split encryption key having two or more key portions with storage server retaining a first key portion and transmitting a second key portion to the sending client. In other embodiments however storage server may employ other means of securely storing the message besides encryption.

Once generated the access token is returned to message routing server by storage server . In one embodiment storage server combines integrates the access token with a message notification and transmits the integrated message notification to message routing server . In another embodiment storage server transmits the access token to message routing server where message routing server integrates the access token with a message notification. In various embodiments the message notification may be selected from one or more predefined notifications or it may be dynamically or manually generated by storage server and or message routing server . In one embodiment where multiple such message routing servers are utilized by various subsidiaries of a parent company for example each message routing server can be configured to generate subsidiary specific notifications notwithstanding that the message routing servers are each associated with the same storage server.

Once the access token is returned to message routing server message routing server transmits the integrated notification to one or more of recipients to facilitate recipient access to the message . In one embodiment message notifications are delivered from message routing server to one or more recipients in the form of an electronic mail messages using an email based communications protocol such as SMTP or X.400. Once a recipient has received a message notification in e.g. their email inbox the recipient may open and view the message notification as they would with any other email message. In one embodiment the recipient may utilize a user input device such as a mouse to select a hyperlink or one or more controls incorporated within the notification to initiate retrieval of one or more corresponding secure messages stored by storage server . In one embodiment the token is submitted to storage server by one or more of recipients in response to recipient input .

In response to receiving the access token from the one or more recipients storage server then transmits the corresponding secure message or a portion thereof to one or more indicated recipients . In one embodiment communications between message routing server and storage server as well as communications between recipients and storage server occur in accordance with a first communication protocol such as HTTP whereas communications between message routing server and recipients occur in accordance with a second communication protocol such as SMTP.

In one embodiment in addition to storage server returning the access token to message routing server storage server further returns one or more control parameters or instructions to message routing server to indicate whether any post processing in association with the message is to be performed. In one embodiment storage server returns one or more control parameters or instructions to message routing server to cause message routing server e.g. via local mail server or directly to return a message to sending client that includes an access token to facilitate client in accessing information as to the status of the corresponding message. In one embodiment message routing server returns a message identifier described above with respect to Opaque Archives and the first encryption key portion to the sending client for use e.g. by the sender in obtaining log information about the associated message such as whether a recipient has read the message or forwarded to message to another recipient.

Due to the influx of unsolicited email messages or SPAM that has proliferated throughout the Internet many mail servers have been configured to perform what are referred to as reverse domain name service or reverse DNS lookups. Each of these lookups typically entails a mail server determining the identity of a sending client through examination of data contained within or indicated by the to field appearing in the message header. The mail server then compares the address or domain corresponding to the determined sending client with the network address of the device from where the message originates e.g. as determined by the address associated with the device that opened the SMTP port connection . If the two addresses domains differ the receiving mail server assumes the message has been relayed without authorization designates the message as SPAM and rejects the message accordingly.

To facilitate delivery of the message delivery notifications to recipients behind certain firewalls for example without each notification being characterized as SPAM each message routing server is co located within the same domain of the sending client it supports. illustrates domain relationships between a storage server and multiple message routing servers within a secure messaging system in accordance with one embodiment of the invention. As shown storage server located in network domain is communicatively coupled to message routing servers . Each of message routing servers is in turn communicatively coupled to local mail servers and and sending clients and . Message routing server is co located with local mail servers and and sending clients within domain and message routing server is co located with local mail servers and and sending clients within network domain . Because message notifications are transmitted e.g. via message routing server from the same domain from which they originate e.g. via sending clients and a reverse DNS lookup performed on an associated message will not cause the message to be rejected by the receiving system.

While the present invention has been described in terms of the above illustrated embodiments those skilled in the art will recognize that the invention is not limited to the embodiments described. The present invention can be practiced with modification and alteration within the spirit and scope of the appended claims. Thus the description is to be regarded as illustrative instead of restrictive on the present invention.

