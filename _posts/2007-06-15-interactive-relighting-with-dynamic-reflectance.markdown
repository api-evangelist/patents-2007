---

title: Interactive relighting with dynamic reflectance
abstract: Interactive relighting with dynamic reflectance involves relighting a graphical scene with dynamic changes to the reflectance(s) in the graphical scene. A graphical scene may include source radiance, regions having reflectances, a surface spot, incident radiation from the source radiance at the surface sport, an incident direction, a viewing direction, exit radiance, and so forth. In an example embodiment, a graphical scene is relighted based on at least one adjusted reflectance of the graphical scene using an incident radiance at a surface spot that is separated into respective incident radiance components corresponding to different respective numbers of interreflections in the graphical scene. In another example embodiment, a graphical scene is relighted based on at least one adjusted reflectance of the graphical scene using a tensor representation for a reflectance of a surface spot with the tensor representation being segmented into three adjustable factors for lighting, viewing, and reflectance.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07884820&OS=07884820&RS=07884820
owner: Micorsoft Corporation
number: 07884820
owner_city: Redmond
owner_country: US
publication_date: 20070615
---
When computers first started displaying graphics the visual graphics were rudimentary. They tended to be limited to lines and then combinations of lines and blocks. Over time the capability of computers to display graphics has increased significantly. Computers can now display three dimensional 3D graphics with realistic looking surfaces.

In fact computer generated graphics are becoming more and more realistic. One approach to generating realistic looking graphics involves accurately mimicking the behavior of light as it propagates through a graphical scene including with respect to surfaces. The result can be impressive compared to the rudimentary lines and blocks of the past. Unfortunately accurately mimicking light propagation behavior within a graphical scene is computationally intensive. Consequently there are formidable barriers to displaying real world lighting effects in real time.

Interactive relighting with dynamic reflectance involves relighting a graphical scene with dynamic changes to the reflectance s in the graphical scene. A graphical scene may include source radiance regions having reflectances a surface spot incident radiation from the source radiance at the surface sport an incident direction a viewing direction exit radiance and so forth. In an example embodiment a graphical scene is relighted based on at least one adjusted reflectance of the graphical scene using an incident radiance at a surface spot that is separated into respective incident radiance components corresponding to different respective numbers of interreflections in the graphical scene. In another example embodiment a graphical scene is relighted based on at least one adjusted reflectance of the graphical scene using a tensor representation for a reflectance of a surface spot with the tensor representation being segmented into three adjustable factors for lighting viewing and reflectance.

This Summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used as an aid in determining the scope of the claimed subject matter. Moreover other method system scheme apparatus device media procedure API arrangement etc. implementations are described herein.

Generally embodiments for interactive relighting are described in which source radiance viewing direction and bidirectional reflectance distribution functions BRDFs can each be changed on the fly. In handling dynamic BRDFs described techniques efficiently account for the effects of BRDF modification on the reflectance and incident radiance at a surface point. For reflectance we describe a BRDF tensor representation that can be factorized into adjustable terms for lighting viewing and BRDF parameters. For incident radiance there exists a non linear relationship between global illumination and BRDFs in a scene. To address this nonlinearity we describe precomputed transfer tensors PTTs that decompose or separate global illumination into precomputable components that are each a function of BRDFs in the scene. These components can be relatively rapidly combined at run time to accurately determine incident radiance. We additionally describe a technique for efficient handling of high frequency mirror reflections by extracting them from the BRDF tensor representation and processing them using precomputed visibility information.

With computer graphics the visual quality of a computer generated scene can be appreciably enhanced by simulating the natural propagation of light. Before reaching the viewer light emitted from illumination sources may undergo a number of physical interactions in a scene giving rise to rich visual effects such as soft shadows and interreflections. Accounting for the myriad paths of light through a scene and their complex interactions with objects however involves a substantial expense in computation. For interactive real time relighting much of this global illumination computation may be performed in advance.

Although arbitrary environment lighting is possible at run time the exit radiance at a surface point may be efficiently evaluated using precomputed radiance transfers PRT in a conventional approach. Different transfer functions are pre computed for different levels of reflectance effects. For view independent diffuse reflections source lighting is transformed by a transfer vector into exit radiance from a surface point. For view dependent glossy reflections a transfer matrix is used to convert source illumination into a distribution of exit radiance that can be evaluated in the direction of the viewer. These radiance transfer functions are precomputed with respect to given BRDFs in the scene. As a result these reflectance material properties are effectively baked into the transfer mechanism and cannot be changed at run time for this existing PRT approach.

In contrast we describe an example interactive relighting technique that more generally accommodates changes in reflectance in addition to lighting conditions and viewing directions. The consideration of dynamic BRDFs in global illumination brings special challenges. BRDF models can be evaluated with respect to changing incident light distributions viewing directions and reflectance parameters. To facilitate this we describe example embodiments involving a reflectance tensor representation that can be factorized or segmented into adjustable components for each of these dynamic quantities.

As noted above another challenging issue is that incoming radiance at a surface point has a non linear relationship to BRDFs in a scene. This nonlinearity arises partly from the multiple times a light ray may interact with a surface or surfaces during global illumination such that the ray becomes transformed by the surfaces BRDFs multiple times. Because of this non linearity dynamic BRDFs cannot be incorporated into PRT or other linear precomputed light transport frameworks in the same manner as dynamic source lighting.

In contrast we describe an example approach that decomposes or separates the incoming radiance at a surface point into components that can be precomputed as a function of source radiance and reflectances in the scene. In an example embodiment these components specifically represent global illumination along different light paths that arrive at a given surface point. Precomputed transfer tensors PTT can relate these incident radiance components along each path to source illumination and scene reflectances. By precomputing PTTs and then evaluating and combining these components at run time example embodiments can efficiently determine the non linear changes in global illumination that result from modifications of reflectance parameters. With this PTT based formulation scenes can be interactively rendered with dynamic lighting conditions viewing directions and reflectances.

Aside from the challenges of computing the appearance effects of dynamic BRDFs the factorization of BRDFs used to facilitate precomputation involves an issue. For BRDFs with sharp specular components numerous basis terms are used for accurate reconstruction at a considerable expense in performance. To avoid the inefficiencies associated with large bases an example embodiment extracts the mirror parts of specular reflections from the BRDF tensor representation and processes them independently using an efficient procedure based on precomputed visibility information. This high frequency lighting is then combined with the PTT results to yield a final rendering.

Thus in an example embodiment the PTT technique facilitates interactive relighting generalized to also include dynamic BRDFs. With PTTs a factorized tensor representation of BRDFs and or separate processing of mirror reflections compelling transformations in the appearance of objects can be generated. Moreover the resulting global illumination effects in the surrounding scene can also be realistically produced. Certain described embodiments for interactive relighting with dynamic reflectance have a variety of example applications. One application is for real time rendering of scenes containing objects whose BRDFs are animated such the morphing of a human into a liquid metal robot . Another application is the interactive tuning of material properties under global illumination. Interactive relighting with dynamic reflectance can also be used in other applications.

Processing device may be realized as by way of example but not limitation a general personal computer e.g. a notebook desktop portable etc. computer a client server or workstation computer a television based device an entertainment appliance including portable ones a mobile phone a gaming device a personal digital assistant PDA a device otherwise described herein some combination thereof and so forth. An example embodiment for a processing device is described herein below with particular reference to .

In example embodiment s graphics component is capable of realizing one or more implementations of interactive relighting with dynamic reflectance. An example embodiment for a graphics component is described herein below with particular reference to . The visual results of interactive relighting with dynamic reflectance may be presented on display screen .

By way of example only a visual result is shown in block diagram at display screen . A graphical scene of a 3D chess board with multiple pieces is displayed. Interreflections of light are rendered in the illustrated chess scene. In fact the example chess scene is relighted while including light that has previously bounced off of zero one or two prior regions such as the board or chess pieces. Light interreflections and numbers of bounces are described further herein below.

In an example embodiment exit radiance is produced responsive to transferred incident radiance and reflectance at surface spot . An example quantitative implementation for this relationship is given below by equation 1 . In equation 1 exit radiance is represented by B transferred incident radiance is represented by I and reflectance at surface spot is represented by H.

In an example embodiment at action a graphical scene which includes a region having a reflectance is lighted with a light source a reflectance and a viewpoint. For example a graphics component may light a graphical scene. Examples of light sources reflectances viewpoints regions etc. are described further herein below with particular reference to .

At action the lighted graphical scene is displayed. For example the lighted graphical scene may be displayed on a display screen . At action the reflectance of the region of the graphical scene is adjusted. For example the reflectance of a visible or a hidden region may be adjusted.

At action the graphical scene is relighted based on the adjusted reflectance of the region. For example the adjusted reflectance whether visible or hidden may affect the incident light at a given surface spot. Thus when a reflectance is adjusted the appearance of the graphical scene may be updated by relighting the scene. The adjusted reflectance may correspond to a region generally or to the surface spot specifically.

The act s of block may be implemented in many different manners in accordance with described embodiments. Blocks A and B illustrate two different example embodiments. These two example embodiments may be implemented individually jointly simultaneously sequentially partially or fully overlapping and so forth.

At block A the graphical scene is relighted based on the adjusted reflectance of the region using an incident radiance that is separated into respective incident radiance components corresponding to different respective numbers of interreflections within the graphical scene. Example implementations of this embodiment are described further herein below with particular reference to .

At block B the graphical scene is relighted based on the adjusted reflectance of the region using a tensor representation for the reflectance that is segmented into three adjustable factors for viewing lighting and reflectance. Example implementations of this embodiment are described further herein below with particular reference to .

At action the relighted graphical scene having the adjusted reflectance is displayed. For example the relighted graphical scene may be displayed on a display screen . Changes to the graphical scene resulting from the reflectance adjustment and subsequent relighting may be readily apparent to the human eye.

In an example embodiment reflectance adjustor may perform act s of adjusting at least one reflectance of one or more regions of a graphical scene. Graphical scene display unit may perform act s of displaying on a display screen each graphical scene as it is relighted based on adjustments to reflectance source radiance viewpoint and so forth.

Graphical scene relighter relights a graphical scene based on adjustment s to one or more of source radiance viewing direction reflectance and so forth. Incident radiance components separator A separates the incident radiance into respective components corresponding to respective numbers of interreflections within the graphical scene. The components may comprise PTTs with each being a function of the reflectances of the scene.

Reflectance tensor factor segmenter B segments a tensor that represents reflectance at a surface spot into multiple factors. These factors may be adjustable and may be associated with viewing lighting reflectance etc. parameters. Example embodiments of these various components and acts are described in greater detail herein below.

Source radiance propagates through the scene undergoing global illumination effects such as interreflection at reflectance region H and shadowing at reflectance region H . Given a fixed spatial configuration of the scene this global illumination is influenced by the BRDFs of the objects within. However it should be understood that the principles of the described embodiments are not limited to relighting with a fixed spatial configuration.

Surface spot SS is a point area etc. on a surface. At a given surface spot the incoming global illumination referred to as transferred incident radiance is transformed into exit radiance according to the BRDF of the spot. Evaluating exit radiance in viewing direction VD yields the appearance of the point in the rendered image. As used herein incident radiance is a general term. However without loss of generality the more specific transferred incident radiance terminology is used herein in some descriptive portions.

With relighting the scene is to be rendered with changes in source radiance L and viewing angle or more generally also with changes in scene reflectances H. By way of example but not limitation reflectances H are represented as a n nmatrix where nis the number of distinct scene regions with dynamic BRDFs and nis the size of a basis used to represent reflectance parameters. From a rendering equation the exit radiance B of a scene point x can be formulated as the following relighting equation 1 

This relighting equation 1 is comprised of two major components. One component is the incident radiance I L H arriving at x which is dependent on the BRDFs in the scene as well as the source radiance L and the incident direction . The other component f H is the reflectance function which relates transferred incident radiance from direction to exit radiance with respect to the reflectance Hof the surface spot. In the following we describe example formulations for incident radiance and reflectance functions and then describe an example procedure for interactive relighting using these two components.

To handle global illumination in a manner that facilitates efficient run time evaluation of incident radiance we describe a scheme that divides or separates incident radiance into components that can be precomputed as a function of the BRDFs in the scene. In an example embodiment each component represents incident radiance with respect to a sequence of BRDF basis functions for surfaces along a light path from the environment map. Thus for light that reflects first from a region Rand then from a region Rbefore reaching the surface spot there is a component for each pair of BRDF basis functions from the two regions. We precompute PTTs with respect to the different sequences of BRDF basis functions. At run time these transferred incident radiance components are evaluated and combined according to current values of reflectance H and source radiance L.

In an example embodiment for processing sequences of BRDF basis functions we group light paths by the number of interreflections they include such that the incident radiance may be expressed as follows in equation 2 . . . 2 where Iis the total transferred incident radiance of light paths with k interreflections.

In most scenes there exist innumerable paths of global illumination. However because of surface absorption the magnitude of global illumination tends to decrease rapidly for larger values of k. Consequently for an example embodiment we consider transferred incident radiance for k 2. In addition the frequency characteristics of global illumination become considerably lower after each interreflection due to scattering of light so for further computational efficiency an example implementation involves modeling the transferred incident radiance of direct lighting Iin terms of wavelets of Iby fourth order spherical harmonics and of Ias a scalar.

Scene illustrates paths of global illumination with sequences of BRDF basis functions as modeled by PTTs. As shown Iincludes nseparate light paths with ndifferent basis functions for each path. For an example embodiment to expedite computation of Iat run time we precompute a PTT Tthat relates source radiance to transferred incident radiance with respect to each of these sequences of BRDF basis functions.

Specifically for one bounce interreflection we have a 4D tensor T l r p s in terms of source radiance wavelet l region r BRDF basis function p and spherical harmonic s of the transferred incident radiance. For two bounce interreflection we similarly consider light paths that involve n nordered pairs of regions with n npossible basis function pairs for each path. Because Iis a scalar we precompute a 5D PTT T l r p r p where the subscripts index the first and second interreflections.

In an example embodiment incident radiance is separated into respective components that are respectively associated with a different respective number of scene interreflections. Thus total incident radiance is effectively determined responsive to incident radiance with no interreflections incident radiance with one interreflection incident radiance with two interreflections and so forth.

For relatively efficient evaluation of reflectances at a surface spot we describe an example embodiment including a tensor BRDF representation that can be factorized into adjustable lighting viewing and reflectance terms. We model BRDFs from a set of reflectance data f h that may be generated from a given reflectance model taken from measurements of real materials some combination thereof and so forth. In the reflectance function model h indexes the BRDFs is the view direction and is the incident direction.

In an example embodiment reflectance at surface spot is determined responsive to a reflectance factor F a view factor F and a lighting factor F as well as a tensor core . Tensor core may be a third order reflectance tensor core D. Reflectance factor F U may be a matrix based on the sampling resolution of the reflectance index h. View factor F U may be a matrix based on the sampling resolution of the view direction . Lighting factor F U may be a matrix based on the sampling resolution of the incident direction .

For an example embodiment with PTTs for incident radiance and the tensor decomposition for reflectance functions the relighting equation 1 can be relatively rapidly evaluated at run time for arbitrary distant source radiance scene BRDFs and viewing directions.

By way of example only let the source radiance L be represented by a Haar wavelet basis L 1 l N such that L CL. The relighting equation 1 is rewritten using the reflectance function tensor approximation of equation 4 to obtain the exit radiance from equation 5 as follows 

The incidence component Urepresents the transferred incident radiance at x after modulation by the BRDF lighting factor U. We compute the incidence component Uat run time as separate terms in correspondence with PTTs as shown by equation 6 below 6 where Udenotes the incidence component for lighting that has undergone k interreflections before arriving at x. Each of these terms may be evaluated as described in the following sections. Direct Lighting

For direct lighting in an example embodiment transferred incident radiance is determined by the visibility of light sources. Denoting visibility from point x towards direction as v we can express the incidence component as follows in equation 7 

In evaluating the incidence component for one bounce interreflection at run time in an example embodiment inner products between the incident transfer tensor Tand the BRDF coefficients of each region are computed. They are added together to obtain the transferred incident radiance with which an inner product is computed with a matrix Cbased on the BRDF light factor as shown in equation 8A 

In an example embodiment for incident radiance after two bounces we instead process radiance transferred through ordered pairs r r of scene regions. Because transferred incident radiance after two bounces can be considered to arrive at surface spot x in a uniform distribution the incidence component is given by equation 9A 

The high frequency specular components of many BRDFs involve a large number of basis terms for accurate reconstruction but use of a large basis makes interactive performance all the more difficult. In an example embodiment to handle specular effects we extract the high frequency mirror part of specular reflection from the BRDF tensor. The high frequency mirror part can be relatively rapidly processed using precomputed visibility.

This specular component bifurcation divides BRDFs into a mirror part fand a remainder part fas shown in equation 10A below 

In an example implementation the BRDF tensor is computed using f while the effects of fare separately evaluated. For direct lighting the visibility map of the vertex is queried for the mirror direction of the view angle. If it is not occluded the corresponding light from the environment map is multiplied by fto obtain the mirror part. Otherwise the mirror part is computed with respect to transferred incident radiance from one bounce interreflection. The uniform incident radiance from two bounce interreflection may be disregarded. Mirror part extraction can produce significant reductions in approximation error for each of the sampled values of n n n.

Generally a device may represent any computer or processing capable device such as a server device a workstation or other general computer device a data storage repository apparatus a personal digital assistant PDA a mobile phone a gaming platform an entertainment device a router computing node a mesh or other network node a wireless access point some combination thereof and so forth. As illustrated device includes one or more input output I O interfaces at least one processor and one or more media . Media include processor executable instructions .

In an example embodiment of device I O interfaces may include i a network interface for communicating across network ii a display device interface for displaying information on a display screen iii one or more man machine interfaces and so forth. Examples of i network interfaces include a network card a modem one or more ports a network communications stack a radio and so forth. Examples of ii display device interfaces include a graphics driver a graphics card a hardware or software driver for a screen or monitor and so forth. Examples of iii man machine interfaces include those that communicate by wire or wirelessly to man machine interface devices e.g. a keyboard a remote a mouse or other graphical pointing device etc. .

Generally processor is capable of executing performing and or otherwise effectuating processor executable instructions such as processor executable instructions . Media is comprised of one or more processor accessible media. In other words media may include processor executable instructions that are executable by processor to effectuate the performance of functions by device . Processor executable instructions may be embodied as software firmware hardware fixed logic circuitry some combination thereof and so forth.

Thus realizations for interactive relighting with dynamic reflectance may be described in the general context of processor executable instructions. Generally processor executable instructions include routines programs applications coding modules protocols objects components metadata and definitions thereof data structures application programming interfaces APIs etc. that perform and or enable particular tasks and or implement particular abstract data types. Processor executable instructions may be located in separate storage media executed by different processors and or propagated over or extant on various transmission media.

Processor s may be implemented using any applicable processing capable technology and one may be realized as a general purpose processor e.g. a central processing unit CPU a microprocessor a controller etc. a graphics processing unit GPU a derivative thereof and so forth. Media may be any available media that is included as part of and or accessible by device . It includes volatile and non volatile media removable and non removable media storage and transmission media e.g. wireless or wired communication channels hard coded logic media combinations thereof and so forth. Media is tangible media when it is embodied as a manufacture and or as a composition of matter. For example media may include an array of disks or flash memory for longer term mass storage of processor executable instructions random access memory RAM for shorter term storing of instructions that are currently being executed and or otherwise processed link s on network for transmitting communications and so forth.

As specifically illustrated media comprises at least processor executable instructions . Generally processor executable instructions when executed by processor enable device to perform the various functions described herein. Such functions include but are not limited to i those actions that are illustrated in flow diagram of ii those actions implementable by the components of graphics component of iii those actions undertaken for graphical processing e.g. of and iv the graphical renderings and lightings of other FIGS. other algorithms described herein combinations thereof and so forth.

The devices acts aspects features functions procedures modules data structures techniques components parts etc. of are illustrated in diagrams that are divided into multiple blocks and other elements. However the order interconnections interrelationships layout etc. in which are described and or shown are not intended to be construed as a limitation and any number of the blocks and or other elements can be modified combined rearranged augmented omitted etc. in any manner to implement one or more systems methods devices procedures media apparatuses arrangements etc. for interactive relighting with dynamic reflectance.

Although systems media devices methods procedures apparatuses mechanisms schemes approaches processes arrangements and other example embodiments have been described in language specific to structural logical algorithmic and functional features and or diagrams it is to be understood that the invention defined in the appended claims is not necesarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

