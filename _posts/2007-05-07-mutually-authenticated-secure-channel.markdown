---

title: Mutually authenticated secure channel
abstract: A system and methods for establishing a mutually authenticated secure channel between a client device and remote device through a remote access gateway server. The remote access gateway server forwards secure connection requests and acknowledgements between the client and the remote device such that the remote access gateway does not possess any or all session keys necessary to decrypt communication between the client device and remote device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08782414&OS=08782414&RS=08782414
owner: Microsoft Corporation
number: 08782414
owner_city: Redmond
owner_country: US
publication_date: 20070507
---
Current operating systems provide functionality for a user to connect to a personal computer remotely establish a remote access session and interact directly with the user interface of the remote personal computer as though the user were logged in directly. To perform such functionality the operating system receives mouse and keyboard information and sends screen updates to reflect the state of the operating system over the network connection. The network connection may be secure and or the data sent as part of the remote desktop session may be encrypted.

The following presents a simplified summary of the disclosure in order to provide a basic understanding to the reader. This summary is not an extensive overview of the disclosure and it does not identify key critical elements of the invention or delineate the scope of the invention. Its sole purpose is to present some concepts disclosed herein in a simplified form as a prelude to the more detailed description that is presented later.

The present example provides a system and methods for establishing a mutually authenticated secure channel between a client device and remote device through a remote access gateway server. The remote access gateway server forwards secure connection requests and acknowledgements between the client and the remote device such that the remote access gateway does not possess any or all session keys necessary to decrypt communication between the client device and remote device.

Many of the attendant features will be more readily appreciated as the same becomes better understood by reference to the following detailed description considered in connection with the accompanying drawings.

The detailed description provided below in connection with the appended drawings is intended as a description of the present examples and is not intended to represent the only forms in which the present example may be constructed or utilized. The description sets forth the functions of the example and the sequence of steps for constructing and operating the example. However the same or equivalent functions and sequences may be accomplished by different examples.

Although the present examples are described and illustrated herein as being implemented in a mutually authenticated secure channel system the system described is provided as an example and not a limitation. As those skilled in the art will appreciate the present examples are suitable for application in a variety of different types of mutually authenticated secure channel system systems.

A user may own one or more personal computers and other networked devices at their home. The one or more personal computers and any other networked devices may be connected to the internet through a network switch. The network switch may include network address translation NAT functionality and may also implement firewall functionality to prevent unauthorized access to the one or more personal computers and any network devices from the internet.

A user may establish a remote desktop session between a client personal computer and a remote personal computer or device. The user must know the network address of the remote personal computer to which the user wishes to connect. However if each of the user and the remote personal computer are located behind a firewall it may be difficult or not possible for the user to discover the current network address of the remote personal computer.

A mutually authenticated secure channel system enables the user to establish and keep alive a secure connection between the remote personal computer and a remote activation gateway server. The user may then log on to another personal computer connect to a remote activation gateway index server and discover the remote activation gateway server to which the remote personal computer is connected. The user may then connect to the appropriate remote activation gateway server establish a secure connection to the remote activation gateway server and the remote activation gateway server may facilitate an encrypted channel between the user s personal computer and the remote personal computer such that any and all of the information sent may not be intercepted and read by a hacker or other unauthorized user.

While the present example mutually authenticated secure channel system is discussed in the context of remote desktop connections it is to be appreciated that such an example mutually authenticated secure channel system may be used to facilitate a secure channel between any two networked devices for the exchange of any type of data.

Although not required embodiments of the invention will be described in the general context of computer readable instructions being executed by one or more computing devices. Computer readable instructions may be distributed via computer readable media discussed below . Computer readable instructions may be implemented as program modules such as functions objects Application Programming Interfaces APIs data structures and the like that perform particular tasks or implement particular abstract data types. Typically the functionality of the computer readable instructions may be combined or distributed as desired in various environments.

In other embodiments device may include additional features and or functionality. For example device may also include additional storage e.g. removable and or non removable including but not limited to magnetic storage optical storage and the like. Such additional storage is illustrated in by storage . In one embodiment computer readable instructions to implement embodiments of the invention may be stored in storage . Storage may also store other computer readable instructions to implement an operating system an application program and the like.

The term computer readable media as used herein includes computer storage media. Computer storage media includes volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions or other data. Memory and storage are examples of computer storage media. Computer storage media includes but is not limited to RAM ROM EEPROM flash memory or other memory technology CD ROM Digital Versatile Disks DVDs or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by device . Any such computer storage media may be part of device .

Device may also include communication connection s that allow device to communicate with other devices. Communication connection s may include but is not limited to a modem a Network Interface Card NIC or other interfaces for connecting computing device to other computing devices. Communication connection s may include a wired connection or a wireless connection. Communication connection s may transmit and or receive communication media.

Communication media typically embodies computer readable instructions or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term computer readable media may include communication media. The term modulated data signal means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example and not limitation communication media includes wired media such as a wired network or direct wired connection and wireless media such as acoustic radio frequency infrared and other wireless media.

Device may include input device s such as keyboard mouse pen voice input device touch input device infra red cameras video input devices and or any other input device. Output device s such as one or more displays speakers printers and or any other output device may also be included in device . Input device s and output device s may be connected to device via a wired connection wireless connection or any combination thereof. In one embodiment an input device or an output device from another computing device may be used as input device s or output device s for computing device .

Components of computing device may be connected by various interconnects such as a bus. Such interconnects may include a Peripheral Component Interconnect PCI such as PCI Express a Universal Serial Bus USB firewire IEEE 1394 an optical bus structure and the like. In another embodiment components of computing device may be interconnected by a network. For example memory may be comprised of multiple physical memory units located in different physical locations interconnected by a network.

Those skilled in the art will realize that storage devices utilized to store computer readable instructions may be distributed across a network. For example a computing device accessible via network may store computer readable instructions to implement one or more embodiments of the invention. Computing device may access computing device and download a part or all of the computer readable instructions for execution. Alternatively computing device may download pieces of the computer readable instructions as needed or some instructions may be executed at computing device and some at computing device . Those skilled in the art will also realize that all or a portion of the computer readable instructions may be carried out by a dedicated circuit such as a Digital Signal Processor DSP programmable logic array and the like.

The remote activation gateway server is communicatively coupled to the remote activation gateway index server . In this example initial state of the mutually authenticated secure channel system the client is communicatively coupled to the remote activation gateway index server by the connection and the remote device is communicatively coupled to the remote activation gateway server by the connection .

In order to establish a cryptographically strong identity the client includes a digital identity certificate . Similarly the remote device includes a digital identity certificate and the remote activation gateway server includes a digital identity certificate . Each of the digital identity certificates and are cryptographic public key certificates issued by a common certificate authority. As public key certificates each of the digital identity certificates and include any or all of a public cryptographic key an identifier a validity period the network address of a revocation center and the digital signature of the identity certificate as generated by the certificate authority. Each of the digital identity certificates and may be created in accordance with the Secure Sockets Layer SSL such that an SSL connection may be made using any or all of the digital identity certificates and .

The data center represents a sub network behind a firewall or other network security device. As such the data center may include any number of servers such as the remote activation gateway server and the remote activation gateway index server but may include any number of servers providing a variety of other functions such as hypertext transport protocol HTTP . The data center may include a number of switches routers as well as other network security devices to forward network data from outside the sub network to the appropriate server or other network device within the sub network.

Each of the client and the remote device are personal computers and may be implemented by the example computing device of . As previously discussed while each of the client and the remote device are discussed in the context of a remote desktop session each of the client and the remote device may be any type of networked device in accordance with the example computing device of . Furthermore each of the client and remote device may exchange any type of network data in addition to or instead of remote desktop session data.

The client and the remote device may execute software to participate in the mutually authenticated secure channel system . However the functionality necessary to participate in the mutually authenticated secure channel system may be included in an operating system or the like. Each of the client and the remote device may obtain a digital identity certificate and respectively from a certificate authority to participate in the mutually authenticated secure channel system e. The certificate authority verifies that the identity of the user of each of the client and remote device and securely issues the digital identity certificate and respectively to the client and the remote device . The certificate authority may securely issue each of the digital identity certificates and via an encrypted secure connection by mailing physical digital storage including the digital identity certificate and to the user for installation or any other method that ensures that the security of each of the digital identity certificates and is not compromised.

The remote activation gateway server also includes a digital identity certificate issued by the same certificate authority that issued each of the digital identity certificate to the client and the digital identity certificate to the remote device . The digital identity certificate may be installed on the remote activation gateway server using any secure method as previously discussed. For example the digital identity certificate may simply be sent from the certificate authority to the remote activation gateway server over a secure wired connection.

In preparation for establishing a mutually authenticated secure channel connection a user of the remote device connects to a registration service and registers the user s identity with the registration service. Such an identity may include any type of information including the user s name or user name another secure type of identifier or the like. The user may then associate the remote device with the user s identity within the mutually authenticated secure channel system . Note that it may be at this point that the digital identity certificate is issued to the remote device . Once the remote device is registered in the mutually authenticated secure channel system the identity of the user and the identity of the remote device are stored in the remote activation gateway index server .

Similarly the client may also register with the mutually authenticated secure channel system . The user may then establish a match between the client and the remote device by associating the digital identity of the client the remote device and the user s identity within the mutually authenticated secure channel system . In associating the digital identity of the client the remote device and the user s identity the user grants permission to the remote activation gateway server to connect the client and the remote device .

To begin a mutually authenticated secure channel session the remote device connects to the remote activation gateway server via the connection and begins sending any number of keep alive commands to prevent the connection from timing out. Once the remote activation gateway server has verified the identity of the remote device and completed the connection with the remote device the remote activation gateway server updates the entry stored at the remote activation gateway index server to indicate that the remote device is now connected to the remote activation gateway server .

The user of the client may then connect to the remote activation gateway index server via the connection . The client then establishes a cryptographically strong identity with the remote activation gateway index server and requests that the remote activation gateway index server provide an identifier of the remote access gateway to which the remote device is connected.

Turning now to shows an example data flow diagram in which the remote device from establishes a secure connection with a remote access gateway server from and in which the client from connects to a remote access gateway index server from to discover the identity of the remote access gateway to which the remote device is connected. Each of the client remote activation gateway index server remote activation gateway and remote device function similarly to like numbered elements of and will not be described again.

The remote device may initiate a mutually authenticated secure channel by establishing a connection with the remote activation gateway server . Such a connection may be a typical Transmission Control Protocol Internet Protocol TCP IP connection or the like. The remote activation gateway responds with an acknowledgement to the remote device to establish the connection.

The remote device may then send a request to establish a secure connection with the remote activation gateway . Such a secure connection may be a Secure Sockets Layer SSL connection or any other type of secure connection. In such a secure connection each of the communicating entities are authenticated by an security authority and data passing over the secure connection may be encrypted.

The remote device and the remote activation gateway may each include a digital identity certificate for use in establishing the secure connection between the remote device and the remote activation gateway server . Once the remote activation gateway server has established the secure connection the remote activation gateway server may send a message to the remote device to notify the remote device that the secure connection has been established.

The remote device may then send keep alive commands to the remote activation gateway server to prevent the connection from timing out due to inactivity. For example the remote device may send a ping or other TCP IP command to the remote activation gateway server and receive an acknowledgement in response.

The client may then send a request to the remote activation gateway index server to determine the address of the remote activation gateway server to which the remote device is currently connected. Such a request may be made using any method for example a user on the client may instantiate a computer application to log in to the remote activation gateway index server . The remote activation gateway index server may then present the user with a list of all the remote devices associated with the user from which the user may select the remote device to which they wish to establish a mutually authenticated secure channel.

The remote activation gateway index server may then respond with the address of the remote access gateway server to which the remote device is connected. The client may then establish a connection with the remote access gateway server to which the remote device is connected. As has already been discussed with respect to the remote device the connection may be any type of network connection. Once the network connection between the client and the remote access gateway server has been established the remote access gateway server may respond to inform the client that the connection has been established.

The client may then send a request to the remote access gateway server to establish a secure connection . As discussed with respect to the remote device the secure connection may be any type of secure connection such as an SSL connection. Once the secure connection has been established the remote activation gateway server responds to the client to inform the client that the secure connection has been established.

Turning now to shows an example state of the mutually authenticated secure channel system from once the client from has connected to the remote access gateway from to which the remote device from is also connected. Each of the client remote activation gateway index server remote activation gateway and remote device function similarly to like numbered elements of and will not be described again.

After the example flow of has been performed the client is connected to the remote activation gateway server via a secure connection . As discussed in the discussion of the secure connection may be any type of secure network connection such as Secure Sockets Layer SSL connection. Accordingly the remote device is also connected to the remote activation gateway server by a secure connection .

Turning now to shows an example data flow diagram in which the client from sends a request for a mutually authenticated secure tunnel between the client from and the remote device from to the remote activation gateway from . Each of the client remote activation gateway and remote device function similarly to like numbered elements of and will not be described again.

The client may send a request to establish a mutually authenticated secure tunnel with the remote device to the remote activation gateway server . Such a request may be made using any method and for the purposes of discussion it may be assumed that such a request is made using a predetermined protocol shared by the client the remote activation gateway server and the remote client .

At this point the remote activation gateway server may establish the cryptographically strong identity of each of the client and the remote device . Such an establishment may be made via the use of a digital identity certificate on each of the client and the remote device . In response to a positive establishment of the cryptographically strong identities of each of the client and the remote device the remote activation gateway server allows communication between the client and the remote device .

The remote activation gateway server forwards the request to the remote device . The remote device may acknowledge or respond affirmatively or negatively to the request . Accordingly the remote activation gateway server forwards the response or acknowledgement to the client .

To establish the mutually authenticated secure channel the client sends a request to the remote activation gateway server to establish the mutually authenticated secure channel with the remote device . As the remote activation gateway server has established the cryptographically strong identity of each of the client and the remote device the remote activation gateway may forward the request for the secure channel from the client to the remote device . The request may include any security information for example a session key necessary to create a cryptographically secure connection between the client and the remote device .

At this point the remote device may also create any cryptographic session key necessary to create a secure connection with the client and send a response to the remote activation gateway server . The remote activation gateway server forwards the secure connection response from the remote device to the client . Once the response is received by the client a cryptographically secure connection is established between the client and the remote device and any communication between the client and the remote device may be decrypted only by the client and the remote device .

The client may then send encrypted traffic such as request to establish a remote desktop connection or other remote desktop data to the remote activation gateway server . The remote activation gateway server does not possess the session key necessary to decrypt the encrypted traffic and forwards the encrypted traffic to the remote device .

Similarly the remote device may send encrypted traffic such as graphical screen updates as part of a remote desktop session to the remote activation gateway server . As previously discussed the remote activation gateway server does not possess the session key necessary to decrypt the encrypted traffic and forwards the encrypted traffic to the client .

As discussed in the discussion of the client includes a session key to encrypt and decrypt data traffic sent to and received from the remote client . Similarly the remote device includes a session key to encrypt and decrypt data traffic sent to and received from the client . Such a session key and session key may any type of secure encryption key for example a Secure Sockets Layer SSL session key.

Also as discussed in the discussion of the remote activation gateway server forwards encrypted data traffic between the client and the remote device over the data forwarding connection . The remote activation gateway server does not include the session key necessary to decrypt the encrypted data traffic between the client and the remote device and therefore may not view or capture any communication between the client and the remote device .

