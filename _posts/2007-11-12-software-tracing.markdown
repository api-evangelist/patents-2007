---

title: Software tracing
abstract: A method for generating trace information for an exception in a software application, the software application having a traced mode for the generation of trace information and an untraced mode, and the software application further having a retry point as a defined point in a series of instructions for the execution of the software application, the method comprising the steps of: commencing execution of the software application in the untraced mode; on execution of the retry point, recording execution state information for the retry point; on occurrence of an exception at an exception point in the software application, reverting execution to the retry point using the recorded execution state information and switching to the traced mode; and in response to a determination that the exception point is executed in the traced mode, causing execution of the software application to proceed in the untraced mode.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08250543&OS=08250543&RS=08250543
owner: International Business Machines Corporation
number: 08250543
owner_city: Armonk
owner_country: US
publication_date: 20071112
---
This application claims the benefit of British Patent Application No. GB0623355.5 filed on Nov. 23 2006 which is incorporated by reference herein in its entirety.

The present invention relates to software problem diagnosis and more particularly to data capture techniques for facilitating software problem diagnosis.

Problems can be encountered during the execution of a software application. For example exceptions to the normal operation of the software application can manifest in various ways including but not limited to the following irregular or undesirable results erroneous data interruptions to execution poor performance excessive and unnecessary resource utilization abnormal or premature termination abnormal state and a complete failure of the application. The process of problem determination for such exceptions can involve the use of many tools and techniques. Perhaps most notably the capture of information relating to the state of a software application at the point of exception can be utilized. For example techniques such as First Failure Data Capture FFDC can provide an automated snapshot of a system environment when an unexpected internal error occurs. Furthermore the provision of memory and state dumps can be relied on in the event of software failure and is common in such software as operating systems.

The inadequacies of such data capture techniques in problem determination are familiar to those skilled in the art and include the limited scope of the data collected at the point of exception. For example it is not possible to retrieve state information leading up to an exception using such techniques. To address these deficiencies software tracing is often employed to monitor and record software application state information at execution time. In this way a rich set of valuable trace information can be recorded for the entire execution of a software application such that in the event of an exception state information for the entire period leading up to the exception is available to assist in problem determination.

However recording trace information routinely during the execution of a software application is burdensome and imposes a further resource requirement over and above that of the software application itself manifesting as a requirement for further storage and processing throughput. In some environments the burden of generating and recording trace information at execution time can be so great that it exceeds the resource requirements of the software application itself. For this reason a decision to include facilities for the generation and recording of trace information in a software application typically involves a compromise. The balance is between a resource efficient high performance software application and a rich set of trace information for use in the event of exceptions at runtime. Generally though regardless of how the balance is struck for a particular software application performance and reliability are likely to be compromised.

It would therefore be advantageous to provide the advantages of a software application that is free of the burden of routinely generating and recording trace information at runtime while also retaining the richness of trace data provided where such trace information is generated and recorded in the event of an exception.

The present invention accordingly provides in a first aspect a method for generating trace information for an exception in a software application the software application having a traced mode for the generation of trace information and an untraced mode and the software application further having a retry point as a defined point in a series of instructions for the execution of the software application the method comprising the steps of commencing execution of the software application in the untraced mode on execution of the retry point recording execution state information for the retry point on occurrence of an exception at an exception point in the software application reverting execution to the retry point using the recorded execution state information and switching to the traced mode and in response to a determination that the exception point is executed in the traced mode causing execution of the software application to proceed in the untraced mode.

In this way the software application executes in the traced mode during the retry execution of the software application between the defined retry point and the exception point. Notably the software application returns to the untraced mode once the exception point is executed in the traced mode during the retry execution. Thus trace information is generated for the retry of the software application only and not for the entire execution of the software application. Further trace information is not generated for the execution of the software application following the exception point during the retry execution since the software application is returned to the untraced mode at this point. In this way the extent of the execution of the software application which is undertaken in the traced mode is reduced to only that extent necessary to cover the retry execution. The impact of tracing the execution of the software application is therefore constrained to the retry execution.

The determination that the exception point is executed in the traced mode can include a determination that the software application enters an exception state at the exception point in the traced mode.

Alternatively the determination that the exception point is executed in the traced mode can include a determination that the retry point is to be removed from a call stack for the software application.

The execution state information can include all information required to allow the execution of the software application to restart from the retry point.

The present invention accordingly provides in a second aspect an apparatus for generating trace information for an exception in a software application the software application having a traced mode for the generation of trace information and an untraced mode and the software application further having a retry point as a defined point in a series of instructions for the execution of the software application the apparatus comprising means for commencing execution of the software application in the untraced mode means for on execution of the retry point recording execution state information for the retry point means for on occurrence of the exception at an exception point in the software application reverting execution to the retry point in the traced mode using the recorded execution state information and means for in response to a determination that the exception point is executed in the traced mode causing execution of the software application to proceed in the untraced mode.

The present invention accordingly provides in a third aspect an apparatus comprising a central processing unit a memory subsystem an input output subsystem and a bus subsystem interconnecting the central processing unit the memory subsystem the input output subsystem and the apparatus as described above.

The present invention accordingly provides in a fourth aspect a computer program element or computer readable storage medium comprising computer program code which when loaded into a computer system and executed thereon causes the computer to perform the steps of a method as described above.

Software routines A B and C are executable software components constituting part of or being called by the software application . For example the software routines can be functions procedures subroutines macros application programming interface routines programs subprograms software methods or any other executable program component. Software routines A B and C will include a series of instructions to the CPU of a computer system for their execution.

The software application is operable to generate trace information which is recorded in a data store. In this regard the software routine is operable in one of at least two modes including a trace mode . In the trace mode trace information is recorded to the trace information data store . In the absence of the trace mode such trace information is not recorded. Trace information can include by way of example only the state and content of data structures variables flags and other data items used by or included in the software application descriptive information relating to the state or functioning of the software application failure data information storage dumps software routine entry point information software routine exit point information call stack information and exception information. The trace mode is switchable to an on and off state at runtime. For example the trace mode can be a global flag accessible to all software routines in and used by the software application . In this way software routines are able to determine whether to generate and record trace information by interrogating the global flag. Other techniques for the operation of a trace mode will be apparent to those skilled in the art. When the trace mode is on trace information is generated which can affect system performance. When the trace mode is off trace information is not generated and system performance is not affected.

While the trace mode has been described as a polarized on and off system of operation it will be apparent to those skilled in the art that varying degrees of trace mode can be implemented and such variable tracing modes are entirely compatible with the exemplary embodiments of the present invention described herein. In particular the trace mode off can in practice be implemented as a reduced trace mode wherein trace information is generated at a coarser granularity or a lower frequency than in the trace mode on. In this regard the characteristics of the trace mode which are pertinent to the present description are that the trace mode off is less burdensome in that it may be less resource intensive require less processing overhead and or be less storage intensive for example than the trace mode on. 

The software application further includes an identification of an exception point . The exception point is a nominal identifier for the purpose of explanation only of a location in a series of instructions forming part of the software application or called by the software application where an exception occurs at execution time. Such an exception can include for example irregular or undesirable results erroneous data interruptions to execution poor performance excessive and unnecessary resource utilization abnormal or premature termination abnormal state and a complete failure of the application. Such exceptions are detectable by facilities such as error detection routines First Failure Data Capture FFDC facilities exception handlers error handlers and operating system interrupt or error handlers. In the example of software routine C is illustrated as including the exception point indicating that it is within software routine C that an exception will occur during execution.

The software application further includes a retry point which is a defined point in a series of instructions for the execution of the software application . The retry point can be defined by a software developer or an automated retry point defining routine. Such a routine may operate by scanning software routines comprising the software application and insert retry point using defined criteria. For example an aspect oriented software environment may weave retry point software aspects into software methods in accordance with an aspect definition. Such an aspect definition can include for example the entry or exit point of every method every occurrence of a particular method or function call every method executing at a regular frequency of temporal distance and the occurrence of a developer inserted indicator.

The retry point is a defined point in the execution of the software application for retrying execution of the software application in the event of an exception. When executed the retry point records execution state information to a data store. The execution state information includes all information required to allow the execution of the software application to restart from the retry point . For example the execution state information can include the call stack state local and global variable information and pertinent content in the memory of the computer system. A retry trace processor is operable to detect an exception at exception point and identify the appropriate retry point . The retry trace processor is then operable to retry the execution of the software application commencing from the retry point . An important part of the operation of the retry trace processor and the retry point is that the trace mode is turned on when execution is retried from the retry point . Subsequently when the exception point has been executed during the retry the trace mode is turned off. 

During retry the trace mode can be turned on by the retry trace processor or alternatively by the software routine B as part of the retry point . Subsequently the trace mode can be turned off in one of two main ways. Firstly if the exception point causes an exception during the execution from the retry point the retry trace processor will be triggered and the trace mode can be turned to off by the retry trace processor . Alternatively it is possible that the exception point does not cause an exception during execution from the retry point . This is a typical occurrence in software problem determination problems caused by such aspects as timing and synchronization may not be reproduced on subsequent execution of a software routine. In particular the very change to a trace mode of on can cause timing differences which manifest in an exception which is not reproducible. In this scenario the trace mode can be switched to off when the software routine B is to be removed from the call stack . The removal of software routine B from the call stack is an indication that the software routine C executed without exceptions and is a useful trigger to deactivate the trace mode . Thus regardless of whether the execution from the retry point results in an exception at the exception point the trace mode can be switched to an off state to prevent the undesirable burden of ongoing tracing during the subsequent execution of software application .

In this way the software application executes with the trace mode on during the retry execution of the software application between the define retry point and the exception point . Notably the software application returns to the trace mode off once the exception point is executed with trace mode on during the retry execution. Thus trace information is generated for the retry of the software application but not for the entire execution of the software application . Further trace information is not generated for the execution of the software application following the exception point during the retry execution since the software application is returned to the trace mode off. In this way the extent of the execution of the software application which is undertaken with trace mode on is reduced to only that extent necessary to cover the retry execution. The impact of tracing the execution of the software application is therefore limited to the retry execution.

While many of the elements of are represented as residing within the software application it will be apparent to those skilled in the art that these elements may alternatively reside outside the software application and instead reside elsewhere within a computer system such as in the storage of the computer system or may form part of another aspect of the computer system such as a part of the operating system. In particular the call stack data structure may be organized to reside outside the software application itself but within the storage of the computer system such as a memory of the computer system. Similarly the retry trace processor may be a facility provided in software or hardware outside the software application itself such as part of an operating system or a service component associated therewith.

The determination as to whether the exception point is reached is preferably made by recognizing that an exception has occurred during the retry execution or alternatively by recognizing that the software routine B having the retry point is to be removed from the call stack .

Insofar as embodiments of the invention described are implementable at least in part using a software controlled programmable processing device such as a microprocessor digital signal processor or other processing device data processing apparatus or system it will be appreciated that a computer program for configuring a programmable device apparatus or system to implement the foregoing described methods is envisaged as an aspect of the present invention. The computer program may be embodied as source code or undergo compilation for implementation on a processing device apparatus or system or may be embodied as object code for example.

Suitably the computer program is stored on a carrier medium in machine or device readable form for example in solid state memory magnetic memory such as disk or tape optically or magneto optically readable memory such as compact disk or digital versatile disk or other computer readable medium and the processing device utilizes the program or a part thereof to configure it for operation. The computer program may be supplied from a remote source embodied in a communications medium such as an electronic signal radio frequency carrier wave or optical carrier wave. Such carrier media are also envisaged as aspects of the present invention.

It will be understood by those skilled in the art that although the present invention has been described in relation to the above described example embodiments the invention is not limited thereto and that there are many possible variations and modifications which fall within the scope of the invention.

The scope of the present invention includes any novel features or combination of features disclosed herein. The applicant hereby gives notice that new claims may be formulated to such features or combination of features during prosecution of this application or of any such further applications derived therefrom. In particular with reference to the appended claims features from dependent claims may be combined with those of the independent claims and features from respective independent claims may be combined in any appropriate manner and not merely in the specific combinations enumerated in the claims.

