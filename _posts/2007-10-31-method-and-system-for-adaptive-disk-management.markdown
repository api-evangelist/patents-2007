---

title: Method and system for adaptive disk management
abstract: Provided herein are at least one embodiment of systems and methods of adaptive disk management for a recording device employing a memory storage device such as hard disk storage so that memory storage device usage is tracked in the recording device and the memory storage device is controlled based on time-based patterns of user behavior.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08474002&OS=08474002&RS=08474002
owner: Cisco Technology, Inc.
number: 08474002
owner_city: San Jose
owner_country: US
publication_date: 20071031
---
The present invention is generally related to media storage playback systems and more particularly is related to a system and method for maintaining storage and playback of media content.

With recent advances in digital transmission technology subscriber television systems are now capable of providing much more than the traditional analog broadcast video. In implementing enhanced programming the home communication terminal device HCT otherwise known as the set top terminal STT has become an important computing device for accessing media content services and media content within those services and navigating a user through a maze of available services. In addition to supporting traditional analog broadcast video functionality digital HCTs or DHCTs now also support an increasing number of two way digital services such as video on demand and personal video recording.

Typically a DHCT is connected to a cable or satellite or generally a subscriber television system and includes hardware and software necessary to provide the functionality of the digital television system at a user site. Typically some of the software executed by a DHCT is downloaded and or updated via the subscriber television system. Each DHCT also typically includes a processor communication components and memory e.g. RAM ROM and hard drive and is connected to a television or other display device such as a personal computer. While many conventional DHCTs are stand alone devices that are externally connected to a television a DHCT and or its functionality may be integrated into a television or personal computer or even an audio device such as a programmable radio as will be appreciated by those of ordinary skill in the art.

DHCTs are typically capable of providing users with a very large number and variety of media content choices. As the number of available media content choices increases viewing conflicts arise whereby the user must choose between watching two or more media content instances e.g. discrete individual instances of media content such as for a non limiting example a particular television show or program all of which the user would like to view. Further because of the large number of viewing choices the user may miss viewing opportunities. Storage devices such as hard drives coupled with the DHCT help alleviate this problem by providing a mechanism to store media content for later retrieval for viewing. However media content storage systems can cause a delay when not ready to access stored media content at the time of retrieval by a user. Similarly hard disk life can be shortened and power consumption unnecessarily increased if the hard disk stays in an active state when not needed. Therefore there exists a need to efficiently manage the storage and retrieval of media content.

Provided herein are systems and methods of adaptive disk management for a DHCT or any other media storage device employing a memory storage device such as hard disk storage as is known in the art so that memory storage device usage is tracked in a media recording playback device e.g. a recording device such as for example a DHCT a digital video recorder DVR computer etc. and controlling the memory storage device based on patterns of user behavior.

In one aspect a method of predictive management of a recording device is described. The method comprises setting a collection period comprised of a plurality of days dividing the collection period into a number of time segments and allocating a memory area to each time segment. User data is saved during the collection period. The user data is comprised of events caused by user activity or non events indicating a lack of user activity. User data is saved in the memory area for the time segment in which it occurs. Patterns of user behavior are determined by analyzing the memory areas for the time segments that comprise the collection period and corresponding user data associated with each time segment. The recording device is operated in accordance with the determined patterns of user behavior.

In another aspect a recording device with predictive disk management is described. The recording device is comprised of a memory a time shift buffer comprised of a hard disk drive and a processor. The processor is configured to execute executable code stored on the memory. The executable code performs the steps of setting a collection period comprised of a plurality of days dividing each day of the collection period into a number of time segments and allocating a memory area to each time segment. User data is saved during the collection period. The user data is comprised of events caused by user activity or non events indicating a lack of user activity. User data is saved in the memory area for the time segment in which it occurs. Patterns of user behavior are determined by analyzing the memory areas for the time segments that comprise the collection period and corresponding user data associated with each time segment. The time shift buffer of the recording device is operated in accordance with the determined patterns of user behavior.

Additional advantages will be set forth in part in the description which follows or may be learned by practice. The advantages will be realized and attained by means of the elements and combinations particularly pointed out in the appended claims. It is to be understood that both the foregoing general description and the following detailed description are exemplary and explanatory only and are not restrictive as claimed.

Before the present methods and systems are disclosed and described it is to be understood that the methods and systems are not limited to specific synthetic methods specific components or to particular compositions as such may of course vary. It is also to be understood that the terminology used herein is for the purpose of describing particular embodiments only and is not intended to be limiting.

As used in the specification and the appended claims the singular forms a an and the include plural referents unless the context clearly dictates otherwise. Ranges may be expressed herein as from about one particular value and or to about another particular value. When such a range is expressed another embodiment includes from the one particular value and or to the other particular value. Similarly when values are expressed as approximations by use of the antecedent about it will be understood that the particular value forms another embodiment. It will be further understood that the endpoints of each of the ranges are significant both in relation to the other endpoint and independently of the other endpoint.

 Optional or optionally means that the subsequently described event or circumstance may or may not occur and that the description includes instances where said event or circumstance occurs and instances where it does not.

The present methods and systems may be understood more readily by reference to the following detailed description of preferred embodiments and the Examples included therein and to the Figures and their previous and following description.

One embodiment of the present invention is generally implemented as part of a subscriber television system STS which includes for example digital broadband delivery systems DBDS and cable television systems CTS . As a non limiting example a subscriber television system STS and its operation will be described initially with the understanding that other conventional data delivery systems are within the scope of the preferred embodiments of the invention. shows a block diagram view of a STS which is generally a high quality reliable and integrated network system that is typically capable of delivering video audio voice and data services to digital home communication terminals DHCTs . Although depicts a high level view of a STS it should be appreciated that a plurality of subscriber television systems can tie together a plurality of regional networks into an integrated global network so that DHCT users can receive media content provided from anywhere in the world.

Further it will be appreciated that the STS shown in is merely illustrative and should not be construed as implying any limitations upon the scope of the preferred embodiments of the present invention. For instance subscriber television systems also included within the scope of the preferred embodiments of the invention include systems not utilizing physical structured cabling for transmission such as but not limited to satellite systems. Further transmission media included within the scope of the preferred embodiments of the invention include but are not limited to HFC optical satellite RF FM and microwave. Further data provided from the headend to the DHCTs and programming necessary to perform the functions discussed below will be understood to be present in the STS in accordance with the description below.

The STS typically delivers broadcast video signals as digitally formatted signals in addition to delivering traditional broadcast analog video signals. Furthermore the system can typically support one way broadcast services as well as both one way data services and two way media content and data services. The two way operation of the network typically allows for user interactivity with services such as Pay Per View programming Near Video On Demand NVOD programming according to any of several known NVOD implementation methods Video on Demand VOD programming according to any of several VOD implementation methods and interactive applications such as Internet connections.

The STS also provides the interfaces network control transport control session control and servers to access media content from media content services and distributes media content to DHCT users. As shown in a typical STS comprises a headend hubs an HFC access network and DHCTs . It should be appreciated that although a single component e.g. a headend is illustrated in a STS can feature a plurality of any one of the illustrated components or may be configured with alternative embodiments for any one of the individual components or with yet other additional components not enumerated above.

Media content provided by one or more content providers not shown is communicated by the content providers to one or more headends . From those headends the media content is then communicated over a communications network that includes a plurality of HFC access networks only one HFC access network is illustrated . The HFC access network typically comprises a plurality of HFC nodes each of which may serve a local geographical area. The hub connects to the HFC node through a fiber portion of the HFC access network . The HFC node is connected to a tap which in one embodiment is connected to a network interface unit NIU which is connected to a digital home communication terminal DHCT . In other embodiments the tap is connected directly to a digital home communication terminal DHCT . The NIU when implemented is normally located at the property of a subscriber and provides a transparent interface between the HFC node and the user property internal wiring. Coaxial cables are typically used to couple nodes taps and NIUs because the electrical signals can be easily repeated with radio frequency RF amplifiers.

As the high level operations of many of the functions of a STS are well known to those of ordinary skill in the art further high level description of the overall STS of will not be contained herein.

In a typical system the programming services and other information from content providers can be distributed according to a variety of mechanisms. The input signals may be transmitted from sources to the headend via a variety of transmission paths including satellites not shown and terrestrial broadcast transmitters and antennas not shown . The headend can also receive content from a direct feed source via a direct line . Other input sources from content providers include a video camera analog input source or an application server . The application server may include more than one line of communication. One or more components such as analog input source input source video camera and application server can be located external to the headend as shown or internal to the headend as would be appreciated by one having ordinary skill in the art. The signals provided by the content or programming input sources can include a single media content instance i.e. individual instances of media content such as an episode of a television show a movie or a web page etc. or a multiplex that includes several media content instances.

The headend generally includes one or more receivers that are each associated with a content source. MPEG encoders such as encoder are included for digitally encoding at least some local programming or a real time feed from video camera or the like. The encoder outputs the respective compressed video and audio streams corresponding to the analog audio video signal received at its input. For example encoder can output formatted MPEG 4 typically carried over an MPEG 2 compliant transport stream MPEG 2 or MPEG 1 packetized elementary PES streams or transport streams compliant to the syntax and semantics of the ISO MPEG 2 standard respectively. The PES or transport streams may be multiplexed with input signals from switch receiver and control system . The multiplexing logic processes the input signals and multiplexes at least a portion of the input signals into transport stream . Analog input source can provide an analog audio video broadcast signal which can be input into modulator . From modulator a modulated analog output signal can be combined at combiner along with other modulated signals for transmission into transmission medium . Alternatively analog audio video broadcast signal from analog input source can be input into modulator . Alternatively analog audio video broadcast signal can be input directly from modulator to transmission medium . The analog broadcast media content instances are transmitted via respective radio frequency RF channels each assigned for transmission of an analog audio video signal such as NTSC video.

The switch such as asynchronous transfer mode ATM switch provides an interface to an application server . There can be multiple application servers providing a variety of services such as a Pay Per View service including video on demand VOD a data service an Internet service a network system or a telephone system. Service and content providers may download content to an application server located within the STS . The application server may also be located within the headend or elsewhere within the STS such as in a hub . The various inputs into the headend are then combined with the other information from the control system which is specific to the STS such as local programming and control information which can include among other things conditional access information. The headend contains one or more modulators to convert the received transport streams into modulated output signals suitable for transmission over the transmission medium through the network . In one example the network can be an IP network. Each modulator may be a multimodulator including a plurality of modulators such as but not limited to QAM modulators that radio frequency modulate at least a portion of the transport streams to become output transport streams . The output signals from the various modulators or multimodulators are combined using equipment such as a combiner for input into the transmission medium which is sent via the in band delivery path to subscriber locations not shown . In band delivery path can include for example DTS and ATS. In one embodiment the server also provides various types of data to the headend . The data in part is received by the media access control functions that output MPEG transport packets containing data instead of digital audio video MPEG streams. The control system enables the television system operator to control and monitor the functions and performance of the STS . The control system interfaces with various components via communication link in order to monitor and or control a variety of functions including the frequency spectrum lineup of the programming for the STS billing for each subscriber and conditional access for the content distributed to subscribers. Information such as conditional access information is communicated from the control system to the multiplexing logic where it is multiplexed into a transport stream .

Among other things the control system provides input to the modulator for setting the operating parameters such as selecting certain media content instances or portions of transport streams for inclusion in one or more output transport stream system specific MPEG table packet organization and or conditional access information. Control information and other data can be communicated to hubs and DHCTs via an in band delivery path or via an out of band delivery path .

Also shown in are Out Of Band OOB signals that provide continuously available two way signaling to the subscribers DHCT regardless of which in band signals are tuned to by the individual DHCT in band tuners as described below. The OOB signals consist of a Forward Data Signal FDS and a Reverse Data Signal RDS . The OOB signals can comply to any one of a number of well known transport protocols but preferably comply to either a DAVIC 1.1 Transport Protocol with FDS of 1.544 mega bits per second Mbps or more using quadrature phase shift keying QPSK modulation and an RDS of 1.544 Mbps or more using QPSK modulation or to a DOCSIS Transport Protocol with FDS of 27 Mbps using 64 QAM modulation and a RDS of 1.544 Mbps or more using QPSK modulation or 16 QAM modulation. The OOB signals provide the two way operation of the network which allows for subscriber interactivity with the applications and services provided by the network. Furthermore the OOB signals are not limited to a 6 MHz spectrum but generally to a smaller spectrum such as 1.5 or 3 MHz.

The out of band data is transmitted via the out of band FDS of transmission medium by means such as but not limited to a Quadrature Phase Shift Keying QPSK modem array . Two way communication utilizes the RDS of the out of band delivery path . Hubs and DHCTs transmit out of band data through the transmission medium and the out of band data is received in headend via out of band RDS . The out of band data is routed through router to an application server or to control system . The out of band control information includes such information as a pay per view purchase instruction and a pause viewing command from the subscriber location to a video on demand type application server located internally or external to the headend such as application server as well as any other data sent from the DHCT or hubs all of which will preferably be properly timed. The control system also monitors controls and coordinates all communications in the subscriber television system including video audio and data. The control system can be located at the headend or remotely.

The transmission medium distributes signals from the headend to the other elements in the subscriber television system such as a hub a node and subscriber locations . The transmission medium can incorporate one or more of a variety of media such as optical fiber coaxial cable and hybrid fiber coax HFC satellite direct broadcast or other transmission media.

The DHCT further preferably includes at least one processor for controlling operations of the DHCT an output system for driving the television display and at least one tuner system for tuning into a particular television channel or frequency to be displayed and for sending and receiving various types of data or media content to and from the headend . The DHCT may include in other embodiments multiple tuners for receiving downloaded or transmitted media content. Tuner system can select from a plurality of transmission signals provided by the subscriber television system. Tuner system enables the DHCT to tune to downstream media and data transmissions thereby allowing a user to receive digital or analog media content delivered in the downstream transmission via the subscriber television system. The tuner system includes in one implementation an out of band tuner for bi directional quadrature phase shift keying QPSK data communication and a quadrature amplitude modulation QAM tuner in band for receiving television signals. Additionally a receiver receives externally generated information such as user inputs or commands from an input device such as remote control device or other devices. According to another embodiment of the invention a telephone modem not shown in the DHCT can be utilized for upstream data transmission and a headend hub or other component located upstream in the STS can receive data from a telephone network corresponding with the telephone modem and can route the upstream data to a destination internal or external to the STS such as an application data server in the headend or content provider. In other aspects an IP signaling path can be used utilizing for example DOCSIS or some other method.

The DHCT includes signal processing system which comprises demodulating system and transport demultiplexing and parsing system herein demultiplexing system to process broadcast media content and or data. One or more of the systems of signal processing system can be implemented with software a combination of software and hardware or preferably in hardware. Demodulating system comprises functionality for RF signal demodulation either an analog transmission signal or a digital transmission signal. For instance demodulating system can demodulate a digital transmission signal in a carrier frequency that was modulated among others as a QAM modulated signal. When tuned to a carrier frequency corresponding to an analog TV signal transmission demultiplexing system is bypassed and the demodulated analog TV signal that is output by demodulating system is instead routed to analog video decoder . Analog video decoder converts the analog video signal i.e. the video portion of a media content instance that comprises a video portion and an audio portion received at its input into a respective non compressed digital representation comprising a sequence of digitized pictures and their respective digitized audio. Presented at the input to analog video decoder is an analog video signal such as NTSC video comprising of audio and video.

Digitized pictures and respective audio output by analog video decoder are presented at the input of compression engine . Digitized pictures and respective audio output by analog video decoder can also be presented to an input of media engine via an interface not shown dedicated for non compressed digitized analog video and audio such as ITU 656 for display on TV . Compression engine is coupled to localized memory preferably DRAM for input and processing of the input digitized pictures and their respective digitized audio. Alternatively compression engine can have its own integrated memory not shown . Compression engine processes the sequence of digitized pictures and digitized audio and converts them into a video compressed stream and an audio compressed stream respectively. The compressed audio and video streams are produced in accordance with the syntax and semantics of a designated audio and video coding method such as specified by the MPEG 2 audio and MPEG 2 video ISO standard so that they can be interpreted by video decoder and audio decoder for decompression and reconstruction at a future time. Each compressed stream consists of a sequence of data packets containing a header and a payload. Each header contains a unique program identification or PID associated with the respective compressed stream.

Compression engine multiplexes the audio and video compressed streams into a transport stream such as an MPEG 2 transport stream for output. Furthermore compression engine can preferably compress audio and video corresponding to more than one program in parallel e.g. two tuned analog TV signals and to multiplex the respective audio and video compressed streams into a single transport stream. Output of compressed streams and or transport streams produced by compression engine is input to signal processing system . Parsing capabilities within signal processing allow for interpretation of sequence and picture headers for instance annotating their locations within their respective compressed stream for future retrieval from storage device . A compressed analog media content instance e.g. TV program episode or show corresponding to a tuned analog transmission channel can be output as a transport stream by signal processing and presented as input for storage in storage device via interface as will be described below. The packetized compressed streams can be also output by signal processing and presented as input to media engine for decompression by video decompression engine and audio decompression engine for its display on TV .

Demultiplexing system can include MPEG 2 transport demultiplexing. When tuned to carrier frequencies carrying a digital transmission signal demultiplexing system enables the separation of packets of data corresponding to the compressed streams of information belonging to the desired media content instances for further processing. Concurrently demultiplexing system precludes packets in the multiplexed transport stream that are irrelevant or not desired such as packets of data corresponding to compressed streams of media content instances of other media content signal sources e.g. other TV channels from further processing.

One having ordinary skill in the art will appreciate that signal processing system will preferably include other components not shown including memory decryptors samplers digitizers e.g. analog to digital converters and multiplexers among others. Further other embodiments will be understood by those having ordinary skill in the art to be within the scope of the preferred embodiments of the present invention including analog signals e.g. NTSC that bypass one or more elements of the signal processing system and are forwarded directly to the output system . Further outputs presented at corresponding next stage inputs for the aforementioned signal processing flow may be connected via accessible memory in which the outputting device stores the output data and the inputting device thereafter inputs the output data written to memory by the respective outputting device. Outputting and inputting devices include analog video decoder compression engine media engine signal processing system and components or subcomponents thereof. Further it will be understood by those having ordinary skill in the art that components of signal processing system can be spatially located in different areas of the DHCT . Further it will be understood by those having ordinary skill in the art that although the components of signal processing system are illustrated as being in communication with an incoming signal from the communications interface the signal may not necessarily be in the order shown for all signals.

The DHCT also includes media engine which includes digital video decoder also known as video decompression engine and digital audio decoder also known as audio decompression engine and other digital signal processing components not shown as would be appreciated by those having ordinary skill in the art. For example demultiplexing system is in communication with tuner system and processor to effect reception of digital compressed video streams digital compressed audio streams and data streams corresponding to one or more media content instances to be separated from other media content instances and or streams transported in the tuned transmission channel and to be stored in a first part not shown of DRAM of DHCT assigned to receive packets of one or more media content instances. Other dedicated memory may also be used for media content instance packets.

Furthermore while conducting this process demultiplexing system demultiplexes and separates desired compressed streams from the received transport stream without disturbing its content. Further parser parses i.e. reads and interprets compressed streams such as to interpret sequence headers and picture headers and deposits a transport stream carrying compressed streams of a first media content instance into DRAM . Processor causes transport stream in DRAM to be transferred to the storage device via interface . Under program control by processor the demultiplexing system in communication with the digital video decoder storage device and processor effect notification and or transfer of received packets of one or more compressed streams corresponding to one or more media content instances from a first part of DRAM to a second part not shown of DRAM assigned to the digital video decoder and the digital audio decoder . Alternatively media engine can have access to a dedicated localized DRAM not shown . Upon demultiplexing and parsing the transport stream carrying one or more media content instances signal processing system outputs to DRAM ancillary data in the form of a table or data structure not shown comprising the relative or absolute location of the beginning of certain pictures in the compressed media content instance for convenience in retrieval during future operations.

In another embodiment according to a plurality of tuners and respective number of demodulating systems demultiplexing systems and signal processing systems a respective number of broadcast digital media content instances are received and routed to the hard disk of storage device simultaneously. Alternatively a single demodulating system a single demultiplexing system and a single signal processing system each with sufficient processing capabilities can serve to process more than one digital media content instance.

In one implementation compression engine can output formatted MPEG 2 or MPEG 1 packetized elementary streams PES inside a transport stream all compliant to the syntax and semantics of the ISO MPEG 2 standard. Alternatively compression engine can output other digital formats that are compliant to other standards. The digital compressed streams output by compression engine corresponding to a media content instance are deposited in local memory for compression engine and routed to demultiplexing system . Demultiplexing system parses i.e. reads and interprets the transport stream generated by compression engine without disturbing its content such as to interpret picture headers and deposits the transport stream into DRAM . Processor causes transport stream in DRAM to be transferred to the storage device . While parsing the transport stream demultiplexing system outputs to memory ancillary data in the form of a table or data structure not shown comprising the relative or absolute location of the beginning of certain pictures in the compressed media content stream for the media content instance for convenience in retrieval during future operations. In this way random access operations such as fast forward rewind and jumping to a location in the compressed media content instance can be attained.

In another embodiment according to a plurality of tuners a respective number of analog video decoders and a respective number of compression engines the aforementioned compression of analog video and audio is performed and routed to hard disk of the storage device simultaneously for a respective number of analog media content instances. Alternatively a single compression engine with sufficient processing capabilities can serve to compress more than one analog media content instance.

The DHCT may also include one or more wireless or wired interfaces also called communication ports for receiving and or transmitting data to other devices. For instance the DHCT may feature USB Universal Serial Bus Ethernet for connection to a computer IEEE 1394 for connection to media content devices in an entertainment center Internet serial and or parallel ports. The user inputs may be for example provided by an input device including a computer or transmitter with buttons or keys located either on the exterior of the terminal or by a hand held remote control device or keyboard that includes user actuated buttons or even aural input.

The DHCT includes at least one storage device to provide storage for downloaded media content. Storage device can be an optical storage device or a magnetic storage device among others and is preferably a hard disk drive. Storage device comprises storage for media content and or data that can be written to for storage and later read from for retrieval for presentation. The storage device preferably includes at least one hard disk . Throughout this disclosure references relating to writing to or reading from the storage device or references regarding recordings from or to the storage device will be understood to mean that such read or write operations are occurring to the actual medium for example the hard disk of the storage device . Preferably located in each hard disk is one or more time shift buffers TSBs which comprise a plurality of clusters as described below for temporarily receiving media content and or data. The storage device is also comprised of a controller that receives operating instructions from the device driver of the operating system as described below and implements those instructions to cause read and or write operations to the hard disk . The device driver communicates with the storage device controller to format the hard disk causing the hard disk to be divided radially into sectors and concentric circles called tracks as illustrated by the block diagram illustration of the example hard disk in . Note from that the same number of sectors per track are illustrated but other embodiments with a different number of tracks per side sectors per track bytes per sector and in different zones of tracks are within the scope of the preferred embodiments of the invention. The sector is the basic unit of storage on the hard disk . In one implementation each sector of a hard disk can store 512 bytes of user data. While data is stored in 512 byte sectors on the hard disk the cluster such as example cluster is typically the minimum unit of data storage the operating system uses to store information. Two or more sectors on a single track make up a cluster.

Referring again to storage device is preferably internal to DHCT coupled to a common bus through a communication interface preferably an integrated drive electronics IDE or small computer system interface SCSI although IEEE 1394 or USB among others can be used. In other embodiments the storage device can be externally connected to and thus removable from the DHCT via a communication port implemented as IEEE 1394 or USB or as a data interface port such as a SCSI or an IDE interface. In one implementation under the auspices of the real time operating system as described below and executed by processor and in coordination with the personal video recording PVR application client and the device driver the latter two components described below downloaded media content herein understood to also refer to other types of data in addition to or instead of media content instances are received in DHCT via communications interface and stored in a temporary cache not shown in memory . The temporary cache is implemented and managed to enable media content transfers from the temporary cache to storage device or in concert with the insertion of a newly arriving media content into the temporary cache. In one implementation the fast access time and high data transfer rate characteristics of the storage device enables media content to be read from the temporary cache in memory and written to storage device in a sufficiently fast manner. Orchestration of multiple simultaneous data transfer operations is effected so that while media content is being transferred from the cache in memory to storage device new media content is received and stored in the temporary cache of memory . In other implementations the downloaded media content is received through communications port in the DHCT and then transferred directly to storage device thus bypassing the temporary cache.

Processor in communication generally with device driver and storage device controller and demultiplexing system effect retrieval of compressed video streams compressed audio streams and data streams corresponding to one or more media content instances from storage device . Retrieved streams are deposited in an output cache in storage device and transferred to memory and then processed for playback according to mechanisms that would be understood by those having ordinary skill in the art. In some embodiments the media content instances are retrieved and routed from the hard disk to the video and audio decoding system simultaneously and then further processed for eventual presentation on a display device or other device.

In one implementation the DHCT includes system memory which includes FLASH memory and dynamic random access memory DRAM for storing various applications modules and data for execution and use by the processor . Basic functionality of the DHCT is provided by an operating system that is primarily stored in FLASH memory . The operating system includes among other elements at least one resource manager that provides an interface to resources of the DHCT such as for example computing resources. Also included within operating system is one or more device drivers that provides operating instructions to an internal or external storage device such as storage device and other peripheral devices not shown. In one implementation device driver provides operating instructions to the storage device controller of the storage device to effect among other functions read and or write operations to the hard disk of the storage device . The device driver includes several driver modules including MPEG transport audio video A V File System Manager and DVR Manager . MPEG transport provides functionality for decoding i.e. providing operating instructions to the media engine for MPEG A V decoding and playing A V encoded in MPEG transport streams. A V File System Manager under control of the DVR Manager enables MPEG transport to effect the decoding and playback functionality by effecting retrieval of MPEG A V media content from the storage device and providing the content to the audio decoder and video decoder of media engine . AV File System Manager also provides functionality for the recording of MPEG streams. The AV File System Manager manages data about each recorded media content instance including where it is stored physically i.e. cluster management as described below and the locations of I Frames a series of still pictures of an MPEG transport stream that the DHCT can use to provide a display during rewind or fast forward operations .

The AV File System Manager also provides a software generated pointer called Normal Play Time NPT which points to locations within files and locations within media content instances within those files. Based on the Lightweight Stream Control Protocol NPT can be thought of as the clock associated with a video asset as distinguished from real time clock not shown for the DHCT . For every file that is created for media content downloaded to the storage device an NPT is generated. There is an NPT for the read head of the storage device and for the write head of the storage device . For writing content to the storage device for a newly created file e.g. a TSB file an NPT is created for the write head of the storage device with an initial value of zero. In one implementation the AV File System Manager receives a periodic interrupt for example every 510 msec set up by the PVR application through the computer services of the operating system . This interrupt is synchronized with the internal real time clock not shown of the DHCT in order to advance the pointer i.e. the NPT at a substantially constant rate. The NPT continues to increase in value from an initial value of zero until the associated file is closed. For the read head of the storage device the NPT starts at 0 at the start of the file advances in real time in normal play mode advances faster than real time in fast forward mode decrements in rewind mode and is fixed when the video is paused. The DVR Manager is the driver module that controls the operation of the MPEG encoding and MPEG decoding through MPEG transport and uses the services of the AV File System Manager to store and provide functionality for the playback of files. It will be understood that references to the device driver will include one or more or a combination of one or more of the aforementioned device driver modules.

One or more programmed software applications herein referred to as applications are executed by utilizing the computing resources in the DHCT . The applications or application clients may be resident in FLASH memory or downloaded or uploaded into DRAM . Applications stored in FLASH memory or DRAM are executed by processor e.g. a central processing unit or digital signal processor under the auspices of the operating system . Data required as input by an application is stored in DRAM or FLASH memory and read by processor as need be during the course of application execution. Input data may be data stored in DRAM by a secondary application or other source either internal or external to the DHCT or possibly anticipated by the application and thus created with the application at the time it was generated as a software application in which case it is stored in FLASH memory . Data generated by an application is stored in DRAM by processor during the course of application execution. DRAM also includes application memory that various applications may use for storing and or retrieving data.

An application referred to as navigator is also resident in FLASH memory for providing a navigation framework for services provided by the DHCT . The navigator registers for and in some cases reserves certain user inputs related to navigational keys such as channel increment decrement last channel favorite channel etc. The navigator also provides users with television related menu options that correspond to DHCT functions such as for example blocking a channel or a group of channels from being displayed in a channel menu.

The FLASH memory also contains a platform library . The platform library is a collection of utilities useful to applications such as a timer manager a compression manager a configuration manager an HTML parser a database manager a widget toolkit a string manager and other utilities not shown . These utilities are accessed by applications via application programming interfaces APIs as necessary so that each application does not have to contain these utilities. Two components of the platform library that are shown in are a window manager and a service application manager SAM client .

The window manager provides a mechanism for implementing the sharing of the screen regions and user input. The window manager on the DHCT is responsible for as directed by one or more applications implementing the creation display and deallocation of the limited DHCT screen resources. It allows multiple applications to share the screen by assigning ownership of screen regions or windows. The window manager also maintains among other things a user input registry in DRAM so that when a user enters a key or a command via the remote control device or another input device such as a keyboard or mouse the user input registry is accessed to determine which of various applications running on the DHCT should receive data corresponding to the input key and in which order. As an application is executed it registers a request to receive certain user input keys or commands. When the user presses a key corresponding to one of the commands on the remote control device the command is received by the receiver and relayed to the processor . The processor dispatches the event to the operating system where it is forwarded to the window manager which ultimately accesses the user input registry and routes data corresponding to the incoming command to the appropriate application.

The SAM client is a client component of a client server pair of components with the server component not shown being located on the headend preferably in the control system . A SAM database i.e. structured data such as a database or data structure in DRAM includes a data structure of services and a data structure of channels that are created and updated by the headend . Herein database will refer to a database structured data or other data structures as is well known to those of ordinary skill in the art. Many services can be defined using the same application component with different parameters. Examples of services include without limitation and in accordance with one implementation presenting television programs available through a WatchTV application pay per view events available through a PPV application digital music not shown media on demand available through an MOD application and an interactive program guide IPG . In general the identification of a service includes the identification of an executable application that provides the service along with a set of application dependent parameters that indicate to the application the service to be provided. As an example a service of presenting a television program media content instance could be executed by the WatchTV application with a set of parameters specifying those needed to view HBO or with a separate set of parameters to view CNN. Each association of the application component tune video and one parameter component HBO or CNN represents a particular service that has a unique service I.D. The SAM client also interfaces with the resource manager as discussed below to control resources of the DHCT .

Application clients can also be downloaded into DRAM at the request of the SAM client typically in response to a request by the user or in response to a message from the headend . In the example DHCT illustrated in DRAM includes a media on demand application MOD an e mail application PVR application and a web browser application . It should be clear to one with ordinary skill in the art that these applications are not limiting and merely serve as examples for embodiments of the invention. Furthermore one or more DRAM based applications may be resident as an alternative embodiment in FLASH memory . These applications and others provided by the subscriber television system operator are top level software entities on the network for providing services to the user.

In one implementation applications executing on the DHCT work with the navigator by abiding by several guidelines. First an application utilizes the SAM client for the provision activation and suspension of services. Second an application shares DHCT resources with other applications and abides by the resource management policies of the SAM client the operating system and the DHCT . Third an application handles situations where resources are only available with navigator intervention. Fourth when an application loses service authorization while providing a service the application suspends the service via the SAM the navigator will reactivate an individual service application when it later becomes authorized . Finally an application client or application is designed to not have access to certain user input keys reserved by the navigator i.e. power channel volume etc. .

The MOD client application provides the user with lists of available media content titles for each media content instance to choose from and with media content instances requested by the user. The MOD client application provides media content to the user by engaging typically in a direct two way IP Internet Protocol connection with VOD content servers not shown that would be located in one embodiment in the headend .

An executable program or algorithm corresponding to an operating system OS component or to a client platform component or to an application client or to respective parts thereof can reside in and execute out of DRAM and or FLASH memory . Likewise data input into or output from any executable program can reside in DRAM or FLASH memory . Furthermore an executable program or algorithm corresponding to an operating system component or to a client platform component or to an application client or to respective parts thereof can reside in FLASH memory or in a local storage device such as storage device externally connected to or integrated into DHCT and be transferred into DRAM for execution. Likewise data input for an executable program can reside in FLASH memory or a storage device and be transferred into DRAM for use by an executable program or algorithm. In addition data output by an executable program can be written into DRAM by an executable program or algorithm and be transferred into FLASH memory or into a storage device. In other embodiments the executable code is not transferred but instead functionality is effected by other mechanisms.

Permanent recordings and other write operations of media content to the storage device are primarily effected by a PVR architecture comprising the PVR application and the device driver . At one level of abstraction the PVR application provides high level control for writing of digital data from multiple input streams to the storage device for both scheduled permanent recordings and permanent recordings from a time shift buffer TSB or writes to the TSB . The TSB is a configurable allocation of hard disk clusters that store the data downloaded from the data streams. More than one TSB may be used for instance one TSB per tuner in the case of a DHCT with multiple tuners. Through mechanisms explained below media content received into the TSB will have a temporary recording designation. That is media content stored in clusters of the TSB will have a temporary residence. This receiving of media content into the TSB for temporary residence will also be referred to as buffering. The media content stored in the TSB will either be deleted i.e. the clusters storing the media content will be configured as writeable for eventual write operations that overwrite the media content within those clusters or retained through election by the user as a permanent recording. A permanent recording will be understood to mean media content that is stored for an extended period of time as decided by the user. Permanent recordings are stored in non buffer clusters i.e. not in clusters of the TSB that are not used for the TSB in instances when the user elects in advance to make a scheduled recording of a media content instance that has not yet been tuned to at the DHCT . A permanent recording can also be achieved by selecting a media content instance stored in the TSB and designating the media content instance as permanent. Further when the media content instance is designated as permanent the associated TSB clusters are configured for eventual designation as non buffer clusters i.e. permanent recording clusters . Thus permanent recordings will preferably be more permanent than media content in the TSB and permanent recordings can eventually be deleted from the disk space typically at the explicit request of a user as one example. This deletion occurs in one implementation by configuring the associated non buffer clusters as writeable and thus eventually available for the TSB or scheduled recordings. As part of the high level control provided by the PVR application the PVR application also provides media content instance data management and user interfaces. With respect to media content instance data management the PVR application maintains the media content instance guide data on the hard disk for all permanently recorded files and TSB files with their associated media content.

Hard disk drives have a finite life and when used in a high stress application such as a DHCT placing the disk into an idle state whenever possible helps prolong the life of the unit. However placing the disk into an idle state may produce results contrary to customer s expectations since they generally expect a settop box to be always on and ready for use.

One of the attractive features of a DHCT is the ability to pause live TV and even rewind to replay something that was on earlier. As described above this functionality is provided by the TSB . The TSB normally keeps some amount of video available for review at all times. Having this available at all times requires that the hard drive always be active which can cause undue wear and power consumption.

People are generally creatures of habit. They tend to perform the same basic routines typically on a daily or weekly schedule. These habits are further reinforced by the fact that most television channels have regular schedules and people tend to have favorite shows. By monitoring viewing habits reasonable estimations can be made as to when a user is not watching television such that it is permissible to disable the TSB and when the viewer is most likely to be watching television. This can be accomplished in one aspect by establishing a collection period comprised of a plurality of days and dividing each day i.e. 24 hour period of the collection period into a number of time segments. For example a 24 hour period can be divided into 15 minute increments 30 minute increments one hour increments etc. For each time segment a memory storage location or bin is allocated. For instance memory can be allocated in the DRAM for this purpose. Enough of these memory storage locations should be allocated to store multiple days of data for instance several weeks worth of data. Each time a key press is detected from an input device associated with the DHCT such as remote control device or other devices the memory storage location corresponding to the current time is marked as active. In this way a history is created of times that the user interacts with the settop. In one aspect the actual channel key press and or program viewed would also be recorded as provided by the user input registry and or the navigator . The above describes just one method of determining viewer usage patterns. It is to be appreciated that other methods are contemplated within the scope of this invention.

The memory storage locations for a collection period or a portion of a collection period e.g. days week or weeks that have passed can be examined to make a reasonable prediction as to what the patterns of user behavior will be for time periods in the future. If the memory storage location for a particular time segment is marked as used in a previous corresponding time period there is a greater probability that it will happen again for the same time period in the future based on predictive human behavior. This projected activity can then be used to decide when to enable or disable the TSB . Based on available guide data and historical data on the channel watched it is possible to tell when a program both starts and end. The TSB can be disabled until just before the start of the program. The DHCT could also be programmed to tune to the right program and start the TSB recording at the start of the anticipated show.

One issue that can arise is that the predictive nature of the methods disclosed herein could prevent or reduce the user from making a key press which would cause any key press history from being recorded. However one of the aims of this invention is to make sure the TSB is ready when the user wants it. If the user never engages the TSB with one of the trick mode keys pause rewind fast forward etc. then there is no issue. In another scenario the DHCT may be in an off or sleep state and the user would turn it on in order to view a show. Alternatively a screen saver blanker could be displayed after long periods of inactivity perhaps coincident with idling the disk drive. A key press to disable the blanker would serve as an activity trigger.

If the DHCT automatically is turned off while idle the user can press the power key either on the DHCT or on the remote to activate the unit which results in some activity. Alternatively circuitry could be utilized to detect any type of remote control activity such as a TV volume command etc that would signal the presence of a user controlling the monitor device. If the unit is always on other variations are possible including noting that the TSB is being utilized via the trick mode e.g. pause rewind fast forward slow motion etc. commands. While this strategy generally works well for short attention span programs typical of the prime time lineup other shows are not quite so predictable and knowing when to turn the TSB off can be more challenging. For example movies and sports events fall into this category. For the duration of these types of events the user can go for long periods with utilizing the remote control . In order to prevent prematurely shutting the TSB down during these events SAM client data may be consulted to determine the ending time of the event. Some fixed margin may be added and then if no activity occurs within that time the TSB may be safely disabled.

By looking at the data from one or more prior collection periods it is possible to predict the likelihood of activity for the same periods in the future. In one non limiting example each time segment is 15 minutes which results in 4 24 7 time segments for a week.

It is common practice for the user to periodically initiate some action via the remote control while the user is actively watching TV. Such actions can be comprised of for example switching channels displaying program guide information or other activities that the DHCT may perform. After a prolonged period of inactivity it is reasonable to assume that the user is no longer actively engaged nor likely to interact with the settop and putting the hard disk drive into a sleep state will not be immediately noticed. However the user will return to watching TV and may immediately expect DVR services such as rewinding the current channel. If the hard disk has been idled this operation can fail leading to an unsatisfactory experience for the user. However if usage patterns are collected and used to predictively spin up the hard drive and enable the TSB in anticipation of the user s TV viewing patterns the experience can be enhanced.

As described above the navigator gathers information based on remote control key presses. By tracking this information over a period of time the user s typical usage pattern will be recorded in memory storage locations corresponding to time segments and then used to spin the hard disk up prior to the expected access time thus making the DHCT fully functional when the user needs it. In one aspect the information can be periodically stored to non volatile memory such as the hard disk drive thus preventing the loss of data should the unit be reset. Because people are generally habitual in their nature and typically go through roughly the same routine on a daily or weekly basis by collecting data over a period of several collection periods e.g. several weeks reasonable predictions can be made as to the behavior expected in the future.

The algorithm comprises dividing the collection period into time segments e.g. 15 minutes each and creating a bin for each segment to keep a record of remote control events. Whenever a remote control or front panel key is pressed the corresponding bin is marked as used. By examining which bins have been marked it can be roughly determined when throughout the day the user was actively engaged in watching TV. Knowing that many people are on a weekly schedule it is reasonable to expect that by examining usage patterns for the prior weeks it is possible to predict when the user is most likely to request the DVR rewind services.

In one respect the algorithm provides for the collection of data for at least one collection period e.g. one week before attempting predictive behavior. During this time some reasonable default behavior would be used. Once a collection period s worth of data has been collected the algorithm would look back in the memory storage areas for corresponding time segments from the collection period. Assuming that the disk is idled at the beginning of a time segment that shows some form of user activity to make sure the disk is ready when needed a spin up window is defined. Since the TSB is generally expected to hold 60 minutes worth of data the hard disk can be spun up 60 minute prior to the first expected key press. The algorithm determines which bin to examine. The correct bin would correspond to a time one collection period prior to the target ready time. For example at 6 00 AM on a Tuesday the memory storage area for 7 00 AM on one or more prior Tuesdays would be examined. If activity was recorded in the memory storage area for the time segment that included 7 00 a.m. on Tuesday of the collection period then at approximately 6 00 a.m. on the present Tuesday the hard disk would be spun up in anticipation of user activity corresponding to activity that occurred in the collection period.

Once the disk is running a spin down window is defined. For example a typical spin down window might be to wait for 120 minutes past the last expected key press. To determine this window the current time is checked and any memory storage areas from the prior collection period corresponding to the current time to a time 120 minutes into the future are examined. If any are non zero i.e. activity occurred and was recorded the disk remains running. The current program s running time as found in guide data related to programming can be used to modify the correct spin down time so that the disk does not spin down during the viewing of a movie sporting event or other similar extended programming. The decision logic would operate like the spin up logic.

At step patterns of user behavior are determined by analyzing the memory storage areas for the time segments that comprise one or more collection periods. This analysis can be used to predict future behavior of a user. Determining patterns of user behavior can include for example determining a time period to perform routine maintenance on the recording device through a subscriber television system based on the lack of user activity during one or more time segments of the collection period determining whether a user rewinds pauses or fast forwards while the recording device is receiving a particular television show or a particular type of television show determining television shows or types of television shows that a user selects for watching through the recording device among other things. Routine maintenance can include for example defragmenting the hard drive searching the drive for bad blocks reorganizing databases etc.

At step the recording device is operated in accordance with the patterns of user behavior. Operating the recording device in accordance with the patterns of user behavior can include for example placing the time shift buffer of the recording device in a rest state during periods of time in which the determined patterns of user behavior indicate the recording device is not in use disabling the time shift buffer during periods of time in which the determined patterns of user behavior indicate a user does not rewind pause or fast forward while viewing a television show enabling the time shift buffer during periods of time in which the determined patterns of user behavior indicate a user rewinds pauses or fast forwards while viewing a television show enabling the time shift buffer for a particular television show or a particular type of television show when the determined patterns of user behavior indicate a user watches the particular television show or the particular type of television show enabling the time shift buffer and storing information about a particular television show or a particular type of television show on the memory storage device when the determined patterns of user behavior indicate a user watches the particular television show or the particular type of television show among other operations.

The present methods and systems can be operational with numerous other general purpose or special purpose computing system environments or configurations. Examples of well known computing systems environments and or configurations that can be suitable for use with the system and method comprise but are not limited to personal computers server computers laptop devices and multiprocessor systems. Additional examples comprise set top boxes programmable consumer electronics network PCs minicomputers mainframe computers distributed computing environments that comprise any of the above systems or devices and the like.

The processing of the disclosed methods and systems can be performed by software components. The disclosed system and method can be described in the general context of computer executable instructions such as program modules being executed by one or more computers or other devices. Generally program modules comprise computer code routines programs objects components data structures etc. that perform particular tasks or implement particular abstract data types. The disclosed method can also be practiced in grid based and distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment program modules can be located in both local and remote computer storage media including memory storage devices.

While the methods and systems have been described in connection with preferred embodiments and specific examples it is not intended that the scope be limited to the particular embodiments set forth as the embodiments herein are intended in all respects to be illustrative rather than restrictive.

Unless otherwise expressly stated it is in no way intended that any method set forth herein be construed as requiring that its steps be performed in a specific order. Accordingly where a method claim does not actually recite an order to be followed by its steps or it is not otherwise specifically stated in the claims or descriptions that the steps are to be limited to a specific order it is no way intended that an order be inferred in any respect. This holds for any possible non express basis for interpretation including matters of logic with respect to arrangement of steps or operational flow plain meaning derived from grammatical organization or punctuation the number or type of embodiments described in the specification.

Throughout this application various publications are referenced. The disclosures of these publications in their entireties are hereby incorporated by reference into this application in order to more fully describe the state of the art to which the methods and systems pertain.

It will be apparent to those skilled in the art that various modifications and variations can be made without departing from the scope or spirit. Other embodiments will be apparent to those skilled in the art from consideration of the specification and practice disclosed herein. It is intended that the specification and examples be considered as exemplary only with a true scope and spirit being indicated by the following claims.

