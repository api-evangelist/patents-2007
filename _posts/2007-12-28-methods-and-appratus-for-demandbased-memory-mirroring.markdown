---

title: Methods and appratus for demand-based memory mirroring
abstract: A method includes determining an amount of memory space in a memory device available for memory mirroring. The method further includes presenting the available memory space to an operating system. The method further includes selecting at least a portion of the amount of memory space to be used for memory mirroring with the operating system. The method further includes adding a non-selected portion of the available memory to memory space available to the operating system during operation. An associated system and machine readable medium are also disclosed.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07949850&OS=07949850&RS=07949850
owner: Intel Corporation
number: 07949850
owner_city: Santa Clara
owner_country: US
publication_date: 20071228
---
Computing devices may include memory devices having memory space designated for storing copies of data already being stored in the memory device. Allowing the memory space to be used for redundant purposes allows data to be recovered if the primary storage space for the data in the memory device experiences a memory error.

While the concepts of the present disclosure are susceptible to various modifications and alternative forms specific exemplary embodiments thereof have been shown by way of example in the drawings and will herein be described in detail. It should be understood however that there is no intent to limit the concepts of the present disclosure to the particular forms disclosed but on the contrary the intention is to cover all modifications equivalents and alternatives falling within the spirit and scope of the invention as defined by the appended claims.

In the following description numerous specific details such as types and interrelationships of system components and logic partitioning integration choices are set forth in order to provide a more thorough understanding of the present disclosure. It will be appreciated however by one skilled in the art that embodiments of the disclosure may be practiced without such specific details. In other instances control structures gate level circuits and full software instruction sequences have not been shown in detail in order not to obscure the invention. Those of ordinary skill in the art with the included descriptions will be able to implement appropriate functionality without undue experimentation.

References in the specification to one embodiment an embodiment etc. indicate that the embodiment described may include a particular feature structure or characteristic but every embodiment may not necessarily include the particular feature structure or characteristic. Moreover such phrases are not necessarily referring to the same embodiment. Further when a particular feature structure or characteristic is described in connection with an embodiment it is submitted that it is within the knowledge of one skilled in the art to effect such feature structure or characteristic in connection with other embodiments whether or not explicitly described.

Embodiments of the invention may be implemented in hardware firmware software or any combination thereof. Embodiments of the invention may also be implemented as instructions stored on a machine readable medium which may be read and executed by one or more processors. A machine readable medium may include any mechanism for storing or transmitting information in a form readable by a machine e.g. a computing device . For example a machine readable medium may include read only memory ROM random access memory RAM magnetic disk storage media optical storage media flash memory devices and others.

Referring now to in one embodiment a computing device includes a plurality of processors a chipset and a plurality of peripheral devices . The computing device may be embodied as any type of computing device such as for example a desktop computer system a laptop computer system a server or enterprise computer system or a handheld computing device. The processors may include but are not limited to processors manufactured or marketed by Intel Corp. IBM Corp. and Sun Microsystems Inc. Each of the processors may also include one or more processing cores.

Each of the processors are communicatively coupled to the chipset via a number of signal paths . Signal paths may be embodied as any type of signal paths capable of facilitating communication between the processors and the chipset . For example the signal paths may be embodied as any number of wires printed circuit board traces via bus intervening devices and or the like. The chipset includes a memory controller hub MCH or northbridge an input output controller hub ICH or southbridge and a firmware device . The firmware device is communicatively coupled to the input output controller hub via a number of signal paths . Similar to the signal paths the signal paths may be embodied as any type of signal paths capable of facilitating communication between the input output controller hub and the firmware device such as for example any number of wires printed circuit board traces via bus intervening devices and or the like. The firmware device is illustratively embodied as a memory storage device for storing Basic Input Output System BIOS data programs and or instructions and or other information.

The MCH is communicatively coupled to a memory device via a number of signal paths . Again similar to the signal paths described above the signal paths may be embodied as any type of signal paths capable of facilitating communication between the MCH and the memory device such as for example any number of wires printed circuit board traces via bus intervening devices and or the like. The memory device may be embodied as dynamic random access memory devices DRAM synchronous dynamic random access memory devices SDRAM double data rate dynamic random access memory device DDR SDRAM and or other volatile memory devices. Additionally although a single memory device is illustrated in in other embodiments the computing device may include additional memory devices.

The chipset is also communicatively coupled to a number of peripherals via a number of signal paths . Again similar to the signal paths the signal paths may be embodied as any type of signal paths capable of facilitating communication between the chipset and the peripherals such as for example any number of wires printed circuit board traces via bus intervening devices and or the like. The peripherals may include any number of peripheral devices including data storage devices interfaces and output devices. For example as illustrated in the peripheral devices may include a hard disk an inband network interface card NIC an out of band network interface card and I O device which may include a keyboard a mouse a display a printer a scanner or the like. Additionally in other embodiments the computing device may include additional or other peripheral devices depending upon for example the intended use of the computing device . The components of computing device may be connected by various interconnects. In one embodiment an interconnect may be point to point between two components while in other embodiments an interconnect may connect more than two components. Such interconnects may include a Peripheral Component Interconnect PCI such as PCI Express a System Management bus SMBUS a Low Pin Count LPC bus a Serial Peripheral Interface SPI bus an Accelerated Graphics Port AGP interface or the like. Further it should be appreciated that the computing device may include other components sub components and devices not illustrated in for clarity of the description. For example it should be appreciated that the MCH may include a video controller for controlling a video display or interface and that the ICH may include an interrupt controller for generating interrupt events.

In one embodiment the memory device may be used for memory mirroring which allows data to be stored in the memory device as well as a copy of the stored data. Thus if an error occurs with the stored data the copy may be used so that no data is lost. However in typical systems implementing memory mirroring the memory is bifurcated such that half is used for storing data and the second half is automatically used for mirroring the first half.

Referring now to a block diagram shows memory device configured to selectively mirror only portions of a data stored in the memory device . In other words memory mirroring may be used such that only a portion of data stored in the memory device may be copied and stored in the memory device . In one embodiment the memory device may include a plurality of memory banks designated as bank and bank in . Each memory bank may include a plurality of dual in line memory modules DIMMs . Bank includes DIMMs and bank includes DIMMs . As illustrated in each DIMM is connected to the MCH with the DIMMs of bank connected to the MCH via branch and the DIMMs of bank connected to the MCH via branch . In one embodiment the branches may be extensions of the signal paths as shown in .

During operation the MCH controls the flow of data to and from the DIMMs for data storage and retrieval. When memory mirroring is implemented bank may be used to mirror e.g. copy and store data stored in bank . When selective memory mirroring is implemented selected portions of data stored in the DIMMs of bank may be copied and stored in the DIMMs of bank . In one embodiment data stored at a particular address designated as A Ain for each DIMM in the DIMMs of bank is stored in a corresponding address in the DIMMs of bank . As illustrated in data stored at address A DATA of the DIMM of bank is stored at address Aof the DIMM of bank . Similarly illustrated in data stored at address A DATA of DIMM of bank is stored at address Aof the DIMM of bank and data stored at address A DATA of the DIMM of bank is stored at address Aof the DIMM of bank . Thus allowing selected portions of memory space in bank may be mirrored in bank allowing memory not used for memory mirroring to be available for other use. In one embodiment the corresponding addresses may be used for memory mirroring due to interleaving considerations between the each corresponding set of DIMMs of each memory bank.

The configuration of may allow corresponding memory addresses to be used in the manner described allowing each branch to serve as a channel such that a read operation of mirrored data may be done using bank or bank allowing various considerations such as memory traffic or performance for example to be addressed. In one embodiment the memory banks and may include other memory module configurations such as single in line memory modules SIMMs .

At block an amount of memory space is selected for memory mirroring from the amount of memory space determined to be available at block . In one embodiment the selection of memory to be used for memory mirroring may be selected based upon powers of two allowing the MCH to control the memory space selected accordingly. The selection of memory space to be used for memory mirroring may also be performed in various manners. For example during an initial boot of a system a system user may enter a setup mode of the system such as I O Device of the computing device to provide a system user the ability to input the amount of memory to be used for memory mirroring. The input of the system user may be processed for control of the MCH in order to control the appropriate memory for mirroring.

Referring now to a flowchart illustrates a routine for selecting memory in a system to be used for memory mirroring. At block a power on self test POST is performed during initialization of system. At block a determination as to if memory mirroring is enabled is made. If memory mirroring is not enabled the system e.g. the computing device may continue booting up at block in another memory configuration such as in independent channel mode for example. If memory mirroring is enabled at block a determination is made as to which memory may be used for mirroring. At block available memory may be put into two logical buckets one of which may be memory visible to the OS and the other may be not visible to the OS. At block an operating system is booted.

At block the OS may request an amount of mirrored memory from the visible memory. In one embodiment this request may be made by the OS via an application programming interface. At block the BIOS programs may set up mirroring for the amount of memory requested by the OS. In one embodiment this may be performed during runtime via an system management interrupt. In another embodiment this may be performed during runtime.

At block the BIOS programs may add memory to the operating memory e.g. memory not used for mirroring but available during normal operation. At block the OS may continue operation with critical areas protected through memory mirroring.

It should be appreciated that the routine of the flowchart may be configured such that only a portion of available memory space is made available for mirroring to the OS the non available portion being included in non mirrored memory space. If the OS requests more memory space that that made available memory space may be removed from the non mirrored memory space a hot remove and added to the portion of memory space made available for memory mirroring to the OS.

Referring now to there is shown a block diagram of a virtual machine monitor VMM set up in mirrored memory. Also shown in is a plurality of virtual machines VMs which may be operated by the VMM . During operation of a system the VMM may be used to select an amount of memory space to be used for memory mirroring. For example if a server is running a VMM memory may only need to be mirrored to support critical areas of the VMM itself which can handle any memory errors with the virtual machines VMs by inspecting memory device bank registers. Furthermore VMMs may also determine whether to execute VMs with mirrored or non mirrored memory space based upon considerations such as purpose and need. In the VMM is shown as having selected the VMs to be operated without mirroring.

While the disclosure has been illustrated and described in detail in the drawings and foregoing description such an illustration and description is to be considered as exemplary and not restrictive in character it being understood that only illustrative embodiments have been shown and described and that all changes and modifications that come within the spirit of the disclosure are desired to be protected.

