---

title: Method and apparatus to support VoIP calls in an IEEE 802.16 interface
abstract: In some embodiments, an apparatus includes a connect control module adapted to receive a dynamic service addition message containing a reserved bandwidth amount of a reserved bandwidth allocation for an uplink service flow. The reserved bandwidth allocation is capable of accommodating two or more Voice over Internet Protocol (VoIP) calls and the uplink service flow is substantially in accordance with an Institute of Electrical and Electronic Engineers (IEEE) 802.16 standard. The apparatus also includes a call session module coupled to the connect control module and adapted to generate a connection request message for a VoIP connection. The connect control module, in response to the connection request message, is further adapted to send a dynamic service change request message to activate a call-session bandwidth portion of the reserved bandwidth allocation for the VoIP connection.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07899024&OS=07899024&RS=07899024
owner: Intel Corporation
number: 07899024
owner_city: Santa Clara
owner_country: US
publication_date: 20070228
---
Embodiments of the present invention are related to the field of electronic devices and in particular to communication devices.

A broadband wireless access BWA system provides a point to multipoint communication system in a communications network. BWA systems typically use microwave and millimeter wave technology to transmit communication signals from a wireless base station BS to one or more subscriber stations SS . A BWA system may transmit various types of digital signals including video voice television Internet and other data signals.

An 802.16 family of standards were developed by the Institute of Electrical and Electronic Engineers IEEE to provide for fixed portable and or mobile BWA networks e.g. the IEEE std. 802.16 published 2004 and subsequent revisions . The Worldwide Interoperability for Microwave Access WiMAX forum facilitates the deployment of broadband wireless networks based on the IEEE 802.16 standard. In particular the WiMAX forum ensures the compatibility and inter operability of broadband wireless equipment. For convenience the terms 802.16 and WiMAX may be used interchangeably throughout this disclosure to refer to the IEEE 802.16 suite of air interface standards.

WiMAX networks may be converged wireless network designed to provide voice video and data services. A significant benefit of the converged wireless networks such as a WiMAX network is in the sharing of the most valuable resources the wireless spectrum among different services. However the wireless network convergence in a WiMAX network also comes with some challenges due to its point to multiple point topology. Downlink traffic broadcast to all SSs clients from BS is not much of an issue. The challenges lie in the arbitration of uplink transmission between multiple SSs as well as the allocation of uplink bandwidth with Quality of Service QoS needed for different services.

In the following description for purposes of explanation numerous details are set forth in order to provide a thorough understanding of the disclosed embodiments of the present invention. However it will be apparent to one skilled in the art that these specific details are not required in order to practice the disclosed embodiments of the present invention. In other instances well known electrical structures and circuits are shown in block diagram form in order not to obscure the disclosed embodiments of the present invention. The term coupled shall encompass a direct connection an indirect connection or an indirect communication.

With reference to an illustrative Broadband Wireless Access BWA system is shown according to the various embodiments of the present invention. The BWA system may use wireless cells to cover geographic areas. The BWA system may include a base station BS at a central site location transmitting to a plurality of subscriber stations SS at remote site locations with each SS having Customer Premise equipment CPE . Generally the BWA system may be illustrated two kinds of CPEs and . However depending upon the implementation both kinds of CPEs and may be present in the BWA . A given SS may include either CPE or . Additionally although only one CPE of each type is illustrated there may be a plurality of either kind of CPE in the BWA system . Elements of the BWA system may communicate with each other in accordance with the communication protocol of the IEEE 802.16 standard. In general this 802.16 standard may define wireless broadband access for fixed and or mobile SSs such as SSs in a wireless Metropolitan Area Network MAN which may also be referred to as a WiMAX network.

The first kind of CPE may have coupled thereto one or more Internet Protocol IP phones for example coupled by way of an Ethernet connection of the CPE and in some embodiments may also have coupled thereto one or more computing devices such as a personal computer. In some embodiments each IP phone may include a Session Initiation Protocol SIP user agent not shown . The second kind of CPE may have coupled thereto one or more analog phones for example coupled by way of a RJ11 interface of the CPE and in some embodiments also may have coupled thereto one or more of the computing devices such as a personal computer. The IP phones and analog phones result in Voice over Internet Protocol VoIP calls. SIP is an application layer control signaling protocol for creating modifying and terminating sessions with one or more IP phones see Request For Comments RFC 3261 specification from the Internet Engineering Task Force IETF SIP Working Group. However protocols other than SIP may be used for VoIP call sessions.

The BS may have a receive transmit antenna to receive wireless communication signals via a wireless transmission medium from the SSs and to transmit wireless communication signals to the SSs . The CPEs and may include antennas and respectively. The antennas and may receive and transmit a wireless communication signal from and to the BS . The BS may collect traffic to and from the SSs within a cell. The BS may include equipment including BS uplink scheduler having an interface to a wired or wireless backbone network such as the Internet thereby providing a link between a given SS and the backbone network . In turn the backbone network may have a number of devices coupled to it as illustrated by the IP phone and the computing device .

The CPEs and according to various embodiments of the present invention are directed toward supporting VoIP. More specifically the CPEs and are configured to transport VoIP traffic originating from the IP phones or analog phones over a connection with differentiated Quality of Service QoS tailored for voice services. The various embodiments of the present invention deploy VoIP over WiMAX by using a two phase call control procedure that may be implemented in the CPEs and as will be described hereinafter after a description of the relevant portions of the IEEE 802.16 standard.

IEEE 802.16 defines a service flow as a Media Access Control MAC transport service that provides unidirectional transport of packets either uplink packets transmitted by the SS or downlink packets transmitted by the BS. A service flow is characterized by a set of QoS Parameters such as latency jitter and throughput assurances. The BS provides a given QoS according to the QoS Parameter Set defined for the service flow. Generally a service flow as described in the IEEE 802.16 standard may have three states each service flow can transition to any of the three states a Provisioned this state of service flow is known via provisioning by for example a network management system b Admitted this state of service flow has resources reserved by the BS for the SS and c Active this state of service flow has resources committed by the BS for the SS. IEEE 802.16 includes a parameter QoS Parameter Set Type Set Type within each service flow encoding which specifies the proper application of the QoS Parameter Set to the Provisioned Set the Admitted Set and or the Active Set. The 802.16 standard proposes a two phase Activation Model wherein resources such as bandwidth are first admitted and then once the end to end negotiations are completed the resources are activated .

IEEE 802.16 defines a DSA Dynamic Service Addition message and a DSD Dynamic Service Deletion message that may be used to create or delete service flows dynamically as VoIP calls are set up or torn down respectively. However using DSA DSD for reserving bandwidth for one or more VoIP calls has the following issues a To prevent a subscriber from using the service for which the subscriber is not authorized each DSA request needs to forward to authorization server for authorization. It may add significant overhead and delay to each VoIP call setup. b Two Service Flow Identifiers SFIDs need to be assigned and released for each VoIP call which may add extra overhead and complexity in the SFID management across BSs. It also means that two SSs can use the same SFID which may cause confusion in account management since the accounting records are based on SFIDs. c Since the BS cannot predict how many DSA DSD messages will be sent from subscribers for VoIP calls BS overall bandwidth may not be distributed optimally for different services which may result in VoIP call rejection or bandwidth waste. d It also may add overhead to BS scheduler to process DSA DSD messages on per call basis. As will be described hereinafter the CPEs and according to various embodiments of the present invention take another approach the two phase call control procedure as well be discussed hereinafter.

IEEE 802.16 WiMAX also defines uplink scheduling services using bandwidth request grant process to differentiate QoS requirements. The following are service classes of IEEE 802.16 for various services Unsolicited Grant Services UGS Real Time Polling Services rtPS Non Real Time Polling Services nrtPS and Best Effort Services BE . Each service class includes a grouping of service flow properties or attributes including QoS parameters used by the SS or BS to request service flows with desired QoS. UGS is designed to support constant bit rate CBR or CBR like service flows such as T1 E1 emulation and VoIP without silence suppression. In other words UGS is tailored for carrying services that generate fixed units of data periodically. Consequently the BS schedules regularly in a preemptive manner reserved bandwidth allocations bandwidth grants without an explicit bandwidth request from the SS. Real Time Polling Services rtPS is designed to support real time service flows that generate variable size data packets on a periodic basis such as MPEG video. SSs are polled frequently enough to meet the real time requirement of service flows. UGS or rtPS may be used with the CPEs according to various embodiments of the present invention with UGS being referred to in some of the embodiments. Generally Non Real Time Polling Services nrtPS and Best Effort Services BE are not suited for VoIP calls.

Referring to an overview block schematic diagram is shown which is representative of the BS and one of the SSs of the BWA system shown in in accordance with various embodiments of the present invention. The BS and SS conceptually are divided into an uplink portion and a downlink portion by an imaginary line . Functional units of the BS and SS may conform to the layers of the Opens Systems Interconnect OSI model including the media access control MAC layer and the physical PHY layer with the layers being divided into uplink and downlink portions. Hence the SS may be illustrated with a packet classifier coupled to uplink MAC PHY layer portions and a downlink MAC PHY layer portions . Likewise the BS may be illustrated with a packet classifier coupled to downlink MAC PHY layer portions and an uplink PHY layer portion and MAC layer portion . A conceptual transmission pipe is illustrated between the uplink MAC PHY layers of the SS and the uplink PHY layer portion of the BS with this pipe being illustrated with an uplink UGS service flow and an uplink BE service flow. Likewise a conceptual transmission pipe is illustrated between the downlink MAC PHY layer portions of the BS and the downlink PHY layer portion of the SS with this pipe being illustrated with a downlink UGS service flow and a downlink BE service flow. The SS may be either the CPE or of . The packet classifier in the SS may classify and route the uplink VoIP packets to the uplink UGS service flow toward the BS while the packet classifier in the BS may classify and route the downlink VoIP packets to the downstream UGS service flow toward the SS . Classifiers use rules such as destination IP Port address QoS attributes e.g. Tos Type of Service DSCP Differentiated Service Code Point to classify the packets. There may be multiple classification rules for a service flow so multiple IP connections may be routed to the same service flow.

The SS utilizes the two phase call control procedure which includes Phase I for bandwidth reservation and Phase II for bandwidth activation. Prior to Phase I there may be a provisioning of a service flow. During provisioning the service flow is instantiated and its Provisioned QoSParamSet may be set to included a provisioned bandwidth that may be subsequently reserved during Phase I as will be described hereinafter. As one possibility the amount of the provisioned bandwidth may be set by a network management system not shown . The provisioned bandwidth may be negotiated between the BS and the SS prior to or during connection setup. The provisioned bandwidth may be set for some number of phones with this number of phones not being limited to one. For example 200 Kbps may be set for the provisioned bandwidth for a given SS which may want to undertake two VoIP calls simultaneously assuming 100 Kbps per VoIP call. In this example even though the SS may connect more than two IP or analog phones or to the CPE or respectively at most there may be only two active calls at any given time during the Phase II bandwidth activation to be described hereinafter. Statistically at the SS not all VoIP calls may be active at the same time so the SS with respect its VoIP users may be able to under subscribe with respect to setting the provisioned bandwidth with the BS without significant reductions in performance.

For bandwidth reservations of Phase I the BS may provide reserved bandwidth allocations to the SSs for VoIP service flows with such SSs having previously established provisioned service flows. Due to constraints on the BS the reserved bandwidth allocation in some cases may be less than the provisioned bandwidth. In any case due to the prior establishment of the provisioned bandwidth the BS knows in advance the amount of the desired reserved bandwidth allocation to be provided to a given SS if not subject to any BS constraints. For bandwidth activation of Phase II the uplink downlink UL DL UGS service flows are activated for at least one VoIP call. Assuming the reserved bandwidth allocation in Phase I was for more than one VoIP call then more than one active VoIP call i.e. a plurality of VoIP calls may share the same UGS service flow. In some embodiments each VoIP call included in the UGS service flow may be activated and deactivated separately.

In the two phase call control procedure a single reserved bandwidth allocation for a plurality of VoIP calls may be granted for a service flow without having to grant multiple reserved bandwidth allocations for a service flow in response to multiple DSA messages. Likewise there are not multiple DSD messages requesting deactivation of reserved bandwidth allocations for one or more VoIP calls. This may reduce connection setup overhead of the BS scheduler. Additionally improved bandwidth efficiency may be achieved without impacting VoIP quality by the BS being able to allocate bandwidth for voice services in advance avoiding the issue of not know how many voice calls will be initiated removed in a given DSA DSD message. Hence bandwidth waste and poor voice services may be reduced. Additionally the CPEs and may work with any IP phone and any analog phone respectively. The two phase call control procedure does not require changes to MAC layer or PHY layer of the CPEs and since it may be implemented in the application space. Additionally since the two phase call control procedure is implemented in the CPEs and it may be transparent to the BS . Therefore the inclusion of the two phase call control procedure may create a value added service for the CPE or without causing any interoperability issue with the BS . No modifications of the 802.16 standard are needed to implement the two phase call control procedure. Additionally inclusion of the two phase call control procedure in the CPE or may provide support for a Vonage usage model over WiMAX.

Referring to the SS is shown in a more detailed manner but with just the VoIP call connections being shown no packet classifier . shows the CPE of in more detail and shows the CPE of in more detail. Referring to according to one embodiment of the present invention the SS takes the form of the CPE which is shown coupled to two IP phones and one computer . The various OSI layers of the CPE are shown in more detail in than in but are not divided into uplink and downlink portions as undertaken with such layers being configured for IP phones . In some embodiments the phones and computer may be coupled to an Ethernet PHY layer which in turn is coupled to a call session module in the form of a Session Initiation Protocol SIP proxy through an Ethernet MAC layer an Internet Protocol IP layer and a Transmission Control Protocol TCP layer . Also in some embodiments the IP layer may be coupled to the BS through a MAC CS Convergence Sublayer a MAC CPS Common Part Sublayer a WiMAX PHY layer and the wireless medium . A connect control module such as a WiMAX Connect Control WCC module is included in the CPE and includes a WCC Application Programming Interface API that interfaces with the call session module SIP proxy and a MAC API that interfaces with the MAC CS and the MAC CPS . The architecture of the CPE of provides support for IP phones . The WCC module is responsible for mapping the VoIP streaming with a WiMAX service flow. The SIP proxy may play both a server role and a client role. When acting as a SIP server SIP proxy receives SIP messages from one of the IP phones . The SIP proxy acting as a SIP client then forwards the SIP messages to the network on behalf of the IP phone . The voice streaming packets may be routed from Ethernet MAC layer to the WiMAX service flows that are set up by the WCC module through the IP layer .

Referring to according to one embodiment of the present invention the SS takes the form of the CPE which is shown coupled to one analog phone may be more than one and one computer . Many of the components of are the same as hence they will retain the same reference numbers and will not be described again. However CPE includes components to handle an analog phone which includes a codec COder DECoder SLIC Subscriber Line Interface Circuit combination . The codec may provide for coding analog signals from the analog phone into digital signals and decoding digital signals into analog signal going to the analog phone . The SLIC may provide loop interface functions including for example battery feed overload protection supervision and 2 4 wire hybrid. The codec SLIC combination may be coupled to a call session module in the form of a SIP user agent through drivers which also is coupled to the IP . The SIP user agent is coupled to the WCC module via the WCC API and is coupled to the TCP . The architecture of the CPE of supports analog phones . The WCC module again is responsible for mapping the VoIP streaming with a WiMAX service flow. SIP user agent may interface with the Codec and SLIC combination for analog phone events such as on hook off hook detection and ringing activation. The voice streaming packets may be routed from codec to the WiMAX service flows that are set up by the WCC module through the IP layer .

With respect to the two API interfaces of the WCC module are defined as follows. The SIP proxy of and the SIP user agent of are generically referred to as the call session module since the exchanged messages signals with the WCC API are the same in . Although SIP is used to implement the call session module other call session protocols may be used. The WCC API of the WCC module in both may enable the SIP application to activate or deactivate WiMAX service flows using the following messages a wccConnReq a connection request message from the call session module SIP proxy of or SIP user agent of to connect a VoIP streaming to a WiMAX service flow b wccConnRsp a connection response message to wccConnReq c wccDiscReq a disconnection request message from the call session module SIP proxy of or SIP user agent of to disconnect a VoIP streaming to a WiMAX service flow and d wccDiscRsp a response message to wccDiscReq. The MAC API of the WCC module may use IEEE 802.16 MAC messages to control service flows. In some embodiments these IEEE 802.16 messages may include a dsaReq dynamic service addition Request DSA REQ request to create a service flow b dsaRsp dynamic service addition Response DSA RSP response to DSA REQ c dscReq dynamic service change Request DSC REQ request to change service flow attributes d dscRsp dynamic service change Response DSC RSP response to DSC REQ e dsdReq dynamic service deletion Request DSD REQ request to delete a service flow and f dsdRsp dynamic service deletion Response DSD RSP response to DSD REQ.

Referring to a control state transition diagram is provided for WCC module of according to the various embodiments of the present invention using the above described API messages or signals and provides an overview of the diagrams of to be presented hereinafter. This diagram of has the following states a Initialization State initial state after power up or reset b Admitted State resources such as UL DL service flow have been reserved allocated but not yet activated i.e. no active VoIP calls c WaitForActivation State waiting for BS response on service flow activation d Active State there is at least one active VoIP call and e WaitForDeactivation State waiting for BS response on service flow deactivation. The Admitted State corresponds to the Phase I of the two phase call control procedure described above. While in the Initialization State the BS may send to the WCC module a non solicited dsaReq message requesting that it provide a reserved bandwidth allocation for some number of VoIP calls. Upon responding with a dsaRsp message not shown to the BS the WCC module may transition from the Initialization State to the Admitted State . The WCC module may transition from the Admitted State back to the Initialization State when the BS sends the dsdReq message to delete the service flows. Upon receiving a wccConnReq message from the call session module the WCC module may send a dscReq message to the BS and may transition from the Admitted State to the WaitForActivation State . Upon receiving a dsqRsp message from the BS the WCC module may transition from the WaitForActivation State to the Active State . Active State corresponds to Phase II of the two phase call control procedure described above in that there now is an Active VoIP call. If another VoIP call is to be added as indicated by the wccConnReq message extending from the Active State to the WaitForActivation State then for that VoIP call the WCC module transitions back to the WaitForActivation State . When a VoIP call is terminated by the WCC module receiving a wccDiscReq message from the call session module then the WCC module may transition from the Active State to the WaitForDeactivation State where the WCC may send a dscReq message to the BS. Upon receiving a dscRsp message from the BS the WCC may transition to the Admitted State .

Referring to a procedure of the WiMAX Connection Control WCC module of according to the various embodiments of the present invention is shown in which the WCC module starts in its Initialization State and after a number of operations either remains in the Initialization State or transitions to its Admitted State . While the WCC module is in its Initialization State if in an operation the WCC module receives a wccConnReq message from the call session module SIP Proxy of or the SIP user agent of requesting that a VoIP stream be connected to a WiMAX service flow while in its Initialization State then the WCC module in an operation may respond to the call session module with a wccConnRsp message indicating Failure no connection exists and then continue in the Initialization State as shown by the repeated Initialization state . While in the Initialization State the WCC module in an operation may receive a dsaReq message from the BS requesting bandwidth reservation of the service flow for VoIP calls. This BS initiated dsaReq message have its Set Type parameter set to Admitted Set and in some embodiments may use the Service Name Class UGS with there being a QoS Parameter Set associated with UGS. In some embodiments the BS initiated dsaReq may include a bandwidth amounts for the reserved bandwidth allocations which may be equal to or less than the provisioned bandwidths for uplink UP and downlink DL connections. In an operation the WCC module may determine whether the Set Type of the SS initiated dsaReq message is Admitted . If yes then in an operation the WCC may send a dsaRsp response message to the BS with a Confirmation Code CC parameter set to Okay OK . Next in an operation the available bandwidth quantity Bw XL may be initialized to the bandwidth amount of the reserved bandwidth allocation. This may be the provisioned bandwidth if the BS is not constrained in providing the full amount of the provisioned bandwidth. In an operation the WCC module may determine whether the UP DL connections are each admitted. If yes then the WCC module may transition to its Admitted State and if no then the WCC may remain in its Initialized State. In operation if the Set Type is not Admitted then in an operation the WCC module may respond with a dsaReq message where the CC is set to indicate other wrong QoS parameter set type and then may proceed to the Admitted State .

With reference to the WCC module of according to the various embodiments of the present invention starts in the Admitted State . If a wccConnReq message request for an VoIP call is received by the WCC module while in the Admitted State in an operation then in an operation the uplink available bandwidth quantity Bw UL may be compared with the amount of the uplink call session bandwidth requested bandwidth reqBw for the VoIP call to determine whether it is equal to or greater than the uplink reqBw and the amount of the available downlink bandwidth Bw DL may be compared with the downlink call session bandwidth requested bandwidth reqBw to determine if it is equal to or greater than the downlink reqBw. If yes then in an operation the WCC module may cause the SS to send a dscReq message to the BS to activate the uplink UL connection. Next in an operation the WCC module may set a T7 timer defined in IEEE 802.16 to define a period of time to receive a dscRsp message from the BS. Likewise in an operation the WCC module may cause the SS to send a dscReq message to the BS to activate the downlink DL connection. Next in an operation the WCC module may set a T7 timer to define a period of time to receive a dscRsp message from the BS. Thereafter the WCC module may transition to the WaitForActivation State . In operation if the available bandwidth quantities do not exceed the reqBw the WCC module may proceed to send a wccConnRsp message that indicates Failure not sufficient recourse for the VoIP phone call. While in the Admitted State in an operation the WCC may receive from the BS a dsdReq message to request the deletion of an Active VoIP call from the BS. In an operation the WCC may set the CC parameter of a dsdRsp message and in an operation the dsdRsp message may be sent to the BS. Then the WCC may transition back to the Initialization State .

Referring to the WCC module of starts in a WaitForAction State . While in this WaitForAction State in an operation the WCC module may receive a dsdReq message from the BS. In an operation the WCC may set the parameter CC to reject in a dsdRsp message and in the operation may send the dsdRsp message to the BS. Thereafter the WCC module stays in WaitForActivation State . While in this WaitForAction State in an operation the WCC module may receive a dscRsp message from the BS in response to the previously sent dscRsp message sent in . In an operation the WCC module may check the CC parameter of the received dsdRsp message to see if it is set to Success . If yes in an operation the timer T7 timer may be set and in an operation the Bw XL may be reduced by the amount of the session call bandwidth portion requested bandwidth reqBw for the VoIP call. In operation the WCC module may determine whether the downlink and the uplink are activated. If yes then in operation the WCC module may send a wccConnRsp to the call session module indicating successful activation for the VoIP call and then is in the Active State . If no in operation then the WCC module may remain in the WaitForActivation State . If no in the operation then in an operation the WCC module may send a wccConnRsp to the call session module indicating failure Action failure and then may proceed to an operation where the WCC module may determine if there are any Active Calls. If yes then the WCC module is in the Active State . If no then the WCC module is in the Admitted State. If the T7 timer set in times out while waiting for the dsdRsp message indicating activation of the desired bandwidth for the VoIP call in an operation then in an operation the WCC module may determine whether a Retry count has not reached a retry limit. If yes then in an operation the WCC module may repeat its dscReq message to activate a VoIP connection and again may set the T7 timer in an operation and may remain in the WaitForActivation State . If no in operation then the WCC module may perform clean up procedures in an operation . In an operation an error log may be entered stating T7 timeout retry exceeded limit . In an operation the WCC module next may send a wccConnRsp message to the call session module indicating Failure Action Failure . Next in an operation the WCC may proceed to see if there are any active calls. If there are any active calls then the WCC module may proceed to the Admitted State . If there are no active calls then the WCC module may proceed to the Active State .

With respect to the WCC module of according to the various embodiments of the present invention starts in the WaitForDeactivation State due to having received a wccDiscReq message from the call session module. While in the WaitForDeactivation State in an operation the WCC module may receive from the BS a dsdReq message requesting deactivation of a service flow when a VoIP call is still active. In an operation the WCC module may respond by setting the CC parameter to reject in the 802.16 standard the setting is read as reject temporary resource in a dsdRsp message. In an operation the WCC may send the dsdRsp message to the BS and may remain in the WaitForDeactivation State . While in the WaitForDeactivation State in an operation the WCC module may receive from the BS a dscRsp message responding to a prior dscReq request message for deactivation. The WCC module in an operation may check the parameter CC of the dscRsp message to see if it was set for Success by the BS. If yes then in an operation the T7 timer may be reset and in an operation the available bandwidth quantity Bw XL may be increased by the reqBw of the deactivated VoIP call. Next in an operation the WCC module may check and see if both the Uplink and Downlink connections have been deactivated. If yes then in an operation the WCC module may send a wccDiscRsp message to the call session module indicating Success and in operation may check to see if there are any remaining active calls. If yes the WCC may transition to the Active State and if no the WCC may transition to the Admitted State . If no in operation the WCC module may remain in the WaitForDeactivation State . If no in the operation then in an operation an error log may be entered for the CC parameter and the WCC module may loop to operation . The WCC module may activate the T7 timer prior to sending any dsa dsc dsd request messages which may timeout if the dsa dsc dsd response is not processed in time. Hence while in the WaitForDeactivation State in an operation the WCC module may have a T7 timer timeout while waiting for the dscRsp message from the BS. Then in an operation the WCC module may determine if the number of Retries has not exceeded a set limit and if yes then in an operation the dscReq message to deactivate the connection may be retried and in an operation the T7 timer may be set and the WCC module may remain in the WaitForDeactivation State . If no in operation then in an operation a error log may be made indicating that in attempting deactivation the T7 retries exceeded the set limit and in operation a wwwDiscRsp signal may be sent to the call session module. Then in operation the WCC module determines whether there are any remaining Active calls and if yes the WCC module may transition to the Active State and if no the WCC module may transition to the Admitted State .

With respect to the WCC module of according to the various embodiments of the present invention starts in the Active State due to having received active bandwidth from the BS which is being used for active VoIP calls. The WCC module may want to increase or decrease the available bandwidth quantity BW XL by a bandwidth increment of decrement respectively. For example the BS may not have provided the entire maximum provisioned bandwidth and may want to increase the reserved bandwidth. Alternatively the WCC module may have reserved for the SS with the maximum provisioned bandwidth but for example the subscriber agreement may allow for increasing the maximum provisioned bandwidth or decreasing the maximum provisioned bandwidth. Other possibilities may lead to the need and ability to increase the reserved provisioned bandwidth allocation. To initiate this in an operation the WCC module may receive a dscReq message from the SS enquiring as to whether to increase the available bandwidth quantity Bw XL . In an operation the WCC module asks itself whether to increase or decrease or keep the same the bandwidth and if it is an increase does it want to increase the reserved bandwidth allocation. If there is to be an increase then in an operation the available bandwidth quantity Bw XL is increased by a bandwidth increment bwIncrement . Then in an operation the WCC responds to the BS by sending a dscRsp message with the CC parameter set to Okay so as to accept the bandwidth increment or decrement. If at operation there is a bandwidth decrement then in an operation the WCC module may decide whether it wants to decrease the available bandwidth quantity Bw XL . If yes then in an operation the available bandwidth quantity Bw XL may be decreased by the bandwidth decrement bwDecrement and the WCC module may send a dscRsp message to the BS with the parameter CC set to Okay to accept the decrement with the WCC remaining in the Active State . If the WCC module does not want to accept the bandwidth decrement at operation in effect wants to keep Bw XL the same then in an operation the WCC module may set the parameter CC in a dscRsp message to reject and in an operation may send the dscRsp response to the BS with the WCC remaining in its Active State . Upon receipt of a wccConnReq message from the call session module for connecting a VoIP call while the WCC module is in its Active State in an operation then in an operation the WCC module checks to see if the available bandwidth quantities Bw UL and Bw DL are greater than that needed for the amount of the call session bandwidth needed for the VoIP call reqBw . If yes then in an operation the WCC module may generate a dscReq message requesting activation of the UL connection and may send it to the BS. Next in an operation the WCC module may set the T7 timer for a response from the BS to the dscReq message for the UL connection. Likewise in an operation the WCC module may generate a dscReq message requesting activation of the DL connection and may send it to the BS. Next in an operation the WCC module may set the T7 timer for a response from the BS to the dscReq message for the DL connection and transitions to its WaitForActivation State . If no to operation then in an operation the WCC module response to the call session module by sending a wccConnRsp message indicating Failure not sufficient resource with the WCC module remaining in its Active State . Upon receipt of a wccDiscReq message from the call session module for a disconnected VoIP call while the WCC module is in its Active State in an operation in an operation the WCC module may send to the BS a dscReq message to disconnect the UL connection bandwidth for the disconnected VoIP call and in an operation may set the T7 timer for receipt of a response to the dscReq message for the UL connection Likewise in an operation the WCC module may send to the BS a dscReq message to disconnect the DL connection bandwidth for the disconnected VoIP call and in an operation may set the T7 timer for receipt of a response to the dscReq message for the DL connection and then may transition to its WaitForDeactivation State . While the WCC module is in its Active State in an operation the WCC module may receive a dsdReq message from the BS asking whether the WCC wants to disconnect the service flow. In an operation the WCC module may generate a dsdRsp message with the parameter CC set to reject and then in operation the WCC module may send the dsdRsp message to the BS with the WCC module remaining in its Active State .

Referring to an originating call setup scenario is depicted for IP phones of . In the Admitted State of the WCC in a first operation a SIP INVITE message may be transmitted from the caller agent to the SIP proxy . In a second operation the SIP proxy may forward the INVITE to the callee user agent . In a third operation a SIP trying signal may be sent from the SIP proxy to the caller agent . In a fourth operation a SIP ringing signal may be sent from the callee agent to the SIP proxy . In a fifth operation the SIP proxy may pass on the SIP ringing signal to the caller agent . In a sixth operation the callee agent may send a SIP OK to initiate the establishment of a VoIP call. In a seventh operation in response to the SIP OK the SIP proxy may send a wccConnReq message to the WCC requesting bandwidth for a VoIP call. In response to the wccConnReq message in eighth and ninth operations the WCC may send DSC REQ messages to the BS for the UL DL with the parameter set including qosSetType active and maxSusRate 100 k after which the WCC transitions to its WaitForActivation state . In the eighth operation the DSC REQ may accomplish the following functions for uplink service flow allocate the bandwidth as shown in maxSusRate parameter and configure the packet classifier of in the SS so the VoIP packets may be routed to the appropriate UGS service flow. The classification rule used in the configuring of the packet classifier may be based on IP address port or QoS Type of service differentiated services codepoint DSCP . In the ninth operation the DSC REQ may allocate the bandwidth as shown in the maxSusRate parameter and configure the packet classifier of in the BS so that the VoIP packets may be routed to the appropriate UGS service flow. In tenth and eleventh operations the BS may respond with DSC RSP messages for UL and DL respectively with the qosSetType set to active and maxSusRate 100 k with the WCC transitioning to its Active State . In a twelfth operation the WCC may send a wccConnRsp message to the SIP proxy . In a thirteenth operation the SIP proxy may send a SIP OK signal to the caller agent . In a fourteenth operation the caller agent may send an SIP acknowledgment ACK to the SIP proxy and in a fifteenth operation the SIP proxy may send the ACK to the callee agent after which a voice connection is established.

Referring to there is described a tear down scenario for the terminating call for the analog phones of . In a first operation the callee agent may send a SIP BYE message to the caller agent . In a second operation the caller agent may respond by sending a SIP OK message to the callee agent . In a third operation the callee agent may responds by sending a wccDiscReq to the WCC message to deactivate UL DL service flows for a VoIP call. In fourth and fifth operations the WCC may respond to the wccDiscReq message by sending DSC REQ messages for the UL and DL. Since this is the 1st VoIP call the maxSusRate may be set to 0. If it is not the 1st VoIP call then maxSusRate may be decrement by 100 Kbps. After the sending of the DSC REQs the WCC transitions to its WaitForActivation state . In sixth and seventh operations the BS may respond to the DSC REQs by sending DSC RSPs for the UL and DL with maxSusRate 0 with the WCC transitioning to the Admitted State . In an eighth operation the WCC may send wccDiscRsp to the callee agent with the voice connection then being torn down.

Referring to there is illustrated a CPE system which may be the CPE or of . The CPE system may include a processor integrated circuit chip and an IC chip carrier for mounting the chip . The IC chip carrier may be mounted on a substrate or printed circuit board PCB via a socket . However in other systems the IC carrier may be directly coupled to the PCB . The PCB may have mounted thereon a main memory and a plurality of input output I O modules for external devices or external buses all coupled to each other by a bus system on the PCB . The system may further include a mass storage device coupled to the bus system via an I O module . Additionally two illustrative phones or may be coupled to the bus system via I O modules and . Additional I O modules may be included for other external or peripheral devices or external buses.

In some embodiments with respect to the CPE system taking the form of CPE of the call session module SIP proxy and the WCC module of may be software modules that are moved from the mass storage device to the memory for execution by the processor . In some embodiments with respect to the CPE system taking the form of CPE of the call session module SIP user agent and the WCC module of may be software modules that are moved from the mass storage device to the memory for execution by the processor . Although the call session and WCC modules are shown as software modules in other embodiments they may be hard wired.

Although specific embodiments have been illustrated and described herein it will be appreciated by those of ordinary skill in the art that any arrangement which is calculated to achieve the same purpose may be substituted for the specific embodiment shown. This application is intended to cover any adaptations or variations of the present invention. Therefore it is manifestly intended that this invention be limited only by the claims and the equivalents thereof.

