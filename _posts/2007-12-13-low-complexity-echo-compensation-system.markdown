---

title: Low complexity echo compensation system
abstract: An echo reduction system includes a signal analysis filter that converts an input into sub-band signals. A signal down-sampling circuit down-samples the sub-band signals at a first down-sampling rate. An echo analysis filter converts a loudspeaker signal into echo sub-band signal that are further processed by an echo down-sampling circuit. The circuit down-samples the echo sub-band signals at a second down-sampling rate to generate down-sampled echo sub-band signals. An echo compensation filter folds the down-sampled echo sub-band signals with an estimated impulse response of a loudspeaker-room-input system. A second echo down-sampling circuit down-samples the folded down-sampled echo sub-band signals at a third down-sampling rate to generate estimated echo sub-band signals. The first down-sampling rate is equal to the product of the second and third down-sampling rates.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08194852&OS=08194852&RS=08194852
owner: Nuance Communications, Inc.
number: 08194852
owner_city: Burlington
owner_country: US
publication_date: 20071213
---
This application claims the benefit of priority from European Patent Application No. EP 06 02 6232.6 filed Dec. 18 2006 now European Patent No. 1 936 939 A1 which is incorporated by reference.

This disclosure relates to echo compensation. In particular this disclosure relates to an echo compensation system that reduces or eliminates echoes in a communication system.

Echo reduction or suppression may be used in communication systems such as hands free sets and speech recognition systems. Communication systems may include an input device that detects a signal such as a speech signal. The input device may also detect undesirable signals such as echoes.

Echoes may occur when sound is reflected from a surface. Such signals may be detected and re transmitted back to a source. Echoes may be annoying to the user and may result in a communication failure.

An echo reduction system includes a signal analysis filter that converts an input into sub band signals. A signal down sampling circuit down samples the sub band signals at a first down sampling rate. An echo analysis filter converts a loudspeaker signal into echo sub band signal that are further processed by an echo down sampling circuit. The circuit down samples the echo sub band signals at a second down sampling rate to generate down sampled echo sub band signals. An echo compensation filter folds the down sampled echo sub band signals with an estimated impulse response of a loudspeaker room input system. A second echo down sampling circuit down samples the folded down sampled echo sub band signals at a third down sampling rate to generate estimated echo sub band signals. The first down sampling rate is equal to the product of the second and third down sampling rates.

Other systems methods features and advantages will be or will become apparent to one with skill in the art upon examination of the following figures and detailed description. It is intended that all such additional systems methods features and advantages be included within this description be within the scope of the invention and be protected by the following claims.

A far end environment may include a far end input and a far end output or loudspeaker . The far end input may detect a speech signal of a far end speaker . Speech from the far end speaker may be reproduced by the near end loudspeaker and may be received by the near end input as reflected sound or an echo signal x n . The echo compensation system may reduce or eliminate the echo signal x n . The echo compensation system may be part of the near end environment and may be included in a communication system associated with the near end environment. A second echo compensation system may be part of the far end environment and may reduce or eliminate echoes in the far end environment . The communication system may be a hands free telephone or head set wireless telephone or other communication device. The echo compensation system may be part of a speech recognition system.

A signal down sampling circuit may communicate with each signal sub band filter and may down sample each of the sub band signals respectively by a first down sampling factor of r. The first down sampling factor r may be equal or substantially equal to the product of a second down sampling factor r and a third down sampling factor r according to Equation 2 below Eqn. 2 

The second and third down sampling factors r and r may be integer values. The second down sampling factor r may be equal to about 64 and the third down sampling factor r may be equal to about 2. Thus the first down sampling factor r may be equal to about 128 where the number of sub bands M may be equal to about 256. Other values of the second down sampling factor r may be used such as values between about 32 and about 512. Other values for the third down sampling factor r may be used such as integer values between about 2 and about 4. When using the higher values for the second and third down sampling factors the first down sampling factor r may be equal to about 2048 r rr 4 512 . The sampling rate of the input signal may be equal to about 11025 Hz. The signal down sampling circuits may generate down sampled sub band signals y n . 

In some systems only part of the microphone signal y n may be divided into sub bands by the signal analysis filter bank . For example a predetermined frequency range of the output signal y n may be divided into sub bands while a remaining frequency band or frequency region may be analyzed without sub band division.

The echo compensation system of may include an echo analysis filter or filter bank. The echo analysis filter may include a plurality of echo sub band filters which may divide the reference audio signal or echo signal x n into a plurality of echo sub bands signals.

The echo analysis filter may include a plurality of first echo down sampling circuits . Each first echo down sampling circuit may communicate with respective echo sub band filters and may down sample each of the echo sub band signals by the second down sampling factor r. The sub band signals down sampled by the first echo down sampling circuit may be stored in a ring buffer or other memory storage.

An echo compensation filter may receive the output of each of the first echo down sampling circuits or ring buffer output . The echo compensation filter may have a filter response n . In some systems the coefficients of the echo compensation filter may be adapted to perform echo compensation after initial down sampling by the first echo down sampling circuits using the first down sampling factor r where the value of r may be equal to about 64.

Filter coefficients of the echo compensation filter may be adapted for each sub band using a Normalized Least Mean Square process according to Equation 3 below 

The echo compensation filter may include a second echo down sampling circuit which may further down sample the output of the first echo down sampling circuits or ring buffer . In some systems the coefficients of the echo compensation filter may be adapted to perform echo compensation after down sampling by the second echo down sampling circuits using the third down sampling factor r. To reduce computational loads the filter coefficients may be adapted after the signals may be down sampled using the third down sampling factor r .

The echo analysis filter bank of may output sub band signals short time spectra in the frequency domain according to Equation 4 below 

The coefficients e may represent temporally adapted estimates for the corresponding impulse response of the LRM environment H e in accordance with the coefficients of h n in the time domain.

Aliasing terms of the signal analysis filter bank for 0 may be eliminated based on Equations 6 and 7 below 

In Equations 6 and 7 the sub bands M may have the same sub band width. The signal sub band filters G e for 1 . . . M 1 may be derived using Equations 5 and 6 for the sub band 0 by a frequency shift operation.

The echo compensation filter of may generate estimated sub band signals circumflex over d n corresponding to the echo signal d n captured by the input in the LRM environment . A summing circuit may subtract the estimated sub band signals circumflex over d n from the down sampled sub band signals y n to generate sub band error signals e n . 

The estimated sub band signals circumflex over d n may be generated based on the echo sub band signals previously stored in the ring buffer which may represent echo sub band signals sampled at the second down sampling rate r . However such signals may be processed using the first down sampling rate r which may correspond to the down sampling rate of the input sub band signals. Processing the echo signals using the second down sampling rate r may result in low aliasing terms while processing the microphone signals using the first higher down sampling rate r may reduce the computational load. Thus adapting the filter coefficients of the echo compensation filter may be performed at the first or highest down sampling rate r which may be equal to about 128 when using 256 sub bands. This may reduce the computational load and may reduce memory requirements. In some systems the sub band error signals e n may be filtered to reduce background noise that may be present in the microphone signal y n . 

The echo compensation system of may include a synthesis filter bank . is the synthesis filter bank . The synthesis filter bank or synthesis filter may include a plurality of up sampling circuits and corresponding synthesis sub band filters . Each up sampling circuit may receive the corresponding sub band error signals e n . The up sampling circuits may up sample the sub band signals using the factor r as an up sampling factor. The up sampling factor r may be equal to the first down sampling factor r where r r r .

Each synthesis sub band filter may include high pass filters band pass filters and or low pass filters to reduce or eliminate artifacts. A summing circuit may sum the output of each of the synthesis sub band filters to generate a synthesized speech signal n . The synthesized speech signal may have reduced acoustic echo.

The analysis sub band filters the echo sub band filters and the synthesis sub band filters may include square root Hann window filters. Square root Hann window filters may be efficient and robust in terms of stability. The filter length of the analysis sub band filters the echo sub band filters and or the synthesis sub band filters may be equal in length. The filter length may be about equal to the number of sub bands into which the microphone signal and the reference audio signal are divided. Filter banks of M parallel filters may include a prototype low pass filter h n and modulated band pass filters h n h n wwhere w e. Such filters may be based on discrete Fourier transforms in the form of a polyphase process which may provide a substantially flat frequency response.

The analysis sub band filters and the echo sub band filters may also be Hann window filters rather than square root Hann window filters which may be raised to an exponent corresponding to a first rational number. The first rational number may be for example about 0.75. Other values for the first rational number may be used such as values between about 0.50 to about 0.95. The synthesis sub band filters may also be Hann window filters rather than square root Hann window filters that may be raised to an exponent corresponding to a second rational number. The second rational number may be for example about 0.25 such that the sum of the first and second rational numbers may be about equal to 1. Other values for the second rational number may be used such as values between about 0.05 to about 0.50. Because the signal analysis filter bank may affect the quality of the enhanced microphone signal more than the synthesis filter bank the first rational number may be larger than the second rational number.

The first down sampled sub band echo signals may be down sampled a second time using a third down sampling factor r Act so that the total amount of down sampling may be about equal to r r r which may be the same as the down sampling factor applied to the microphone signal. Filter coefficients of the echo compensation filter may be adapted to generate estimated sub band signals Act . The estimated sub band signals may correspond to the echo signal. Filter adaptation may be performed using the first down sample factor of r r r . The estimated sub band echoes may be subtracted from the input sub signals Act to generate echo compensated microphone sub band signals. The echo compensated microphone sub band signals may be synthesized and combined Act to generate an enhanced audio signal for transmission to a remote communication party.

The output signals y n may be transmitted to an echo compensation system of . The echo compensation system may include the plurality of signal analysis filter banks which may receive the corresponding microphone signal y n . Each signal analysis filter bank may be the same or similar to the signal analysis filter bank of . Each output signal y n may correspond to a specific microphone channel of the input array . Each signal analysis filter bank or filter may generate a down sampled microphone sub band signal y n corresponding to the specific microphone channel k. 

The echo compensation system may include a plurality of the echo compensation filters . The number of echo compensation filters may be equal to the number of input channels k. Each echo compensation filter may be the same or similar to the echo compensation filter of . Each echo compensation filter may receive the output of the echo analysis filter bank . The echo analysis filter bank may be the same or similar to the echo analysis filter bank of . Each echo compensation filter may generate estimated sub band signals circumflex over d n based on the response n of the corresponding echo compensation filter .

A plurality of signal combining circuits may subtract the corresponding estimated sub band signals circumflex over d n from the down sampled sub band signal y n to generate sub band error signals e n which may correspond to the specific input channel k. The estimated sub band signals circumflex over d n may be generated by folding or combining the echo compensation filter response n with the corresponding sub band signals based on the reference audio signal x n . Adaptation of the echo compensation filter coefficients and the folding of the coefficients with the sub band reference signals may be performed at a down sampling rate that may be about equal to the down sampling rate of the signal analysis filter bank .

A beam forming circuit may receive and process the sub band error signals e n . The beam forming circuit may be adaptive or may be non adaptive. The beam forming circuit may be a delay and sum beam forming circuit. The beam forming circuit may process the signals using a process described by Optimum Array Processing Part IV of Detection Estimation and Modulation Theory by H. L. van Trees Wiley Sons New York 2002 which is incorporated by reference.

The beam forming circuit may be a delay and sum beam former or it may be a Generalized Sidelobe Canceller. The Generalized Sidelobe Canceller may include a first or lower adaptive signal processing path with a blocking matrix and an adaptive noise canceling circuit. The Generalized Sidelobe Canceller may include a second or upper non adaptive signal processing path with a fixed beam former. The beam forming circuit may process the signals using a process described by An alternative approach to linearly constrained adaptive beamforming by Griffiths IEEE Transactions on Antennas and Propagation vol. 30 p. 27 1982 which is incorporated by reference.

The beam forming circuit may combine the sub band error signals e n for each of the k input channels to generate beam formed sub band signals. A beam formed filter circuit may receive the beam formed sub band signals and may suppress a residual echo to enhance the quality of the beam formed sub band signals. The beam formed filter circuit may include a Wiener filter. The Weiner filter may reduce background noise in the frequency domain according to Equation 8 below 1 Eqn. 8 where e n may denote an estimated short time power density of the background noise and where e n may denote a short time power density of the full band error signal.

The beam formed filter circuit may generate enhanced sub band signals n . A synthesis filter bank may receive the enhanced sub band signals n . The synthesis filter bank may include a plurality of up sampling circuits and corresponding synthesis sub band filters . Each up sampling circuit may receive the corresponding enhanced sub band signals n . The up sampling circuits may up sample the sub band signals using the factor r as the up sampling factor. The up sampling factor r may be equal to the first down sampling factor r where r r r . Each synthesis sub band filter may include high pass filters band pass filters and or low pass filters to reduce or eliminate artifacts. A summing circuit may sum the output of each of the synthesis sub band filters to generate a synthesized speech signal n . 

The logic circuitry and processing described above may be encoded in a computer readable medium such as a CDROM disk flash memory RAM or ROM an electromagnetic signal or other machine readable medium as instructions for execution by a processor. Alternatively or additionally the logic may be implemented as analog or digital logic using hardware such as one or more integrated circuits including amplifiers adders delays and filters or one or more processors executing amplification adding delaying and filtering instructions or in software in an application programming interface API or in a Dynamic Link Library DLL functions available in a shared memory or defined as local or remote procedure calls or as a combination of hardware and software.

The logic may be represented in e.g. stored on or in a computer readable medium machine readable medium propagated signal medium and or signal bearing medium. The media may comprise any device that contains stores communicates propagates or transports executable instructions for use by or in connection with an instruction executable system apparatus or device. The machine readable medium may selectively be but is not limited to an electronic magnetic optical electromagnetic or infrared signal or a semiconductor system apparatus device or propagation medium. A non exhaustive list of examples of a machine readable medium includes a magnetic or optical disk a volatile memory such as a Random Access Memory RAM a Read Only Memory ROM an Erasable Programmable Read Only Memory i.e. EPROM or Flash memory or an optical fiber. A machine readable medium may also include a tangible medium upon which executable instructions are printed as the logic may be electronically stored as an image or in another format e.g. through an optical scan then compiled and or interpreted or otherwise processed. The processed medium may then be stored in a computer and or machine memory.

The systems may include additional or different logic and may be implemented in many different ways. A controller may be implemented as a microprocessor microcontroller application specific integrated circuit ASIC discrete logic or a combination of other types of circuits or logic. Similarly memories may be DRAM SRAM Flash or other types of memory. Parameters e.g. conditions and thresholds and other data structures may be separately stored and managed may be incorporated into a single memory or database or may be logically and physically organized in many different ways. Programs and instruction sets may be parts of a single program separate programs or distributed across several memories and processors. The systems may be included in a wide variety of electronic devices including a cellular phone a headset a hands free set a speakerphone communication interface or an infotainment system.

While various embodiments of the invention have been described it will be apparent to those of ordinary skill in the art that many more embodiments and implementations are possible within the scope of the invention. Accordingly the invention is not to be restricted except in light of the attached claims and their equivalents.

