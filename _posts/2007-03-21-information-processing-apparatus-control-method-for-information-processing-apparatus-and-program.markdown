---

title: Information processing apparatus, control method for information processing apparatus, and program
abstract: The address of an image processing apparatus is set as the network address of an external network of an information processing apparatus, a network address different from the address of the image processing apparatus is set as the network address of a local network, and an address different from these network addresses is distributed to another information processing apparatus.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07953078&OS=07953078&RS=07953078
owner: Canon Kabushiki Kaisha
number: 07953078
owner_city: 
owner_country: JP
publication_date: 20070321
---
The present invention relates to an information processing apparatus and more particularly to an information processing apparatus in an image processing system that includes an information processing apparatus as an extended control apparatus which is appended to an image processing apparatus to extend its functions and flexibility. In this case the image processing apparatus has e.g. a printer function image input function document filing function document transmission reception function image conversion function and the like.

In recent years most of printers scanners FAX apparatuses or image processing apparatuses which have multi functions of these apparatuses comprise a network communication function. Some of these image processing apparatuses having the network communication function comprise a data transfer function of sending image data to a PC server or the like connected via a network.

In such a data transfer function host protocols such as an SMTP protocol used to transfer e mail messages an HTTP protocol that can implement i FAX and file uploading an FTP protocol used to output files and the like are used. HTTP is short for Hyper Text Transfer Protocol and FTP is short for File Transfer Protocol.

On the other hand as a means for extending functions of an image processing apparatus a so called external controller apparatus is available. Such an external controller apparatus achieves various extended functions. For example the external controller apparatus can extend a network function to convert data of a network LAN communication format used in a user environment into data suited to an I F scheme of the image processing apparatus. Also the external controller apparatus provides an extended storage function that spools communication data and a load distribution function that takes over some processes to be executed by the image processing apparatus or a client apparatus.

As a connection mode between such an external controller apparatus and image processing apparatus the network communication function of the image processing apparatus may be used upon connection. As the connection mode in this case a dual network mode in which the external controller apparatus is inserted between the image processing apparatus and a LAN and works as a bridge between the image processing apparatus and LAN is known. Also a single network mode in which the image processing apparatus and the external controller apparatus are connected to the LAN is known.

Upon comparison between the single network mode and dual network mode the dual network mode does not consume the bandwidth of the LAN since an independent local network is formed between the external controller apparatus and image processing apparatus in this mode. The external controller apparatus and image processing apparatus exchange a large volume of image data. In the dual network mode the independent local network can use a transmission scheme of a broader bandwidth than the LAN in such case.

Furthermore in the dual network mode the external controller apparatus and image processing apparatus behave as one network apparatus. On the other hand in the single network mode the external controller apparatus and image processing apparatus independently consume logical resources such as network addresses and the like and physical resources such as a hub ports and the like. Therefore the dual network mode consumes fewer network resources in the LAN than the single network mode.

Japanese Patent Laid Open No. 2003 99230 discloses a method of providing additional functional capability by an information processing apparatus to be referred to as an extended control apparatus hereinafter connected to an image processing apparatus.

An extended image processing system is configured by an image processing apparatus and extended control apparatus . This system provides further extended functions to the image processing apparatus which has a printer function image input function document filing function document transmission reception function image conversion function and the like. A network interface card to be abbreviated as NIC hereinafter not shown of the image processing apparatus and a NIC of the extended control apparatus are connected via a LAN . Note that the NIC is also called a local NIC and the LAN is also called a local network. A NIC of the extended control apparatus is connected to an external LAN and communicates with other network nodes via the external LAN . Note that the NIC is also called an external NIC and the external LAN is also called an external network.

A client personal computer to be referred to as a client PC hereinafter is a personal information processing apparatus and is mainly set on the desktop of the user to execute various application programs. The client PC is connected to the external LAN and uses services provided by other network nodes or provides services to other network nodes via the external LAN .

A server computer is a large scale information processing apparatus is connected to the external LAN and provides services mainly to other network nodes via the external LAN . A printer is a network compatible peripheral device is connected to the external LAN and provides services of the image processing apparatus to other network nodes via the external LAN . A router is a network node which connects neighboring networks and connects a wide area network WAN such as the Internet virtual private network and the like and the external LAN .

A case will be explained below using wherein the extended control apparatus that can provide a secure print application function is connected to the image processing apparatus which has no secure print application function.

In the network environment a print job which is generated at one site in the network can be printed at another site. In some cases confidential information or information associated with secrecy in another aspect must be printed.

Upon transmitting such confidential information to a device a method of transmitting a print job encrypted on the client PC side to the device and printing the print job decrypted on the device side is known. Also a method of temporarily storing print information sent from the client PC by the device and printing that information when the user has been successfully authenticated using an IC card or the like on the device side is also known. In order to assure security protection against electronic eavesdropping of transmission a print job may be generally encrypted by an encryption method using a secret key. Also in order to permit to view hardcopy printouts without authentication or to electronically eavesdrop and view print jobs stored in a print queue authentication using an IC card may be used.

However when the image processing apparatus is the conventional one which does not incorporate any decryption module corresponding to the encryption method for each client PC or does not incorporate any decryption module or user authentication system a secure print function cannot be used.

The extended control apparatus is used as a means for extending the functions of the image processing apparatus . The extended control apparatus incorporates a decryption module corresponding to the encryption method for each client PC and provides the decryption module and user authentication system to the conventional image processing apparatus thus allowing the image processing apparatus to use the secure print function. A secure print application of the extended control apparatus receives encrypted print data from the client PC using an LPD protocol and stores the received data in a storage device in the extended control apparatus . When the user has been authenticated using an IC card or the like the secure print application transmits the stored print data to the image processing apparatus thereby printing that data.

Note that the extended control apparatus is transparent to the client PC and the image processing apparatus seems as if it were processing the secure print function.

A case will be described below using wherein the extended control apparatus which can provide an e mail print application function is connected to the image processing apparatus which does not have any e mail print application function.

In the network environment a print job which is generated at one site in the network can be printed at another site. In some cases the image processing apparatus is connected to the external network via a firewall having a function of blocking external invasions and attacks and so forth and access to the image processing apparatus except for e mail is inhibited. However even when access other than e mail is inhibited printing must be done depending on circumstances.

Upon transmitting a print job to the image processing apparatus connected via the firewall the following methods are known. That is the client PC side attaches the print job to an e mail message and transmits that e mail message to the image processing apparatus . Then the image processing apparatus side prints the print job attached to the received e mail message or picks up the e mail message including print information sent from the client PC from a POP server and prints the print information.

However when the image processing apparatus is the conventional one which does not incorporate any SMTP server function or POP client function an e mail print function cannot be used.

However the extended control apparatus is used as a means for extending the functions of the image processing apparatus . Since the extended control apparatus incorporates the SMTP server function and provides the POP client function to the conventional image processing apparatus the image processing apparatus can use the e mail print function. The e mail print application of the extended control apparatus receives an e mail message including print information transmitted from the client PC and transmits the print information to the image processing apparatus thus printing the print information.

Note that the extended control apparatus is transparent to the client PC and the image processing apparatus seems as if it were processing the e mail print function.

According to the method disclosed in Japanese Patent Laid Open No. 2003 99230 the IP address of the external NIC of the extended control apparatus uses that of the image processing apparatus and that of the local NIC is assigned an IP address which is registered in advance.

The destination address of print data from the client PC is that of the external NIC of the extended control apparatus. A communication is made so that the destination address of the print data from the extended control apparatus to the image processing apparatus is that of the NIC of the image processing apparatus and the source address is that of the local NIC of the extended control apparatus.

However the technique disclosed in Japanese Patent Laid Open No. 2003 99230 poses the following problem upon daisy chain connecting a plurality of extended control apparatuses between the LAN and image processing apparatus. That is since the technique disclosed in Japanese Patent Laid Open No. 2003 99230 does not take a combination of functions provided by the respective extended control apparatuses into consideration the same IP address may be assigned to the local NICs of the respective extended control apparatuses. For this reason this poses a problem for communications between application modules on the respective extended control apparatuses and those on the image processing apparatus.

Such a problem is not specific to the image processing apparatus and extended control apparatus but is common in daisy chains connecting the image processing apparatus and a plurality of information processing apparatuses via a local network.

The present invention provides a technique that can prevent the same address from being assigned to local NICs of respective information processing apparatuses even when a plurality of information processing apparatuses are daisy chain connected between an external LAN and image processing apparatus.

An information processing apparatus according to one aspect of the present invention is an information processing apparatus which can communicate with an image processing apparatus the information processing apparatus comprising a first network interface adapted to connect the image processing apparatus via a network a second network interface adapted to connect other information processing apparatus via a network a first setting unit adapted to set a network address of the image processing apparatus as a network address of the second network interface a second setting unit adapted to set a network address different from the network address set by the first setting unit as a network address of the first network interface a determining unit adapted to determine a network address different from the network address set by the first setting unit and the network address set by the second setting unit as a network address of the other information processing apparatus based on the network address set by the first setting unit and the network address set by the second setting unit and a transmitting unit adapted to transmit the network address determined by the determining unit to the other information processing apparatus.

An information processing apparatus according to another aspect of the present invention is an information processing apparatus which can communicate with an image processing apparatus the information processing apparatus comprising a network interface adapted to connect the image processing apparatus and other information processing apparatus via a network a first setting unit adapted to set a network address of the image processing apparatus as a network address of the network interface a second setting unit adapted to set a network address different from the network address set by the first setting unit as a network address of the network interface a first determining unit adapted to determine a network address different from the network address set by the first setting unit and the network address set by the second setting unit as a network address of the other information processing apparatus based on the network address set by the first setting unit and the network address set by the second setting unit and a transmitting unit adapted to transmit the network address determined by the first determining unit to the other information processing apparatus.

An information processing apparatus according to still another aspect of the present invention is an information processing apparatus which can communicate with an image processing apparatus the information processing apparatus comprising a first network interface adapted to connect other information processing apparatus which is connected to the image processing apparatus via a first network via a second network different from the first network a second network interface adapted to connect a third network different from the first network and the second network a first setting unit adapted to set a network address of the image processing apparatus as a network address of the second network interface a receiving unit adapted to receive a network address different from a network address set in the other information processing apparatus from the other information processing apparatus and a second setting unit adapted to set the network address received by the receiving unit as a network address of the first network interface.

An information processing apparatus according to still another aspect of the present invention is an information processing apparatus which can communicate with an image processing apparatus the information processing apparatus comprising a first network interface adapted to connect other information processing apparatus which is connected to the image processing apparatus via a first network via a second network different from the first network a second network interface adapted to connect a third network different from the first network and the second network a first setting unit adapted to set a network address of the image processing apparatus as a network address of the second network interface a receiving unit adapted to receive a network address different from a network address set in the other information processing apparatus from the other information processing apparatus and a second setting unit adapted to set a network address different from the network address received by the receiving unit as a network address of the first network interface.

A method of controlling an information processing apparatus according to still another aspect of the present invention is a method of controlling an information processing apparatus which can communicate with an image processing apparatus the method comprising a first setting step of setting a network address of the image processing apparatus as a network address of a second network interface out of a first network interface adapted to connect the image processing apparatus via a network and the second network interface adapted to connect other information processing apparatus via a network a second setting step of setting a network address different from the network address set in the first setting step as a network address of the first network interface a first determining step of determining a network address different from the network address set in the first setting step and the network address set in the second setting step as a network address of the other information processing apparatus based on the network address set in the first setting step and the network address set in the second setting step and a transmitting step of transmitting the network address determined in the first determining step to the other information processing apparatus.

A method of controlling an information processing apparatus according to still another aspect of the present invention is a method of controlling an information processing apparatus which can communicate with an image processing apparatus the method comprising a first setting step of setting a network address of the image processing apparatus as a network address of a second network interface out of a first network interface adapted to connect other information processing apparatus which is connected to the image processing apparatus via a first network via a second network different from the first network and the second network interface adapted to connect a third network different from the first network and the second network a receiving step of receiving a network address different from a network address set in the other information processing apparatus from the other information processing apparatus and a second setting step of setting the network address received in the receiving step as a network address of the first network interface.

A method of controlling an information processing apparatus according to still another aspect of the present invention is a method of controlling an information processing apparatus which can communicate with an image processing apparatus the method comprising a first setting step of setting a network address of the image processing apparatus as a network address of a second network interface out of a first network interface adapted to connect other information processing apparatus which is connected to the image processing apparatus via a first network via a second network different from the first network and the second network interface adapted to connect a third network different from the first network and the second network a receiving step of receiving a network address different from a network address set in the other information processing apparatus from the other information processing apparatus and a second setting step of setting a network address different from the network address received in the receiving step as a network address of the first network interface.

A program according to still another aspect of the present invention is a computer executable program which implements a method of controlling an information processing apparatus which can communicate with an image processing apparatus the program being comprising a first setting step of setting a network address of the image processing apparatus as a network address of a second network interface out of a first network interface adapted to connect the image processing apparatus via a network and the second network interface adapted to connect other information processing apparatus via a network a second setting step of setting a network address different from the network address set in the first setting step as a network address of the first network interface a first determining step of determining a network address different from the network address set in the first setting step and the network address set in the second setting step as a network address of the other information processing apparatus based on the network address set in the first setting step and the network address set in the second setting step and a transmitting step of transmitting the network address determined in the first determining step to the other information processing apparatus.

A program according to still another aspect of the present invention is a computer executable program which implements a method of controlling an information processing apparatus which can communicate with an image processing apparatus the program being comprising a first setting step of setting a network address of the image processing apparatus as a network address of a second network interface out of a first network interface adapted to connect other information processing apparatus which is connected to the image processing apparatus via a first network via a second network different from the first network and the second network interface adapted to connect a third network different from the first network and the second network a receiving step of receiving a network address different from a network address set in the other information processing apparatus from the other information processing apparatus and a second setting step of setting the network address received in the receiving step as a network address of the first network interface.

A program according to still another aspect of the present invention is a computer executable program which implements a method of controlling an information processing apparatus which can communicate with an image processing apparatus the program being comprising a first setting step of setting a network address of the image processing apparatus as a network address of a second network interface out of a first network interface adapted to connect other information processing apparatus which is connected to the image processing apparatus via a first network via a second network different from the first network and the second network interface adapted to connect a third network different from the first network and the second network a receiving step of receiving a network address different from a network address set in the other information processing apparatus from the other information processing apparatus and a second setting step of setting a network address different from the network address received in the receiving step as a network address of the first network interface.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

Embodiments of the present invention will be described in detail hereinafter. Note that an embodiment of the present invention will exemplify extension of the functions of an image processing apparatus. However the present invention is not limited to the image processing apparatus but it can be applied to similar extension methods and also includes such applications. In the embodiment of the present invention two functions i.e. a secure print function and e mail print function will be explained as extended functions of the extended control apparatus. However the present invention is not characterized by the extended functions themselves but it is characterized by the configurations and operations upon connecting a plurality of extended control apparatuses. Hence the extended functions are not particularly limited.

An extended image processing system is configured by an image processing apparatus extended control apparatus and extended control apparatus . In the extended image processing system the extended control apparatuses and further provide two extended functions to the image processing apparatus which has a printer function image input function document filing function document transmission reception function image conversion function and the like.

As shown in the image processing apparatus as an apparatus whose functions are to be extended and the extended control apparatuses and are daisy chain connected via internal LANs and . More specifically a NIC not shown of the image processing apparatus is connected to a local NIC of the extended control apparatus via the internal LAN . Also an external NIC of the extended control apparatus is connected to a local NIC of the extended control apparatus via the internal LAN . Furthermore an external NIC of the extended control apparatus is connected to an external LAN and the extended image processing system communicates with other network nodes via the external LAN .

A client PC is a personal information processing apparatus and is mainly set on the desktop of the user to execute various application programs. The client PC is connected to the external LAN and uses services provided by other network nodes or provides services to other network nodes via the external LAN .

A server computer is a large scale information processing apparatus is connected to the external LAN and provides services mainly to other network nodes via the external LAN .

A printer is a network compatible peripheral device is connected to the external LAN and provides services of the image processing apparatus to other network nodes via the external LAN .

A router is a network node which connects neighboring networks and connects a wide area network WAN such as the Internet virtual private network and the like and the external LAN .

The image processing apparatus provides various basic image processing functions such as a printer function image input function document filing function document transmission reception function image conversion function and the like.

A reader unit image input device optically reads a document image and converts it into image data. The reader unit includes a scanner unit which has a function of reading a document and a document feed unit which has a function of feeding document sheets.

A printer unit image output device conveys a print sheet prints image data on the print sheet as a visible image and discharges the print sheet outside the apparatus. The printer unit includes a marking unit feeder unit and paper paper discharge unit . The marking unit has a function of transferring and fixing image data on a print sheet. The feeder unit has a plurality of different types of paper cassettes. The paper discharge unit has a function of sorting and stapling printed print sheets and discharging the stapled printed sheets outside the apparatus.

A controller apparatus is electrically connected to the reader unit and printer unit and is also connected to the external LAN . The controller apparatus provides a copy function by controlling the reader to read image data of a document and controlling the printer unit to output the image data onto a print sheet. Also the controller apparatus provides a scanner function by converting image data read by the reader unit into code data and transmitting the code data to a client apparatus not shown via the external LAN . Furthermore the controller apparatus provides a printer function by converting code data received from a client apparatus via the external LAN into image data and outputting the converted image data to the printer unit .

An operation unit is connected to the controller apparatus and comprises a liquid crystal touch panel. The operation unit provides a user I F required to operate an image input output system.

The extended control apparatus includes a controller and peripheral device . The controller can execute software programs including an operating system various device drivers and various application programs. The peripheral device includes various types of peripheral devices which extend the hardware of the extended control apparatus .

The extended control apparatus includes a controller . The controller execute software programs including an operating system various device drivers and various application programs.

The image processing apparatus and extended control apparatus are connected via the internal LAN and can communicate with each other. The extended control apparatus is connected to the extended control apparatus via the internal LAN and can communicate with the image processing apparatus in two ways.

The CPU and bus controller control the operations of the overall controller apparatus . The CPU operates based on a program which is loaded from a ROM via a ROM I F . Such a program describes an operation for interpreting PDL page description language code data received from a client apparatus and rasterizing it to raster image data and that operation is processed by software. The bus controller controls data transfer input output from respective I Fs and controls arbitration upon bus contention and DMA data transfer.

A DRAM is connected to the main controller via a DRAM I F and is used as a work area to operate the CPU and an area used to store image data.

A codec compresses raster image data stored in the DRAM by a method such as MH MR MMR JBIG JPEG or the like and decompresses the compressed stored code data to raster image data. An SRAM is used as a temporal work area of the codec . The codec is connected to the main controller via an I F . The bus controller controls data transfer between the codec and DRAM to attain DMA transfer.

A graphic processor executes processing such as image rotation variable magnification processing color space conversion and the like. An SRAM is used as a temporary work area for the graphic processor .

An external communication I F controller is connected to the main controller via a connector and is connected to an external network via the connector .

To a general high speed bus an extension connector used to connect an extension board and an I O controller are connected. The general high speed bus normally adopts a PCI bus.

The I O controller is equipped with an asynchronous serial communication controller of two channels which is used to exchange control commands with the CPUs of the reader unit and printer unit . The asynchronous serial communication controller is connected to a scanner I F and printer I F as external I F circuits.

A panel I F is connected to an LCD controller and includes an I F required to make display on a liquid crystal screen of the operation unit and a key input I F used to attain inputs of hardware keys and touch panel keys.

The operation unit has a liquid crystal display unit a touch panel input device adhered onto the liquid crystal display unit and a plurality of hardware keys. A signal input by some touch panel key or hardware key is sent to the CPU via the aforementioned panel I F and the liquid crystal display unit displays image data sent from the panel I F . The liquid crystal display unit displays functions upon operation of the image processing apparatus image data and the like.

A real time clock module updates saves the date and time managed inside the device and is backed up by a backup battery .

An E IDE connector is used to connect an external storage device. In the present embodiment a hard disk drive HD drive is connected to the E IDE connector so that image data is stored in a hard disk HD or is read out from the hard disk .

A connector is connected to the reader unit and includes an asynchronous serial I F and video I F . A connector is connected to the printer unit and includes an asynchronous serial I F and video I F .

The scanner I F is connected to the reader unit via the connector and is connected to the main controller via a scanner bus . The scanner I F has a function of applying predetermined processing to an image received from the reader unit . Furthermore the scanner I F has a function of outputting a control signal generated based on a video control signal sent from the reader unit onto the scanner bus .

The printer I F is connected to the printer unit via a connector and is connected to the main controller via a printer bus . The printer I F has a function of applying predetermined processing to image data output from the main controller and outputting the processed data to the printer unit . Also the printer I F has a function of outputting a control signal generated based on a video control signal sent from the printer unit onto the printer bus .

The bus controller controls transfer of raster image data rasterized on the DRAM to the printer unit . In other words the raster image data rasterized on the DRAM is DMA transferred to the printer unit via the printer bus and the video I F .

Software processed by the controller apparatus incorporated in the image processing apparatus is implemented as so called firmware which is executed by the CPU .

A real time OS is a real time operating system and provides various resource management services and frameworks optimized to control an embedded system for software programs that run on the OS. Various resource management services and frameworks provided by the real time OS include for example multitask management thread management that makes a plurality of processes operate substantially in parallel by managing a plurality of executable contexts of processes by the CPU a protocol stack which implements processes of various protocols such as inter task communications that implement synchronization and data exchange between tasks memory management interrupt management various device drivers local interfaces networks communications and the like and so forth.

A file system is a mechanism which is built up on storage devices such as a hard disk memories and the like and is required to store data. The file system is used to spool jobs to be handled by the controller apparatus of the image processing apparatus and to save various data.

A job control device control module controls the hardware of the image processing apparatus and also controls jobs which use basic functions print scan communication image conversion and the like mainly provided by the hardware of the image processing apparatus .

A management module controls the internal state associated with the operation of the controller apparatus of the image processing apparatus . In other words the management module manages the operation of the controller apparatus .

A control API is an application programming interface which is provided so as to allow an embedded application group higher than this layer to use services provided by a software module group lower than this layer.

A network service allows an external network node such as the client PC or the like to use the basic functions of the apparatus through mutual conversion of the control API and network protocol. In particular the network service comprises a network server function which implements various protocols LPR NetWare SMB PAP IPP and the like for the network print function. With this function the network service allows the external network node such as the client PC or the like to input print jobs.

The network service provides secure network connections implemented by an encryption technique and the like. The network service also provides a mechanism for easily tunneling non secure TCP connections using Secure Shell secsh or SSH of IETF.

An embedded application logic presentation interface and embedded application UI configure an embedded application. The embedded application implements higher level functions such as copy image scan document transmission reception document filing and the like in addition to the basic functions of the image processing apparatus using the basic functions of the control API .

The presentation interface is an interface provided to separate the business logic and presentation logic of the embedded application.

The embedded application UI corresponds to the presentation logic of the embedded application. The embedded application UI controls display and inputs on a graphical user interface GUI that allows the user to manipulate the embedded application. The embedded application UI provides a local user interface on the operation unit of the image processing apparatus . Furthermore the embedded application UI also provides a Web application implemented using a markup language such as HTML or the like and Web techniques such as HTTP and the like.

The user can remote control the image processing apparatus by connecting the Web application from a Web browser which runs on the client PC or the like. In the present embodiment a presentation layer of the embedded application implemented as the Web application will be referred to as a remote UI.

An embedded Java environment is an interpreter environment configured with a focus on a Java virtual machine. The embedded Java environment loads and combines instruction string data described using Java byte codes and the Java virtual machine sequentially loads and interprets instructions and executes them. With this environment on the entire firmware which is statically combined to a single load module as well as the real time OS the extensibility and flexibility that allows for dynamic addition or replacement of software even very partially can be assured.

A Java Native Interface JNI provides firmware native system resources including the real time OS job control device control module control API and the like. Furthermore the JNI provides a Java class library group which allows a Java program to use services. The basic part of embedded Java environment is built up with well known Java 2 Platform Micro Edition.

The embedded application logic in the image processing apparatus can be controlled from the presentation logic implemented by an application in the system of the extended control apparatus .

The image processing apparatus stores a flag used to control whether or not it cooperates with the extended control apparatus and this flag is stored in a nonvolatile memory or the like not shown .

The basic dialog shown in is implemented by a touch panel and when the user touches a frame of each individual displayed function that function is executed. A copy mode key is pressed when the user wants to perform a copy operation. Upon pressing the copy mode key a copy mode window is displayed. An extended function key is pressed to enter a mode for settings of double sided copy multiple copy move and binding margin a setting of frame erasure and the like.

A status line displays messages indicating the device status and print information. In the status line displays that the apparatus is ready to copy.

An image mode key is pressed to enter a setting mode required to apply hatching shadow casting trimming and masking to a copy image. A user mode key is pressed to register a mode memory and to set a default mode dialog. An applied zoom key is pressed to enter a mode for applying independent magnification processing in the X and Y directions of a document and a zoom mode program for calculating the variable magnification ratio based on the document size and copy size. Each of an M1 key M2 key and M3 key is pressed to call the registered mode memory. An option key is pressed to make settings of an option function such as a film projector or the like so as to directly copy from a film. A sorter key is pressed to make sort non sort and group settings. A document mixed loading key is pressed when A4 and A3 sized documents or B5 and B4 sized documents are set on a document feeder together.

An equal magnification key is pressed to set a copy magnification to 100 . A reduction key and enlargement key are pressed to perform reduction and enlargement of given sizes. A paper selection key is pressed to select copy paper. Density keys and are pressed to adjust the density. Every time the density key is pressed the copy density increases. Every time the density key is pressed the copy density decreases. A density indicator changes its display contents to the right or left upon pressing of the density keys and . An AE key is pressed to automatically adjust the density of a document with a dark background like a newspaper and to copy such a document. A HiFi key is pressed upon copying a document with a high halftone density like a photo document. A text emphasis key is pressed to emphasize text upon copying a text document. A log key is pressed to display log information of printed jobs. Upon pressing the log key information including the end times user name file name the number of printed pages and the like of each print job is displayed. A printer selection key is pressed to select a receiving side copying machine upon executing remote copy or tandem copy.

A guide key is pressed when the user wants to know the function of a given key and displays an explanation of that key. A FAX key is pressed to execute FAX transmission reception. A Box key is pressed to display a Box function. A printer key is pressed when the user wants to change the print density or when he or she wants to refer to printout detailed information of PDL data from a remote client apparatus.

A CPU is a central processing unit which controls the overall extended control apparatus and executes programs stored in a ROM and hard disk unit . A network interface is a controller required to make data communications with other devices via a network.

Software executed by the CPU can exchange data in two ways with a print device or other network devices or other computers via the external LAN . A peripheral device interface is a controller required to control the peripheral device .

A memory is a volatile storage unit used to store instructions to be executed by the CPU data and the like. The ROM is a read only storage unit used to store programs data and the like required to execute basic hardware control. The hard disk unit is a nonvolatile storage unit used to store programs to be executed by the extended control apparatus calculated data and the like. The hard disk unit stores a boot program startup program a program for initiating executions operations of hardware and software a plurality of applications edit files user files network management programs and the like. The hard disk unit has an address table required for a local address distribution unit to be described later to distribute non overlapping local addresses.

The peripheral device interface is a controller which implements the specifications such as USB RS 232C serial IEEE1394 and the like and is required to connect the peripheral device . The peripheral device comprises e.g. a user authentication device required to specify the user or the like. The local NIC is a controller required to make data communications with the image processing apparatus via the network. The external NIC is a controller required to make data communications with client apparatuses on the external network via the network.

Software to be processed by the controller incorporated in the extended control apparatus is implemented as so called firmware and is executed by the CPU of the extended control apparatus .

A local network driver is connected to the internal LAN to control the local NIC and to exchange data with the image processing apparatus .

An external network driver is connected to the internal LAN to control the NIC and to exchange data with the extended control apparatus and external LAN .

A network communication controller controls network communication protocols such as TCP IP and the like and exchanges data between the local side and external side.

A secure print application unit is required to execute an encrypted secured print function. More specifically the secure print application unit receives an encrypted print job from the client PC using an LPD protocol. The encrypted print job is stored in the hard disk unit intact. The secure print application unit decrypts the encrypted print job stored in the hard disk unit and actually prints that print job using the image processing apparatus only when user authentication is confirmed.

The network communication controller examines all packets received by the local network driver and controls packets which are not related to the secure print application unit to pass through the apparatus to the external NIC . Also the network communication controller examines all packets received by the external NIC and controls packets which are not related to the secure print application unit to pass through the apparatus to the local NIC . Furthermore upon reception of packets by the local network driver the network communication controller checks if both the NICs of the extended control apparatus are set with network addresses. If it is determined that both the NICs are set with network addresses the network communication controller controls packets other than those addressed to the apparatus to pass through the apparatus. If it is determined that both the NICs are not set with network addresses the network communication controller captures the received packets without passing them through. Upon reception of packets by the external network driver the network communication controller controls packets other than those addressed to the apparatus to pass through the apparatus irrespective of whether or not the network addresses are set.

A local address request unit transmits a local address request packet which requests the local address of the local NIC . A local address distribution unit distributes the address of the NIC of the extended control apparatus which is daisy chain connected to the apparatus in response to a local address request packet from the extended control apparatus . The local address distribution unit local address distribution module has an address table corresponding to in used to distribute non overlapping local addresses.

A CPU is a central processing unit which controls the overall extended control apparatus and executes programs stored in a ROM and hard disk unit . A network interface is a controller required to make data communications with other devices via a network. Software executed by the CPU can exchange data in two ways with a print device or other network devices or other computers via the external LAN .

A memory is a volatile storage unit used to store instructions to be executed by the CPU data and the like. The ROM is a read only storage unit used to store programs data and the like required to execute basic hardware control. The hard disk unit is a nonvolatile storage unit used to store programs to be executed by the extended control apparatus calculated data and the like. The hard disk unit stores a boot program startup program a program for initiating executions operations of hardware and software a plurality of applications edit files user files network management programs and the like.

The local NIC is a controller required to make data communications with the image processing apparatus via the network. The external NIC is a controller required to make data communications with the client PC on the external network via the network.

Software to be processed by the controller incorporated in the extended control apparatus is implemented as so called firmware and is executed by the CPU of the extended control apparatus .

A local network driver controls the local NIC connected to the internal LAN and exchanges data with the image processing apparatus and extended control apparatus .

An external network driver is connected to the external LAN to control the NIC and to exchange data via the external LAN.

A network communication controller controls network communication protocols such as TCP IP and the like and exchanges data between the local side and external side.

An e mail print application unit is required to transmit print information to the image processing apparatus and to control it to print the print information. Such print information is received as an e mail message including print information which is transmitted from the client PC using an SMTP protocol or POP protocol.

A local address request unit transmits a local address request packet which requests the local address of the NIC .

The network communication controller examines all packets received by the local network driver and controls packets which are not related to the e mail print application unit to pass through the apparatus to the external NIC . Also the network communication controller examines all packets received by the external NIC and controls packets which are not related to the e mail print application unit to pass through the apparatus to the local NIC . Furthermore upon reception of packets by the local network driver the network communication controller checks if both the NICs of the extended control apparatus are set with network addresses. If it is determined that both the NICs are set with network addresses the network communication controller controls packets other than those addressed to its own apparatus to pass through the apparatus. If it is determined that both the NICs are not set with network addresses the network communication controller captures the received packets without passing them through. Upon reception of packets by the external network driver the network communication controller controls packets other than those addressed to its own apparatus to pass through the apparatus irrespective of whether or not the network addresses are set.

A local address distribution unit local address distribution module distributes the address of the local NIC of the extended control apparatus which is daisy chain connected to the apparatus in response to a local address request packet.

The local address request sequence according to the present embodiment will be described below. More specifically operations until the network addresses of the extended control apparatuses and which are daisy chain connected to the image processing apparatus are set and the image processing apparatus communicates with a device on the LAN will be described.

During a period from when the extended control apparatuses start up until they settle the network settings of the NICs all packets received by the local NIC do not pass through the apparatus to the external NIC. In other words all the packets received by the local NIC are captured by the network communication controller. On the other hand all packets received by the external NIC pass through the apparatus to the local NIC.

 Sequence S The image processing apparatus transmits an ARP request packet to the client PC prior to communications with the client PC on the external network. The network communication controller of the extended control apparatus captures the ARP request packet and acquires the source IP address and source MAC address of that packet. Note that the extended control apparatus does not return any response to the ARP request packet. Therefore the image processing apparatus re transmits the ARP request packet to the client PC after an elapse of a predetermined period of time.

 Sequence S The local address request unit of the extended control apparatus transmits a local address request packet addressed to the image processing apparatus from the local NIC . Since the image processing apparatus does not incorporate any module that can respond to the local address request packet it does not return any response.

 Sequence S The extended control apparatus sets the source IP address and source MAC address acquired from the ARP request packet as those of the external NIC . Note that since no response is returned in response to the local address request packet the extended control apparatus sets a value calculated from the IP address of the external NIC by adding or subtracting 1 from that address as the IP address of the local NIC . In this way the network settings of the extended control apparatus are completed.

 Sequence S After the addresses of the local NIC and external NIC of the extended control apparatus are settled the extended control apparatus sends an SNMP Get request packet to the source of the ARP request packet so as to acquire the product name device type and the like.

 Sequence S If the appropriate product name device type and the like can be acquired based on an SNMP Get response packet from the image processing apparatus the extended control apparatus shifts to a normal operation state.

At this time since the network settings of the NICs of the extended control apparatus are settled the network communication controller of the extended control apparatus passes through packets from the image processing apparatus if they are not addressed to the apparatus. On the other hand the network communication controller passes packets from the external network through if they are not addressed to its own apparatus.

 Sequence S The extended control apparatus which determines the address of the local NIC by itself launches the local address distribution module.

 Sequence S The image processing apparatus re sends an ARP request packet since the ARP request packet transmitted in sequence S results in an error. The network communication controller of the extended control apparatus passes the ARP request packet which is not addressed to the apparatus through. The network communication controller of the extended control apparatus captures the ARP request packet since network address settings are not completed and acquires the source IP address and source MAC address of the packet. Note that the extended control apparatus does not return any response to the ARP request packet. Therefore the image processing apparatus re sends an ARP request packet addressed to the client PC after an elapse of a predetermined period of time.

 Sequence S The local address request unit of the extended control apparatus generates a local address request packet and transmits it from the local NIC to the extended control apparatus .

 Sequence S Upon reception of the local address request packet the local address distribution module of the extended control apparatus returns a local address response packet which includes a local address to be assigned to the extended control apparatus in a data part. Note that the local address to be assigned is determined based on the address table . Alternatively the extended control apparatus may be notified of the local address set in the extended control apparatus and may determine an address which does not overlap that address.

 Sequence S The source IP address and source MAC address acquired from the ARP request packet are set as those of the external NIC of the extended control apparatus . Upon reception of the local address response packet the extended control apparatus sets the address included in the data part of the response packet as that of the local NIC . In this way the network settings of the extended control apparatus are complete.

 Sequence S After the addresses of the local NIC and external NIC are settled the extended control apparatus sends an SNMP Get request packet to the source of the ARP request packet in order to acquire the product name device type and the like.

 Sequence S If the appropriate product name device type and the like can be acquired based on an SNMP Get response packet from the image processing apparatus the extended control apparatus shifts to a normal operation state.

At this time in the extended image processing system including the image processing apparatus extended control apparatus and extended control apparatus the normal operation state which is seen as one apparatus from the external LAN is settled.

 Sequence S The image processing apparatus transmits an ARP request packet again to the client PC prior to communications with the client PC on the external network. That is the image processing apparatus re sends an ARP request packet since the ARP request packet transmitted in sequence S resulted in an error. The network communication controllers and of the extended control apparatuses and pass the ARP request packet which is not addressed to its own apparatuses through. The client PC captures the ARP request packet and acquires the source IP address and source MAC address of the packet. After that the client PC sends an ARP response including the MAC address of the client PC to the image processing apparatus as a response to the ARP request.

 Sequence S After that the client PC sends an SNMP Get request packet to the source of the ARP request packet so as to acquire the product name device type and the like.

 Sequence S The client PC acquires the appropriate product name device type and the like based on an SNMP Get response packet from the image processing apparatus and makes access such as print processing or the like to the extended image processing system.

In the example shown in the image processing apparatus repeats transmission of an ARP request packet in sequences S S and S. However the extended control apparatus may alternatively transmit an ARP request packet in sequence S and the extended control apparatus may alternatively transmit an ARP request packet in sequence S. Such processing can be implemented by adding an alternative processing function to each extended control apparatus and the number of extended control apparatuses to which the image processing apparatus is connected need not be taken into consideration resulting in simple control.

In step S the apparatus is initialized at the time of startup. After that when the user operates the image processing apparatus to designate a communication with any device on the LAN the controller apparatus sends an ARP request packet source address A in the present embodiment to that device in step S.

In step S the controller apparatus waits for reception of a packet. If a packet is received the process advances to step S to check if the received packet is an SNMP Get request packet see S and S in . If it is determined in step S that the received packet is not an SNMP Get request packet the process returns to step S. Note that a predetermined period of time is set and if the SNMP Get request packet cannot be received within the predetermined period of time a time out error occurs. Upon reception of the SNMP Get request packet the controller apparatus returns an SNMP Get response packet including the appropriate product name device type and the like in step S transmit SNMP Get response packet .

The controller apparatus checks in step S if the local addresses of all the connected extended controller apparatuses are settled. If the local addresses are not settled yet the process returns to step S to send an ARP request packet again. If the local addresses of all the connected extended controller apparatuses are settled the controller apparatus enters the procedure of normal image processing.

In case of the arrangement in which the extended control apparatus alternatively sends an ARP request packet step S is excluded. Furthermore a route that returns from step S to step S and a route for checking whether or not the received packet is an image processing request packet if it is determined in step that the received packet is not an SNMP Get request packet may be added.

This processing is executed upon reception of packets by the local NIC during a period from when the extended control apparatuses and start up until the addresses of the NICs are determined. Note that a case will be explained wherein processing is done using a common flowchart independently of the connected positions of the extended control apparatuses and and expressions local NIC and external NIC will be used in the following description. However different flowcharts may be used for the extended control apparatus connected to the image processing apparatus and other extended control apparatuses.

During a period from when the extended control apparatus starts up until the addresses of the NICs are determined all packets received by the local NIC are captured without passing through the apparatus to the external NIC. All packets received by the external NIC pass through the apparatus to the local NIC.

The network communication controller checks in step S if the received packet is a TCP IP packet i.e. to check if an ARP request packet is received . If the result is YES in step S the process advances to step S otherwise the process ends.

In step S the network communication controller acquires the source address from the packet address A of the image processing apparatus in the present embodiment . In step S the network communication controller sets acquired source address A as that of the external NIC .

In step S the network communication controller sends a local address request packet from the local NIC . The network communication controller checks in step S if a response is received. If the result is YES in step S the process advances to step S otherwise the process advances to step S.

If the extended control apparatus is directly connected to the image processing apparatus in case of the extended control apparatus in the present embodiment since the image processing apparatus does not incorporate any module that responds to the local address request packet no response returns. Hence the process advances to step S.

The network communication controller checks in step S if the address of the external NIC is an odd number. If the result is YES in step S the process advances to step S otherwise the process advances to step S. In step S the network communication controller sets the address of the external NIC 1 as that of the local NIC. In step S the network communication controller sets the address of the external NIC 1 as that of the local NIC.

In step S the network communication controller sends an SNMP Get request packet from the local NIC in order to confirm whether the local NIC can communicate with the image processing apparatus . The image processing apparatus which incorporates an SNMP agent outputs a response packet in response to this SNMP packet. Since the extended control apparatus does not incorporate any SNMP agent it does not respond.

The network communication controller checks in step S if a response is received. If the result is YES in step S the process advances to step S otherwise the process terminates as an error in step S. In step S the network communication controller launches the local address distribution module. After that the launched local address distribution module processes a local address request packet received by the external NIC.

If it is determined in step S that the extended control apparatus is not directly connected to the image processing apparatus in case of the extended control apparatus in the present embodiment the local address distribution module of the extended control apparatus responds to a local address request packet. Hence the process advances to step S.

In step S the network communication controller acquires the local address from the local address response packet. In step S the network communication controller sets the acquired local address as that of the local NIC .

In step S the network communication controller sends an SNMP Get request packet from the local NIC in order to confirm whether the local NIC can communicate with the image processing apparatus . The image processing apparatus which incorporates an SNMP agent outputs a response packet in response to this SNMP packet. Since the extended control apparatus does not incorporate any SNMP agent it does not respond.

The network communication controller checks in step S if a response is received. If the result is YES in step S the process ends since it is determined that the addresses are normally settled. If the result is NO in step S the process terminates as an error in step S.

As described above the flowchart indicating the operation of the extended control apparatus e.g. extended control apparatus directly connected to the image processing apparatus without the intervention of another extended control apparatus between the image processing apparatus and itself is defined by steps S to S and steps S to S. On the other hand the flowchart indicating the operation of the extended control apparatus e.g. extended control apparatus directly connected to the image processing apparatus with the intervention of another extended control apparatus between the image processing apparatus and itself is defined by steps S to S and steps S to S.

The local address distribution module checks in step S whether the received packet is a local address request packet. If the result is YES in step S the process advances to step S otherwise the process ends.

In step S the local address distribution module selects an address from an address list registered in advance see the address table in and the address table in . More specifically if the network address is determined in the extended control apparatus the local address distribution unit registers network addresses to be distributed in the address table . The network addresses to be registered can assume arbitrary values. For example if the address of the local NIC is address of the external NIC 1 the local address distribution unit registers network addresses with values obtained by adding 2 3 4 . . . to the address of the external NIC in the address table. If the address of the local NIC is address of the external NIC 1 the local address distribution unit registers network addresses with values obtained by subtracting 2 3 4 . . . from the address of the external NIC in the address table. The number of network addresses to be registered can be an arbitrary value.

In step S the local address distribution module selects addresses different from the network addresses of the external NIC and local NIC of itself from the network addresses registered in advance in the address table and determines them as the addresses to be distributed to the extended control apparatus . After the local address distribution module deletes the selected addresses from the address table or checks them to be able to identify that these addresses have already been selected the process advances to step S.

In the description of the present embodiment the network addresses to be distributed are registered in the address table . Alternatively a method of registering the network address set for itself in the address table may be adopted. That is according to the setting of the network address of itself that value is written in the address table. Then upon reception of a local address request packet an arbitrary address other than that registered in the address table may be generated and may be determined as the address to be distributed. In this case the address generated as those to be distributed is additionally registered in the address table. In this way the identical network addresses can be prevented from being distributed to a plurality of extended control apparatuses.

In step S the local address distribution module sets the selected address in a response packet. In step S the local address distribution module transmits the local address response packet from the external NIC thus ending the processing.

An implementation example of a local address request packet unique to the present embodiment using the TCP IP protocol will be described below. The protocol required for the local address request packet unique to the present embodiment will be referred to as a configurator protocol hereinafter. In the present embodiment the configurator protocol is implemented on an UDP User Datagram Protocol . Note that the configurator protocol allows communications based on the MAC address without using any IP addresses. That is the configurator protocol communicates with a device whose IP address is not set using the MAC address and can set an IP address or the like in that device. The present embodiment communicates the local address request packet using the configurator protocol.

The configurator protocol uses a UDP port number 0x83b6. Then the IP address Dest IP of the destination in the request packet is set to be 255.255.255.255 and the MAC address thereof Dest MAC is set to be 0xffffffffffff .

Note that the MAC address is a physical address unique to a device. In the case of Ethernet the MAC address has a 6 byte length. Of the 6 byte length the first 3 bytes are managed and assigned as a vendor code by IEEE Institute of Electrical and Electronic Engineers The remaining 3 bytes specify a code uniquely managed by each vendor not to overlap each other . As a result there are no network devices having the same physical addresses worldwide and all different addresses are assigned to network devices.

If the MAC address is 0xffffffffffff that packet is handled as a broadcast packet and all network devices connected on the network receive this packet.

 5 Protocol information a flag corresponding to each individual protocol information When the Request code is 0 set only information associated with a protocol with the corresponding byte 1 is set.

If the MAC address value stored in this field does not match that of the network address except for a case in which the Request code 4 Discovery this packet is ignored.

Note that individual values are determined to be values called factory initial values determined in advance upon factory shipping.

Using such a configurator protocol a local address request can be transmitted and a local address to be set can be acquired via a local address response.

The present embodiment has been explained as an image processing system as an extended image processing apparatus. However the present invention relates to the settings of the local addresses of daisy chain connected extended function units and can be applied to any other systems without being limited to the image processing apparatus. The present invention also includes such applications.

In the present embodiment the processing described so far can be similarly executed for a case wherein the connection order of the extended control apparatuses and is reversed or even a case wherein another extended control apparatus is added. Furthermore when another extended control apparatus is added the added extended control apparatus transmits a local address request packet to the extended control apparatus . The local address distribution unit of the extended control apparatus selects an address which is not assigned to any apparatus from those registered in the address table and determines it as an address to be distributed to the added extended control apparatus.

Moreover the present invention explained the case that each extended control apparatus physically includes two network interface cards. However these network interface cards may be physically incorporated as one board. In other words each extended control apparatus may include each communication unit with the local network and the external network. For example the network interface card and network interface card shown in may be a united structure.

In the description of the present embodiment the extended control apparatus provides the secure print function and the extended control apparatus provides the e mail print function. However the present invention is not limited to such specific functions. For example various removable storages a magneto optical media drive USB storage memory card represented by SmartMedia CompactFlash or the like and so forth are connected as peripheral devices to the extended control apparatus. The present invention may be applied to a media application function that passes documents stored in memory media to the image processing apparatus to print transmit or file them. Also the present invention may be applied to a media application function that allows the image processing apparatus to receive image scanned or received documents or filed documents and to store them in memory media. Also one extended control apparatus may provide a plurality of functions.

The local interface is an optional interface used to provide a dedicated communication route between two devices and is implemented by USB a dedicated bus or the like. Also the local interface may be implemented by tunneling packets via frames applied to the local interface.

Furthermore program codes and related data according to the present invention are stored in a floppy disk FD or CD ROM and are supplied to a computer from there. The objects of the present invention are achieved by supplying a storage medium which records a program code of a software program that can implement the functions of the above mentioned embodiments to a computer or image processing apparatus and reading out and executing the program code stored in the storage medium by a computer or a CPU or MPU of the computer or image processing apparatus.

As a method of supplying programs and data to a computer it is a common practice to adopt a method of storing the programs and data in a floppy disk and supplying them to a computer main body via a floppy disk drive . In this case the program code itself read out from the storage medium implements the functions of the above mentioned embodiments and the storage medium which stores the program code constitutes the present invention.

As the storage medium used to supply the program code an optical disk magneto optical disk CD DVD magnetic tape nonvolatile memory card ROM and the like may be used in addition to the floppy disk hard disk and the like. The CD includes a CD ROM and CD R and the DVD includes a DVD ROM DVD R RW and DVD RAM.

The functions of the aforementioned embodiments are implemented not only by executing the program code read out by the computer or image processing apparatus. The present invention also includes a case wherein the functions of the aforementioned embodiments are implemented by some or all actual processing operations which are executed by an OS operating system running on the computer or image processing apparatus based on instructions of the program code.

Furthermore the present invention includes a case wherein the program code read out from a storage medium is written in a memory of an expansion card or a function expansion unit which is inserted into or connected to the computer. After that the functions of the aforementioned embodiments are implemented by some or all of actual processes executed by a CPU or the like arranged in the function expansion card or unit based on the instruction of that program code.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent No. 2006 083868 filed Mar. 24 2006 which is hereby incorporated by reference herein in its entirety.

