---

title: Information processing apparatus, information processing method, program, and storage medium
abstract: An information processing apparatus performs layout processing on print data, performs a preview based on layout-processed print data, and stores the print data used in the preview into a print queue when actual print processing is performed, thus preventing the same print processing from being repeatedly performed.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08537408&OS=08537408&RS=08537408
owner: Canon Kabushiki Kaisha
number: 08537408
owner_city: Tokyo
owner_country: JP
publication_date: 20071210
---
The present invention relates to an information processing apparatus having a preview function for presenting displaying a visually recognizable print image to a user for example before performing print processing and relates to an information processing method a program and a storage medium.

A conventional image processing system acquires a print image to be printed and displays the image on a screen beforehand.

According to a conventionally known technique a computer data processing apparatus is associated with a printer to analyze a print command that is interpretable by the printer. The computer creates print commands for each of CMYK planes and generates a print image. Furthermore after a computer transmits a print command to a printer the computer receives print image data generated by the printer and displays a print image based on the received data.

A representative operating system OS for a computer incorporated in a printing system is for example Windows provided by Microsoft Corporation. An application program installed on a computer can generate print data. The generated print data is stored in a spool file according to a standard data format of the OS. The OS invokes a printer driver to print the print data. The printer driver reads print data from the spool file. An image generation processing unit generates print image and converts the generated print image into a print command that is interpretable by a printer. The print command is transmitted to the printer. The printer interprets the print command and executes print processing for forming a print image on a recording medium.

A printer driver of a conventional printing system can activate a previewer capable of providing a preview function for displaying an image to be printed before starting print processing. An image generation unit generates a print image to be previewed. The previewer displays the generated preview print image. Namely the preview function of the printer driver can be realized by the image generation unit that generates a print image and the previewer that displays the print image as discussed in Japanese Patent Application Laid Open No. 2004 102618 corresponding to U.S. Patent Application Publication No. 2004 0049741.

A conventional printing system can combine print jobs and perform a preview considering the layout of each print job. More specifically the printing system generates an integrated job composed of a plurality of print jobs each including print data converted into the intermediate code format while storing layout information of each print job involved in this integrated job. In displaying a preview of combined jobs the printing system reproduces the layout of respective print jobs involved in the integrated job by referring to the layout information of a page to be previewed. During a preview operation the printing system can change layout information of respective print jobs in the integrated job without having any adverse effects on other print jobs because the printing system stores the layout information in addition to the intermediate data as discussed in Japanese Patent Application Laid Open No. 2001 130082 corresponding to U.S. patent application Ser. No. 09 698 052 filed on Oct. 30 2000.

In addition the previewer may process modify a preview print image generated by the image generation unit before performing a preview display so that an image can be accurately printed on a disk shaped recording medium e.g. CD R or on a complicated rectangular medium. In this case a conventional method a CD R area display function enables a user to confirm image areas positioned inside and outside a medium area through the preview display of print contents beforehand as discussed in Japanese Patent Application Laid Open No. 2004 110807 corresponding to U.S. Patent Application Publication No. 2004 0088654.

Furthermore a conventional printing system allows a user to confirm print setting contents in addition to preview contents. A conventional printing system enables a user to change print settings during a preview display operation and continue actual print processing if any erroneous print setting is found during the preview display referred to as print setting change function as discussed in Japanese Patent Application Laid Open No. 2006 011847 corresponding to U.S. Patent Application Publication No. 2005 0286100.

The above described conventional technique includes the following problems to be solved. One of the above described conventional printing systems can execute a preview while the printer driver is invoked by the OS. The print processing object of the printer driver invoked by the OS is the front print job in a print queue. In general the print processing object is only one print job for each print queue. Accordingly other print jobs in the print queue are not a print object for the printing system that is currently executing a preview function.

Therefore if the print queue includes any print job being currently processed the conventional printing system cannot execute a preview function for other print jobs. Furthermore the printing system cannot start printing other jobs remaining in the same print queue before the printing system completes the preview of a presently processed job. Furthermore when a plurality of users of the same OS simultaneously issue print jobs the users cannot simultaneously use the preview function.

A printing system performs layout processing to generate a preview print image. At this moment the above described print job is intermediate data. Therefore the printing system further performs bitmap processing for a display of a preview screen. However the preview bitmap data subjected to the bitmap processing for a screen display may not be suitable for a printer that actually executes print processing and cannot be used for other purposes. More specifically to generate a print image for an actual print operation the printing system is required to perform the layout processing again. Namely the printing system repeatedly performs the same layout processing every time a print image is generated.

When two or more print jobs are combined another conventional printing system separately stores layout information of the integrated print jobs. Thus the printing system is required to perform layout processing for displaying a print image using the preview function. Furthermore a conventional printing system can change layout information during a preview operation. In this case the printing system necessarily performs the layout processing for actual print processing performed by a printer. Namely if the layout information is not changed during a preview operation the printing system repeatedly performs the same layout processing for the preview operation and actual print processing.

Exemplary embodiments of the present invention are directed to an information processing apparatus having a preview function that prevents the same layout processing from being repeatedly performed and enables a user to effectively perform print processing. Furthermore exemplary embodiments of the present invention are directed to an information processing apparatus that does not print preview oriented information added for a preview operation.

According to an aspect of the present invention an information processing apparatus includes a layout processing unit configured to receive document data from a spool file a preview document generation unit configured to receive document data from the layout processing unit a print command generation processing unit configured to receive document data from the preview document generation unit and a preview control unit configured to control a preview based on preview document data. If a preview flag is set the layout processing unit is configured to output the document data received from the spool file to the preview document generation unit without performing layout processing based on print setting information. If the preview flag is not set the layout processing unit is configured to perform layout processing on the document data received from the spool file based on the print setting information and to output layout processed document data to the preview document generation unit. If the preview is completed or the preview is not set the preview document generation unit is configured to output the layout processed document data to the print command generation processing unit. If the preview is set while the preview is not completed the preview document generation unit is configured to set a preview flag and to generate preview document data based on the layout processed document data. The preview control unit is configured to output to the spool file document data to which a preview flag is set based on a print instruction. The print command generation processing unit is configured to convert the layout processed document data into a print command that is interpretable by a printer.

According to another aspect of the present invention a method includes if a preview flag is set outputting document data received from a spool file without performing layout processing based on print setting information if the preview flag is not set performing layout processing on the document data received from the spool file based on the print setting information and outputting layout processed document data if a preview is completed or the preview is not set outputting the layout processed document data if the preview is set while the preview is not completed setting a preview flag and generating preview document data based on the layout processed document data outputting to the spool file document data to which a preview flag is set based on a print instruction and converting the layout processed document data into a print command that is interpretable by a printer.

Further features and aspects of the present invention will become apparent from the following detailed description of exemplary embodiments with reference to the attached drawings.

The following description of exemplary embodiments is illustrative in nature and is in no way intended to limit the invention its application or uses. It is noted that throughout the specification similar reference numerals and letters refer to similar items in the following figures and thus once an item is described in one figure it may not be discussed for following figures. Exemplary embodiments of the present invention are described in detail with reference to attached drawings.

In the following description XPS represents XML Paper Specification developed by Microsoft Corporation as one of open standard electronic document formats.

In general an XPS document has a tree structure composed of at least one FixedDocumentSequence hereinafter referred to as FDS as a root element. The FDS includes a plurality of FixedDocuments hereinafter referred to as FD Each FD includes a plurality of FixedPages hereinafter referred to as FP . Each of FDS FD and FP may be referred to as XPS part.

The FP includes contents of a document page including actually displayed or printed contents described according to an XML format. The resources such as fonts and images used for page contents of each FP can be commonly used among a plurality of FPs. Print settings of FDS FD and FP can be described in a PrintTicket hereinafter referred to as PT . The PT includes print settings i.e. settings for printing an XPS document described according to the XML format. The PT describing print settings for printing each FP is a combined PT merging a PT of the FDS a PT of a parent FD of a print object FP and a PT of the print object FP.

As described above the XPS document can be easily understood by introducing the concept of logical XPS parts. As the XPS document itself can be regarded as a byte stream internal data of the XPS document may be referred to as XPS data. Accordingly exemplary embodiments of the present invention are described using XPS parts and XPS data.

In the data processing apparatus an application generates a print job and a printer driver generates a print command based on spool data of the generated print job so that the associated printer can control a print operation. The data processing apparatus according to an exemplary embodiment is a personal computer that can accept print settings instructed or input by a user. The data processing apparatus includes printer driver which includes various functional blocks including a print setting processing unit print command generation unit data communication processing unit and preview control unit . The data processing apparatus also includes an I F control unit central control unit input operation unit setting information notification unit and storage unit . An operating system OS installed on the data processing apparatus controls various functional blocks of the data processing apparatus .

A communication interface is provided for communication between the data processing apparatus and the printer . An example of the communication interface is a serial interface e.g. USB IEEE1394 Ethernet IrDA IEEE802.11 or power line a parallel interface e.g. Centronics or SCSI or any other wired wireless interface capable of realizing communications. The printing system according to an exemplary embodiment is not a single apparatus.

The data processing apparatus and the printer i.e. an apparatus performing image forming processing are mutually connected via a specific bi directional interface. However the present invention is not limited to the disclosed example and therefore can be an integrated printing system having functions comparable to a combination of a data processing apparatus and a printer.

The central control unit controls various functions of the data processing apparatus . The processing performed by the central control unit corresponds to a function of a central processing unit CPU . The input operation unit includes various input devices that allow a user to instruct print settings. The setting information notification unit notifies a user of print settings. An exemplary notification device is for example a monitor or any other display device or a sound generating device.

The interface I F control unit controls an interface function of the data processing apparatus . A universal serial bus USB host controller can realize the function of the I F control unit . In this respect the I F control unit includes a function of the USB host. The software e.g. the OS or a driver can constitute part of the function of the USB host. A storage unit stores the OS and application programs as well as command code of the printer driver. The software can use the storage unit to temporarily store data and read the stored data for operation. The storage unit is for example a hard disk drive or a semiconductor memory.

A printer driver is the software enabling a user of the data processing apparatus to instruct various print settings generate print data and control the printer . The central control unit executes a program of the printer driver to realize a print setting processing unit a print command generation unit including a layout processing unit a preview document generation unit and a print command generation processing unit and a data communication processing unit .

The print setting processing unit performs various print settings including sheet settings and print quality settings. The print setting processing unit receives an instruction or an input from a user and displays or notifies setting contents.

In the print command generation unit the layout processing unit performs page layout processing for a print job generated by an application. The preview document generation unit generates a preview document according to print settings. The print command generation processing unit converts print data having been subjected to the layout processing into a print command. The print command generation unit transmits the generated print command to the I F control unit via the data communication processing unit .

The I F control unit transmits the print command to the printer . A preview control unit provides a preview function to a user. The preview function of the preview control unit includes displaying a print image of the preview document via the setting information notification unit acquiring user s instructions via the input operation unit switching a print image to be displayed continuing a print operation and canceling the print operation.

The filter pipeline includes a layout filter a preview filter and a print command filter . The layout filter performs processing for determining a page layout of XPS data. The preview filter provides a preview function. The print command filter converts the XPS data into a print command that is interpretable by a printer.

In the present embodiment the filter is a program capable of generating any output data based on input data through various e.g. processing conversion non conversion and generation processes.

According to the printing system in print data of each page of a document generated by the application is temporarily stored in an XPS spool file via a print support function of the OS. The filter pipeline of the printer driver converts the print data into a print command that is interpretable by the printer and supplies the print command to the printer .

The user interface module enables a user to set various print attributes including a sheet size and a print direction. The user interface module further allows a user to set a preview for displaying a print image before the printer starts a print operation. The user interface module returns print setting information setting values of a plurality of print setting items to the application . An exemplary print setting dialog provided by the user interface module is described below with reference to .

In printing a generated document the application notifies the print support function of starting terminating a print operation print setting information returned from the user interface module or starting terminating a drawing operation of each document page. The print support function of the OS stores the drawing contents of the application and print setting information into the XPS spool file .

The filter pipeline including one or more filters reads print setting information and XPS parts from the XPS spool file converts the read information into a print command that is interpretable by the printer and supplies the print command to the printer which performs print processing.

The print support function of the OS invokes each filter when a spooled print job is de spooled. The spooled XPS data can be edited while maintaining the contents of XPS data passing through each filter of the filter pipeline or converted into a data format unique to the driver and finally converted into a print command that is interpretable by the printer .

When the processing for XPS data of a print job is entirely completed or when the print job is cancelled each filter of the filter pipeline terminates the operation. The filter pipeline according to an exemplary embodiment includes the layout filter i.e. the layout processing unit the preview filter i.e. preview document generation unit and the print command filter i.e. print command generation processing unit .

The layout filter performs page layout processing on XPS data received from the XPS spool file according to print setting information. The layout filter generates layout completed XPS data. If the print setting information does not include any layout settings or if a preview completion flag is stored the layout filter directly outputs the received XPS data. The layout processing according to an exemplary embodiment includes an N up print for printing a plurality of pages on a single sheet surface or a poster print for printing a single page on a plurality of sheet surfaces.

The preview filter receives an output of the layout filter and provides a preview function for enabling a user to check confirm a preview image based on the print setting information. If the print setting information indicates that a preview setting is OFF or if the print setting information includes a preview completion flag the preview filter directly outputs the received XPS data.

If the print setting information does not include a preview completion flag and the preview setting is ON the preview filter stores a preview completion flag into a PT i.e. print setting information of FDS .

Next the preview filter activates a preview control module and prepares a preview XPS document . The preview filter stores the FDS in the preview XPS document . Then the preview filter caches each input XPS part and stores the cached XPS part into the preview XPS document .

If the preview filter receives a print continuation notification from the preview control module before processing a finally input XPS part the preview filter outputs the FDS and cached XPS parts and acquires the remaining XPS parts from the input. Further the preview filter directly outputs the acquired XPS parts. Furthermore the preview filter completes the preview XPS document and terminates the processing of each filter.

The print command filter receives an output of the preview filter and converts the XPS data into a print command that is interpretable by the printer according to print setting information. The print command filter outputs the print command to the printer . The print command filter may be referred to as a render filter if the print command filter once converts the input XPS data into image data. The render filter is generally used for a printer driver of an inkjet printer or other low price raster printer.

The print command filter if it operates as a render filter converts the input XPS data into image data applies image processing e.g. color space conversion binarization etc. to the image data and generates a print command that is interpretable by a raster printer. If a high function printer e.g. a page printer can interpret an XPS print command the print command filter edits the input XPS data and outputs XPS data. The print command filter directly outputs the input XPS data if the print command filter is not required to process the data. In this case the print command filter is not required for the printer driver.

The printer i.e. an output device interprets a print command received from the filter pipeline and forms a visible image on a print sheet . An exemplary print result on the print sheet is 2 up print processing performed by the layout filter .

The 2 up print processing includes reducing the size of two pages of the XPS spool file and printing an image of reduced pages on a single sheet surface. In general the N up print processing includes reducing the size of N pages so that the reduced pages can be disposed on the same sheet surface. Accordingly a layout completed page generated by the N up layout processing includes an XML description relating to the contents of a plurality of pages stored in the XPS spool file .

For example the size of an XML description relating to the page contents subjected to the 2 up layout processing is approximately the double size of an XML description relating to page contents stored in the XPS spool file . Similarly the size of an XML description relating to the page contents subjected to the N up layout processing is appropriately N times of the size of an XML description relating to page contents stored in the XPS spool file .

Therefore if the page contents stored in the XPS spool file is complicated the size of an XML description relating to the page contents becomes larger. The cost required for the layout processing increases. If a large number of pages N are involved in the N up print processing the cost required for the layout processing increases.

The preview control module reads the preview XPS document and provides a preview function for a user. The preview control module provides a preview user interface displays a print image switches a print image of a page to be displayed according to a user s instruction continues print processing and interrupts print processing.

If a user instructs print start when the preview filter is writing XPS data into the preview XPS document the preview control module notifies the preview filter of continuing the print processing and terminates the processing. If a user instructs print cancellation when the preview filter is writing XPS data into the preview XPS document the preview control module cancels a print job and terminates the processing.

If a user instructs print start after the preview XPS document is completed the preview control module generates a new print job based on the data of the preview XPS document and terminates the processing. If a user instructs print cancellation after the preview XPS document is completed the preview control module terminates the processing. The preview control module deletes the preview XPS document before terminating the processing. The preview control module provides a preview window illustrated in .

An exemplary 2 up print operation is performed when the preview setting is ON as described below with reference to . The application can use a print setting function of the user interface module via the print support function of the OS. The print setting information includes a preview setting being set to ON and a layout setting being set to 2 up.

The application starts printing a document composed of a plurality of pages according to the acquired print setting information. The document print data of the application and the print setting information are stored into the XPS spool file via the print support function of the OS. The print support function of the OS activates the filter pipeline upon starting spooling document pages into the XPS spool file .

The layout filter performs page layout processing referring to the print setting information indicating that the layout print setting is 2 up and outputs a layout processed page. The preview filter adds a preview completion flag to the print setting information and stores print settings and XPS data into the preview XPS document . Then the preview filter activates the preview control module . The preview control module displays a print image based on the preview XPS document and provides a print function to a user.

If the designated layout setting is 2 up a document of the application is composed of two pages. The number of pages stored in the preview XPS document is one page. Accordingly generation of the preview XPS document is completed. If a user instructs print start to the preview control module a new print job is generated and the contents of the preview XPS document are directly stored.

When a new print job is printed again the print setting information includes a preview completion flag. Therefore the layout filter and the preview filter directly output the input data. The print command filter converts the input XPS data into a print command that is interpretable by the printer . The printer interprets the supplied print command and forms an image on a print sheet i.e. output result .

If a document of the application includes a large number of pages the printing system may be unable to completely generate the preview XPS document when a user instructs print start to the preview control module . In this case the preview control module notifies the preview filter of continuing the print processing. The preview filter stops generating the preview XPS document and outputs all of the stored XPS parts acquires remaining XPS parts from the input and outputs the acquired XPS parts. Next the print command filter converts the input into a print command. The printer interprets the print command and generates the print result .

As described above an exemplary embodiment does not perform layout processing if the print operation is continued. Therefore the exemplary embodiment can prevent the same processing from being repeatedly executed and can realize effective print processing.

Furthermore if the preview XPS document is completed during a preview of a print job the printing system can once stop the print processing of this print job. Therefore the printing system can start print processing of a succeeding print job remaining in a print queue. Accordingly when a preview of a print job is performed the printing system can perform a preview of another print job and generate a print command of another print job and can activate the printer.

According to an exemplary embodiment the filter pipeline includes three filters. However the filter pipeline can include a single filter functionally equivalent to the above described plurality of filters.

For the purpose of simplifying the description of an exemplary embodiment the input output except for a print command of each filter is the XPS part. However the input output of each filter can be a stream of XPS data.

The display example illustrated in is a basic setting tab that includes a simple display area of basic settings composed of character information and image information . There is also provided a page settings tab special effects tab favorites tab and utilities tab . A sheet type selection field displays a type of sheet that is selected by a user. The sheet type selection field is a drop down menu that if clicked by a user can display a list of selectable sheet types together with the selected sheet type. The selectable sheet types include plain paper glossy paper coated paper photo paper postcard New Year s card which the printer can use as print sheets.

A sheet feeding method selection field displays a sheet feeding method of the printer which can be selected by a user. More specifically the sheet feeding method selection field enables a user to select automatic paper feeding e.g. a paper feeding tray or a paper feeding cassette or manual paper feeding e.g. a paper feeding port through which a user can manually feed one or more print sheets .

A print quality selection field enables a user to select an appropriate print quality level. A color adjustment field enables a user to adjust print colors. A monochrome print setting field includes a check box that if checked by a user sets a gray scale print even if an original document is a color document.

A preview print setting field includes a check box that allows a user to confirm how the print settings have effects on an actual print document before the printer starts a print operation. A user can press a RESTORE DEFAULTS button to change setting values of the basic setting tab to standard default setting values.

After completing selection of the setting items a user can press an OK button to fix the selected print settings for a print operation and close the print setting dialog . A user can press a CANCEL button to discard all contents of selected setting items and close the print setting dialog . A user can press an APPLY button to fix the selected print settings while maintaining the print setting dialog in an opened state. A user can press a HELP button to open another window that displays a text describing details of each setting item of the basic setting tab .

A menu bar has a menu format that enables a user to select a command to be input to a previewer e.g. switching of display . A tool bar includes user operation fields to . A user can easily perform switching of a preview page by operating the fields to in the tool bar without using the menu bar . A page switching button is composed of four direction buttons which enable a user to switch a preview display to the top page the previous page the next page or the last page. A drop down list enables a user to select a desirable display size of a preview image e.g. whole 100 200 etc.

A user can press a PRINT START button to deactivate the previewer and bring the preview XPS document into a print processable state. A user can press a PRINT STOP button to deactivate the previewer and cancel the print job if generation of the preview XPS document is incomplete. A preview display area can display a print image visible image to be formed on a print sheet based on the contents of the preview XPS file.

A display area displays setting values relating to representative print setting items of the print job i.e. an object of the preview processing . According to the illustrated example the total number of pages of document to be printed is three pages. The number of presently previewed pages is two. The number of copies according to the print settings is one copy. Further a direct print is designated.

The display screen illustrated in is displayed when the print setting information included in a spooled print job indicates that the preview setting is ON when the print support function of the OS activates the filter pipeline and when the preview filter activates the preview control module .

An ordinary printer cannot print a plurality of documents simultaneously. Therefore the OS has a logical queue i.e. print queue that manages a plurality of print jobs to be processed by the same printer. The queue has a front print job whose processing state is printing. The front print job becomes a processing object of the printer driver.

In a state illustrated in the printing system executes a preview of the preview XPS document A . The front print job i.e. Job B of the print queue is in a printing state. As the preview setting of Job B in ON the printing system generates a preview XPS document B . At this moment the printing system simultaneously executes a preview of the preview XPS document A and a preview of the preview XPS document B. This is useful for a single user who requires a preview of a plurality of print jobs or for a plurality of users who require simultaneous preview of print jobs. Upon completing the preview XPS document A the printing system deletes the Job B from the print queue as illustrated in .

In a state illustrated in the printing system simultaneously executes a preview of the preview XPS document A and a preview of the preview document B . The front print job i.e. Job C of the print queue is in a printing state. As the preview setting of Job C in OFF the printing system does not execute preview processing. The filter pipeline generates a print command that is interpretable by the printer . The printer forms an image on a print sheet. The print processing speed of a general printer is slow. On the other hand the application requires a relatively short time to perform print processing of a document and to spool print data.

While the printer prints the contents of Job C a user may instruct initiating a print of the preview XPS document A . In this case the preview control module adds a new print job to the queue and stores the contents of the preview XPS document A into the XPS spool file as illustrated in .

In a state illustrated in the printing system executes a preview of the preview document B . The front print job i.e. Job C of the print queue is in a printing state. The printer continues the print processing. Job A i.e. a print job newly generated to continue the print of the preview XPS document A is in a waiting state. Upon completing the print processing of Job C the printing system deletes the Job B from the print queue as illustrated in .

In a state illustrated in the printing system executes a preview of the preview document B . The front print job i.e. Job A of the print queue is in a printing state. The Job A is an already previewed print job as readily understood by referring to the preview completion flag stored in the print settings as described above.

Accordingly the printing system does not execute a preview of Job A . The filter pipeline generates a print command that is interpretable by the printer . The printer forms an image on a print sheet. Upon terminating the print processing of Job A the printing system deletes the Job A from the print queue as illustrated in .

In a state illustrated in the printing system executes a preview of the preview document B . The print queue does not store any print job.

As described above the printing system according to an exemplary embodiment can simultaneously display a plurality of preview images and perform an actual print of a print job included in a print queue while providing the preview function.

According to an exemplary embodiment a newly generated print job is added to the rear of the print queue. However the print support function of the OS can add a new print job to anywhere in the print queue. For example a new print job can be added to the front of the print queue as a print job preceding the existing print jobs.

In a case where a new print job can be freely added to anywhere in the print queue the preview control module can select an optimum position and store the new print job to the selected position. For example when the print jobs stored in the print queue are XPS documents estimating the processing time of a printer that prints the print jobs is feasible by acquiring information about the total number of pages and the size of each job.

Hence at the time a new print job is added the preview control module can select an optimum position to minimize an average waiting time estimated for a printing operation of all print jobs stored in the print queue. Furthermore the user interface can be configured to allow a user to select a desired position for a new print job in the print queue. As described above a new print job can be arbitrarily stored anywhere in the print queue.

An exemplary preview completion flag stored in a PT is described below with reference to . As described above the PT includes print settings described according to the XML format. Therefore the contents of the PT can be visually expressed as text refer to .

The PT illustrated in describes exemplary print settings including designation of a 2 up layout. The PrintSchema regulates the standard description contents of the PT including the setting items relating to the N up layout. The PrintSchema is a publicly opened schema. The N up settings involved in the PT include JobNUpAllDocumentsContiguously having an effect on the FDS and DocumentNUp having an effect on the FD which are regulated by the PrintSchema. The printer driver exclusively handles these print settings although the priorities given to them are dependent on each printer driver. According to the present embodiment the 2 up layout is designated to each of these print settings.

The print settings include other setting items although an exemplary embodiment describes only the N up layout. Some of the setting items can have an effect on the FP as well as on the FDS and the FD.

Although the Property of the framework is used to store the preview completion flag according to the examples illustrated in Feature Option can be also used. It is also useful to prepare a private name space indicating a preview completion flag so that the presence of the name space can express the preview completion flag. As the PT is described according to the XML format any other expression complying with the PrintSchema can be used to store the preview completion flag.

Each filter of the filter pipeline is required to merge the PT of the XPS as described above to acquire print setting information. Each part of an XPS document can include a PT or may not include a PT. Even if an XPS part includes a PT the PT may be an imperfect PT that describes only N up information as illustrated in . Therefore it is necessary to merge a PT of the FDS with the PT including user s default print settings. The PT of default print settings includes all setting items that the printer driver can manage. Accordingly the merged PT includes all print setting items.

In step S the program acquires a default PT including default print settings determined by a user. In step S the program acquires an FDS of an XPS document. In step S the program acquires a PT of the FDS. In step S the program determines whether the PT of the FDS has been acquired. If the PT of the FDS has been acquired YES in step S the processing flow proceeds to step S. If the PT of the FDS has not been acquired NO in step S the processing flow proceeds to step S. In step S the program sets a reference PT that includes the acquired PT of the FDS merged with the default PT. Then the program terminates the processing of this routine. In step S the program sets a reference PT that is identical to the default PT. Then the program terminates the processing of this routine.

The above described all print setting items include setting items that an application can set and do not include a preview completion flag i.e. setting items in a printer driver . The processing illustrated in can acquire a reference PT including all setting items that the printer driver can manage.

Exemplary processing of the layout filter is described below with reference to . is a flowchart illustrating an example of the layout filter processing. The CPU of the central control unit executes a program relating to the flowchart of which can be loaded into the RAM of the storage unit from the hard disk of the storage unit of the data processing apparatus .

In step S the layout filter acquires a reference PT as described above. In step S the layout filter determines whether the reference PT includes a preview completion flag. If the reference PT includes the preview completion flag YES in step S the processing flow proceeds to step S. If the reference PT does not include the preview completion flag NO in step S the processing flow proceeds to step S.

In step S the layout filter acquires an FD. In step S the layout filter acquires a PT of the FD. In step S the layout filter determines whether the PT of the FD has been acquired. If the PT of the FD has been acquired YES in step S the processing flow proceeds to step S. If the PT of the FD has not been acquired NO in step S the processing flow proceeds to step S.

In step S the layout filter merges the acquired PT of the FD with the reference PT. In step S the layout filter determines whether print setting information of the reference PT includes layout processing settings. If the print setting information includes the layout processing settings YES in step S the processing flow proceeds to step S. If the print setting information does not include the layout processing settings NO in step S the processing flow proceeds to step S.

The layout filter executes sequential processing of steps S to S to directly output the input XPS data to the preview filter without executing the layout processing. In step S the layout filter transmits the acquired FDS to the preview filter . In step S the layout filter transmits the acquired FD to the preview filter . In step S the layout filter successively acquires remaining XPS parts from the input and transmits the acquired XPS parts to the preview filter . Then the layout filter terminates the processing of this routine.

The layout filter executes sequential processing of steps S to S to perform the layout processing on the input XPS data and to output the processed data to the preview filter . In step S the layout filter transmits the acquired FDS to the preview filter . In step S the layout filter transmits the acquired FD to the preview filter . In step S the layout filter successively acquires remaining XPS parts from the input generates a layout completed FP i.e. an FP having been subjected to the layout processing and transmits the layout completed FP to the preview filter .

As described above the PT includes layout settings having an effect on the FDS and layout settings having an effect on the FD. Therefore the layout filter transmits the FD if required to the preview filter . After all the FPs including the newly generated layout completed FP are transmitted to the preview filter the layout filter terminates the processing of this routine.

In a sequential procedure of steps S and S the layout filter does not execute layout processing because a preview completed print job has been already subjected to the layout processing. In step S the layout filter transmits the input FDS to the preview filter . In step S the layout filter successively acquires remaining XPS parts from the input and transmits the acquired XPS parts to the preview filter . Then the layout filter terminates the processing of this routine. Thus the XPS data is transmitted to the next filter the preview filter .

In this manner an exemplary embodiment refers to a preview completion flag involved in a PT and can prevent the same layout processing from being repeatedly executed after performing a preview.

In step S the preview filter acquires a reference PT as described above. In step S the preview filter determines whether the reference PT includes a preview completion flag. If the preview completion flag is included YES in step S the processing flow proceeds to step S. If the preview completion flag is not included NO in step S the processing flow proceeds to step S.

In step S the preview filter determines whether the preview setting i.e. print setting information of the reference PT is ON. If the preview setting of the reference PT is not ON NO in step S the processing flow proceeds to step S. If the preview setting is ON YES in step S the processing flow proceeds to step S.

The preview filter executes sequential processing of steps S through S to generate a preview XPS document. In step S the preview filter adds a PT to the acquired FDS if the FDS does not include any PT. In step S the preview filter adds a preview completion flag to the PT of the FDS. In step S the preview filter activates the preview control module .

In step S the preview filter generates a preview XPS document and adds the acquired FDS. The preview XPS document includes an XPS document having been subjected to the layout processing and a preview completion flag added to this preview XPS document. In step S the preview filter acquires the next XPS part from the input and caches the acquired XPS part. Then the preview filter adds the cached XPS part to the preview XPS document.

In step S the preview filter determines whether the acquired XPS part is the final part. If the acquired XPS part is the final part YES in step S the processing flow proceeds to step S. If the acquired XPS part is not the final part NO in step S the processing flow proceeds to step S. In step S the preview filter does not output any XPS data and transmits a notification of terminating the processing to each filter of the filter pipeline . Thus the print job is deleted from the print queue.

In step S the preview filter determines whether a print continuation notification is received from the preview control module . If the print continuation notification is not received NO in step S the processing flow returns to step S to continue generating the preview XPS document. If the print continuation notification is received YES in step S the processing flow proceeds to step S.

The preview filter executes sequential processing of steps S to S when a user instructs initiating a print operation before the preview XPS document is completely generated. In step S the preview filter transmits the acquired FDS to the print command filter .

In step S the preview filter successively transmits the cached XPS parts to the print command filter . In step S the preview filter successively acquires remaining XPS parts from the input and transmits the acquired XPS parts to the print command filter . Then the preview filter terminates the processing of this routine.

In a sequential procedure of steps S and S the preview filter does not execute preview processing because a preview completed print job has been already subjected to the preview processing. In step S the preview filter transmits the input FDS to the print command filter . In step S the preview filter successively acquires remaining XPS parts from the input and transmits the acquired XPS parts to the print command filter . Then the preview filter terminates the processing of this routine. Thus the XPS data is transmitted to the next filter the print command filter .

In the above described processing the preview filter caches the input XPS parts while generating the preview XPS document. If the print continuation notification is received before completing the preview XPS document the preview filter outputs the cached XPS document to the print command filter . However the preview filter may not cache the XPS parts. In this case the preview filter reads XPS parts from the preview XPS document being currently generated and outputs the read XPS parts to the print command filter .

The above described processing can store a preview completion flag in a preview XPS file and can output XPS data to generate a print command according to a print start instruction even if generation of the preview XPS file is not completed. Furthermore the above described processing can prevent preview completed XPS data from being previewed again.

A sequential procedure of steps S to S is an event processing loop. Step S is a start terminal of the event processing loop. In step S the preview control module acquires an event. In step S the preview control module determines whether the event is print start i.e. a print instruction . If the event is the print start YES in step S the processing flow proceeds to step S. If the event is not the print start NO in step S the processing flow proceeds to step S.

In step S the preview control module determines whether the event is print stop. If the event is the print stop YES in step S the processing flow proceeds to step S. If the event is not the print stop NO in step S the processing flow proceeds to step S.

In step S the preview control module performs event processing other than the print start and the print stop. For example as described above with reference to if the event generated via the preview window is switching of a page to be displayed the preview control module again draws the contents of the preview display area of the preview window. Furthermore in processing a timer event the preview control module can change the display of the number of spooled pages. In this manner the preview control module can perform various processing in step S. Step S is a terminal end of the event processing loop. The processing flow returns to step S.

When the event is the print start YES in step S the preview control module executes sequential processing of step S through step S i.e. print start processing . In step S the preview control module determines whether the preview filter is currently generating a preview XPS document. If the preview filter is currently generating the preview XPS document YES in step S the processing flow proceeds to step S. If the preview filter has completely generated the preview XPS document NO in step S the processing flow proceeds to step S.

In step S the preview control module notifies continuation of the print processing to the preview filter because the previewed print job still remains in the print queue. Then the processing flow proceeds to step S. In step S the preview control module adds a new print job to the print queue because the print job has already been deleted from the print queue. The preview control module inputs the contents of the preview XPS document and outputs an XPS document of the new print job to the spool file . Then the processing flow proceeds to step S.

An exemplary print job generation procedure performed by the preview control module is described below. First the preview control module notifies the OS of adding a print job and acquires a path of the XPS spool file from the OS. Next the preview control module copies the contents of a preview XPS document corresponding to the print job to the XPS spool file . Next the preview control module requests the OS to schedule the added print job.

When the event is the print stop YES in step S the preview control module executes sequential processing of steps S and S i.e. print cancellation processing . In step S the preview control module determines whether the preview filter is currently generating a preview XPS document. If the preview filter is currently generating the preview XPS document YES in step S the processing flow proceeds to step S. If the preview filter has completely generated the preview XPS document NO in step S the processing flow proceeds to step S.

In step S the preview control module cancels the print job because the previewed print job still remains in the print queue. When the preview filter has completely generated the preview XPS document the previewed print job does not remain in the print queue. Thus the preview control module skips the processing of step S. In step S the preview control module deletes the preview XPS document and terminates the processing of this routine.

In this manner if any print job is present during a preview operation the printer can promptly start a print operation according to a user s print start instruction. Furthermore as the preview XPS document of each original print job is stored a plurality of preview functions can be simultaneously provided.

As described above an exemplary embodiment can obtain the following effects 1 even if a user instructs print start via the previewer the printing system does not perform the same layout processing again and can reduce the processing load of a computer and 2 if generation of the preview XPS document is terminated the printing system can process a succeeding print job in the print queue during a preview of the preceding job.

According to the first exemplary embodiment in continuously performing an actual print operation after a print preview the printing system can directly use the layout processing completed preview XPS document generated during the print preview. Therefore in the actual print operation the printing system performs only limited processing required for the layout processing completed preview XPS document. Thus the printing system is not required to perform the same layout processing for the print preview and the actual print processing.

On the other hand there is a conventional system that processes modifies the contents to be displayed before displaying a preview image for the purpose of letting a user confirm print contents beforehand or check the presence of any print error. For example as described above the CD R area display function is usable to add a border line identifying the inside and outside areas of a CD R disk on a print image generated for the print preview to perform density adjustment processing and to display a processed print image. In the case of a printer driver capable of processing an XPS document to realize the CD R area display function the preview control module processes a print image on each page of a preview XPS document.

Therefore if the CD R area display function is realized by the printing system according to the first exemplary embodiment the printer continues an actual print operation using a processed preview XPS document. Thus an image of a CD R area does not disappear from an actual print result.

Furthermore according to a second exemplary embodiment if the preview control module processes modifies a print image on each page of a preview XPS document in performing a preview display the printing system continues an actual print operation after the print image of each page is restored to its original unprocessed state.

The portions already described in the first exemplary embodiment e.g. the illustrations in are not described below. Instead of using the processing illustrated in which is exclusively performed for the first exemplary embodiment the second exemplary embodiment executes the processing illustrated in .

More specifically the preview control module when activated by the preview filter reads the preview XPS document and performs preview display processing for displaying a preview image of a page e.g. first page as described below. Similarly the preview control module performs the preview display processing for switching a page displayed according to a user s instruction.

Furthermore the preview control module performs preview XPS document reset processing as described below if a print start instruction is received from a user after the preview XPS document is completed. Then the preview control module generates a new print job based on the data of the preview XPS document and terminates the processing.

Next exemplary preview display processing performed by the preview control module according to the second exemplary embodiment is described below.

First the preview control module acquires print setting information PT of a page to be previewed from the preview XPS document. Next referring to the acquired PT the preview control module determines whether the print setting of a page to be previewed is a CD R print. If the print setting is the CD R print the preview control module processes a print image for the display of a CD R area. For example the preview control module adds a drawing command to an FP for drawing a border line that defines a portion corresponding to the inside of a CD R and a portion corresponding to the outside of the CD R or a drawing command for decreasing the density of an image positioned outside the CD R. Then the preview control module displays the processed print image as a print preview image.

The preview XPS document reset processing performed by the preview control module according to the present embodiment is described below.

First the preview control module acquires each FP from the preview XPS document. Next the preview control module determines whether the acquired FP includes a drawing command added for the CD R area display. If the FP includes the drawing command added for the CD R area display the preview control module deletes the drawing command.

More specifically the root element of the FixedPage declares a private name space whose prefix is ns0000 defines ns0000 owner attribute belonging to this name space as attribute information of each drawing command and designates the Previewer as an attribute value. Accordingly the preview control module can be identified as a creator of the drawing command. The method for identifying the drawing command is not limited to the above described method.

According to the CD R media settings illustrated in the psf Option element is a child element of the above mentioned psf Feature element. The name attribute value of the psf Option element is ns0000 Disc. 

In step S the preview control module performs preview display processing described below in more detail to display a print preview of a page to be displayed e.g. first page . In step S the preview control module determines whether the event acquired in step S is switching of a page to be previewed.

If the preview control module determines that the event acquired in step S is switching of a page to be previewed YES in step S the processing flow proceeds to step S. If the preview control module determines that the event acquired in step S is not switching of a page to be previewed NO in step S the processing flow proceeds to step S.

In step S the preview control module performs preview display processing for displaying a print preview of a page designated by a user in the event acquired in step S. In step S the preview control module performs preview XPS document reset processing described below in more detail to restore the preview XPS document to its original state.

In step S the preview control module performs FixedPage processing PrintTicket acquisition processing described below in more detail to acquire print setting information PT of a page to be previewed.

In step S the preview control module acquires setting contents relating to the type of sheet referring to the PT acquired in step S. More specifically the preview control module retrieves the psf Feature element whose name attribute value is psf PageMediaType and acquires contents of the psf Option element i.e. child element .

In step S the preview control module refers to the psf Option element acquired in step S and determines whether the type of sheet setting is CD R. More specifically the preview control module determines whether the name attribute value of the psf Option element is ns0000 Disc when the prefix of private name space is declared as ns0000. 

If the preview control module determines that the type of sheet setting is CD R YES in step S the processing flow proceeds to step S. If the preview control module determines that the type of sheet setting is not CD R NO in step S the processing flow proceeds to step S.

In step S the preview control module refers to the FP of a page to be previewed and determines whether the FP includes a drawing command added for a CD R highlight display. If the preview control module determines that the FP includes the drawing command added for the CD R highlight display YES in step S the processing flow proceeds to step S. If the preview control module determines that the FP does not include the drawing command added for the CD R highlight display NO in step S the processing flow proceeds to step S.

In step S the preview control module adds a drawing command for the CD R area display i.e. drawing command unique to the preview display to the FP of the page. In step S the preview control module adds a preview flag i.e. flag identifying that the creator of the drawing command is the preview control module to the drawing command added in step S. In step S the preview control module performs a preview display based on the FP of the page. Then the preview control module terminates the processing of this routine.

The above described processing is not limited to the drawing command for displaying an area of a CD R disk and can also be applied to a drawing command for displaying grid lines or a scale or a drawing command for displaying a print area of an enlarged document image in a borderless print operation.

A sequential procedure of steps S to S is a page processing loop performed for each page included in the preview XPS document . Step S is a start terminal of the page processing loop. The processing of succeeding steps S to S is successively performed from FP of a leading page for all pages involved in the preview XPS document .

In step S the preview control module determines whether the FP of the page includes the drawing command added for the CD R area display. If the preview control module determines that the FP of the page includes the drawing command added for the CD R area display YES in step S the processing flow proceeds to step S. If the preview control module determines that the FP of the page does not include the drawing command added for the CD R area display NO in step S the processing flow proceeds to step S.

In step S the preview control module deletes the drawing command for the CD R area display from the FP of the page. Step S is a terminal end of the page processing loop. The page processing loop repeatedly returns to step S until the preview control module completes the processing for the FP of the final page included in the preview XPS document . If the preview control module has completed the processing for the FP of the final page the preview control module terminates the processing of this routine.

In step S the preview control module acquires a default PT that includes user s default print settings. The default PT acquired in step S is designated as a provisional FP processing PT. In step S the preview control module acquires an FDS from the preview XPS document . In step S the preview control module acquires a PT related to the FDS acquired in step S. In step S the preview control module determines whether the FDS related PT has been acquired in step S.

If the preview control module determines that the PT related to the FDS has been acquired YES in step S the processing flow proceeds to step S. If the preview control module determines that the PT related to the FDS has not been acquired NO in step S the processing flow proceeds to step S.

In step S the preview control module merges the FDS related PT acquired in step S with the provisional FP processing PT. The PT including the merged PT in this step is designated as a provisional FP processing PT. In step S the preview control module acquires from the preview XPS document an FD to which a page to be previewed belongs. In step S the preview control module acquires a PT related to the FD acquired in step S. In step S the preview control module determines whether the FD related PT has been acquired in step S.

If the preview control module determines that the FD related PT has been acquired YES in step S the processing flow proceeds to step S. If the preview control module determines that the FD related PT has not been acquired NO in step S the processing flow proceeds to step S.

In step S the preview control module merges the FD related PT acquired in step S with the provisional FP processing PT. The PT including the merged PT in this step is designated as a provisional FP processing PT. In step S the preview control module acquires an FP of a page to be previewed from the preview XPS document . In step S the preview control module acquires a PT related to the FP acquired in step S. In step S the preview control module determines whether the FP related PT has been acquired in step S.

If the preview control module determines that the FP related PT has been acquired YES in step S the processing flow proceeds to step S. If the preview control module determines that the FP related PT has not been acquired NO in step S the preview control module identifies the provisional FP processing PT as final FP processing PT and terminates the processing of this routine.

In step S the preview control module merges the FP related PT acquired in step S with the provisional FP processing PT and identifies the FP including the merged PT as final FP processing PT. Then the preview control module terminates the processing of this routine.

As described above even when the preview control module processes modifies a preview print image on a page of the preview XPS document the printing system according to an exemplary embodiment can continue actual print processing using the preview XPS document after the print preview.

Therefore the printing system can prevent the same layout processing from being repeatedly performed for the print preview and the actual print processing while realizing the CD R area display function.

Accordingly an exemplary embodiment enables a user to accurately confirm the contents printed on a CD R disk before starting the print processing and does not soil a dedicated tray of a printing apparatus. Thus an exemplary embodiment can provide a print preview function capable of improving the usability of a user. Moreover an exemplary embodiment can provide an information processing apparatus that does not print preview oriented information added in a preview operation.

According to the second exemplary embodiment when the preview control module processes modifies a preview print image on a page of a preview XPS document the printing system can continue actual print processing after the print image on the page is restored to its original unprocessed state. Therefore the printing system can prevent the same layout processing from being repeatedly performed for the print preview and the actual print processing while realizing the CD R area display function.

A printing system according to a third exemplary embodiment is configured to continue actual print processing without restoring the print image on the page to its original unprocessed state.

The portions already described in the second exemplary embodiment e.g. the illustrations in are not described below. Instead of using the processing illustrated in which is exclusively performed for the second exemplary embodiment the third exemplary embodiment executes the processing illustrated in . The processing illustrated in is peculiar to the second exemplary embodiment. The third exemplary embodiment does not execute the processing illustrated in .

More specifically if a print start instruction is received from a user after the preview XPS document is completed the preview control module generates a new print job based on the data of the preview XPS document without performing the preview XPS document reset processing described in the second exemplary embodiment and terminates the processing.

If the print command filter receives XPS data from the preview filter the print command filter performs print command filter processing as described below to convert the XPS data into a print command that is interpretable by the printer and outputs the print command.

A sequential procedure of steps S through S is a document processing loop performed for each document included in XPS data. Step S is a start terminal of the document processing loop. The processing of succeeding steps S through S is successively performed from FD of a leading document for all documents involved in the XPS data.

A sequential procedure of steps S through S is a page processing loop performed for each page included in the FD. Step S is a start terminal of the page processing loop. The processing of succeeding steps S through S is successively performed from FP of a leading page for all pages involved in the FD. In step S the print command filter performs FixedPage processing PrintTicket acquisition processing for acquiring print setting information PT of the page.

A sequential procedure of steps S thorough S is a drawing command processing loop performed for each drawing command included in the FP of the page. Step S is a start terminal of the drawing command processing loop. The processing of succeeding steps S through S is successively performed from a leading drawing command for all drawing commands involved in the FP. In step S the print command filter acquires a drawing command involved in the FP.

In step S the print command filter determines whether the drawing command acquired in step S is a drawing command stored by the preview control module that performs a preview display. More specifically the print command filter determines whether the root element of FixedPage declares a private name space defines owner attribute belonging to this name space as attribute information of the drawing command and designates the Previewer as an attribute value. For example as described above in when the prefix of private name space is declared as ns0000 the print command filter determines the drawing commands with ns0000 owner attribute whose attribute value is Previewer. 

If the print command filter determines that the acquired drawing command is the drawing command stored by the preview control module YES in step S the processing flow proceeds to step S. If the acquired drawing command is a drawing command other than the drawing command unique to the preview display NO in step S the processing flow proceeds to step S.

In step S the print command filter converts the drawing command acquired in step S into a print command that is interpretable by the printer. Step S is a terminal end of the drawing command processing loop. The drawing command processing loop repeatedly returns to step S until the print command filter completes the processing for the final drawing command involved in the FP. If the print command filter has completed the processing for the final drawing command the processing flow proceeds to step S.

In step S the print command filter outputs the print command converted in step S. Step S is a terminal end of the page processing loop. The page processing loop repeatedly returns to step S until the print command filter completes the processing for the FP of the final page involved in the FD. If the print command filter has completed the processing for the FP of the final page the processing flow proceeds to step S.

Step S is a terminal end of the document processing loop. The document processing loop repeatedly returns to step S until the print command filter completes the processing for the FD of the final document involved in the XPS data. If the print command filter has completed the processing for the FD of the final document the print command filter terminates the processing of this routine.

According to the first exemplary embodiment in performing actual print processing after performing a print preview operation the printing system can continue the actual print processing using the layout processing completed preview XPS document generated in the print preview operation. Therefore in the actual print processing the printing system performs only limited processing required for the layout processing completed preview XPS document. Thus the printing system is not required to perform the same layout processing for the print preview and the actual print processing.

There is a conventional printing system that accepts a change request from a user with respect to print settings when a print preview image is displayed and executes print processing according to the changed print settings. In this case the printing system newly generates a print image for actual print processing after the print preview operation. Therefore the printing system can perform print processing according to the print settings according to user s intent.

However the following problem may arise if the printing system according to the first exemplary embodiment accepts a change request from a user during a print preview display operation.

More specifically according to the first exemplary embodiment the printing system continues actual print processing directly using the layout processing completed preview XPS document generated during a print preview operation. However depending on print setting contents changed during the print preview operation the processing completed layout and the changed print settings may contradict each other.

For example during a display of a preview XPS document of A4 sheet size having been subjected to the 2 in 1 layout processing a user may change the output sheet setting from A4 to B5. However the printing system according to the first exemplary embodiment continues the actual print processing directly using the preview XPS document that maintains the 2 in 1 layout print layout for the A4 sheet size. Therefore the print image does not fit the B5 sheet which is different from the A4 sheet in size and aspect ratio and therefore some of the print image will be lost along an edge when printed on a sheet. Thus a user cannot obtain an expected print result i.e. the 2 in 1 layout of B5 sheet size .

Hence a printing system according to a fourth exemplary embodiment is configured to accept a change in print settings if the change does not have any adverse effect on the print processing e.g. layout processing having been already performed on the preview XPS document while providing a print setting change function during a print preview display operation performed according to the first exemplary embodiment.

The portions already described in the first exemplary embodiment e.g. the illustrations in are not described below. Instead of using the processing illustrated in which is exclusively performed for the first exemplary embodiment the fourth exemplary embodiment executes the processing illustrated in .

More specifically after the layout filter performs the page layout processing based on print setting information the layout filter performs processing completion flag storage processing as described below.

On the other hand the preview control module when activated by the preview filter reads the preview XPS document and performs settable value list display processing for a page to be previewed e.g. first page as described below. Similarly the preview control module performs the settable value list display processing for switching a page displayed according to a user s instruction.

Furthermore the preview control module performs print setting update processing in response to a user s instruction that changes print settings as described below.

Exemplary processing completion flag storage processing performed by the layout filter is described below. First the layout filter adds a processing completion flag about layout processing performed based on actually print setting information to the PT acquired by the reference PrintTicket acquisition processing. More specifically if the 2 in 1 layout print processing is performed referring to the psf Feature element whose name attribute value is psf JobNupAllDocumentsContiguously the root element of the PT declares a private name space whose prefix is ns0000 defines ns0000 layoutfilterprocess attribute belonging to the above described name space as attribute information of the psf Feature element and designates done as an attribute value. Thus the layout filter can identify completion of the 2 in 1 layout print processing.

Next the layout filter stores a processing completion flag about print settings applied to the processing completed layout processing as described above. More specifically if the layout position and the size are determined based on sheet settings in performing the 2 in 1 layout print processing the layout filter adds attribute information about an element corresponding to sheet settings i.e. psf Feature element whose name attribute value is psf PageMediaSize as described above. Thus it can be identified that the layout filter has performed the layout processing based on the sheet settings.

The settable value list display processing performed by the preview control module is described below in more detail. First the preview control module acquires print setting information PT of a page to be previewed from a preview XPS document. Next the preview control module refers to the acquired PT and determines whether the layout filter has performed layout processing based on the print settings that are subjected to a setting change. If the layout filter has performed the layout processing based on the print settings to be changed the preview control module does not accept the setting change of the print settings.

On the other hand if the layout filter has not performed the layout processing based on the print settings to be changed the preview control module determines options whose settings are changeable based on PrintCapabilities hereinafter referred to as PC acquired using the above described acquired PT and displays a list of options on a preview screen.

The PrintCapabilities include capability information of a printer and a printer driver more specifically information relating to setting values being settable in performing print settings using the PT which are described according to the XML format. Similar to the PT the PrintSchema can regulate the PrintCapabilities.

Furthermore the exemplary PC illustrated in defines constrained attribute as attribute information relating to the psf Option element. The constrained attribute indicates whether a sheet represented by the psf Option element is currently selectable. More specifically if the attribute value is psk None a sheet expressed by psf Option element is currently selectable. On the other hand if the attribute value is psk PrintTicketSettings a sheet expressed by psf Option element is not currently selectable. According to the example illustrated in it is understood that the printer supports five sheet types of A5 A4 B5 L size 2L size which are currently selectable.

In step S the preview control module performs settable value list display processing as described below to display changeable print settings and options of a page to be displayed e.g. first page on the print preview screen. In step S the preview control module determines whether the event acquired in step S is a change of print settings.

If the preview control module determines that the event acquired in step S is the change of print settings YES in step S the processing flow proceeds to step S. If the preview control module determines that the event acquired in step S is not the change of print settings NO in step S the processing flow proceeds to step S.

In step S the preview control module performs print setting update processing as described below to update the PT of the page included in the preview XPS document . In step S the preview control module determines whether the event acquired in step S is a switching of a page to be previewed.

If the preview control module determines that the event acquired in step S is the switching of a page to be previewed YES in step S the processing flow proceeds to step S. If the preview control module determines that the event acquired in step S is not the switching of a page to be previewed NO in step S the processing flow proceeds to step S.

In step S the preview control module performs settable value list display processing for displaying on the print preview screen print settings and options changeable with respect to a page designated by a user in the event acquired in step S.

In step S the preview control module determines whether there is any change in print settings. If the preview control module determines that there is any change in print settings YES in step S the processing flow proceeds to step S. If the preview control module determines that there is no change in print settings NO in step S the processing flow proceeds to step S. In step S the preview control module notifies the contents of changed print settings to the preview filter .

In step S the preview control module performs the settable value list acquisition processing for acquiring a list of sheet types settable for a page to be previewed. In step S the preview control module displays on the print preview screen the list of settable sheet types acquired in step S. In step S the preview control module performs the settable value list acquisition processing for acquiring a list of sheet feeding methods settable for the page to be previewed.

In step S the preview control module displays on the print preview screen the list of sheet feeding methods acquired in step S. In step S the preview control module performs the settable value list acquisition processing for acquiring a list of output sheets settable for the page to be previewed. In step S the preview control module displays on the print preview screen the list of output sheets acquired in step S. Then the preview control module terminates the processing of this routine.

In step S the preview control module performs FixedPage processing PrintTicket acquisition processing for acquiring print setting information PT of a page to be previewed.

In step S the preview control module refers to the PT acquired in step S and determines whether a layout processing completion flag is added to the print settings for which the settable value list is acquired. More specifically to acquire a settable value list with respect to the type of sheet the preview control module determines whether the root element of the PT declares a private name space defines layoutfilterprocess attribute belonging to this name space as attribute information of the Feature element whose name attribute value is psf PageMediaType and designates done as an attribute value. For example when the prefix of a private name space is ns0000 the attribute described above is ns0000 layoutfilterprocess. 

If the preview control module determines that the layout processing completion flag is added YES in step S the processing flow proceeds to step S. If the preview control module determines that the layout processing completion flag is not added NO in step S the processing flow proceeds to step S.

In step S the preview control module refers to the PT acquired in step S and acquires PrintCapabilities PC according to the present print settings. In step S the preview control module refers to the PC acquired in step S and acquires a settable value list. In step S the preview control module refers to the PT acquired in step S and designates only the contents of print settings included in the PT as settable values. Then the preview control module terminates the processing of this routine.

In step S the preview control module acquires an FP of a page to be previewed from the preview XPS document . In step S the preview control module acquires a PT related to the FP acquired in step S. In step S the preview control module determines whether the FP related PT has been acquired in step S.

If the preview control module determines that the FP related PT has been acquired YES in step S the processing flow proceeds to step S. If the preview control module determines that the FP related PT has not been acquired NO in step S the processing flow proceeds to step S.

In step S the preview control module generates a PT that does not include any print settings and relates the generated PT with the FP acquired in step S. More specifically an exemplary PT including no print settings is a PT including only root elements. In step S the preview control module reflects changes in the print settings received from a user to the FP related PT of a page to be previewed. Then the preview control module terminates the processing of this routine.

Thus the printing system according to an exemplary embodiment can accept a change in print settings if the change does not have any adverse effect on the print processing e.g. layout processing having been already performed on the preview XPS document while providing a print setting change function during a print preview display operation performed according to the first exemplary embodiment.

Thus the printing system is not required to perform the same layout processing for the print preview and the actual print processing while providing the print setting change function. Accordingly a user can easily confirm the contents of print settings being set by the application during a print preview display. Furthermore if there is any error in the print settings a user can change print settings although changeable items may be limited . Thus the printing system can provide an excellent print preview function.

Although not illustrated the storage medium can store management information for the programs stored in the storage medium such as version information and creator name and information relevant to the OS that reads the programs e.g. icons discriminately displaying the programs.

Furthermore a directory of the storage medium can manage data belonging to various programs. Moreover the storage medium can store a program for installing various programs on a computer and a decompression program if the installed program is compressed.

A host computer can execute programs installed from an external device to realize the functions comparable to the processing steps illustrated in and according to the above described exemplary embodiments. In this case the present invention encompasses an information group including the programs that can be supplied to an output apparatus using a storage medium e.g. CD ROM flash memory or floppy disk FD or from an external storage medium via a network.

Moreover software program code for realizing the functions of the above described exemplary embodiments can be supplied to a system or an apparatus including various devices. A computer or CPU or micro processing unit MPU in the system or the apparatus can execute the program to operate the devices to realize the functions of the above described exemplary embodiments. Accordingly the present invention encompasses the program code installable on a computer when the functions or processes of the exemplary embodiments can be realized by the computer.

In this case the program code itself can realize the functions of the exemplary embodiments. The equivalents of programs can be used if they possess comparable functions. Furthermore the present invention encompasses supplying program code to a computer with a storage or recording medium storing the program code. In this case the type of program can be any one of object code interpreter program and OS script data. A storage medium supplying the program can be selected from any one of a floppy disk a hard disk an optical disk a magneto optical MO disk a compact disk ROM CD ROM a CD recordable CD R a CD rewritable CD RW a magnetic tape a nonvolatile memory card a ROM and a digital versatile disc DVD DVD ROM DVD R .

The method for supplying the program includes accessing a web site on the Internet using the browsing function of a client computer when the web site allows each user to download the computer program of the present invention or compressed files of the programs having automatic installing functions to a hard disk or other recording medium of the user.

Furthermore the program code constituting the programs of the present invention can be divided into a plurality of files so that respective files are downloadable from different web sites. Namely the present invention encompasses World Wide Web WWW servers that allow numerous users to download the program files so that the functions or processes of the present invention can be realized on their computers.

Enciphering the programs of the present invention and storing the enciphered programs on a CD ROM or comparable recording medium is an exemplary method when the programs of the present invention are distributed to the users. The authorized users i.e. users satisfying predetermined conditions are allowed to download key information from a web page on the Internet. The users can decipher the programs with the obtained key information and can install the programs on their computers. When the computer reads and executes the installed programs the functions of the above described exemplary embodiments can be realized.

Moreover an operating system OS or other application software running on a computer can execute part or all of actual processing based on instructions of the programs.

Additionally the program code read out of a storage medium can be written into a memory of a function expansion board equipped in a computer or into a memory of a function expansion unit connected to the computer. In this case based on an instruction of the program a CPU provided on the function expansion board or the function expansion unit can execute part or the whole of the processing so that the functions of the above described exemplary embodiments can be realized.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all modifications equivalent structures and functions.

This application claims priority from Japanese Patent Application No. 2006 342823 filed Dec. 20 2006 and Japanese Patent Application No. 2007 019469 filed Jan. 30 2007 which are hereby incorporated by reference herein in their entirety.

