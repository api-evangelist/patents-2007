---

title: Method of indicating connectivity of peripheral device to computer operating system
abstract: This invention provides a method of connecting a network-connected image input device, to which a plug-and-play function cannot be applied to a computer installed with an OS (operating system) and using the image input device. To this end, when a control program of the image input device is activated, the program notifies the OS of information indicating that the peripheral device is connected, irrespective of connection/non-connection between the peripheral device and the computer. Upon reception of a command for activating the peripheral device, the control program confirms the connection/non-connection between the peripheral device and the computer. When the connection is confirmed, the control program controls the peripheral device to activate.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08171182&OS=08171182&RS=08171182
owner: Canon Kabushiki Kaisha
number: 08171182
owner_city: Tokyo
owner_country: JP
publication_date: 20071207
---
The present invention relates to a method of supporting an image input device compatible to a network connection installation and use of driver software of the image input device in a computer and a program.

As devices used when data on paper media are converted into digital data and are fetched to computers and the like image input devices such as an imaging scanner copying machine and the like are available. These image input devices can scan many kinds of documents such as monochrome images of text documents and the like color images of magazines developed photos positive and negative films and the like. A digital camera is also handled as an image input device.

Image input devices are often used by connecting them to computers installed with WINDOWS operating system OS available from Microsoft Corporation using connection methods such as USB Universal Serial Bus IEEE1394 SCSI Small Computer System Interface and the like. In this case a service called Windows Image Acquisition WIA provided by an interface program is launched. For example when an image input device is connected to a computer using USB the OS detects that connection and notifies the WIA service of the detection of connection. Upon reception of the notification the WIA service loads a control program corresponding to the connected image input device thus rendering the image input device ready to use. This service is known as plug and play.

Also image input devices are used by connecting them to computers via a network such as Ethernet or the like. When an image input device is connected to a computer via a network the OS has no function of detecting that connection and notifying the WIA service of the detection of connection like plug and play upon connection of the image input device. Therefore if the image input device is not connected or the power supply of the image input device is not turned on at the activation timing of the OS that image input device cannot be recognized unless the OS is restarted.

To solve this problem a technique which uses a dedicated resident program for monitoring detection of a network connection Japanese Patent Laid Open No. 2004 240490 and a technique which uses a dedicated device for detecting a network connection Japanese Patent Laid Open No. 05 327715 have been proposed. These dedicated resident program and device notify the WIA service of the network connection of the image input device. Upon reception of the notification the WIA service loads a control program corresponding to the image input device thus rendering the image input device ready to use. However the dedicated resident program or device for monitoring detection of a network connection is additionally required.

The present invention provides a method of allowing the use of an image input device connected after the OS activation timing without using a dedicated resident program or a dedicated device used to monitor detection of a network connection. To this end the present invention provides a method of supporting by a computer a peripheral device connected to the computer installed with an OS operating system via a network comprising the steps of 

notifying when the program for controlling the peripheral device is activated the OS of information indicating that the peripheral device is connected irrespective of connection non connection between the peripheral device and the computer 

confirming when the program for controlling the peripheral device receives a command for activating the peripheral device the connection non connection between the peripheral device and the computer 

controlling when the connection is confirmed in the step of confirming the peripheral device to activate.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

Preferred embodiments of the present invention will be described in detail hereinafter with reference to the accompanying drawings.

A schematic arrangement of a general host PC used in control of a scanner as an image input device will be briefly described below with reference to .

The host PC includes a ROM read only memory RAM random access memory central processing unit disk device bus I F I F and external storage device . The disk device holds an OS Operating System and scanner control program. The ROM stores a program of a basic I O system BIOS . The OS is loaded onto the RAM and programs such as the scanner control program and the like are also loaded onto the RAM . The RAM provides a storage area and work area required to operate the control program. The central processing unit executes processing according to the programs held on the RAM . The bus interconnects the aforementioned components and allows data exchange among the components. The I F interface is used to make communications with the scanner and is implemented by a USB interface in this embodiment. The I F connects an input unit such as a mouse keyboard and the like. The external storage device is used to drive external storage media such as a floppy disk CD ROM compact disc read only memory and the like. When the programs are stored in advance in external storage media in place of the RAM the external storage device reads out and downloads them. Reference numeral denotes an interface for a network connection which uses an Ethernet network using a TCP IP Transmission Control Protocol Internet Protocol protocol. Using this interface a network connection with the scanner is established. Monitor is a display apparatus such as a LCD device or a CRT cathode ray tube .

The imaging application issues an image scan request to the WIA service while designating scan setting information in the scanner via an image acquisition application programming interface API . Note that the setting information is scan information such as document type color settings document size resolution and the like. The WIA service sends the scan request to a USB connected scanner to a WIA scanner control program B for USB and sends an image scan request to a LAN connected scanner to the WIA scanner control program A for LAN. The WIA scanner control programs A and B respectively send scan settings to Low Level Drivers A and B using scanner commands unique to the scanner. The Low Level Driver A sends the scan command to a Port Monitor which monitors a LAN port. The Port Monitor sends the scan command to the scanner via a Winsock as a kernel I O for LAN. The Low Level Driver B sends the scan command to the scanner via Usbscan.sys as a kernel I O for USB. The scanner scans an image according to the received scan commands.

The installation operation of the WIA scanner control program A and Port Monitor will be described below with reference to . The installation operation is done when the user activates an installation program . Assume that the installation program is stored in a CD ROM. However the installation program may be downloaded in advance from a server or the like which supplies control programs on the network.

The installation program has a WIA scanner control program Port Monitor and INF information file . The INF file records the copy destination of the WIA scanner control program registry information and the like and the installation program executes installation based on these pieces of information. Upon launching the installation program the program copies a file of the WIA scanner control program onto the OS S . The program then copies the INF file to a folder windows system inf using an API named SetupCopyOEMInf S . The program installs the copy of the WIA scanner control program using an API named DiInstallDevice and the like as the WIA scanner control program A to be referred to as class installation hereinafter S . In this manner the WIA service is set to always load the class installed WIA scanner control program A upon activation.

The installation program displays a message that prompts the user to connect the scanner using a LAN or USB cable S . The user connects the scanner using a cable according to this message. The installation program detects the connected cable and branches according to the detected type of cable S .

If the scanner and PC are connected using a LAN cable S the installation program sets up the Port Monitor S . In this case the program copies the Port Monitor onto the OS and describes information the file name of the WIA scanner control program MAC address installed directory and the like of the scanner in a registry.

If the scanner and PC are connected using the USB cable S the installation program quits. The WINDOWS OS has a scheme for automatically class installing a control program of a USB connected device. Hence after step S the OS installs the WIA scanner control program B for USB depending on the description of the INF file . In this case the WIA service loads the WIA scanner control program B for USB only when the scanner and PC are connected.

The operation of the WIA scanner control program A loaded by the WIA service after installation will be described below with reference to B and .

Even when the scanner and PC are not connected using the LAN and USB interfaces the WIA service loads the WIA scanner control program A for LAN upon activation of the service . When the scanner and PC are connected via the USB interface the WIA service further loads the WIA scanner control program B for USB .

Upon activation of the WIA service in the state of the WIA service loads the WIA scanner control program A S . The loaded WIA scanner control program A loads the Low Level Driver to execute scanner operation preparation processing S . The Low Level Driver seeks connection confirmation from the Port Monitor S which seeks connection confirmation from the Winsock S . The Winsock searches for the scanner S . If the scanner is not connected to the PC the Winsock returns a connection error to the Port Monitor S Hence the Port Monitor returns an error to the Low Level Driver S . The Low Level Driver returns an error to the WIA scanner control program S . The WIA scanner control program has failed the scanner operation preparation processing but returns a success operation preparation completion response to the WIA service S . Hence the WIA service recognizes the scanner as operation preparation completion.

The WIA scanner control program A may notify the WIA service of a success operation preparation completion S immediately after step S. The processing operation for a scan command issued to the scanner connected via the LAN will be described below with reference to . This is the case when the user activates the scanner from the imaging application and instructs it to scan an image.

The imaging application notifies the WIA service of scan setting information and a scan request S . The WIA service sends the scan setting information and scan request to the WIA scanner control program A S .

The WIA scanner control program A does not promptly start a scan operation but starts a scan operation after the operation preparation processing. The WIA scanner control program A loads the Low Level Driver to execute the scanner operation preparation processing S . Furthermore the Low Level Driver seeks connection confirmation from the Port Monitor S which seeks connection confirmation from the Winsock S .

The Winsock searches for the scanner S and notifies the Port Monitor of the result whether the scanner is in a connected or non connected state S . If the notification result from the Winsock indicates the connected state the Port Monitor notifies the Low Level Driver of a success if it indicates non connected state the Port Monitor notifies the Low Level Driver of an error S . If the notification result from the Port Monitor indicates a success the Low Level Driver notifies the WIA scanner control program A of a success if it indicates an error the Low Level Driver notifies the WIA scanner control program A of the error S . If the notification result from the Low Level Driver indicates a success the WIA scanner control program A sends a scan start request to the Low Level Driver S . If the notification result from the Low Level Driver indicates an error the WIA scanner control program A notifies the WIA service of the error and the WIA service cancels the scan request.

If the scanner is in the connected state the Low Level Driver which received the scan start request sends the scan start request to the Port Monitor S . The Port Monitor sends the scan start request to the Winsock S which sends a scan start command to the scanner S . The scanner scans an image according to the command and scanner status information and scanned image data from the scanner are sent to the WIA scanner control program A following the aforementioned path in the reverse direction. The scanned image data is sent to the imaging application after it is processed by the WIA scanner control program A .

When the image input device is connected to the PC via the USB interface that allows the OS to notify the interface program of the connection the processing can be done according to the conventional plug and play function.

Note that the WIA scanner control program A is activated after the WIA service is activated upon activation of the OS. Alternatively activation means of that program may be additionally provided. By activating the WIA scanner control program A it can send information indicating the connection of the scanner to the OS. While the OS recognizes the scanner connection a scanner command can be issued. That is the user need only activate the WIA scanner control program A after he or she uses the scanner.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

