---

title: DHCP-based security policy enforcement system
abstract: A plug-in module of a DHCP server enforces a security policy of a computer network. The module receives a request to provide an IP address for an end-user computer. A blacklist database is consulted to determine if the computer is not in compliance with the policy. If not compliant, the module returns to the computer a special IP address, a special default gateway and a lease time; the special IP address places the computer in a restricted network segment of the network where it cannot send network packets to other computers. If compliant, the computer receives an IP address and a lease time. The first time an IP address is requested a probe is triggered to determine if the computer is compliant using software not present on the computer. A cleanup service located in the restricted segment remove malware and updates software. Lease times increase after each successful request of an IP address.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08312270&OS=08312270&RS=08312270
owner: Trend Micro, Inc.
number: 08312270
owner_city: Tokyo
owner_country: JP
publication_date: 20071217
---
The present invention relates generally to implementing a security policy on a computer to combat computer viruses. More specifically the present invention relates to using the Dynamic Host Configuration Protocol DHCP to enforce such a security policy.

One important job for an information technology department in a corporation or other entity is to enforce a given security policy or policies concerning user s computers. In many cases a security policy requires that each client computer having access to a computer network comply with certain requirements designed to combat computer malware such as viruses worms etc. Enforcement of a security policy within a computer network is a critical part of computer security.

Computer networks can be found most anywhere from corporations government and education to individual s homes. Because it can be easy to join a computer network any virus infected computer joining the network can potentially spread the virus to any computer or device on the network. And the user of the computer might not even be aware that his or her computer is infected. As such most computer networks follow a simple routine when a new computer attempts to join the network. Assuming that the network implements a particular security policy a new computer attempting to join the network is first investigated to see whether it complies with the security policy or not. If not the new computer may be denied access to the network may be redirected to a different network or may only be allowed access to the network for a very short period of time.

Unfortunately many existing systems designed to enforce network security policies require installation of software on the client computer or steps to be performed on the client computer as part of the enforcement. These systems require interaction between the client computer and the network which can be complex expensive and time consuming. For example U.S. patent publication No. US 2004 0103310 describes a technique for enforcing a security policy but requires that a separate software module be present on each client computer in order to determine whether the client computer is in compliance with the security policy. Further this technique also requires a separate DHCP proxy server separate from the actual DHCP server.

Other techniques require changes to the switch or router used by a particular client computer which can be disruptive. In addition while a particular enforcement technique might insure that a client computer is in compliance with the security policy when the client computer first joins the network the client computer might fall out of compliance some time after joining the network and then be infected by a computer virus thus putting the computer network at risk.

A technique is desired that would allow a computer network to constantly enforce a security policy on its various client computers without requiring additional modifications to each client computer or to the network.

To achieve the foregoing and in accordance with the purpose of the present invention a DHCP based security policy enforcement technique is disclosed that enforces a security policy within a computer network.

The present invention uses DHCP to constantly enforce a particular security policy on any number of client computers within a network. No modifications to the client computers are required and no change to any switches or routers in the network are required. A software plug in module to the DHCP server is arranged to modify connection parameters depending upon whether the client computer is following the security policy or not. No additional computer hardware is required and no physical changes to switches routers or other are required in order to quarantine a particular computer that is not in compliance with the security policy. A computer may be quarantined simply by providing a special IP address. In a particular embodiment the plug in module provides a special IP address a new default gateway and thus a restricted network segment to the noncompliant computer in order to quarantine it. Because the computer is now in a restricted network segment it is only allowed to route network packets to other computers in that segment for example computers hosting applications to assist with compliance.

In addition no special software is required to be present on each client computer in the network. Normal users that are in compliance with a security policy would not notice any changes and are allowed to continue working normally. Computers that are not in compliance are flagged relatively quickly and are immediately quarantined such that they cannot spread any malware to other computers on the network.

One useful protocol used in computer networks is the Dynamic Host Configuration Protocol DHCP . The DHCP is a set of rules used by a computer in a network to allow the device to request and obtain an IP address from a server having a list of such addresses available for assignment. The protocol is used by these networked computers to obtain IP addresses and other parameters such as the default gateway subnet mask and IP addresses of DNS servers from a DHCP server. The DHCP server ensures that all given IP addresses are unique in other words no IP address is assigned to a second computer while another computer is still using the address.

In general a DHCP server implementing DHCP automates the assignment of IP addresses subnet masks a default gateway and other IP parameters. When a client computer requests access to a network the client computer sends a query requesting necessary information from a DHCP server. The DHCP server manages a pool of IP addresses and other parameters such as the default gateway the domain name the DNS servers timeservers etc. If successful the DHCP server replies to the client computer with an IP address the subnet mask a default gateway and other information such as a DNS server.

DHCP provides three techniques for allocating IP addresses. The first mode is automatic in which a particular IP address is permanently assigned to a client computer from a range of IP addresses available in the network. The second is manual in which the IP address is selected at the client computer and then DHCP protocol messages are used to inform the DHCP server that the address has been so allocated. The most commonly used technique is dynamic allocation which provides for the reuse of IP addresses. The computer network has available a range of IP addresses and each client computer is configured to request an IP address from the DHCP server when the client computer first requests access to the network. If successful the client computer is provided a quote lease on an IP address for a particular period of time. The period of time could range from hours to months. Before the lease expires the client computer requests renewal of the current IP address. If the lease expires the client computer must request a new IP address from the DHCP server.

The present invention recognizes that knowledge and use of the Dynamic Host Configuration Protocol may be used to perform security policy enforcement on client computers in a network. By providing a plug in software module to an existing DHCP server an embodiment of the invention is able to change various DHCP parameters according to whether or not the client computer is following the desired security policy. These parameters that may be changed include IP address lease time the default gateway the default DNS servers subnet mask etc.

In general when computer starts up restarts reboots or attempts to connect to the network it will request an IP address from DHCP server e.g. using a broadcast UDP packet . Typically DHCP operations include an IP lease discover request and IP lease offer IP lease request and IP lease acknowledgment. Once the DHCP server receives the lease discover request from computer it extends and IP lease offer. The offer is a message to the computer including the computer s MAC address the IP address being offered the subnet mask the lease duration the IP address of a default gateway and the IP address of the DHCP server making the offer. Typically the default lease time is three days. If the DHCP server is implementing a cache it is possible that a computer restarting may receive the same IP address. Once the offer is received computer sends a message including the IP address of the server making the offer. When this message is received by DHCP server it initiates the final phase of the configuration process by sending an acknowledgment packet back to computer . The packet includes the lease duration and other configuration information. Computer may then use the IP address and the computer network and Internet until the lease time expires. Typically the computer will request a renewal of the lease before it expires.

As is known in the art a plug in module is a computer program that interacts with a host application such as the DHCP server to provide a specific function. Plug ins enable third party developers to create capabilities to extend an application to support features yet unforeseen to reduce the size of an application and to separate source code from an application. The host application provides services that a plug in can use including a way for the plug in to register itself with the host application and a protocol by which data is exchanged with the plug in. A plug in is dependent on these services provided by the host application and does not usually work by itself. Conversely the host application is independent of the plug in making it possible for a plug in to be added and updated dynamically without changes to the host application. An open application programming interface typically provides a standard interface allowing third parties to create plug ins that interact with the host application. In another embodiment DHCP server uses an application programming interface API to make a call to a third party software application in order to implement the below describe functionality. Some DHCP servers may not provide an API to let a third party add plug ins. In that situation though the present invention uses a network driver as a plug in to intercept network traffic in the DHCP server.

One of skill in the art will appreciate that other techniques similar to the plug in module loadable module may also be used to implement the below describe functionality. For example module may take the form of an extension or add on software. Or the operating system runs the DHCP server and runs the loadable module. For ease of explanation the below description assumes that a plug in module is used. This module may be written in a programming language such as C or C .

In a first step computer starts up or otherwise attempts to connect to the network and requests an IP address from DHCP server . Plug in module intercepts this request or is asked by the DHCP server to become involved in the request and directs the DHCP server to reply to computer with an IP address an IP address of a default gateway and a short lease time for example three minutes in addition to other information provided to computer . Any other suitable short lease time may be used such as on the order of seconds minutes or hours although is preferable to use a lease time of a few minutes. The lease time may be set by an IT administrator having access to DHCP server . The lease time is the time allowed for the policy checking module to probe computer . Typically the lease time depends on the network traffic load and the startup time of computer in order to be ready for the probe. In a modern computer and network three minutes are typically enough. But some slower computer and networks may take longer and therefore a longer lease time is appropriate.

Next plug in module notifies policy checking module via communication that it should perform a security policy check of computer . Module knows the identity of computer because of its previous request and transmits this identification information such as the computer s MAC address to policy checking module . Module then probes computer via link to see if the computer is following the current security policy. Module is a software module that may be hosted on any computer in the network and need not be hosted directly on each and every end user computer in the network.

As is known in the art computer networks use special application software designed to check if a computer is in compliance with the security policy or to check for vulnerabilities of a client computer. For example the software product Network VirusWall available from Trend Micro Inc. of Cupertino Calif. controls network access by ensuring that devices managed or unmanaged local or remote comply with corporate security policies before they can access the network. Other examples of policy checking software that checks for vulnerabilities or that checks for compliance include Network Security Risk Assessment from eEye Digital Security.

A security policy for a given computer network may include many different components. For example the policy may require that certain antivirus software applications be installed and that these applications be kept up to date. Also the policy may require that the computer s operating system be updated to the latest version and that any security patches be installed or that special encryption software be used. Other examples of components of a security policy include Data Leakage Prevention software backup recovery software or VPN Virtual Private Network software.

If it is determined that a computer is infected with a computer virus worm or other malware an automatic determination of not in compliance is made even if the computer is otherwise implementing the current security policy. The advantage of making this automatic determination is that an infected computer will immediately be placed on the blacklist and will be quarantined the next time it asks for an IP address. In addition antivirus software or the policy checking module may unilaterally remove an infected computer from the network or isolate it in some fashion. Once the probe is complete policy checking module has reached a determination as to whether computer is in compliance with the current security policy of computer network .

The plug in module may direct that the noncompliant computer be quarantined removed from the network or restricted in many different ways. For example the DHCP returns a special subnet mask or non reachable default gateway to the computer thus effectively removing the computer from the network. As is known in the art a gateway is a hardware appliance or box such as a switch. In a preferred embodiment the DHCP server via the plug in module returns a special gateway address to the noncompliant computer thus effectively placing that computer in a restricted network.

In this simple example the only other device on this restricted network is computer which provides remedies for noncompliant computers such as access to the required antivirus software and updates and operating system updates and patches. Depending upon the implementation of switch computer might have access to the Internet but not the rest of network . As is known in the art switches and and DHCP server are arranged to prevent computer from accessing the rest of the network such as computers or . Any attempt by computer to access another computer on the network will be blocked by switch . As shown switch connects to switch . Thus all traffic from computer must go through switch . The network administrator will have configured switch to be reachable from all computers that might possibly need to be quarantined. Preferably computer receives both a different gateway and a different IP address in order to be quarantined.

In step a computer such as computer requests an IP address from DHCP server . The request may be due to the computer restarting joining the network renewing a lease or transferring from a different network etc. Plug in module intercepts this request and updates the running total in the number of times database reflecting how many times this computer has requested an IP address . In step the plug in module checks blacklist and receives an indication via link as to whether that computer is present in the blacklist. If so in step the plug in module instructs the DHCP server to return to the computer a special quarantine IP address such as 5.5.5.5 a special quarantine subnet mask if needed and a relatively long lease time. For example a lease time on the order of days e.g. three days is provided to reduce overhead in the network and to allow the computer to perform remedial actions until it comes into compliance. Once the computer receives its quarantine IP address it will not be able to access the rest of the network and preferably will only be able to access a device such as computer that includes resources for coming into compliance with the security policy.

Assuming though that in step the plug in module determines that the requesting computer is not on the blacklist then in step the plug in module determines using the number of times database how many times has this computer now asked for an IP address. If this is the first time that this computer has requested an IP address then in step the plug in module instructs the DHCP server to return to the requesting computer a normal IP address a normal subnet mask if needed and a relatively short lease time LT. Preferably this lease time LT given out for first time requests is the shortest lease time given out and is on the order of a few minutes for example anywhere from one minute to ten minutes preferably about three minutes.

At the same time the plug in module triggers a probe and directs the policy checking module to probe the requesting computer to see if it is following the current security policy. If the policy checking module determines that the requesting computer is not in compliance then an identification of this computer is added to the blacklist via update . If the computer is in compliance then no action is taken. The advantage of providing at least a lease time of a few minutes while still keeping the lease time under ten minutes for example is that while the user is allowed to get on the network initially upon startup for example and perform some work a probe of his or her computer occurs very quickly. If the computer is not in compliance or is infected it can be placed on the blacklist and removed from the network within a few minutes. Alternatively an infected computer may be immediately removed from the network by antivirus software or by the policy checking module.

On the other hand if this is the second or greater time that this computer has come asking for an IP address then in step the computer also receives a normal IP address a normal subnet mask if needed and a lease time greater than or equal to the previous lease time second time receives a lease time of LT third time receives a lease time of LT etc. . A probe is preferably not conducted of the requesting computer by policy checking module for the second or greater request.

On the Nth time that a requesting computer asks for an IP address in step the usual information is returned and again no probe is triggered. In addition the database that keeps track of how many times this computer has requested an IP address is reset to zero i.e. the running total is set to zero . Thus the next time that this computer requests an IP address it will be considered the first time and a probe will be triggered in step . In one embodiment N is set equal to a value such as three or four such that on the third or fourth time through the running total is reset to zero such that the next time through a probe will be triggered. Of course N may have any suitable integer value.

Cleanup service is any suitable cleanup software application or other application that assists a blacklisted computer in complying with a security policy. For example a product such as HouseCall available from Trend Micro may be used. HouseCall is an application that checks whether a computer has been infected by viruses spyware or other malware. HouseCall performs additional security checks to identify and fix vulnerabilities to prevent reinfection of a computer. Or a product such as Damage Cleanup Services DCS also available from Trend Micro can restore infected client computers to full operational health. DCS removes spyware root kits worms virus remnants and Trojan horses. DCS also repairs system registries and memory. Examples of other cleanup services include FreeScan from McAfee and Free Virus Scan from Kaspersky Lab.

Such a cleanup service may be located on the Internet and may clean a quarantined computer remotely or cleanup service may be located within a company network such as on computer . Computer is preferably in the same network segment as any blacklisted computer i.e. noncompliant computers are given a quarantined IP address that places them in the same network segment as computer hosting the cleanup service . The cleanup service may be invoked automatically upon direction of the plug in module when a noncompliant computer is first given a quarantined IP address may be invoked periodically to scan any computers in its network segment or maybe invoked manually by the user of the noncompliant computer. Cleanup service via link then performs a scan search or other analysis of the noncompliant computer in order to identify and remove any malware identify antivirus updates or operating system patches needed perform any updates needed and otherwise cleans and ensures that the subject computer is now in compliance with any security policy of the network .

If the subject computer cannot be brought into compliance then the cleanup service generates an alert in the form of an e mail message pop up window status reports printout or other indicating to the user or system administrator that the computer is not in compliance. If however the computer is brought into compliance with the security policy computer updates blacklist in order to remove the identification of that newly complying computer and instructs the computer to request a new IP address from DHCP server . Because the computer is no longer on the blacklist when it requests a new IP address it then should be given a normal IP address. Preferably the cleanup service also resets the number of times running total for this computer back to zero.

As mentioned above plug in module to may be implemented in different fashions. In one particular embodiment the plug in module is able to intercept or otherwise monitor DHCP requests from a client computer can access database to determine if a computer is on the blacklist and to determine how many times the computer has asked for an IP address and can accept other suitable input. In terms of output the plug in module is arranged to provide DHCP configuration parameters to a requesting computer such as an IP address an IP address of a default gateway a subnet mask and a lease time. If the computer is on the blacklist the plug in module would provide a quarantined IP address a quarantined subnet mask and different default gateway. In addition the plug in module is arranged to trigger a probe of a requesting computer via the policy checking module and is also able to reset the running total of the number of times the computer has requested an IP address. The plug in module may also direct cleanup service to scan a computer that has been placed on the blacklist. An administrator may also change parameters of the plug in module for example the quarantine IP address range the default gateway lease time etc.

In a specific embodiment the plug in module provides the following default lease times to requesting computers. For the first request the lease time is three minutes thereafter the lease time is doubled until the lease time reaches three days. Of course lease time is a configurable parameter and depends on administrator settings. Other values may be used. For example upon the first request the computer receives a lease time of 30 seconds upon the second request it receives a lease time of 1 minute the third time it receives 3 minutes the fourth time it receives 10 minutes and the fifth and any subsequent times it receives a lease time of 3 days.

As described above blacklist database includes not only identifying information for each noncompliant computer but also a running total of how many times each computer has requested an IP address of the DHCP server. Database has an interface with policy checking module and allows that module to add identifying information for a noncompliant computer such as that computer s IP address and its MAC address. An interface with cleanup service allows the cleanup service to remove an entry for a particular computer from the blacklist once the computer is in compliance. Plug in module has an interface with the blacklist that allows the plug in to read identifying information for each computer and to read or update the number of times running total for each computer.

CPU is also coupled to a variety of input output devices such as display keyboard mouse and speakers . In general an input output device may be any of video displays track balls mice keyboards microphones touch sensitive displays transducer card readers magnetic or paper tape readers tablets styluses voice or handwriting recognizers biometrics readers or other computers. CPU optionally may be coupled to another computer or telecommunications network using network interface . With such a network interface it is contemplated that the CPU might receive information from the network or might output information to the network in the course of performing the above described method steps. Furthermore method embodiments of the present invention may execute solely upon CPU or may execute over a network such as the Internet in conjunction with a remote CPU that shares a portion of the processing.

In addition embodiments of the present invention further relate to computer storage products with a computer readable medium that have computer code thereon for performing various computer implemented operations. The media and computer code may be those specially designed and constructed for the purposes of the present invention or they may be of the kind well known and available to those having skill in the computer software arts. Examples of computer readable media include but are not limited to magnetic media such as hard disks floppy disks and magnetic tape optical media such as CD ROMs and holographic devices magneto optical media such as floptical disks and hardware devices that are specially configured to store and execute program code such as application specific integrated circuits ASICs programmable logic devices PLDs and ROM and RAM devices. Examples of computer code include machine code such as produced by a compiler and files containing higher level code that are executed by a computer using an interpreter.

Although the foregoing invention has been described in some detail for purposes of clarity of understanding it will be apparent that certain changes and modifications may be practiced within the scope of the appended claims. Therefore the described embodiments should be taken as illustrative and not restrictive and the invention should not be limited to the details given herein but should be defined by the following claims and their full scope of equivalents.

