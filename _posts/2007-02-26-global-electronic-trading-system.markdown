---

title: Global electronic trading system
abstract: Methods, systems, and computer readable media for facilitating trading two items (L,Q) from the group of items comprising commodities and financial instruments. At least two agents () want to trade the items (L,Q). There is a trading channel () between the two agents () allowing for the execution of trades. There are flow (trading) limits on the items being traded. A central computer () is coupled to the two agents (). Said computer () is adapted to convey to each agent () current tradable bid and offered prices and sizes subject to the agent's () trading limits.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07895118&OS=07895118&RS=07895118
owner: Scale Semiconductor FLG, L.L.C.
number: 07895118
owner_city: Wilmington
owner_country: US
publication_date: 20070226
---
This application is a continuation of U.S. patent application Ser. No. 10 005 609 entitled GLOBAL ELECTRONIC TRADING SYSTEM filed Nov. 7 2001 which itself claims priority to U.S. provisional patent application Ser. No. 60 249 796 entitled GLOBAL B2B FINANCIAL SERVICES PLATFORM ENABLING FOREIGN EXCHANGE REVERSE AUCTIONS AND A UNIVERSAL PORTAL FOR NEXT GENERATION ELECTRONIC EXECUTION filed Nov. 17 2000 and U.S. provisional patent application Ser. No. 60 288 310 entitled DIRECT C2C FOREIGN EXCHANGE REVERSE AUCTIONS FOREXSTER filed May 2 2001. The above recited applications are hereby incorporated by reference in their entireties into the present continuation patent application.

This invention pertains to the field of global electronic trading of commodities and financial instruments.

Currently hundreds of billions of dollars are exchanged among banks governments and institutions in the foreign exchange fx markets each day. The mechanisms used in these markets have lagged behind the Internet revolution however. These market mechanisms in addition to operating on aging private network and telephone based technologies also restrict participation in these markets by entities that are not part of the interbank network. When an entity without access to the interbank network e.g. an individual or hedge fund currently wishes to make a currency trade that entity is only able to execute the trade through the limited set of banks with whom it has established credit facilities as banks are concerned with counterparty risk especially with the large size of typical over the counter fx trades.

Furthermore because prices in the fx markets change rapidly bids and offers quoted to clients over the telephone by their banks are firm only for a very limited amount of time. In order to get the best possible price the client has to poll as many banks as it has credit lines with. While expensive private networks such as Reuters provide bid offer quotes from several dozen contributing banks these quotes are merely indicative of the current bid and offer prices and thus are not firm bids or offers. Also the quotes provided by these services have been shown to lag the market.

Still other factors affect fx market efficiency. Banks have little incentive to continue to do business with a client who calls for quotes frequently but rarely makes the trade. Thus clients may feel the need to farm out trades by executing suboptimal trades in order to keep in good standing with their banks.

Instead of being concerned solely with market movements an fx market participant must therefore contend with 1 obtaining timely quotes 2 establishing credit lines in order to expand the number of banks with which to seek the best bid offer prices and 3 the politics of counterparty relationships.

Wright Ben Unlocking the C2C forex riddle euromoney.com Jul. 25 2001 U.K. provides a general discussion of some of the business aspects of the present invention.

Morris Jennifer Forex goes into future shock Oct. 2001 gives a general description of several computerized foreign exchange platforms including one described in the present patent application.

Ahuja R. K. Magnanti T. L. and Orlin J. B. Chapters 7 and 9 Prentice Hall Inc. 1993 U.S.A. sets forth some algorithms that may be useful in implementing the present invention.

U.S. Pat. No. 5 375 055 discloses a relatively simple trading system that is capable of implementing only single hop trades. On the other hand the present invention can accommodate multi hop trades. Further in U.S. Pat. No. 5 375 055 the user is given information that suggests to him that he can take a trade when he may not have enough credit to take the whole trade. In the present invention on the other hand if only part of a trade can be executed that information is given to the user the user knows that he has enough credit to execute at least the best bid and best offer that are displayed on his computer.

An even simpler trading system is disclosed in European patent application 0 411 748 A2 and in granted European patents 0 399 850 B1 and 0 407 026 B1 all three of which are assigned to Reuters Limited. These Reuters documents describe a system in which information concerning a potential trade is displayed even if the user can t execute it at all. In the present invention such a potential trade would not be displayed at all. Furthermore the only credit limits that can be accommodated in the Reuters system are volume limits for the purposes of limiting settlement risk. In the present invention any agent may set credit limits in multiple ways so as to limit not only settlement risk measured both by individual instrument volumes and by notional absolute values but also exposure risk. Furthermore the Reuters keystations require a human operator. In the present invention on the other hand an API application programming interface enables any participant to develop programs which partially or fully automate the trading process.

Methods systems and computer readable media for facilitating trading two items L Q from the group of items comprising commodities and financial instruments. At least two agents want to trade some instrument L at some price quoted in terms of another instrument Q. The exchange of L and Q is itself a financial instrument which is referred to as a traded instrument. A trading channel between the two agents allows for the execution of trades. Associated with each channel are trading limits configured by the two agents in order to limit risk. A central computer coupled to the two agents is adapted to convey to each agent current tradable prices and available volumes for the exchange of L for Q and for the exchange of Q for L taking into account the channel trading limits. The central computer facilitates trades that occur across a single trading channel and trades that require the utilization of multiple trading channels .

The proposed system will enable entities such as corporations hedge funds and smaller dealers to make orders by price for currencies other over the counter fx derivative products and other financial instruments. The system permits the use of a special purpose limit order book designed for over the counter transactions between specific parties. As opposed to market orders in which an entity wishing to buy or sell does so with the lowest offer or highest bid on the book at the moment a limit order allows an entity to specify a price and quantity to be added to the book this limit order remains on the book until it expires or until another entity decides to act on the limit order. The system may help turn the tables in favor of clients by enabling their orders to be instantly displayed by price to parties subscribing to the system including banks . Such a system thus has the effect of creating greater price transparency.

The present invention enables an arbitrary number of agents of arbitrary type such as corporate treasuries hedge funds mutual funds and other collective investment schemes banks and other financial institutions and other institutions or persons to trade commodities and financial instrument pairs directly amongst each other thus facilitating client to client or C2C trading by making orders to their peers to buy and sell the traded instrument pairs over credit atomic units and credit molecules .

By way of example the application highlighted most often herein is the spot foreign exchange spot FX market but it must be understood that the present invention has applicability to trading in any type of over the counter commodity or financial instrument including physical commodities energy products oil gas electricity insurance and reinsurance products debt instruments other foreign exchange products swaps and compound instruments and other derivatives composed or derived from these instruments.

A trade is the exchange of a lot of instrument L for a quoted instrument Q. The lot instrument L is traded in an integral multiple of a fixed quantity referred to as the lot size. The quoted instrument Q is traded in a quantity determined by the quantity of the lot instrument L and the price. The price is expressed as Q per L. In a spot FX trade the lot instrument L and the quoted instrument Q are implicit contracts for delivery of a currency on the spot date typically two business days after the trade date .

In the present specification and claims entities that wish to trade with each other are referred to as agents . Agents that extend credit to other agents are referred to as credit extending agents . Agents that do not extend credit to other agents are referred to as clients or non credit extending agents .

Two agents may have direct trading channels between them where the trading channels correspond to credit extended from one credit extending agent typically a bank financial institution or any clearing entity to the other agent . Trading channels are typically secured via placement of collateral margin or other form of trust by an agent with the credit extending agent . Typically trading channels amongst credit extending agents and non credit extending agents already exist. In the spot FX market these trading channels are referred to as trading accounts. In the case that two credit extending agents have a trading channel between them only one agent acts in a credit extending capacity with regards to that trading channel .

Credit extending agents that allow the central computer to utilize a portion of their trading channels to allow other agents to trade with each other are referred to as credit bridging agents . In a preferred implementation of the present system existing banks financial institutions and clearing entities are credit bridging agents as well as credit extending agents and existing trading customers of those institutions are clients .

The proposed system allows two entities to trade with one over a currently unexhausted credit path connecting them via one or more credit bridging entities. On the other hand two entities cannot trade with one another at a given point in time over a credit path if that credit path is exhausted. For example a first entity wishing to trade with a second entity via a third credit bridging entity may have used up all of its available credit with the third entity during some current predetermined time period precluding a trade. Still further the third entity may currently forbid any credit bridging between the first and second entities again precluding a trade. One embodiment of the proposed system thus uses information regarding pre existing credit relationships between entities and current values indicating whether credit bridging entities are currently permitting or forbidding credit bridging between entities in order to facilitate trading amongst entities over indirect credit paths including trades between non credit extending entities.

In another embodiment the proposed system facilitates trading by using a clearing facility to ensure that trades between entities including non credit extending entities are honored. The clearing facility may be independent of the proposed system. Still further the proposed system may provide a choice of a plurality of clearing facilities.

Compared with prior art systems the present invention gives a relative advantage to clients compared to credit extending agents by enabling one way or two way orders from any agent to be instantly displayed to all subscribing agents enabling a trade to take place at a better price with high likelihood than the price available to clients under prior art systems. The present invention brings together clients who may be naturally on opposing sides of a trade without conventional spreads historically charged to them by credit extending agents for their service as middlemen. Of course credit extending agents also benefit on occasions when they are natural sellers or buyers.

Unlike prior art systems the present invention arranges multi hop deals to match orders between natural buyers and sellers who need not have a direct trading relationship. For the application to spot FX trading a multi hop deal can be realized through real or virtual back to back trades by one or more credit bridging agents . In terms of the underlying transfers of financial instruments a multi hop deal is similar to the existing practice of trade give ups from one broker to another.

Unlike prior art systems the present invention computes trading limits from not only cumulative volume but also from net position limits where both volume and position limits may be set in terms of the traded instrument instrument L for instrument Q in terms of any underlying instruments to be exchanged delivered upon settlement such as L individually Q individually or other instruments or in terms of the notional valuations of such instruments. This allows all agents especially credit bridging agents to control risk far more flexibly. Limiting traded or delivered instruments cumulative volume helps to manage settlement risk. Limiting a traded instrument s net position net L Q position helps to manage market risk. Limiting a delivered underlying instrument s net position total net L total net Q or some other underlying instrument s position helps manage market and credit risk by reflecting the ultimate effect of any trade on any account s future balance sheet. The cumulative volume limits allowed by prior art systems are able to address only settlement risk concerns.

The present invention has a natural symmetry in the preferred implementation not only are credit bridging agents financial institutions able to operate as market makers and post one way just a bid or ask and two way both bid and ask prices to agents but clients may post one way and two way prices to credit bridging agents and other clients of any other credit extending or credit bridging agent . This symmetry is not present in prior art trading systems.

When operating as market makers using the proposed system both credit extending entities and non credit extending entities are able to post bid and offer prices to the market in general i.e. to any entity subscribing to the proposed system and having an unexhausted credit path to the market maker or to other entities in particular e.g. the set of one or more entities deemed to be acceptable by the market maker .

The ability of agents to post limit orders can coexist quite well with the existing interbank fx market. For example the proposed system allows non credit extending agents to operate as market makers while credit extending agents that take those deals would be able to move this inventory through a variety of channels. The aggregate volume from many clients fx flows provides an incentive for more credit extending entities e.g. banks to subscribe to the proposed system. The addition of more subscriber credit extending entities will likely make the bid and offer prices more competitive which in turn attracts more non credit extending entities e.g. clients .

The present invention uses a central computer to calculate trading limits to prepare custom limit order books and to match orders but all post trade bookkeeping and settlement is handled in a de centralized manner by the counterparties involved in each trade. The central computer is a network of at least one physical computer acting in a closely coordinated fashion.

Every agent subscribing to a system employing the present invention can be thought of as a node in an undirected graph . The undirected edges of such graphs indicate the existence of a trading channel account between two nodes typically an arrangement of trading privileges and limits based on the extension of credit from one node to another and likely backed by collateral placed by one node with the other . Some nodes in the graph corresponding to credit bridging agents allow credit to be bridged while other nodes are clients who permanently or temporarily forbid credit bridging. For the application to spot FX trading a credit bridging agent authorizes the central computer to initiate back to back spot trades where simultaneous trades in opposite directions at the same price are made between the credit bridging agent and two or more different agents such that the net position effect to the credit bridging agent is exactly zero.

For each trading channel account the central computer maintains a set of limits set by the credit extending agent and a set of limits set by the non credit extending agent . Either of these sets of limits may be empty. These limits specify maximums of cumulative volume of each traded instrument L Q maximum cumulative volume of an underlying instrument e.g. L Q or other maximum cumulative notional value e.g. U.S. dollar equivalent maximum positive or negative net position of each traded instrument L Q maximum positive or negative net position of the underlying instrument e.g. L Q or other and maximum absolute net position notional e.g. U.S. dollar equivalent value total.

For each trading channel account the central computer maintains information sufficient to compute the current value of all the quantities upon which limits may be placed. The cumulative volume values are reset to zero with some period typically one business day at such a time as is agreeable to both agents. It is illustrative to note that the cumulative volume values always increase toward their limit with each trade while the net position values may be decreased back to zero or near zero and may change in sign.

An agent may add remove or adjust any of the elements of the set of limits specified by that agent at any time.

Since trading is permitted or denied based on these limit related values the central computer provides a way for the agents that are parties to an account to inform the central computer of any external activity that would affect these values such as odd lot trades and trades made through existing trading devices or to simply reset all limit related values to a predefined state.

Based on the current values of all these limit related quantities the central computer computes for each traded instrument L Q a directed graph of maximum excursions. In the directed graph for each traded instrument L Q each directed edge from a node to another node has a value that indicates based on the current position how many of the traded instrument L Q may be bought by the first node from the second node . There are typically directed edges in both directions between any pair of nodes since the instrument L Q may be bought or sold. The trading limit values maximum excursions of these buying and selling edges between two nodes vary from moment to moment as trades are made and or credit limits are adjusted by either node .

For all traded instruments L Q and for all nodes that trade L Q and for all other nodes that trade L Q the central computer uses the directed graph of maximum excursions to compute the maximum flow from the first node to the second node . Note that this means that each pair of nodes that trade L Q will have the maximum flow between them calculated in both directions.

The prior art systems could be simulated by the present invention by first eliminating the ability of any node to be a credit bridging agent so that the single pair maximum flow is merely the flow enabled by directed edges connecting the pair of nodes directly. Second all trading limits by non credit extending agents would be disabled and only cumulative volume limits on underlying instruments would be allowed for credit extending agents corresponding to limits only on settlement risk.

For purposes of illustrating the present invention consider for example an agent A extending credit to agent B for the purposes of trading spot FX using the present invention and between the U.S. dollar USD Euro EUR and Japanese Yen JPY in particular. Suppose agent B buys 1 lot of EUR USD at 0.9250 then sells 1 lot of EUR JPY at 110.25 with both trades having agent A as counterparty . The first trade will upon settlement result in 1 000 000 EUR received by agent B and 925 000 USD paid by agent B while the second trade will result in 1 000 000 EUR paid by agent B and 110 250 000 JPY received by agent B. From the perspective of agent B the account stands 1M EUR toward the EUR USD cumulative volume limit 1M EUR toward the EUR USD net position limit 1M EUR toward the EUR JPY cumulative volume limit 1M EUR toward the EUR JPY net position limit 2M EUR toward the EUR cumulative volume limit 925 000 USD toward the USD cumulative volume limit 110 250 000 JPY toward the JPY cumulative volume limit ZERO with respect to the EUR net position limit 925 000 USD toward the USD net position limit and 110 250 000 JPY toward the JPY net position limit. Further supposing that the instrument valuations in agent B s home currency of USD are 0.9200 EUR USD and 0.009090 JPY USD then the account stands 2M 0.9200 925 000 110 250 000 0.009090 3 767 172.50 USD toward the notional USD cumulative volume limit useful for limiting settlement risk and 0 0.9200 925 000 110 250 000 0.009090 1 927 172.34 USD toward the absolute notional net position total.

Now suppose agent B buys 1 lot of USD JPY at 121.50 which upon settlement will result in 1 000 000 USD received and 121 500 000 JPY paid. The net single instrument positions are now 0 EUR 75 000 USD and 10 250 000 JPY. Rather than delivering JPY at settlement which will entail carrying a JPY debit balance in the account agent B will probably choose to arrange an odd lot deal with agent A to buy 10 250 000 JPY at a rate of for instance 121.40 USD JPY at a cost of 84 431.63 USD resulting in final account position values of 0 EUR 9 431.63 USD and 0 JPY. In other words agent B has lost 9 431.63 USD in its account with agent A once all the settlements occur.

Alternatively agent B may choose to roll forward any EUR or JPY net position from the spot date to the next value date or to any forward date by buying or selling an appropriate FX swap instrument from or to agent A.

Odd lot spot odd lot forward odd lot swap and deals with a specific counterparty are not amenable to trading via the limit order book matching system but instead may be facilitated by the central computer through a request for quote mechanism. Since the central computer knows the net positions of all the accounts it may further recommend such deals on a periodic basis such as a particular time that both agents consider to be the end of the business day for the account in question.

For the application of the present invention to markets other than spot FX triangular interactions between traded instrument pairs are not as much a concern. The limits set by credit extending agents are handled the same way where the limits on commodity holdings or currency payments are translated by the central computer into excursion limits how many lots an agent may buy or sell in real time.

The present invention can be implemented in a combination of hardware firmware and or software. The software can be written in any computer language such as C C Java etc. or in a combination of computer languages. The hardware firmware and software provide three levels of content a trade screens b post trade content for back offices and clearing units and c real time credit management content. Through an API application programming interface agents can securely monitor and change in real time the credit limits they have specified for each trading channel in which they participate. Note that the maximum flow across a trading channel is the minimum of the trading limits specified by the two agents associated with the channel so a non credit extending agent can only further reduce the credit limits assigned by the credit extending agent . 

The link between the agents and the central computer can be any telecommunications link wired wireless Internet private etc. Computer can be located anywhere in the world. It can be mirrored for purposes of data backup to increase throughput or for other reasons in that case there is a second central computer . The backup central computer is a network of at least one physical computer operating in a closely coordinated fashion. Such a backup computer is shown in and insures that there will be no interruption of service with hardware software or network failures neither during the failure nor during the needed repairs and further insures that the present invention has the ability to recover from a disaster event.

Since the present invention operates on a global scale said operation has to satisfy local laws and regulations to enable the services of the present invention to be provided. The present invention is therefore designed to enable such accommodations to be made.

The present invention supports purpose specific atomic units enabling trading between specific types of agents . The basic atomic units are type 0 type 1 and type 2 where a type 0 unit involves a single pair of agents where one extends credit to the other a type 1 unit involves a single client trading with a collection of credit extending agents and a type 2 unit involves a single credit bridging agent enabling a collection of its clients to trade with itself and with each other .

Typically but not necessarily each agent is coupled to the central computer when the agents are trading. The identification of one of the two agents as the credit extending agent is necessary only for the creation of a trading channel since either agent may post orders making the market in the same way.

The institutions may also supply via computer tradable bid and offered prices to the client that will not be seen by the other institutions .

The solid lines in represent credit relationships between client and credit extending agents . The credit extending agents may have credit relationships outside the scope of the present invention but only those trading channels whose credit limits are maintained by the central computer are illustrated or discussed. The dashed lines in represent communication links between the agents and the central computer .

As a sub species of type 1 there can be multiple clients as long as all such clients have credit relationships with the same credit extending agents and the clients are not allowed to trade with each other.

Computer provides several post trade capabilities to the client and to the financial institution s trading desk as well as to its back office and credit desk all in real time.

The clearing of the trade is done by conventional means. The operator of computer though it could does not need to act as a clearing agent and does not need to hold as collateral or in trust any financial or other instruments. The client can direct that all clearing is to be handled by a certain credit extending agent . The clearing procedures are dependent upon the instruments traded and any netting agreements or special commodity delivery procedures required for those instruments.

The type 2 atomic unit is illustrated in . Type 2 enables client to client dealing among the clients of a particular credit bridging agent as well as enabling client to credit extending agent trading. As usual the anonymous order matching process is triggered whenever an order to buy is made at a price equal to or higher than the lowest outstanding offer to sell or vice versa. If the match is between a client and the credit bridging agent then a single deal is booked between those two parties . However if the match is between two clients then two back to back deals are booked one between the seller client and the credit bridging agent and the other between the buyer client and the credit bridging agent . This is akin to creating virtual trading channels between the clients . A client who has a credit relationship with the credit bridging agent is able to post its one way or two way order via computer which causes the order to be instantly displayed to all other clients and to the credit bridging agent itself if the existing credit limits between the posting client the credit bridging agent and the receiving client would allow a portion of the order to be executed.

This mini exchange has the liquidity of the natural supply and demand of the entire client base combined with the market making liquidity that the credit bridging agent would be supplying to its clients ordinarily. It is certainly expected and beneficial to the overall liquidity that the credit bridging agent will be able to realize arbitrage profits between the prices posted by its clients and the prices available to the credit bridging agent through other sources of liquidity. In fact there may be instances in some markets where clients are also able to arbitrage against other trading systems.

Again computer provides several post trade capabilities to the client and to the trading desk the back office and the credit desk of the credit bridging agent all in real time as in type 1.

A pair of back to back trades is illustrated in showing that agents and are the ultimate buyer and seller of the deal but they each deal only with the credit bridging agent as their immediate counterparty .

As with all the various atomic units central computer updates the current tradable information after each trade and causes this information to be displayed on the computers associated with all of the subscriber agents .

Again computer provides several post trade capabilities to the clients as well as to the credit bridging agent s trading desk its back office and its credit desk all in real time. The credit bridging agent acts as a clearing agent for this trade and is able to monitor e.g. using XML the client to client exposure in real time.

Thus is created a price discovery mechanism for end users with direct transparency between entities wishing to take opposite sides in the market for a particular instrument. The present invention encompasses decentralized operation of an arbitrary number of separate type 1 and type 2 atomic units. Efficient price discovery is provided to the end user in a decentralized liquidity rich auction environment leveraging existing relationships and co existing with and indeed benefiting from traditional trading methodologies.

Furthermore an arbitrary number of different type 0 type 1 and type 2 atomic units may be interconnected bottom up as illustrated in to provide at all times a liquidity rich efficient price discovery mechanism to the subscribing agents enabling more and more agents across different atomic types to conduct efficient direct auctions with each other directly. The various atomic units may be interconnected into a molecular credit network.

In which may be considered to illustrate a type 3 scenario shaded circles represent credit bridging agents and un shaded circles represent clients .

For purposes of simplicity central computer is not shown on but is in fact coupled to all nodes . Each node has proprietary client software on a computer associated with said node enabling said node to communicate with central computer . Such software may take the form of a Web browser. The diameters of the arrow headed lines represent instrument excursion limits deduced from each trading channel s various types of credit limits. A shortest weighted paths algorithm or other minimum cost flow algorithm is used to calculate the minimal path between two agents subject to credit flows to enable a trade between the agents . The trading agents may be arbitrarily removed from one another both in geographic terms as well as by type of business activity in which they are involved.

Each connected piece of maintains full transparency of orders posted on computer to all financial institutions and clients who are on any unexhausted credit path to the posting entity . Each of the entities who are able to see the posted order are in effect competing through the reverse auction for that particular deal enabling further efficient price discovery to the posting entity .

Prior to each trade computer internally computes the values that define one of these graphs for each pair of instruments being traded. From the graph computer creates a table of multi hop trading limits showing the trading limits between each pair of nodes . From the table of multi hop trading limits computer prepares a custom limit order book for each node for each traded instrument pair. After every trade computer recalculates the trading limits thus leading to a new graph for that instrument pair. Recalculating the trading limits for a given traded instrument pair can affect the topology trading limits of other graphs for other traded instrument pairs. This can occur for example when the trading limits are notional trading limits.

On if an agent has imposed its own internal limits that are smaller than the trading limits that have been imposed by a credit extending agent that is extending it credit computer uses the smaller of the two limits when it creates .

Each trading channel represents an account between a credit extending agent and a client agent . In the preferred implementation of this invention all credit extending agents are credit bridging agents . Even when two adjacent nodes are fully qualified to be credit extending agents one acts as the credit extending agent in the transaction and the other acts as the client agent in the transaction. The accounts that exist between credit extending agents and client agents comprise specified input credit limits balance holdings and collateral computer calculates trading limits from this information.

The operator of computer typically has in its standard agreement with a subscribing agent language stating that if the agent has entered into a written subscription agreement with the operator of computer and said agent trades outside of the network operated by the operator of computer that agent is obligated to notify the operator of computer about such outside trades so that computer can recalculate the trading limits as necessary.

The network of is a non disjointed network. By that is meant that every node in the network is coupled to at least one other node and at least one of the agents associated with each trading channel is a credit bridging agent . The individual trading limits that computer computes for each agent pair are dependent upon the topology of the network . Computer essentially transforms the network into a virtually cliqued networked. A cliqued network is one in which every node is connected to every other node . A virtually cliqued network is one in which every node has a capability to trade with every other node but not necessarily directly. In order to preserve the desired feature of anonymity each node knows the identities of only its immediate trading partners and does not necessarily know whom it is actually trading with.

As a trading system that leverages the existing relationships in the market for the traded instrument the present invention provides all market players typically banks financial institutions clearing entities hedge funds and any corporations or other entities the ability to trade directly with each other through a custom limit order book . These agents may already be connected together with credit relationships but prior art systems allow trading only between two parties that have an explicit credit arrangement. The present invention analyzes the credit worthiness of a potentional counterparty at a higher level performing this analysis in real time and providing each party with a limit order book customized to its current credit availability.

For example in we consider a small network of foreign exchange players banks B and C which have a credit relationship with each other and clients A and D who have margin placed with banks B and C respectively we leave the margin currency and traded instrument unspecified . The specified input credit limits are specified as traded instrument L Q credit limits just one way of specifying input credit limits out of eight possible ways enumerated in the present patent application . Client A s margin allows it to trade 10M with B B s relationship allows it to trade 50M with C and D s margin allows it to trade 5M with C . This information is supplied to computer which draws from said information.

Computer then uses the information contained in Table 1 to create a custom limit order book for each agent A B C D and causes the custom limit order book to be displayed on the computer screen of the respective agent A B C D. The filtered bids and offers in the custom limit order book are for volumes that are an integral multiple of the lot size even if the computed Table 1 amounts contain values which are not integral multiples of the lot size with non integral multiples rounded toward 0.

If client A posts a bid for 10M computer causes the full bid to appear on the custom limit order books of banks B and C and computer causes a filtered bid for 5M to appear on the custom limit order book of client D because the maximum credit implicit or explicit available between A and D is 5M. If there is no implicit or explicit credit available between two nodes they are not allowed to see each other s bids and offers at all on their custom limit order books .

The network of the present invention is preferably built using the Internet Protocol IP because of its ubiquity and may reside on the Internet itself or other public IP network .

It is also possible to locate part or all of the network on a private fiber backbone so that information bound for the Internet can traverse most of the distance to its destination on the presumably higher speed private network . The slower public Internet is then used for just the last segment of travel. It is also possible to provide clients with dedicated bandwidth through private IP networks in order to provide additional levels of quality and service. A single dedicated connection may be backed up by an Internet connection or multiple private connections can be used to avoid the public network entirely.

On the three illustrated agents can be three separate companies three computers within the same company or a hybrid of the above.

The network interfaces with both people and automated systems computers so it provides three access methods 

An agent s software can be launched from the agent s browser but run as a standalone application for better performance and stability.

The computer of each agent can have associated therewith an application programming interface API . The API is a standard interface exposed by the central computer that enables the user to write customized instructions enabling two way communication between central computer and the user . In the case where the user is a credit extending agent the API can be used to update the agent s backoffice information. The agent can program his API to make and cancel orders bids and or offers . The agent can use his API to receive and reformat custom limit order books for any instruments. The agent can use his API to set trading limits with the understanding that the actual trading limits are the minimum of the trading limits specified by the two agents associated with an account. The API can be programmed to estimate how much it would cost an agent to liquidate his position in an instrument. The API can be programmed to estimate that agent s profit loss amount for each instrument being traded this information can be combined with the agent s custom limit order book . Anything that can be achieved by the GUI graphical user interface can be achieved via the API .

Any and all features of the API can be programmed to operate automatically including automatic bidding offering buying and selling. Automated processes accessing computer via application programming interface or a bridge use the same cryptographic protocols as for a human agent inputting instructions via his computer s GUI. Whether an API or a GUI is used an agent s private key for computerized access to computer can be stored in the agent s computer provided said computer has sufficient security safeguards.

As stated above an entity using the proposed system may develop programs that partially or fully automate the trading process. Such programs may allow for example the automation of market making hedging and forecasting strategies. Thus such programs can automatically generate prices and post bids and offers in order to make a market and can also automatically decide to hit bids offers posted by other entities. Still further such programs may allow a combination of computer and trader driven decision making for example certain bids and or offers may be hit automatically based on a computer forecast while other bids and or offers may be sent to graphical user interfaces where action may be taken by traders.

One method for automating such processes is through the use of extensible machine to machine communication protocols such as those based on XML. XML or the eXtensible Markup Language describes a class of languages each called an application of XML. With XML the producer of documents is no longer restricted to telling client browsers what a document should look like but can instead be very explicit about what data a document contains. Where HTML might include instructions to render text as bold red text preceded by a particular bullet symbol XML data instead specifies that a number is a change in a stock price ignoring the presentation details. By saying what the data is rather than how it should look XML enables a new class of interactions that more meaningfully manipulate and respond to data. Most importantly those interactions can be automated involving only machine to machine communications and allowing XML agents to act on behalf of an end user. Machine to machine communication may also use other protocols e.g. those involving the use of Document Type Definitions DTDs or schemas.

Machine to machine communication may also be used by computer systems associated with trading entities to automatically query a large number of credit extending entities e.g. banks simultaneously in order to request their rate quote for a desired currency. Such computer systems can then instantaneously and automatically choose the best price and place a corresponding order. This process could be performed for example using XML where an XML document describes a query for a price to each bank and each bank replies with its rate using a corresponding chunk of XML data.

Privacy authentication and non repudiation are achieved in the present invention via the use of cryptography in a variety of different forms. The cryptographic techniques can comprise symmetric key and or asymmetric key public key cryptography. All data streams are encrypted e.g. by using SSL Secure Socket Layer connections or a combination of SSL encryption with additional authentication and encryption. Authentication can be required between computer and an agent at any and all times these devices communicate with each other. This authentication can be achieved through the use of digital certificates. Revalidation of credentials can be required at the time a trade is consummated.

Each agent may store its private key on a tamper resistant hardware device such as a smartcard protected by a password. The combination of a physical token the card with a logical token the password ensures two levels of security. The hardware token may contain a small CPU that allows it to perform the necessary cryptographic operations internally so that the agent s private key never leaves the smartcard. In a preferred embodiment computer handles bulk encryption decryption using symmetric key cryptography after the slower public key cryptography has been used to exchange a session key between agent and computer .

While trading in the present invention is peer to peer order matching for any particular instrument is done at a centralized location to maintain transactional integrity. illustrates the order matching process. In step the first agent places a bid via its software to computer which accepts the bid at step . Computer then calculates changes to the custom limit order books of agents and at steps and respectively taking into account appropriate trading limits . At step the second agent takes the bid. Step occurs right before step in which a third agent not illustrated posts a new offer bid or offer for the traded instrument L Q. At step computer makes the match between the first agent and the second agent .

A network implementing the present invention can span the entire world which means that there may be time differences for a message sent by different agents to computer . Assuming a network that sends signals at the speed of light but that cannot transmit through the Earth a message sent to the other side of the Earth would have a round trip time of at least 130 milliseconds. On existing IP networks it is observed that if the central computer were located in New York the maximum average round trip communication time between the central computer and a computer in any of the major financial centers is less than 300 milliseconds.

We want to ensure that all agents have a level playing field in accessing computer regardless of where these agents are situated around the world. Determining the latency for each agent and then introducing an individual delay on an agent by agent basis to try to equalize time of arrival at computer would be very difficult due to short term fluctuations in network lag and could have the undesired effect of overcompensating. A malicious agent could also falsify its network delay unfairly obtaining early access to computer .

In order to compensate for the various time lags in sending messages between agents and computer on a global basis the present invention transmits information as rapidly as possible while flagging the order of messages to compensate for latency. The flagging is done by means of border outpost computers .

For agents remote from computer a border outpost computer is inserted into the network typically where the agent s data enters the private backbone that connects to computer . Each border outpost computer comprises a CPU a trusted time source and an input output port . Time source which may comprise a GPS clock accurate to a millionth of a second is used to generate a digital time stamp that is added to each data packet before it is forwarded to computer . The GPS clocks of all the border outpost computers are synchronized with each other to a high degree of accuracy typically one microsecond . The time stamp may be placed onto the packet without the border outpost computer having to understand the packet or have access to its contents. At the computer site the time stamp is stripped off before the packet is processed and then reassociated with the data after it is decrypted and parsed into a command. Computer then sorts the messages into a queue by time order. After a fixed time delay the message that is at the front of the queue is serviced by computer . The fixed time delay is chosen so that with a high degree of certainty a message from the remotest agent s computer will arrive at computer within the fixed time delay. The purpose of the fixed time delay is to allow all messages that might be the first originated message to have a chance to arrive at computer before execution of any messages takes place. The time stamp may be encrypted using either a symmetric or assymetric cipher to prevent its modification or falsification.

Field displays the top best orders from the point of view of the agent . Field displays the best bid price for any agent coupled to the network . Field displays the last two digits 84 of the best available bid price. Field displays the size at the best bid price. Field displays agent s available liquidity for additional selling. Field provides agent with a mouse clickable area the big figure enabling the agent to jump to the buy or sell dialog screen or with amounts already filled in. Field is a mouse clickable numeric keypad allowing the agent to create and cancel orders. Field gives balance sheet values showing live valuations at market price and the profit that was banked by agent for a certain period of time such as the current day. Field is a pop up console allowing for the display of application messages connection failure retry messages and broadcast messages from central computer . Field displays the time since the agent has logged in to computer . Field displays the best available offer in this case four digits of the available offer are used to warn agent that his best available offer is far from the overall best due to a credit bottleneck. Field shows this agent s orders in red. Field shows this agent s current net position in the instrument being traded. Field shows a summary of this agent s offers. Field is a mouse clickable area tab enabling the agent to quickly cancel the top offer.

The method starts at step . In step computer asks whether there have been any trades made since the last multi hop credit computation. This is meant to avoid unnecessary computation. If the answer to the question is yes then step is executed. At step multi hop credit limits are computed as illustrated in . If the answer to the question raised in step is no step is executed. At step the bid side of the book is cleared i.e. variable B becomes the null set the offer side of the book is cleared i.e. variable A becomes the null set and the credit used U as a function of S and T is cleared. In this context used applies only for this particular custom limit order book for this particular agent . Step is then executed where it is asked whether enough bids have been found. Enough is a pre established limit e.g. five and corresponds to N as discussed above in conjunction with custom limit order book detail window . N may be infinity in which case the method always proceeds from step to step . If enough bids have been found the method proceeds to step . If enough bids have not been found the method proceeds to step where it is asked whether there are more unprocessed bids i.e. if the number of bids that have been processed is less that the pre established limit. If the answer is no step is executed otherwise the method proceeds to step where the highest priced oldest unprocessed bid is fetched. The hierarchy is according to highest bid. If there is a tie as to two or more highest bids then the bids are ordered by time. It is forced that there not be a time tie at this point time collisions have already been resolved by locking using sequence numbers.

Step is then executed. X is defined as the flow limit trading limit between S and T minus the credit U between S and T that has already been used up. Y is then set to be the minimum of X and the bid size. In other words Y is what we have to work with. Step is executed where it is asked whether Y is greater than 0. If not the method cycles back to step . If yes step is executed. In step the set of bids B is augmented by the current bid we are working with from step . Also in step the credit used U is augmented by Y.

At step it is asked whether enough offers have been found. Again enough is a pre established limit e.g. five corresponding to N as before. If the answer to this is yes the method stops at step . If the answer is no step is executed. At step it is asked whether there are more unprocessed offers. If not the method ends at step . If yes step is executed where the lowest priced oldest unprocessed offer is fetched. Then step is executed where X is set to be the trading limit between S and T minus the unused credit U. Y is then set to be the minimum of X and the offer size. Step is then executed. At step it is asked whether Y is greater than 0. If not control is passed back to step . If yes step is executed where the current offer price being worked on from box is added to the set of offers A and the credit used U is augmented by Y. Control then passes back to step .

If S is found not to be equal to T at step control is passed to step which disables edges where the edge origin is not a credit bridge and the edge origin is not equal to S. An edge may be disabled internally by adjusting its maximum capacity to 0 or by removing it from the set of edges that comprise the graph. The edge origin is that node from which the lot instrument L flows. Steps and eliminate agents who have not agreed in advance to be intermediaries i.e. credit bridges . An intermediary credit bridge is an agent that allows two other agents to do back to back trades through the intermediary agent . Step disables edges where the edge destination is not a credit bridge and the edge destination is not equal to T. An edge destination is a node that receives the flow of the lot instrument L.

At step the maximal flow from S to T is computed using a maximal flow algorithm such as one of the algorithms disclosed in Chapter 7 of the Ahuja reference previously cited. At step the multi hop credit limit between S and T LIM S T is set to be equal to the maximum flow obtained from step . At step the edges that were disabled in steps and are re enabled. Step asks whether S is the last network node to be processed. If yes the procedure concludes at step . If no the process moves to step where S is advanced to the next network node. Again next is arbitrary and simply refers to any other unprocessed node . After step the method re executes steps .

Step asks whether there is any such unprocessed account A. If not this process stops at step . If there is an unprocessed account A the process executes step where the minimum and maximum excursions for account A are calculated. Step is the subject of . These minimum and maximum excursions are defined in terms of the lot instrument L and are calculated from one or more of eight possible ways of specifying input credit limits. The maximum and minimum excursions are excursions from current position. The input credit limits are specified as part of each account A. In step the set of edges G is augmented with an edge from A s lender to A s borrower with the capacity of the edge being set to the maximum excursion. L is the lot instrument and Q is the quoted instrument. In step the set of edges G is augmented with an edge from A s borrower to A s lender with the capacity of the edge being set to the negative of the minimum excursion. The process then re executes step .

Step asks whether position limits have been defined for the lot instrument. If yes step is executed. At step the lot instrument position limits effects on the maximum and minimum excursions are calculated. This is the subject of . At step it is asked whether volume limits have been specified for the lot instrument. If so step is executed. At step the lot limit volume limits effects on the maximum and minimum excursions are calculated. This is the subject of . At step it is asked whether position limits have been specified for the quoted instrument. If so step is executed. At step the quoted instrument position limits effects on the maximum and minimum excursions are calculated. This is the subject of . At step it is asked whether volume limits have been specified for the quoted instrument. If so step is executed. At step the quoted instrument volume limits effects on the maximum and minimum excursions are calculated. This is the subject of . At step it is asked whether notional position limits have been specified. If so step is executed. At step the notional position limits effects on the maximum and minimum excursions are calculated. This is the subject of . At step it is asked whether notional volume limits have been specified. If so step is executed. At step the notional volume limits effects on the maximum and minimum excursions are calculated. This is the subject of . At step it is asked whether position limits have been specified for the traded instrument L Q. If so step is executed. At step the traded instrument L Q position limits effects on the maximum and minimum excursions are calculated. This is the subject of . At step it is asked whether volume limits have been specified for the traded instrument L Q. If so step is executed. At step the traded instrument L Q volume limits effects on the maximum and minimum excursions are calculated. This is the subject of .

Then step is executed where the maximum excursion is set to be equal to the maximum of 0 and the current value of the maximum excursion. This is done because we don t want to have a negative maximum excursion. At step the minimum excursion is set to be the minimum of 0 and the current value of the minimum excursion. This is done because we do not want to have a positive minimum excursion. Then the method ends at step .

It is important to note that the order of taking into account the effects of the eight types of specified input credit limits is irrelevant because each of the eight can only constrict an excursion more not expand it. Therefore the ultimate limit is the most restrictive one. All of the eight trading limits described herein are recalculated after each trade affecting that limit.

As used herein a trading limit is something calculated by computer and a credit limit is something specified by a guaranteeing agent .

Conventional mathematical shortcuts can be used to speed the calculations without necessarily having to repeat all the method steps in all but the first time a particular method is executed. All of the steps of get executed the first time a method shown in is executed.

In step computer looks for another unsettled flow of instrument L in account A. Another is arbitrary. At step it is asked whether such another unsettled flow exists. If not control passes to step . If the answer is yes step is executed wherein it is asked whether the flow is to account A s borrower . A flow is a transfer of a single instrument along a single edge . This is the same as asking whether the flow is to other than a guaranteeing agent because the lender is the guaranteeing agent . If the answer is yes step is executed during which POS is augmented by the flow amount and control passes back to step . This inner loop constitutes calculation of the net position and is performed for each Q matching that L.

If the answer to the question posed in step is no step is executed wherein POS is decremented by the flow amount and control is passed back to step . At step X is set to be equal to PMAX L minus POS and Y is set equal to PMIN L minus POS. X is the maximum excursion from this flowchart and Y is the minimum excursion from this flowchart. At step the maximum excursion for the traded instrument L Q is set to be equal to the minimum of the current value of this maximum excursion and X and the minimum excursion for the traded instrument L Q is set to be equal to the maximum of the minimum of the current value of the minimum excursion and Y. In other words the set of maximum and minimum excursions is updated based upon the results of this flowchart. The method ends at step .

Control is then passed back to step . If the answer posed in step is no step is executed wherein X is set equal to VMAX L minus VOL and Y is set equal to minus X because of the definition of volume . Again X and Y are the partial limits as calculated by this particular flowchart. Then in step the maximum excursion is set equal to the minimum of the previous value of the maximum excursion and X in the minimum excursion is set equal to the maximum of the previous value of the minimum excursion and minus X. In other words the overall excursions are updated based upon the results of this flowchart. The method then ends at step .

The method commences at step . At step computer retrieves the maximum notional position credit limit PMAXN where N is the notional instrument i.e the instrument in which the limit is presented. In step the notional position NPOS is also zeroed out. In step computer looks for another instrument C with flows in account A. C is an index designating the instrument for which we are executing the loop . The order of selecting the instruments is immaterial. Step asks whether such another instrument C has been found. If not control passes to step . If the answer is yes step is executed wherein the instrument position POS C is zeroed out. At step computer looks for another unsettled flow of instrument C in account A.

Step asks whether such another unsettled flow has been found. If not control passes to step . If the answer is yes step is executed where it is asked whether the flow is to account A s borrower . If yes POS C is augmented with the flow amount at step . If not POS C is decremented by the flow amount at step . In either case control is returned to step . Note that the inner loop is analogous to the loops in . At step NPOS is augmented by the absolute value of POS C multiplied by fixed rate C N which converts to the notional instrument. The absolute value of POS C is used because a negative position presents the same risk to the guaranteeing agent as a positive position.

Before we describe step let us define A and B as those terms are used in step . Note that A in step is not the same as account A . A is the position of L POS L multiplied by fixed rate L N which converts this position to the notional instrument. B is the position of Q POS Q multiplied by fixed rate Q N which converts this to the notional instrument. The positions of L and Q are as calculated in the above loop if L and Q were not subject to these notional limits then A and B would be 0.

In step computer finds the minimum and maximum roots of F X where F X is defined in step . The term root is that of conventional mathematical literature i.e. a value of X that makes F X equal to 0. Let us define E to be equal to the absolute value of A plus B plus NPOS minus the absolute value of A minus the absolute value of B minus PMAXN. If E is greater than 0 then there are no roots. In that eventuality we set the maximum excursion of the traded instrument L Q MAXEXC L Q and the minimum excursion of the traded instrument L Q MINEXC L Q to be equal to 0. If E is less than or equal to 0 the maximum root is the maximum of minus A and B minus E 2 and the minimum root is the minimum of minus A and B plus E 2. Now we are ready to go to step .

At step the maximum excursion of the traded instrument L Q is set equal to the minimum of the previous version of the maximum excursion of the traded instrument L Q and the maximum root multiplied by fixed rate N L which converts it to the lot instrument. Similarly the minimum excursion of the traded instrument L Q is set equal to the maximum of the previous version of the minimum excursion of the traded instrument L Q and the minimum root multiplied by the same conversion factor fixed rate N L . The method terminates at step .

Let R be the conversion factor fixed rate C N where C is the instrument that we are looping through currently. Then step sets VOL to be the previous VOL plus the quantity R times the flow amount. Step is then entered into. At step X is set equal to VMAXN minus VOL. Again X is the limit from just this flowchart. At step the maximum excursion of the traded instrument L Q is set equal to the minimum of the previous value of the maximum excursion of the traded instrument L Q and X times fixed rate N L i.e. we are converting from the notional instrument to the lot instrument. Similarly the minimum excursion of the traded instrument L Q is set equal to the maximum of the previous version of the minimum excursion of the traded instrument L Q and minus X times the same conversion factor. The method ends at step .

The method starts at step . At step computer looks up the specified maximum position credit limit for the traded instrument L Q PMAX L Q and the specified minimum position credit limit for the traded instrument L Q PMIN L Q . In step the total position POS is also zeroed out. In step computer looks for another unsettled flow pair with lot instrument L quoted instrument Q and account A. Again another is arbitrary. At step it is asked whether such another unsettled flow pair has been found. If no control passes to step . If yes control passes to step where it is asked whether the lot instrument flows to account A s borrower . In other words the calculation is done in terms of the lot instrument to begin with so that we do not have to convert to the lot instrument at the end of the calculation. If the answer to this question is yes step is executed where POS is incremented with the lot instrument flow amount. Control then passes to step . If the answer to the question posed in step is no step is executed where POS is decremented by the lot instrument flow amount. Again control then passes to step . At step X is set equal to PMAX L Q minus POS and Y is set equal to PMIN L Q minus POS. At step the maximum excursion of the traded instrument L Q is set equal to the minimum of the previous version of the maximum excursion of the traded instrument L Q and X and the minimum excursion of the traded instrument L Q is set equal to the maximum of the previous value of the minimum excursion of the traded instrument L Q and Y. The method ends at step .

At step it is asked whether such another unsettled flow pair has been found. If no control passes to step . If yes control passes to step where VOL is augmented by the lot instrument flow amount. The calculation is done in the lot instrument so that we do not have to convert to the lot instrument at the end and it makes the calculation more stable because we don t have to worry about fluctuating rates. Control is then passed to step . At step X is set equal to VMAX L Q minus VOL. At step the maximum excursion of the traded instrument L Q is set equal to the minimum of the previous version of the maximum excursion of the traded instrument L Q and X. Similarly the minimum excursion of the traded instrument L Q is set equal to the maximum of the previous value of the minimum excursion of the traded instrument L Q and minus X. The method stops at step .

The method starts at step . At step central computer issues an electronic deal ticket to an auditor. The auditor is a trusted third party e.g. an accounting firm. Ticket has a plaintext portion and an encrypted portion. The plaintext gives the ticket ID and the time and date that the ticket is generated. The encrypted portion states that agent B bought Ffor Ffrom agent S for settlement at T. Deal ticket is digitally signed by central computer for authentication purposes and encrypted by central computer in a way that the auditor can decrypt the message but central computer cannot decrypt the message. This is done for reasons of privacy and can be accomplished by computer encrypting the message using the public key of the auditor in a scheme using public key cryptography.

At step computer issues an in flow ticket to buyer B and to the auditor. Flow ticket contains a plaintext portion and an encrypted portion. The plaintext gives the ticket ID the time and date the ticket is generated and the name of agent B. The encrypted portion states that you agent B bought Ffor Ffrom counterparty S for settlement at T. Ticket is digitally signed by computer and encrypted in such a way that it may be decrypted only by agent B and by the auditor not by computer . Two different encryptions are done one for agent B and one for the auditor.

At step computer issues an out flow ticket to seller S and to the auditor. Out flow ticket contains a plaintext portion and an encrypted portion. The plaintext gives the ticket ID the time and date of issuance and the name of agent S. The encrypted portion states that you agent S sold Ffor Fto counterparty B for settlement at T. Ticket is digitally signed by computer and encrypted only to agent S and to the auditor not to computer . Two different encryptions are used one to agent S and one to the auditor.

Tickets and can include the digital identity of the individual within the agent whose smartcard was plugged into the agent s computer when the transaction was made. The method ends at step .

The method begins at step . At step computer issues deal ticket to the auditor. Ticket contains a plaintext portion and an encrypted portion. Ticket is digitally signed by computer and encrypted only to the auditor. The encrypted portion states that agent B bought Ffor Ffrom agent S for settlement at T and that the deal was fulfilled by multiple direct trades in D the directed deal fulfillment graph i.e. the type of graph that is illustrated in . In other words the auditor knows every agent in the chain.

At step computer looks for the next unprocessed agent V in graph D. Again next is arbitrary. At step it is asked whether such an unprocessed agent V has been found. If not the method stops at step . If the answer is yes node loop is entered into. For agent V this node loop examines the set Eof directed edges in D which have agent V as either a source or destination. Each edge has an amount F that is greater than zero and less than or equal to F. Note that this verification process is for illustration only there would not be a match if these constraints were not satisfied. At step it is asked whether agent V is the ultimate buyer B of the deal. If no control is passed to step . If yes control is passed to step .

At step it is asked whether agent V is the ultimate seller S of the deal. If no control is passed to step . If yes control is passed to step . At step computer concludes that agent V is an incidental participant in the deal i.e. a middleman . Control is then passed to step which verifies that the sum of the edge amounts having agent V as a source equals the sum of the edge amounts having agent V as a destination. Sums are used because that agent could have several edges in and out. Therefore it is known that agent V has no net market position change.

Control is then passed to step . At step it is verified that agent V is the source node as opposed to the destination node of all edges in E. In step it is verified that edge amounts in Esum to F the net amount sold. Control is then passed to step .

In step it is verified that agent V is the destination node as opposed to the source node of all edges in E. At step it is verified that edge amounts in Esum to F the net amount bought. Control is then passed to step where computer looks for the next unprocessed edge in Ecorresponding to account A. Steps constitute an edge loop. Account A is any account held by or extended to counterparty X. Counterparty X is the counterparty to agent V for that edge . The edge has to have some amount F where F is greater than 0 and less than or equal to F and an implicit counter amount F times P otherwise there would be no way to clear the trade. Again next in step is arbitrary. Control is then passed to step .

At step it is asked whether such a next unprocessed edge has been found. If not control is passed to step . If yes control is passed to step where it is asked whether agent V is the destination node for this edge . If yes then step is executed. If no then by definition agent V is the source node for this edge and step is executed. Control is passed to step after either of step or is executed.

At step computer reports an in flow ticket to agent V because the lot currency is flowing in to agent V. Flow ticket contains a plaintext portion and an encrypted portion. The plaintext includes the ticket ID the time and date of issuance and the name of agent V. The encrypted portion states that you agent V bought F of L for F times P of Q from counterparty X for settlement at T. In this case counterparty X is just the immediate neighbor to agent V preserving anonymity. Ticket is digitally signed by computer and encrypted by computer only to agent V and to the auditor not to computer . Two encryptions are performed one to agent V and one to the auditor.

At step computer generates an out flow ticket to agent V. Ticket contains a plaintext portion and an encrypted portion. The plaintext includes the ticket ID the time and date of issuance and the name of agent V. The encrypted portion states that you agent V sold F of L for F times P of Q to counterparty X for settlement at T. Again counterparty X is just the immediate neighbor to agent V preserving anonymity. Flow ticket is digitally signed by computer and encrypted by computer only to agent V and to the auditor not to computer . Two encryptions are performed one to agent V and one to the auditor.

Tickets and can include the digital identity of the individual within agent whose smartcard was plugged into the agent s terminal when the transaction was made.

The above description is included to illustrate the operation of the preferred embodiments and is not meant to limit the scope of the invention. The scope of the invention is to be limited only by the following claims. From the above discussion many variations will be apparent to one skilled in the art that would yet be encompassed by the spirit and scope of the present invention.

