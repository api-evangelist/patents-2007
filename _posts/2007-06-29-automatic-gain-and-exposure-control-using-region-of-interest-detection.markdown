---

title: Automatic gain and exposure control using region of interest detection
abstract: A region of interest may be determined using any or all of sound source location, multi-person detection, and active speaker detection. An weighted mean may be determined using the region of interest and a set of backlight weight regions, or, only the set of backlight weight regions if a region of interest could not be found. The image mean is compared to a target value to determine if the image mean is greater than or less than the target value within a predetermined threshold. If the image mean is greater than the predetermined target value and predetermined threshold value, the gain and exposure are decreased. If the image mean is lesser than the predetermined target value minus the predetermined threshold value, the gain and exposure are decreased.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08165416&OS=08165416&RS=08165416
owner: Microsoft Corporation
number: 08165416
owner_city: Redmond
owner_country: US
publication_date: 20070629
---
Current video cameras lack sufficient dynamic range to capture different types of scenes. The result of such a lack of dynamic range is that an object of interest in a scene may be underexposed or overexposed resulting in an image in which the object of interest is either too dark or too bright. In most images the object of interest may be in the center of the frame and a mask may be used to determine the location of the object of interest. The exposure may then be adjusted based on the current exposure of the area represented by the mask.

The following presents a simplified summary of the disclosure in order to provide a basic understanding to the reader. This summary is not an extensive overview of the disclosure and it does not identify key critical elements of the invention or delineate the scope of the invention. Its sole purpose is to present some concepts disclosed herein in a simplified form as a prelude to the more detailed description that is presented later.

The present example provides a system and method for controlling an automatic gain control and or an automatic exposure control for a camera. A region of interest may be determined using any or all of sound source location multi person detection and active speaker detection. An image mean may be determined using the region of interest and a set of backlight weight regions or only the set of backlight weight regions if a region of interest could not be found. The image mean may then be compared to a target value to determine if the image mean falls within the target value within a predetermined threshold. If the image mean is greater than or less than the predetermined target value and predetermined threshold value the gain may be increased or decreased and the exposure may be increased or decreased.

Many of the attendant features will be more readily appreciated as the same becomes better understood by reference to the following detailed description considered in connection with the accompanying drawings.

The detailed description provided below in connection with the appended drawings is intended as a description of the present examples and is not intended to represent the only forms in which the present example may be constructed or utilized. The description sets forth the functions of the example and the sequence of steps for constructing and operating the example. However the same or equivalent functions and sequences may be accomplished by different examples.

Although the present examples are described and illustrated herein as being implemented in a system for controlling an automatic gain control and an automatic exposure control using region of interest detection the system described is provided as an example and not a limitation. As those skilled in the art will appreciate the present examples are suitable for application in a variety of different types of systems for controlling an automatic gain control and an automatic exposure control using region of interest detection.

Although not required embodiments of the invention will be described in the general context of computer readable instructions being executed by one or more computing devices. Computer readable instructions may be distributed via computer readable media discussed below . Computer readable instructions may be implemented as program modules such as functions objects Application Programming Interfaces APIs data structures and the like that perform particular tasks or implement particular abstract data types. Typically the functionality of the computer readable instructions may be combined or distributed as desired in various environments.

In other embodiments device may include additional features and or functionality. For example device may also include additional storage e.g. removable and or non removable including but not limited to magnetic storage optical storage and the like. Such additional storage is illustrated in by storage . In one embodiment computer readable instructions to implement embodiments of the invention may be stored in storage . Storage may also store other computer readable instructions to implement an operating system an application program and the like.

The term computer readable media as used herein includes computer storage media. Computer storage media includes volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions or other data. Memory and storage are examples of computer storage media. Computer storage media includes but is not limited to RAM ROM EEPROM flash memory or other memory technology CD ROM Digital Versatile Disks DVDs or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by device . Any such computer storage media may be part of device .

Device may also include communication connection s that allow device to communicate with other devices. Communication connection s may include but is not limited to a modem a Network Interface Card NIC or other interfaces for connecting computing device to other computing devices. Communication connection s may include a wired connection or a wireless connection. Communication connection s may transmit and or receive communication media.

Communication media typically embodies computer readable instructions or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term computer readable media may include communication media. The term modulated data signal means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example and not limitation communication media includes wired media such as a wired network or direct wired connection and wireless media such as acoustic radio frequency infrared and other wireless media.

Device may include input device s such as keyboard mouse pen voice input device touch input device infra red cameras video input devices and or any other input device. Output device s such as one or more displays speakers printers and or any other output device may also be included in device . Input device s and output device s may be connected to device via a wired connection wireless connection or any combination thereof. In one embodiment an input device or an output device from another computing device may be used as input device s or output device s for computing device .

Components of computing device may be connected by various interconnects such as a bus. Such interconnects may include a Peripheral Component Interconnect PCI such as PCI Express a Universal Serial Bus USB firewire IEEE 1394 an optical bus structure and the like. In another embodiment components of computing device may be interconnected by a network. For example memory may be comprised of multiple physical memory units located in different physical locations interconnected by a network.

Those skilled in the art will realize that storage devices utilized to store computer readable instructions may be distributed across a network. For example a computing device accessible via network may store computer readable instructions to implement one or more embodiments of the invention. Computing device may access computing device and download a part or all of the computer readable instructions for execution. Alternatively computing device may download pieces of the computer readable instructions as needed or some instructions may be executed at computing device and some at computing device . Those skilled in the art will also realize that all or a portion of the computer readable instructions may be carried out by a dedicated circuit such as a Digital Signal Processor DSP programmable logic array and the like.

The audio video capture component is communicatively coupled to the gain exposure control component . The gain exposure control component is in turn communicatively coupled to each of the automatic gain control and the automatic exposure control . Each of the automatic gain control and the automatic exposure control are further communicatively coupled to the one or more cameras . The one or more cameras and the one or more microphones are communicatively coupled to the audio video capture component .

Referring now to the functioning of the example system the audio video capture component includes functionality to digital capture video audio and still images to produce digital video audio and still image files from the one or more cameras . It is to be appreciated that the one or more cameras may produce panoramic images when disposed as more than one panoramic camera or may also produce a panoramic image when disposed as a single sensor camera. The one or more cameras may each include a camera lens at least one image sensor a control for controlling gain a control for controlling exposure and the like. The one or more microphones may be disposed in an array such that the one or microphones may be used for sound source localization SSL .

The one or more cameras send digital image information to the audio video capture component . Accordingly the one or more microphones also send analog audio information to the audio video capture component . The audio video capture component may include an analog to digital convertor for converting sound waves received by the one or more microphones into a digital audio signal digital storage for storing the digitized audio and video and the like. In particular a digital video signal may be comprised of a series of sequential static digital video images that produce the illusion of motion when played back in order.

The automatic gain control AGC is an adaptive system that amplifies the signal representing a captured digital image. The effect of amplifying the signal representing a captured digital image increases the values of all pixels in the captured digital image thereby adding information to all pixels included in the captured digital image. In turn the effect of adding information to all pixels in the captured digital image may be such that noise or unwanted information is added to the captured digital image. The automatic gain control may further incrementally increase the gain or incrementally decrease the gain to bring the gain within a range of a predetermined target value offset above and below by a threshold value.

The automatic exposure control controls the amount of light that falls upon the image sensor implemented by the audio video capture device . The effect of increasing the amount of light that falls upon the sensor increases the strength of a signal representing a digital image. The effect of decreasing the amount of light that falls upon the sensor decreases the strength of a signal representing a digital image. The automatic exposure control functions similarly to the automatic gain control in that the automatic exposure control may incrementally increase or incrementally decrease the exposure to bring the exposure within a range of a predetermined target value offset above and below by a threshold value.

Once the digital video and audio has been captured by the audio video capture component the gain exposure control component analyzes all or a portion of the captured audio and video to determine whether to increase or decrease the gain and or exposure. The gain exposure control component implements the gain exposure adjustment method to perform such an analysis. Accordingly the gain exposure adjustment method further implements several methods of detecting a region of interest within the captured image.

Once a region of interest has been detected the gain exposure adjustment method calculates the image mean using the region of interest before adjusting the gain and exposure in accordance with the image mean. If no region of interest is detected pixels in different regions of the captured digital image may have a weight applied depending on expected physical characteristics of the environment in which the image was captured. In the case where the one or more cameras includes multiple cameras the sensor included with each camera is adjusted using the portion of a panoramic image captured by the corresponding camera sensor. In the case where the one or more cameras includes only a single camera the sensor of the single camera is adjusted using the entire panoramic image captured by the single camera.

For example shows an exemplary digital image including an example detected region of interest . For example the exemplary digital image may be a single captured digital image in a sequence of digital images that collectively comprise a digital video. In this example the digital image includes a human speaker . The region of interest is a region or regions in the digital image that contains all or a portion of the human speaker or any other object of interest.

The region of interest is shown as including the head of the human speaker however the region of interest may include a smaller region of the human speaker such as the mouth of the human speaker or a larger region of the human speaker such as the entire body of the human speaker . The region of interest is illustrated as a polygon in this example however the shape of the region of interest may be any type of shape including an outline of the human speaker or the like. Furthermore the region of interest may be an array of pixels within the digital image bounded by the edges of the region of interest .

Turning now to shows further detail of an example gain exposure control component . The example gain exposure control component includes the gain exposure adjustment method from a region of interest detection component a collection of one or more backlight weighted regions for use by the gain exposure adjustment method and a tunable parameter also for use by the gain exposure adjustment method .

The region of interest detection component includes sound source localization multi person detection and active speaker detection . Active speaker detection and sound source localization are described in U.S. patent application Ser. No. 11 425 967 filed Jun. 22 2006 titled Identification of People Using Multiple Types of Input . Multi person detection is described in U.S. Pat. No. 7 050 607 filed Dec. 8 2001 titled A System and Method for Multi View Face Detection .

Sound source localization provides functionality for locating a speaker in a captured panoramic digital image by estimating the sound source time of arrivals from a microphone array and using the geometry of the array to estimate the location of the sound source. Active speaker detection includes identifying a pool of identifying features from audio and video input and a classifier that selects a subset of identifying features to identify regions where people or a speaker may be located in a captured digital image. The region of interest detector includes a sound source localization component for locating a human speaker in the digital image using an audio probability diffusion function. Multi person detection includes a system and methods for identifying one or more areas of a digital image in which one or more human faces are likely to be. Multi person detection may also utilize information related to motion in a digital video file to identify an area in which one or more human faces are likely to be.

The region of interest detection component may make use of any or all of sound source localization multi person detection and active speaker detection to determine a region of interest from . It is to be appreciated that each of sound source localization multi person detection and active speaker detection may be used in any combination to best determine the region of interest . For example sound source localization may be used to determine the likely location of one or more human speakers in a captured digital image and the determined likely locations may be combined with likely location of human speakers identified by multi person detection resulting in a more accurate detection of the human speakers.

The gain exposure adjustment method utilizes the region of interest determined by the region of interest detection component to compute the image mean of a digital image under analysis. In the case where the region of interest detection component does not determine a region of interest the gain exposure adjustment method may use the backlight weighted regions instead. The backlight weighted regions will be discussed in more detail in the discussion of .

In addition the gain exposure adjustment method may make use of a tunable parameter to allow finer control of the gain exposure adjustment method . The tunable parameter may further expose an interface allowing a user of the gain exposure control component to modify the value associated with the tunable parameter . The effect of changing the value of the tunable parameter may serve to increase or decrease the likelihood of the gain exposure adjustment method to increase or decrease the gain or exposure.

Turning now to shows an exemplary digital image including an example human speaker . The exemplary digital image includes a first weight region a second weighted region and a third weighted region . While three weighted regions are illustrated in the digital image it is to be appreciated that any number of different weighted regions may be included in the digital image . In an alternative embodiment such a digital image may instead be a panoramic image taken by a panoramic digital camera.

As previously discussed with respect to and the detected region of interest the weighted region most likely to include the human speaker is given the highest weight. Accordingly the next most likely region to include a human speaker is given a lower weight and the next most likely region to include a human speaker is given an accordingly lower weight and so on.

For example the second weight region may be most likely to include the human speaker in the case where the digital image is taken in a conference room setting including a table . In this example the pixels included in the second weight region may each have a weight of 1.38. The first weight region may further be the next most likely region to include a human speaker as a person may be standing to speak. In this example the pixels included in the first weight region may each have a weight of 0.92. The third weight region may be the least likely region to include a human speaker as the third weight region is most likely to include the table in a conference room setting. In this example the pixels included in the third weight region may each have a weight of 0.46.

As previously discussed it is to be appreciated that the digital image may include any number of weighted regions and the pixels included in such weighted regions may be given any appropriate weight. Furthermore such a digital image including the first weight region second weight region and third weight region may be used to determine an image mean in an example method for adjusting image gain and image exposure.

Turning now to shows an example method from for adjusting image gain and image exposure. Block refers to an operation in which a frame of digital video and corresponding audio is captured and stored in memory.

Block refers to an operation to determine one or more regions of interest within the frame of digital video captured at block . A region of interest may be determined in accordance with any or all of sound source localization from multi person detection from or active speaker detection from as described earlier. Each of sound source localization multi person detection and active speaker detection may be used individually or in combination to determine an area of pixels within the digital image captured at block where a human speaker or human speakers are likely to be located.

Block refers to an operation to determine if the region of interest determined at block is empty. If each of sound source localization multi person detection and active speaker detection are unable to determine a region of interest likely to include a human speaker or human speakers the region of interest will be empty. In response to a negative determination flow continues on to block . In response to a positive determination flow continues on to block .

Block refers to an operation in which an image mean is determined using the region of interest determined at block and backlighting image weights in accordance with the discussion of . In an example implementation the image mean may be determined by implementing the following function in computer executable form image mean mean image backlight 1 mean 

Where image mean represents the weighted mean of the digital image captured at block image represents the pixels and any information associated with the pixels such as color information included in the digital image captured at block backlight includes pixels and any weights associated with the pixels in accordance with the backlight regions discussed in ROI represents the pixels and any information associated with the pixels such as color information included in the region of interest determined at block and A represents a tunable parameter from . It is to be appreciated that the region of interest may one or more areas assigned different weights depending on the classification of the area. For example the region of interest may include an area identified using active speaker detection or sound source localization as a human speaking. Such an area may be weighted more heavily than an area determined to include a human that is not speaking using multi person detection. The weighted mean function is a typical mean function intended to determine an average value of the pixels and any information associated with the pixels in the array of pixels in the image passed to the mean function.

Block refers to an operation in which the image mean is determined using only the backlighting image weights in accordance with the discussion of . In an example implementation the image mean may be determined by implementing the following function in computer executable form image mean mean image backlight 

Where image mean represents the mean of the digital image captured at block image represents the pixels and any information associated with the pixels such as color information included in the digital image captured at block and backlight includes pixels and any weights associated with the pixels in accordance with the backlight regions discussed in . Such an image mean may also be referred to as an exposure gain metric. The mean function is a typical mean function intended to determine an average value of the pixels and any information associated with the pixels in the array of pixels in the image passed to the mean function.

Block refers to a determination as to whether the image mean determined at either block or block is greater than a predetermined image mean added to a predetermined threshold. For example the predetermined image mean may be a value selected in accordance with one or more characteristics of the device used to capture the digital video image at block . The predetermined threshold value may also be selected in accordance with one or more characteristics of the device used to capture the digital video image at block .

A positive determination at block may indicate that the gain and or exposure of the device that captured the digital image at block are each too high. In response to a positive determination flow continues on to block . In response to a negative determination flow ends at block .

Block refers to a determination as to whether the image mean determined at either block or block is less than a predetermined image mean subtracted from a predetermined threshold. For example the predetermined image mean may be a value selected in accordance with one or more characteristics of the device used to capture the digital video image at block . The predetermined threshold value may also be selected in accordance with one or more characteristics of the device used to capture the digital video image at block .

A positive determination at block may indicate that the gain and or exposure of the device that captured the digital image at block are each too low. In response to a positive determination flow continues on to block . In response to a negative determination flow ends at block .

Block refers to an operation in which the gain associated with the device that captured the digital image at block is decreased. It is to be appreciated that if the gain is already at a minimum setting the gain may not be decreased below a minimum setting. Flow continues on to block .

Block refers to an operation in which it is determined if the exposure setting is at a setting greater than zero. In response to a negative determination flow continues on to block . In response to a positive determination flow continues on to block .

Block refers to an operation in which the exposure associated with the device that captured the digital image at block is decreased. It is to be appreciated that flow may return to block such that the gain and exposure are decreased until the result is that the gain and exposure are set at such a level that block results in a negative determination and flow ends.

Block refers to an operation in which the exposure associated with the device that captured the digital image at block is decreased. Flow continues on to block .

Block refers to an operation in which the gain associated with the device that captured the digital image at block is decreased. It is to be appreciated that flow may return to block such that the gain and exposure are decreased until the result is that the gain and exposure are set at such a level such that block results in a negative determination and flow ends.

