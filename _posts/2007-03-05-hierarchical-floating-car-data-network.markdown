---

title: Hierarchical floating car data network
abstract: A hierarchical floating car data network comprises a central server, an egress point network, and a participating vehicle network. The egress point network is in communication with the central server. The egress point network comprises a plurality of egress points. The participating vehicle network comprises a plurality of participating vehicles. At least some of the plurality of participating vehicles are in direct communication with each other. At least some of the plurality of participating vehicles are in communication with at least some of the plurality of egress points. Furthermore, at least some of the plurality of participating vehicles may be in communication with the central server. A geographic database is formed from content communicated between the elements of the hierarchical floating car data network.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08965695&OS=08965695&RS=08965695
owner: Google Technology Holdings LLC
number: 08965695
owner_city: Mountain View
owner_country: US
publication_date: 20070305
---
This application is a continuation of U.S. patent application Ser. No. 10 436 967 filed May 12 2003 now U.S. Pat. No. 7 188 026 by Assimakis Tzamaloukas and entitled Hierarchical Floating Car Data Network and is related to U.S. patent application Ser. No. 10 272 039 filed Oct. 15 2002 by Assimakis Tzamaloukas et al. and entitled Enhanced mobile communication device and transportation application thereof the entirety of each of which are hereby incorporated by reference in their entirety.

Global Positioning Systems GPS or GPS receivers are being used in increasing numbers in automobiles to provide vehicle navigation functions. Typically a GPS receiver or navigation device comprises a digital road map or geographic information GIS database of the area of travel. A user such as the driver of a vehicle inputs a destination into the GPS navigation device and the GPS navigation device calculates a route from the current position of vehicle through the network of roads as represented in the GIS database to the destination. Turn by turn directions are relayed to the driver through visual or audible prompts. The current position of the vehicle is determined by receiving GPS signals from GPS satellites. If the GPS signals are obstructed or interfered with the current position of the vehicle may be very difficult to ascertain and the usefulness of the GPS navigation device is severely degraded. GPS signals may be obstructed for example in urban areas with many tall buildings on roads with many trees or mountains and in areas with high levels of background radio noise or interference.

In order to provide accurate driving direction the GIS database must be kept current and up to date. Databases with varying levels of accuracy are commercially available and are released for purchase and installation into GPS receivers at regular intervals. Oftentimes since the databases are updated manually through visual surveys of the roadways aerial observations government data and individual travel on the roadways it takes on average six months to create a new database. Additionally on average by the time a user is able to obtain the database and install it the database is already obsolete by around three months. Furthermore the database is only as good as the individual observations and therefore may be incomplete in certain areas of travel as observations have not been made of those areas.

Some attempts have been made to automate the database update process by providing a central database and a plurality of vehicles containing sensors. The vehicles travel a geographical region of interest and collect sensor information. The sensor information is processed and communicated to the central database. The central database receives the sensor information processes it further and integrates the sensor information into the central database. The centralized only communication architecture of these approaches increases the cost and complexity of integrating the collected data. Furthermore these approaches require a large number of vehicles constantly moving around the geographic region in order to cover as much area as possible and collect as much sensor information as possible. Additionally it is very difficult to collect consistent sensor measurements of an identical route since different traffic conditions drivers traffic lights weather and the like will result in different sensor measurements and thus different information pertaining to a particular route. Also this centralized only approach relies on wireless communications directly to the central database. In many cases due to geographical considerations for example it may not be possible to communicate at all with the central database.

It would be advantageous to have systems and methods that communicate map databases and route information between vehicles traveling a transportation network and between vehicles and a central database without the limitations of the prior art. It would be further advantageous to have systems and methods that determine the geographic location of vehicles unable to receive GPS signals. Thus a need presently exists for a hierarchical floating car data network.

By way of introduction the preferred embodiments below provide a hierarchical floating car data network. The hierarchical floating car data network comprises a central server an egress point network and a participating vehicle network. The egress point network is in communication with the central server. The egress point network comprises a plurality of egress points. The participating vehicle network comprises a plurality of participating vehicles. At least some of the plurality of participating vehicles are in direct communication with each other. At least some of the plurality of participating vehicles are in communication with at least some of the plurality of egress points. Furthermore at least some of the plurality of participating vehicles may be in communication with the central server. A geographic database is formed from content communicated between the elements of the hierarchical floating car data network.

The foregoing paragraph has been provided by way of general introduction and it should not be used to narrow the scope of the following claims. The preferred embodiments will now be described with reference to the attached drawings.

Participating vehicles are operative to communicate directly with other participating vehicles to communicate with the egress point network and to optionally communicate with the central server. Participating vehicles collect and exchange data such as traffic data as the participating vehicle traverses the roads of the transportation network. A driver of a participating vehicle is a user or end user. 

Egress points are located throughout the transportation network. Typically the location of the egress points is fixed and their location is known. Participating vehicles may communicate with the egress point . The egress points may further be connected to the Internet or other wireline network. Participating vehicles may communicate with the egress points according an IEEE 802.11 infrastructure mode of communications. Additionally as least some of the plurality of egress points may communicate with each other.

Egress points are fixed egress points that is their location remains fixed. Some participating vehicles are mobile egress points. The mobile egress points may communicate with the central server. For example participating vehicles and are mobile egress points. The functionality of mobile egress points is identical to that of fixed egress points. A mobile egress point may communicate directly with other participating vehicles with other mobile egress points with fixed egress points and with the central server. The egress point network comprises fixed egress points and mobile egress points. Typically a mobile egress point is a vehicle such as a fleet vehicle having a known schedule and trajectory.

The central server receives communications or content from the egress point network. Content includes all types of data exchanged within the hierarchical floating car data network such as traffic data GIS data end user profile data and synchronization data. The central server comprises a central geographic database navigation applications and network monitoring and management functions. The terms central geographic database and central database are used interchangeably herein.

Participating vehicles egress points and the central server communicate with each other in many ways. Participating vehicles may communicate directly with each other. Any two participating vehicles including for example a participating vehicle and a mobile egress point or for example two mobile egress points that are in range of each other can communicate using an enhanced ad hoc mode of communications as described in U.S. patent application Ser. No. 10 272 039. This mode of communications is referred to as vehicle to vehicle v2v communications. The participating vehicles exchange traffic information navigation information as well as geographic database information stored and maintained local to each participating vehicle.

Participating vehicles and egress points may communicate with each other. Any participating vehicle that comes within range of an egress point can communicate with that egress point according to the IEEE 802.11 infrastructure mode. A mobile egress point and fixed egress point also communicate with each other according to the infrastructure mode. A participating vehicle can transmit and receive data from an egress point. This form of communications is referred to as vehicle to roadside v2r communications . The egress points may also be operative to communicate with a wireline network such as the Internet thereby enabling the egress points to communicate with the central server and with other egress points.

In one more form of communication referred to as vehicle to central server v2c communication a participating vehicle or mobile egress point communicates directly with the central server via a wireless wide area network WWAN link. A WWAN link is a cellular phone link such as CDPD GPRS 1xRTT or 3G. A WWAN link is also a long range line of sight microwave link or a satellite link.

The central server layer comprises a central server as described above. The egress point network layer comprises a plurality of egress points. The plurality of egress points may comprise fixed egress points and mobile egress points. The egress points can communicate with the central server through wireline or wireless communications. Additionally at least some of the egress points whether mobile or fixed can communicate with at least some other of the egress points that is an egress point has one or more peer connections with other egress points.

The participating vehicle network layer comprises a plurality of participating vehicles . A participating vehicle may communicate with egress points of the egress point network. Some of the participating vehicles may be mobile egress points and communicate with the central server and other mobile and fixed egress points. The participating vehicles may communicate directly with other participating vehicles.

A virtual private tunneling network VPTN is created and used for communicating between the central server and the fixed and mobile egress points. A network tunnel is a communication mechanism to establish a direct connection between two Internet host machines just as if there was a direct physical connection. A virtual overlay network can be formed using a plurality of tunnels with the appropriate end host IP addresses. Typically fixed egress points that are more closely located geographically are configured to communicate with one another. This better serves location based applications such as traffic and map updates. Mobile egress points by default establish a tunnel with the central server. If due to performance or scalability issues it is necessary or advantageous to communicate with a fixed egress point a list of fixed egress points is traversed based on the proximity to the mobile egress point s current location.

The central server of the central server layer comprises the central geographic database and receives content from the egress points and the participating vehicles . The central database processes the content to update and keep current the central database. Updates may be performed on the database at various times. For example the database may be updated during off peak hours when the number of communication links from participating vehicles is low the database can be updated every hour or updated every minute or the database can be updated when each new piece of traffic update information is received from the participating vehicles. After the database is updated the database is checked for integrity and stability before replacing the database in use. Shadow databases as well as other methods known by those of ordinary skill in the art may be used to ensure the uninterrupted availability of the central server geographic database.

All or portions of the central database may be communicated to the egress points and the participating vehicles. For example a participating vehicle may request routing information. The central server processes this request and communicates information to the participating vehicle based on for example the speed and direction of the participating vehicle. U.S. Pat. No. 6 292 745 which is hereby incorporated by reference shows a method and system for forming a geographic database and communicating information to end users.

The CPU is a microprocessor such as an embedded processor capable of supporting a flat 32 bit address space. Many such processors are available from companies such as ARM Motorola and Intel. The memory comprises memory such as dynamic random access memory DRAM non volatile memory static random access memory SRAM and the like. The memory stores processed and unprocessed data such as sensor data from the locate position module as well as data received by the radio . The storage comprises a permanent storage device or medium such as CD DVD compact flash memory a hard disk drive and the like. The storage performs a similar function as the memory but typically has a much higher capacity and is non volatile. In some embodiments there may be a memory but no storage or very little memory and a large amount of storage.

The input output module comprises various devices to permit a user to input information into the on board equipment and receive information from the on board equipment. For example the input output module may comprise keypads voice recognition devices buttons or a touch screen so that the user can enter information such as a destination or a point of interest. A visual display such as an LCD screen as well as devices to produce voice commands or other audible alerts may be part of the input output module . The input output module may also include an infrared port a Bluetooth port a Wi Fi port a cellular radio a serial data port a USB port or a parallel data port thereby allowing the user to upload and download information to and from the on board equipment.

The bus comprises data and control paths between the hardware components input output module memory module CPU storage device and Wi Fi cellular radio . The locate position module and the auxiliary sensors are connected directly to the CPU . The antennas are connected to the radio module . Various different busses may be implemented such as a PCI bus.

The radio module Wi Fi cellular radio comprises a wireless local area network WLAN radio such as an IEEE 802.11 Wi Fi radio and further optionally comprises a wireless wide area network WWAN radio such as a digital cellular phone using global packet radio service GPRS 3G microwave satellite or other long range wireless implementation. The Wi Fi radio is used for vehicle to vehicle communication as well as for vehicle to roadside communications. For vehicle to vehicle communications the radio operates using the enhanced ad hoc mode of communications of U.S. patent application Ser. No. 10 272 039.

The optional WWAN radio may be present in a small percentage of participating vehicles for vehicle to central server communications. Vehicle to central server communications may take place under a variety of circumstances. For example data collected by the on board equipment may be very large in quantity and could create storage capacity issues for the on board equipment. If the on board equipment is unable to communicate the data to other participating vehicles or to an egress point it may communicate the data to the central server. Also if the on board equipment needs to request data but is not within range of any other participating vehicles or an egress point it may communicate with the WWAN radio.

The antenna module comprises the antennas used by the on board equipment for wireless communications. For example the antenna module may comprise an external antenna with high gain for the Wi Fi radio . A pair of dipole antennas may be used to exploit spatial and antenna diversity. Two 30 degree directional antennas one pointing forward towards the direction of the traffic flow and the other pointing backwards behind a participating vehicle provides optimized communication coverage for a participating vehicle. The location of the external Wi Fi antenna also directly affects performance. In general installing the external antenna on the roof of the participating vehicle improves performance since wave propagation is unobstructed due to the height and visibility of the antenna. A location near any of the windows also improves performance since signal attenuation is small around 2 dBi to 3 dBi even though the multipath effect is much higher due to the reflection of the wave from the metal components of the participating vehicle. Other antennas include an integrated antenna that is part of off the shelf Wi Fi PCI PCMCIA or SD cards. Another antenna is a GPS receiver antenna. Generally GPS receiver antennas should have a clear view of the sky. With a clear view of the sky a GPS receiver antenna can track many satellites and accurately calculate the current location of the vehicle. Cellular phone and satellite antennas may also be used.

The locate position module allows the on board equipment of the participating vehicle to ascertain its geodetic coordinates. The locate position module may comprise sensors such as a GPS receiver. Many types of GPS receivers may be used such as a differential GPS DGPS receiver or an assisted GPS A GPS receiver. Companies such as Ashtech Garmin Trimble and SiRF provide GPS receivers. Additionally when available a wide area augmentation system WAAS such as that used by the coastguard or a local area augmentation system LAAS such as that used by airports can provide improved location accuracy. The optional auxiliary sensors may include a speed sensor a barometer a gyroscope a bearing sensor an inertial sensor and the like.

The egress points of the egress point network comprise egress point equipment as shown in . The egress point equipment comprises a memory a microprocessor CPU a storage device a bus antennas and a communication module comprising a wireless local area network radio such as a Wi Fi radio a wireless wide area network radio such as a cellular radio and a wireline connection. The components are very similar to those discussed above in accordance with the on board equipment. The memory microprocessor storage device and communication module are in communication via the bus . The antennas are connected to the communication module . Generally the memory CPU and storage device have a higher capacity than that of the on board equipment since the egress point equipment must be able to communicate with and process communications from a plurality of participating vehicles. The antenna module comprises for example a pair of directional high gain Wi Fi antennas pointing in the opposing directions of traffic flow. An array of two or more directional antennas may be used for improved wireless range coverage. The communication module comprises the wireless radios as described above and also comprises a wireline connection. Examples of a wireline connection are a digital subscriber line DSL a cable modem a T1 line a T3 line and an optical line. The wireline connection connect the egress point equipment with the Internet.

As stated above the locate position module of the on board equipment provides the location of the participating vehicle through GPS signals. In many cases the GPS signal is too weak or is blocked and the on board equipment cannot ascertain its position. For example in cities with tall building the GPS signal may be extremely weak due to effects such as the urban canyon effect. Various dead reckoning techniques may be used to ascertain the position of the participating vehicle in the absence of a complete GPS signal. For example an adjacent position dead reckoning method uses a gyroscope or compass in order to estimate the vehicle s position based on its current velocity and direction. Many dead reckoning methods use estimation methods such as least minimum square error LMSE autoregressive equations and Kalman filtering. Dead reckoning methods that rely on the vehicle s projected velocity can provide false or inaccurate position measurements. For example if a vehicle stops at a traffic light for several seconds a large error is likely to appear in the case when the average velocity is used to perform a position calculation.

An enhanced dead reckoning method for determining the position of a participating vehicle is shown in . Participating vehicles travel along three parallel roads and . A first egress point is located at position X Y and a second egress point is located at position X Y . The locations of the egress points are static and are known by the participating vehicles or are communicated to the participating vehicles periodically with geo beacon packets.

In the example of participating vehicles are unable to receive GPS signals when the participating vehicles are within the area defined by the rectangle from xb yb to xe ye . The vehicle at location x y is not within rectangle and receives a location reading from the GPS signals. The vehicle at location x y does not receive a GPS signal and therefore uses enhanced dead reckoning. The vehicle at location x y is within range of the egress points and located at X Y and X Y respectively and receives egress point location information from geo beacons as mentioned above.

A participating vehicle such as vehicle at location x y uses prior art dead reckoning methods and link quality information from egress points and to roughly estimate its location. Signal to noise SNR ratio is used to describe the difference between the signal strength versus the noise level at a location. When a vehicle receives a packet from an egress point it derives the SNR ratio for that packet at that location. In general the higher the SNR ratio the closer the vehicle is located to an egress point with a fixed known location.

The accuracy of the location calculation can be further enhanced by way of a received signal strength indication RSSI communicated from the Wi Fi radio of the on board equipment and the Wi Fi radio of the egress point equipment. For example the participating vehicle can create a query packet that comprises the RSSI and request that the egress points calculate its position using calculations and terrain calibration data. Terrain calibration data is generated when the egress points are installed through field measurements and post processing simulation using wave propagation tools. Wave propagation tools are available from Ekahau Inc. Silicon Valley Wireless Inc. and others.

Observed time difference OTD methods can also be used to calculate the location of the vehicle. For example in observed time difference of arrival OTDOA synchronous transmission from all egress points within range may be used and a difference calculation may be performed at the participating vehicle. In another example the participating vehicle transmits time stamped packets to the egress points and the egress points calculate the position of the participating vehicle using the time stamped packets. Generally the more egress points that are within range of the participating vehicle the greater the accuracy of the position calculation of the participating vehicle. However even with one egress point within range a position calculation can be performed either at the participating vehicle or at the egress point. The location error will be higher however than if multiple egress points were in range. OTD OTDOA SNR and RSSI methods may be used in combination.

Referring back to vehicle x y on road can communicate with egress point and egress point to compute its location. The accuracy of the location can be further enhanced with a vehicle to vehicle link with the vehicle at location x y . Vehicle x y is able to receive GPS signals. The vehicle to vehicle link is at most several hundred feet so the location of vehicle x y is at most several hundred feet from the location of x y . The accuracy of the location of vehicle x y may be further enhanced by applying enhanced dead reckoning methods based on OTD OTDOA SNR or RSSI between the vehicle at location x y and egress points within range.

The vehicle at location x y is not within range of any egress points and cannot receive GPS signals. However vehicle x y is within range of vehicle x y and receives a GPS measurement from that vehicle over vehicle to vehicle link . Additionally vehicle x y can communicate with vehicle to vehicle link with vehicle x y . While vehicle x y cannot receive GPS signals it can communicate with vehicle x y and vehicle x y using vehicle to vehicle links and respectively. Vehicles x y and x y can receive GPS signals and the locations of those vehicles can be transmitted to vehicle x y by way of vehicle x y . Furthermore vehicle x y can receive the location of vehicle x y as ascertained through dead reckoning. Vehicle x y having just entered rectangle has been using enhanced dead reckoning for only a short time an thus has a more accurate location measurement.

Assisted GPS A GPS can also be used to provide a location for a vehicle unable to receive GPS signals or able to receive only intermittent GPS signals such as in U.S. Pat. Nos. 6 131 067 and 6 208 290 both of which are hereby incorporated by reference.

In the context of the hierarchical floating car data network A GPS is adapted so that a participating vehicle broadcasts a location request packet comprising its approximate current position as derived from dead reckoning. An egress point within range receives the location request packet and responds with another packet comprising the satellites in view for the participating vehicle Doppler frequency corrections and other information to enable the on board equipment to calculate the current location of the vehicle. This method is used in vehicle to vehicle communications such as the example given above for vehicle x y wherein one vehicle is unable to receive GPS signals and at least one other vehicle within range is able to receive GPS signals.

A minimum of four satellites must be in view of a participating vehicle to identify all three coordinates with a GPS receiver. If only three satellites are within view a participating vehicle can still accurately derive latitude and longitude but cannot accurately derive altitude.

The egress point communicates the accumulated and processed data with the central server. This occurs periodically for example every hour. In another example the egress point uploads data to the central server when more than one half of its storage capacity is used. The egress point supports remote management and control functions that allow a remote user to retrieve data stored at the egress point.

The egress point maintains a list of other egress points that can be communicated with for intra egress communications as described above of . For example egress points in close proximity to one another may be able to communicate with each other. Egress points delete data that they have accumulated when for example the data has been communicated to the central server or when the data has been communicated to another egress point. Accumulated data is deleted after an explicit positive acknowledgement is received that identifies the successful transfer of custody of the data within the hierarchical floating car data network. Mobile egress points may use a more conservative or dynamic on demand communication schedule to reduce the cost of airtime through the WWAN link.

The wireless communication module comprises a modified IEEE 802.11 device driver that creates an enhanced beacon format as shown in . The enhanced beacon format comprises a legacy IEEE 802.11 beacon a latitude field a longitude field and an altitude field . The dimensions of latitude longitude and altitude are expressed in navigation dimensional units equal to 1 100 000 of a degree. The navigation units may be absolute or relevant to a coordinate position on the surface of the earth. The navigation units may be integers where the smallest unit of measurement is 1 which represents 1 100 000 of a degree. Any compact binary encoding method may be used to represent the navigation unit values. Alternatively floating point coordinates can be sent as part of the enhanced beacon. Floating point coordinates will reduce the location error to less than one meter. Egress points may transmit legacy beacon packets only enhanced beacon packets only or combinations of the two. Egress points may interleave legacy and enhanced beacons to reduce network overhead and to maintain ubiquitous compatibility across egress points and legacy IEEE 802.11 devices.

The egress points are configured to operate on a frequency channel specified by the central server which maintains a channel frequency allocation map. If wave propagation conditions indicate that there is a need to change to a different channel then the egress point requests a new channel from the central server. The channel frequency allocation map is used throughout the hierarchical floating car data network and the egress points are not regularly reconfigured to switch channels rather they request channel reallocation from the central server. Additionally before an egress point switches channels it broadcasts that switch to the participating vehicles within range. Every egress point in the hierarchical floating car data network receives updates comprising a new frequency allocation map when the frequency allocation changes. The frequency allocation map may also be transmitted at regular intervals. Participating vehicles are assigned the same frequency channel as the egress point with which they are in range of. In this way a participating vehicle will seamlessly receive beacons from an egress points as it comes within range. If an egress point has changed its frequency channel participating vehicles that have received notice of the change in frequency channel communicate this information to other participating vehicle via the vehicle to vehicle network.

The egress points broadcasts beacons every 100 ms. Alternatively the egress points may vary the time frequency at which they broadcast beacons from looms to 1000 ms. This may occur for example if an egress point is within range of a large number of slow moving vehicles. If small numbers of fast moving vehicles are within range the beacon frequency may be set from 10 ms to 100 ms. Statistics concerning the performance of the egress point network are maintained in order to determine the optimal beacon frequency transmission rate.

The processor module comprises an embedded operating system device drivers application programming interfaces APIs and a user space application. The embedded operating system is embedded Linux with open source drivers and APIs for the hardware components described in accordance with and for the egress point equipment . Other operating systems may be used. The user space application monitors the status of the software modules and executed a finite state machine such as the finite state machines of U.S. patent application Ser. No. 10 272 039.

The processor module communicates with the interface module the cache module the sensor OBD processing module and the communication protocols module . The cache module is in communication with the sensor OBD processing module and the communication protocols module . The communication protocols module comprises executable code for communicating according to the communication protocols used by the on board equipment for example WLAN. Multiple communications are supported and multiple communication protocols may be simultaneously in use. For example a WLAN link may be active between a participating vehicle and another participating vehicle or egress point and at the same time a WWAN link may be active for uploading or requesting information from the central server.

A WLAN communication protocol also referred to as baseline radio used by the on board equipment is described in U.S. patent application Ser. No. 10 272 039. The baseline radio is expanded to include vehicle to vehicle and vehicle to roadside communications hereinafter referred to as extended radio.

The baseline radio operates according to an enhanced IEEE 802.11 ad hoc mode. It supports broadcast packet transmission so that participating vehicles can establish vehicle to vehicle communication for exchanging traffic data. The enhanced ad hoc mode uses adaptive data rate control methods along with redundant packet retransmission methods at the link layer. The IEEE 802.11 power control static channel assignment and error control coding algorithms are not modified.

The extended radio supports vehicle to vehicle communications as above and also supports vehicle to roadside communications for communicating with an egress point or an IEEE 802.11 access point. To optimize the enhanced ad hoc mode of the extended radio the IEEE 802.11 beacon generation frequency is set to 0 that is there are no MAC media access controller beacons created to synchronize radios. MAC beacons are generally used to optimize the throughput of a WLAN but for vehicle to vehicle communications where links are short lived with low throughput the delay overhead from beacons is expensive and redundant. Also to further optimize the enhanced ad hoc mode there are no authentication association power management or any other control or management IEEE 802.11 packets exchanged. Additionally channel assignment is fixed for all vehicles to avoid long delays resulting from scanning channels for beacons and other traffic activity.

Dynamic channel assignment may be used based on the location of the participating vehicle. A frequency assignment process maps individual channels to individual regions. A participating vehicle learns the current frequency allocation communicating with the central server an egress point or through a synchronization process that can take place between a legacy IEEE 802.11 access point and a participating vehicle located at a home garage or an office parking lot. For example all participating vehicles use channel to establish vehicle to vehicle communication while in exemplary region A and channel in exemplary region B. When a participating vehicle moves from region A to region B the participating vehicle switches from channel to channel .

A region can support more than one frequency channel to provide additional communication capacity. If more than one channel is supported by a region the participating vehicles can switch among the available channels. Since scanning channels in the direct sequence spread spectrum modulation mode requires time unnecessary switching between multiple channels in a single region can degrade overall network performance. In cases where a participating vehicle is unable to establish communication with other elements of the hierarchical floating car data network a corrupted or obsolete channel frequency allocation map may result. In such a case all 11 available channels of the 2.4 GHz ISM band are scanned. For improved performance the scanning process may use a dwell time of less than 100 ms per channel. Once activity is identified at one or more of the channels the scanning process can dynamically loop through only those channels with a dwell time of 250 500 ms per channel. This scanning process is supported by most commercially available 802.11 Wi Fi radios. The device drivers and firmware implementations of the radios may vary. For example the MAC controller from a Cisco Systems radio has an integrated scanner whereas MAC controllers for an Intersil radio usually require an explicit signal to place the radio into scanning mode in order to be able to hop between different frequency channels.

The infrastructure mode of communications is used when communicating with an egress point or access point. The enhanced ad hoc mode is for communicating between participating vehicles that is for spontaneously forming a local wireless network. A method is required for switching between the enhanced ad hoc mode of communication and the infrastructure mode of communications for the on board equipment comprising the extended radio.

The extended radio can switch operation between the infrastructure and enhanced ad hoc mode without having to resort to a global reset of the radio. A global reset is undesirable since all network associations are dropped buffers are cleared and timers are set to their default values. For legacy IEEE 802.11 radios the MAC mode of operation can only be manually set by the user through a programming interface. An application executing as part of the processor module dynamically switches between MAC operation modes. Switching between these modes is transparent to the user. By default the extended radio operates in the enhanced ad hoc mode. If the extended radio comes within range of an egress point and receives a beacon from the egress point or some other legacy IEEE 802.11 access point a device driver generates a MAC signal that notifies the application. A prior art Wi Fi radio operating in ad hoc mode would simply discard the beacon. The application finite state machine uses the received MAC signal to initiate a transition to the infrastructure mode so that the participating vehicle can communicate with the egress point. Under some circumstances if a vehicle to vehicle transaction is occurring then the switch to the infrastructure mode may be delayed. Otherwise if the data collected by the on board device exceed a threshold of the total capacity of the device or the on board device has a pending request such a request for routing directions the application switches modes immediately.

The participating vehicle is configured to be able to associate with any egress point within range for example using a BSSID set to any . A typical association and authentication process comprises a 2 or 4 way handshake which with off the shelf Wi Fi equipment takes 50 1000 ms. The inter access point protocol IAPP proposed in the IEEE 802.11f working group provides mechanisms to establish communication between a plurality of access points using a distribution system DS over a TCP IP or UDP IP network transport protocol. In the hierarchical floating car data network an egress point expedites the process of association with participating vehicles by sharing state information with other egress points regarding the participating vehicle at task. State information includes authentication association and authorization credentials. A credential may include information that uniquely identifies a participating vehicle an end user a Wi Fi radio a back end billing account timestamps location prior transactions and the like. A credential is generated to authorize and protect the content between a first egress point and a participating vehicle. The credential can then be propagated to any other egress point in the network through a secure tunnel. Since a participating vehicle is likely to follow the same route a number of times e.g. commute to work or school an egress point can keep in its cache the credentials for that vehicle after the first encounter. If a participating vehicle communicates with the same egress point then the cached state information continues to be stored as is. Otherwise after a certain period of inactivity an egress point can expunge an idle entry from the cache.

Proactive collaboration may take place between egress points that exist within a route that a participating vehicle repetitively follows. For instance nearby egress points engage a selected state transfer if there is prior indication that a participating vehicle might follow a pre identified common route. Also an end user may have entered a destination into the on board device. In this case the first egress point that establishes communication with that participating vehicle learns the destination and the suggested turn by turn directions that the vehicle is likely to follow to reach its destination. The first egress point propagates this information to other egress points based on their location to the participating vehicle. In this way association authentication and other control and management handshakes can be optimized in all but one of the egress points that a participating vehicle encounters.

Hysteresis is used to avoid false mode switching where an egress point becomes available for a very short period of time and then disappears. Preferably the location of the egress point is such that it optimally faces both directions of traffic. In that case a participating vehicle should receive a regular signal wherein the signal strength increases in strength as the vehicle approaches the location of the egress point. However optimal egress point placement may not be possible or multiple egress points may be co located and interfere with each other. The interference causes misleading SNR and RSSI measurements. To overcome these issues the application decodes the received beacons to determine the relative location of the participating vehicle to the egress points. Based on the relative locations and the velocity and trajectory of the participating vehicle it is determined whether to switch to the infrastructure mode and which egress point to switch to that is which channel to use if more than one egress points are within range. In an alternative embodiment the location of the egress points within range is known to the participating vehicle and the hysteresis calculations are based on actual geographic distances.

Once the participating vehicle transitions to the infrastructure mode it stays there until it loses connectivity with the egress point. When it loses connectivity the application sends a signal to the device driver to switch back to the default ad hoc mode. To avoid long periods where a weak signal from an egress point is received for an extended period of time the application chooses to prematurely switch back to the ad hoc mode using the methods described above.

Position information from the GPS receiver as well as position information from enhanced dead reckoning is used to decide which egress point or access point to switch to in the case of AP footprint overlap. With AP footprint overlap the power emitted from one egress point interferes with an area that is covered by another egress point. Since the on board equipment communicates with only one access point at a time even small signal variations can cause association flip flopping or switching back and forth between different egress points or access points. The position information is used such that for example the egress point closest to the participating vehicle is used even if there is another interfering signal unless there is substantial difference in the quality of the signal due to interference from the surrounding environment.

An automated transmit power control mechanism based on the location of a participating vehicle may be used to reduce interference and increase efficiency. For example a participating vehicle reduces its transmit power level as it approaches an egress point location and conversely it increases its transmit power level as it moves away from an egress point location. In this way interference and near far power and delay capture effects are minimized leading to better utilization of the communication medium.

Turning back to with parallel reference to the modules described above of the processor module is in communication with the sensor OBD module . The sensor OBD module collects and processes data. For example the latitude longitude altitude and vehicle speed and direction from GPS signals are collected and processed. If GPS signals are not available enhanced dead reckoning is used to derive vehicle coordinates. Velocity direction and altitude may also be available from the odometer a compass and a gyroscope. Other sensor measurements from the vehicles on board diagnostics bus can be received by the sensor OBD processing module . Information concerning the speed limit address ranges street names types of roads number of lanes width of the lanes road conditions and the like may also be received. Additional information can be entered using voice commands a keypad or other input device as described above.

Updates to the on board software and in particular the communication protocols module and the sensor OBD processing module can be performed automatically. New or updated version of the software components can be stored in the central server or at the egress points or both. As a participating vehicle comes within range of an egress point that comprises the newer software a high priority upgrade process is executed. During this process the new release of the software is downloaded from the egress point or from the central server through the egress point to the on board equipment of a participating vehicle. Alternatively an end user can manually install new or updated software using a storage medium or a WLAN link with access to the Internet where an automated software upgrade procedure resides. After the new release of the software is downloaded to the on board device it is checked for integrity errors. If no errors are found a self extracting process installs the new components making sure that there is always a fail safe state maintained if for some reason the update process was interrupted or terminated by the end user or due to a power failure of the device. If errors are discovered in any of the steps involved in updating the on board software the device reverts to the last configuration and another attempt is made to download a new image of the update software from an egress point or the central server.

The communication protocols module and the sensor OBD module communicate with the cache module . The cache module collects data from the both modules. Cache module of collects data from wireless communication module and wireline communication module . Wireline communication module provides wireline connectivity for example a wired connection to the Internet. The processing module may collect position and status samples regularly or irregularly as shown in . For example an inertial sensor in a participating vehicle can output samples every 0.1 seconds and an off the shelf GPS receiver can output data every 1 second or more. The on board equipment uses an interrupt based approach that allows all sensor devices to communicate new measurements to the processor as they are received. A peripheral interrupt controller PIC which is usually embedded in the processor permits real time interrupt priority assignment so that no blocking occurs between two or more sensors. Thus all sensor values are collected by the cache and processing can take place.

Since participating vehicles may have different on board equipment they may collect different measurements. shows different measurement types collected by two participating vehicles . The on board equipment of vehicle comprises a GPS receiver and records GPS position data as shown by the squares. Vehicle uses a compass and enhanced dead reckoning to compute is its current position as shown by the triangle.

After collecting a new sensor measurement the measurement is cached along with a timestamp assigning a chronological order to the sample. The sample may also be filtered. A filtering process is invoked asynchronously after receiving the new sensor measurement. The filtering process accepts some measurements and rejects others. The filtering process calculates differences between successive samples. That is samples are evaluated based on their timestamp and the time deltas are maintained. An anchor entry holds a baseline reference entry and all other entries are represented as a delta offset from the anchor entry. If the difference between samples falls below a threshold then the entries are substituted by their average. If entries have the same value for example if the vehicle is stopped redundant entries are discarded.

Prior art databases use begin and end point coordinates to form a road segment. Real roads are represented by connecting several road segments. Road segments allow only the static geometry of the roads to be captured. An on board geographic database for each participating vehicle can be created on the basis of traffic flow segments rather than road segments. Pivotal points as indicated by the black squares and triangles of represent begin and end point coordinates of traffic flow segments. A sample is considered a pivot point if the previous and next sample differ significantly in either direction or velocity. For example vehicle of is moving in the direction indicated by arrow . As can be seen from the samples indicated by the squares vehicle maintains the same direction but reduces its speed around the intersection of the roads. Pivot points are chosen as vehicle slows down and speeds up.

Since a traffic flow segment can be shorter than a prior art road segment generally a relaxation rule is applied to the geographic representation of a polyline comprising many road segments that aggregates a number of small prior art road segments into a single traffic flow segment. Referring back to almost all samples can be considered end points of a prior art road segment whereas only the pivotal samples are the end points used to represent a traffic flow segment. There is a direct relationship between the accuracy of the representation of a road and the amount of pivotal points used.

A database representation based on traffic flow segments is well suited for the on board navigation systems of participating vehicles. The navigation systems continuously calculate multiple routes and suggest an alternative using current road congestion conditions. A traffic flow segment database representation not only saves storage space but also lends itself to efficient innovative routing algorithms which operate on pivotal points rather than road decision nodes such as intersections off ramps and the like.

In another filtering process sensor samples are processed using caching techniques based on application monitoring in order to do a buffer read ahead or decide on the replacement policy. For example a virtual storage access method VSAM can be used. VSAM is a data management system that supports key sequenced data sets KSDS entry sequenced data sets ESDS and relative record data sets RRDS making it very good at efficiently manipulating large amounts of data.

After pivotal sensor points are selected a smoothing function such as least squares fitted to cubic equation or a Kalman filter connects the sample points to produce a vehicle trace. An outlier removal process is applied if some of the pivotal points have a distance that exceeds a threshold from the produced vehicle trace. After the outlier removal process a smooth curve is recalculated based on the remaining pivotal points. Using the accuracy set parameter the process automatically generates shape points on the pivotal data on a segment by segment basis. Any smoothed pivotal data not needed to satisfy accuracy requirements are discarded.

Centerlining is used to deduce cartographic information since the participating vehicle may be driving in the rightmost lane the left most lane in other lanes or may be switching lanes. shows traces from multiple participating vehicles. By analyzing traces or traffic flow segments from a large number of vehicles an automated process can determine if a road segment has multiple lanes in one direction or in multiple directions. Taking the average over all traces from a plurality of participating vehicles traveling in the same direction is sufficient to determine the center of the roadway.

The enhanced ad hoc mode and hierarchical floating car data network enables the accumulation and sharing of multiple traces from participating vehicles. A user does not need to know the exact characteristics of the road nor does a user have to travel on the road in any pre specified manner or speed. Instead merely by using a plurality of traces from normal travel additional database context can be generated to describe the width of a lane or road segment the number of lanes available the geometry of a complex intersection and the like. For example the width of a road segment is the minimum and maximum traces after the removal of the necessary outliers. The number of lanes can be determined from the density distribution of collected traces. Since every trace is associated with a timestamp if a number of simultaneous but space separated traces are collected on the same road segment then that number of traces can be used to count the lanes available at that portion of the road network.

Traces from participating vehicles include speed and direction in addition to location coordinates. By using traffic flow segments represent of the road network in the database dynamic routing guidance algorithms can be made more accurate and detailed. By observing traffic flow patterns of previous samples for a route over a time period impedance weights can be assigned to intersections bridges traffic lights stop signs and the like based on the estimated time it takes for a vehicle to move past that entity. For example entering a freeway in the commute hours might include a traffic flow metering light that on average requires several minutes of wait time. Alternatively in some complex intersections making a left turn might take more time that going through the intersection and then making a u turn followed by a right turn.

Prior art navigation solutions always have to cope with a large number of route decision choices that exist due to the amount of roads available in a geographic area. While the majority of those choices are meaningless from the perspective of an end user a turn by turn routing algorithm cannot easily be programmed to avoid the meaningless choices. By using traffic flow segments along with content from the hierarchical floating car data network a participating vehicle may use prior identified patterns to optimize the organization of the on board navigation database. For a participating vehicle that commutes most days of the year between the same few locations a database is formed comprising navigation and real time traffic guidance for the areas of interest. Other areas can be included in the on board database selectively using the likelihood that an end user might need them at some point. In one example areas or roads within a short distance from locations of interest may be included. In another example common routes chosen by a large population of participating vehicles in the past may be included.

An electronic map update is needed when an old map in an on board database becomes obsolete e.g. every quarter or when a vehicle travels to a new geographical area. The map of the on board database is updated using features and content from the end user s driving patterns. The amount of storage usually required for a complete map is such that only one major metropolitan area can be stored in an on board navigation device. For example a participating vehicle with 100 MB of on board storage capacity dedicated to storing a geographic database may be sufficient to store a map image of the entire San Francisco Bay Area. If the end user needs to update the map database or travels outside the Bay Area for example to Las Vegas Nev. a new map has to be downloaded to the on board navigation device erasing at least portions of the previous map database in order to free some storage space. By way of the hierarchical floating car data network the end user receives map updates continuously as long as there is an egress point or another participating vehicle within range. The on board database is continuously reorganized to reflect the importance of the available content compared to the end user s behavior. Areas where an end user travels are characterized as high value content areas nearby prior collected traces are characterized as medium value content areas far away are characterized as low value content. Through this database organization when new content or updates become available space is freed from the low value content and replaced with the newly received information. For the vast majority of end users the on board database comprises approximately 10 high value content 25 medium value content and 65 low value content. An end user can configure the database to classify content as desired.

Returning to the Las Vegas example when the trip to Las Vegas is taken the low value content is deleted to make room for installation of the new dataset. By default when traveling to a new area an attempt is made to install all available information. In the extreme case that the storage space required to install all available information is insufficient even after deleting all low and medium value content a smaller portion of the new database image is added to provide fundamental support for the new area. As the end user spends more time in the Las Vegas Area the relative content characterization adapts to the new observed patterns downgrading content from the San Francisco Bay Area and eventually completely deleting the Bay Area content if necessary. If on the other hand the end user returns to the Bay Area after only a few days in the Las Vegas Area much of the content from that Bay Area database is still available and the content from the Las Vegas area is downgraded and purged from the navigation device. The end user may adjust the responsiveness of the on board database to new content unlike in the prior art wherein an end user must perform a manual and complete database overwrite when installing a new dataset.

Referring back to the interface module of of serves as an interface between the processor module and the modules comprising the navigation module the routing module the cartography module and the maneuver module . The interface comprises a wrapper function to translate external events and actions into a format compatible with the database application. The database may be modified and those modifications applied to a variety of applications. Metadata tables replacement routines and other known methods may be used to signal changes needed in a database. Some embodiments may not comprise an interface layer.

The navigation module and the routing module and the cartography module and and the maneuver module and are all in communication with the geographic database and . The navigation module searches the database for current location and next direction information. The routing module uses at least some of the information obtained from the navigation module search and also searches the database for complete turn by turn directions to a destination. The cartographic module uses at least some of the information obtained from the navigation module search to display portions of the map pertaining to the region of travel if an on board display or monitor is available. The cartographic module also performs addition searches of the database in order to improve accuracy of the map. The maneuver module which operates when a vehicle deviates from its current route calculates a new path so that the vehicle returns on a correct path to its destination.

The filtering performs feature extraction . Feature extraction identifies distinguishing features that are invariant to certain transformations of the input data. For example when content is accumulated from participating vehicles an on board feature selector algorithm may identify features such as popular routes population centroids congested segments and the like. Part of the feature extraction process for an on board navigation system creates domains that contain information related to the end user s needs.

Classification uses the domains and features from the feature extractor process to assign new information to the right category. The classification process includes learning . Learning uses prior information to better classify new information. One primary function of the classification process is to deal with the variability of new data so that useful new data are not discarded as noise when a condition is not met.

To determine if classified data is credible to update the database statistical reference values are defined based on additional context. For a coordinate adjustment of a road or a road segment the statistical size needed is inversely proportional to the size of the change. For example when more than 10 participating vehicles within one hour suggest a database modification then their average is calculated and the new coordinates are added in the local database along with a credibility probability. As more participating vehicles contribute more new data a new average is calculated and a higher credibility probability is used to characterize the update information. Data can also be classified by average median variance frequency histograms percentiles and the like.

If the participating vehicles use a new flow direction or intersection turn then statistical samples are constructed. Large samples of more than 100 participating vehicles are needed to assign considerable credibility probability. For example providing a local database where a road segment is bi directional a large statistical sample is accumulated that demonstrates that all participating vehicles traveling that particular segment are traveling in the same direction. Additionally the centerlining process for the same road segment reveals a combined trajectory that lies approximately in the middle of the two previous trajectories used to represent the two opposite flows of traffic. This indicates that the road segment has changed from a bi directional road to a road with only one direction of traffic.

There is a trade off between the statistical sample required to make a change in the database and the responsiveness of the system. For example in many European countries when under sever asymmetric traffic flows more lanes from opposite directions might be allocated to the congested flow for just a few hours. In such a case a change to the database is only made after a high volume of vehicles produces a credible statistical sample.

As discussed above the on board equipment executes an application and the baseline radio operates to transmit and receive data packets. Particularly an application finite state machine creates beacon service table BST and vehicle service table VST packets as described in U.S. patent application Ser. No. 10 272 039. BST packets comprise information of only the transmitting participating vehicle and VST packets comprise information of the transmitting participating vehicle as well as other participating vehicles. The application generates BST and VST packets and sets the transmission frequency of the BST and VST packets that ensures stable network operation even with an extremely high concentration of participating vehicles. The application also uses other methods to increase the probability that the transmitted packets will be received. One method uses controlled packet lengths and data rates for optimal signal to noise SNR ratios. Another method transmits the packets a multiple number of times.

Upon receiving a packet the baseline radio captures the packet. The application finite state machine then inspects the contents of the packet. For example the application calculates routing costs for the trajectory that the participating vehicle must travel to reach its destination. Using information received from other participating vehicles traveling in the opposite direction the aggregate flow velocity is estimated a cost is assigned to the corresponding road segments and a shortest path tree SPT routing algorithm is invoked to determine faster alternative routes. Alternative routes are communicated to the user only when there are substantial benefits in time or distance. This also eliminates over shooting wherein congestion is transferred to the alternative route because too many users are instructed to follow the alternative route. The application also alerts the driver of upcoming collision dangers when the flow velocity reduces suddenly shortly ahead of the participating vehicle.

The extended radio also makes use of BST and VST packets to communicate the trajectories of participating vehicles. For the transmission of packets the application communicates with the filtering module to create BST and VST packets comprising the vehicle s trace.

In the on state the application constructs packets of digital data. Packets are constructed of a limited and variable length. The limited and variable length nature of the packet significantly increases the probability that other on board equipment or mobile communication devices receive the packet of digital data as described in U.S. patent application Ser. No. 10 272 039. Since the participating vehicle may be required to transmit or receive large volumes of data the extended radio selectively sets the packet size to the maximum allowed length as specified by the IEEE 802.11 standard which is 2 304 bytes.

A packet burst can preemptively occur even if a BST or VST is queued for transmission . Specifically when in ad hoc mode the application broadcasts BST and VST packets in the same manner as described for the baseline radio in U.S. patent application Ser. No. 10 272 039. Additionally the application broadcasts packet bursts along with the BST and VST packets. A participating vehicle that broadcasts packet bursts can purge data packets from its storage area if at least one other participating vehicle has acknowledged the reception and custody of the packet burst.

The packet or packet burst at the radio is queued which includes applying a priority scheme. Next when the medium is idle the packet is transmitted and the participating vehicle transitions to a receive mode . As will be described with reference to after transmission of the packet burst to an egress point the egress point will issue a negative acknowledgment packet to the participating vehicle in the event that the packet burst was not received properly or rejected by the egress point. The negative acknowledgement packet is received by the participating vehicle as will be described with reference to .

Since in the infrastructure mode there is usually a small time window within which to transmit and receive data throughput is maximized albeit at the risk of losing some data packets. Therefore it is desirable that a participating vehicle that comes within range of an egress point uploads as much data as possible and receives a confirmation from the egress point so that it can purge the data from storage or memory thus freeing up storage space for more data. Unicast data packet exchange is used in the infrastructure mode and the default IEEE 802.11 MAC layer retransmission mechanism is used for instances in which a packet was not received successfully.

Concurrent with the receive mode the link with the egress point is monitored. If the link is lost that is the participating vehicle loses communication with the egress point it is determined if a negative acknowledgment was received while the link was active. If a negative acknowledgement was not received it is assumed that any transmitted packets were successfully received by the egress point and those packets are flagged . Flagged packet may be deleted by the participating vehicle. Next a transition is made to the receive mode . If a negative acknowledgment was received the radio transitions to the receive mode and the packets are not deleted.

The decision to accept or take custody of the packet burst or reject the packet burst is based on the amount of resources available at the participating vehicle as well as its trajectory and connectivity. When a participating vehicle has an excessive amount of data stored in its memory and another participating vehicle has very little data in its memory the first vehicle transmits some of its data to the second vehicle. The trajectory of a participating vehicle is considered in ascertaining whether to assume custody of data from other participating vehicles. If a participating vehicle is moving towards an egress point then accumulated data can be uploaded to a higher layer of the hierarchical floating car data network and from there to other participating vehicles. In this way a participating vehicle acts as a mobile router transferring data from other participating vehicles to an egress point. Alternatively a participating vehicle that has WWAN capabilities can transmit data received in the ad hoc mode from other participating vehicles directly to the central server. From the central server the data can be transmitted to egress points and participating vehicles.

When the beacon packet is received by an egress point the egress point obtains routing instructions from its regional database. If there is no regional database at the egress point as may be the case with a mobile egress point turn by turn directions can be obtained from previously collected traces received by the egress point from other participating vehicles. Also the egress point can forward the routing request to another egress point that has a regional database or the routing request can be forwarded to the central database.

Another participating vehicle within range may also receive the beacon and respond with a packet comprising a series of routing instructions to the destination. The response packet can be constructed from a query of the local database of the participating vehicle that received the beacon or from a destination approximation algorithm. For example a participating vehicle that originated from a location nearby the requested destination may return its complete trace in inverse order as a routing aid to a requesting vehicle . This may be useful in obtaining at least partial instructions until another participating vehicle can provide further assistance.

If a participating vehicle requesting or receiving a request for directions has only a street name in its database but no data to produce turn by turn directions the vehicle derives the coordinates of the destination using an on board reverse geocoding application process. Using those coordinates a surrounding minimum bounding rectangle serves as the designated destination. If another participating vehicle within range has any kind of overlap routing information within the designated destination then a packet comprising the routing information is transmitted back to the requesting vehicle to facilitate routing decisions. The amount of overlap or the distance between the destination and the closest geographic location from the received routing information is compared against a threshold to determine its relevance.

Referring back to when a packet is received a transition from either the on state or the off sate to the rx packet state occurs. In the rx packet state the packet contents such as BST and VST data are extracted processed analyzed and stored. After the received packet has been determined that it comprises new data a self interrupt causes a transition from the rx state to the sensor state for further processing as shown by the NEW SAMPLE transition arrow.

If the further processing produces statistical confidence that the local database needs to be updated then a transition occurs from the sensor state to the database state as shown by the UPDATE DATABASE transition arrow. The database state comprises a hash table with data available from U.S. Census sources along with a query response interface for input output. Alternatively the database state comprises direct system calls to commercially available geographic databases. The data available in the database state can be accessed by all other states in the application.

The egress point software of and the on board software of include a geographic database respectively. Geographic databases have many different formats. In participating vehicles the geographic database is referred to as a local database. The local database comprises a compressed limited data set that covers particular areas of interest or travel. In the egress points the geographic database is referred to as a regional database or an egress point database. The egress point database comprises a data set of the region covered by the egress point. The egress point database may also comprise data on additional regions outside the range of the egress point if the egress point equipment has sufficient memory and storage. The central server comprises the central database which comprises data of all regions.

Referring back to a shape algorithm is applied to generate the geometric representation of present map features such as lines polylines curves rectangles polygons and the like. Next control points are derived that are used to represent complex features generated from the shape algorithm . Pivotal data is continuously loaded from the on board sensor modules and additional context is derived. As described previously additional context is generated to classify content based on the end user s preferences and behavior. If additional context is available it is used to determine the area of interest based not only on the current location of the participating vehicle but also on the features that are most likely to be used from the end user driving the vehicle.

Using the additional context to define the area of interest and classify the collected sensor data a pattern matching algorithm is used to compare validate and integrate the information available. Many pattern matching algorithms may be used. Some examples include maximum likelihood estimation Bayesian estimation discriminant functions neural networks and machine learning.

Upon completion of the database update the state machine returns to the sensor state and then back to the state that caused the transition to the sensor state .

In most geographic databases roads are classified based on the amount of detail they provide. For example in one database four levels of detail are used. At level major interstate freeways are included. At level interstates highways and expressways are included. At level interstates highways expressways and main residential streets are included. At level all available roads are included. Turn by turn routing algorithms use the layered structure of the database road representation to expedite the process of discovering the route to the destination. A common approach includes after setting the origin and destination points applying routing at the highest level for areas nearby the origin destination points and for the remaining uncovered areas applying routing search algorithms using road detail information available at level .

Sometimes traces from participating vehicles may correspond to off road routes and not a new road or an additional lane. For example a driver may drive through a gas station to avoid a traffic light at an intersection. That route should not be considered as an indication that the intersection has changed. In another example the trace of a vehicle using a bike lane or the emergency lane should not be considered as an indication of a new available lane. Also overlapping areas such as bridges overpasses and tunnels should not be considered intersections. Trend analysis of the samples is used to avoid situations such as these. Trend analysis is based on linear regression equations. Many other techniques may be used.

Errors can also be produced when calculating average flow speed for road segments comprising both carpool lanes and regular lanes. On many large roads a carpool lane or high occupancy vehicle HOV lane is reserved for use by vehicle carrying more than one passenger. When the speed of the vehicle is recorded as discussed above some vehicles will appear to be moving much faster than other vehicles producing an artificially high average flow speed. If the sample is large enough the error can be reduced since a much larger proportion of vehicles travel on non HOV lanes over during a period of time. For example if 75 of participating vehicles are not in the HOV lane then using the median of all readings for a road segment leads to a number much closer to the realistic flow speed. Alternatively using the relative location of participating vehicle along with speed can also provide accurate results. For example a participating vehicle with a trace that appears on average to be on the 10 of the leftmost traces previously accumulated for a road segment is very likely to be using an HOV lane. This is further the case if the vehicle is moving at a much higher average flow speed than vehicles with traces on the rest of the road segment.

One common and standard interchange format for geographic databases is the Geographic Data File GDF format. GDF is used by the International Standards Organization ISO and Committee European pour Normalization CEN . Another common interchange format is the Spatial Data Transfer Standard SDTS . Another format called openGIS from the Open GIS Consortium can be used to represent GIS data from various database providers. Many methods and systems may be used to form the geographic databases from sensor data from the participating vehicles as they travel the transportation network such as the method and system of U.S. Pat. No. 5 953 722 which is hereby incorporated by reference.

The structure of the geographic database supports methods to search and identify objects of interest. An object of interest comprises unique database semantic identifiers and enhanced characteristics to facilitate interpretation of database entries. In the GDF model a node edge point line area federal information processing standards FIPS relationship source document and a name are objects of interest. A set of nodes or edges X Y Z values attributes text of a name geometric composition and any descriptive information are characteristics. A sub attribute may be used with a characteristic to define a limitation for an object. When a characteristic is associated with an object it is given a value.

A database object can be identified by either an explicit reference when a unique identifier is available or by a descriptive reference when a portion of the characteristic data forms the database query. The database publisher is responsible for defining the reference applicable to a database object the format of the references and the fields that comprise a reference.

There are two kinds of updates that can take place in a database an incremental update and an insert or delete update. An incremental update is for updating old data with current data. An insert or delete update is for inserting new information or deleting old information. For example a change in the allowable traffic direction is an incremental update whereas a new street entity name and direction is an insertion update. All updates are accompanied by control metadata that ensures the integrity of the database before and after the update. As an update is processed the database transitions between valid states and always maintains a valid fallback state in case of database instabilities.

An update identifier is a number that uniquely identifies the updating process. Since many participating vehicles and egress points can generate database updates an update identifier comprises two fields a unique participating vehicle or egress point identifier and a wrap around sequentially increasing integer which is based on the number of updates produced from the same source. The update identifier also comprises a dependency field a database identification fields a timestamp and a number of actions field. The dependency field is a set of update identifiers that must be successfully completed prior to the current update. The database identification field is the identifier of the database being updated. The timestamp is the time period during which the update information became available. The number of actions field is the number of updates requested from the source of the additional information that is the participating vehicle or egress point.

The update identifier also comprises the database actions. The database actions comprise a detailed description of the nature of the update to be performed. The types of actions are add and object delete and object add a characteristic delete a characteristic and modify a characteristic. An action comprises the fields a credibility factor that comprises the statistical sample collected before the update was generated an object reference that provides a pointer to an object an old data state and a new data state comprising the old and new contents of the object. The contents of the old data state and the new data state change according to the type of the action that is required.

An action is performed if the statistical sample described by the credibility control field exceeds a threshold. If there is no strong statistical evidence to apply an update the action is discarded. Calibration using past results can take place to adjust the credibility factor if it appears to be too high to too low.

The geographic database and the updates can be represented in different formats. In that case a wrapper may be used to translate a proprietary database format to a non proprietary database format incorporate the new updates and then translate the resultant database to its original proprietary format. A metadata table can be used to translate data from a future version database to a database in use by a participating vehicle. If a metadata table cannot provide the necessary version translation replacement routines are used. A replacement routine replaces native code from the interface layer or a navigation application. To speed up execution of the replacement routine they may be compiled to an interpreted machine independent format. Portions of the metadata engine may be written in a Java virtual machine JVM environment. If memory is limited replacement functions may be loaded into memory during initialization or during run time as needed.

To ensure stability and continuous operation of the database of the central server a duplicate copy of the database is maintained. A participating vehicle or egress point uploads information to the central server. A database modification process similar to that described above compares the new information with the current database contents and creates a transaction data file that contains all necessary actions that need to be executed. Each transaction identifies the data entity affected and the kind of modification to be made to it. A unique transaction ID is assigned to each transaction in the data file. The resultant file comprises a series of modifications to be made to the second database. Once the second database has been successfully updated the original copy of the central database is checked out to apply the modifications stored in the transaction file.

Through the hierarchical floating car data network database updating is redefined through a layered data centric architecture. Egress points for example comprise a portion of the central database that covers their geographic vicinity. Egress points upload their modified regional databases along with their accumulated data to the central server. Using a unique egress point region identifier the central server directly integrates the regional database.

When exchanging databases or routing traces compression methods utilizing data represented as deltas can be used such as in U.S. Pat. No. 6 460 046 which is hereby incorporated by reference. Curve fitting methods linear approximation and other methods can also be used. Huffman coding may be used where Huffman trees can be created that correspond to different information layers of the database such as in U.S. Pat. No. 6 393 149 which is hereby incorporated by reference. If processing requirement for compression and decompression are high thereby causing processing bottlenecks less efficient compression techniques may be used. Scaling methods may be used to select sample points along new or modified trajectories in much the same way a variable segment length describes a complex line.

The foregoing detailed description has discussed only a few of the many forms that this invention can take. It is intended that the foregoing detailed description be understood as an illustration of selected forms that the invention can take and not as a definition of the invention. It is only the following claims including all equivalents that are intended to define the scope of this invention.

