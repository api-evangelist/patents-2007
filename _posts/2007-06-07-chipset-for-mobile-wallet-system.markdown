---

title: Chipset for mobile wallet system
abstract: The invention presents a chipset for a mobile wallet system in a communication terminal having a SIM socket and a RFID antenna. The chipset includes a wallet module and a controller module. The wallet module has a contactless interface port coupled to the RFID antenna and a wallet memory for storing wallet applications. The controller module, connected to the SIM socket of the communication terminal, has a controller memory stored with SIM function software, mobile wallet application software and software to control the wallet module. The controller module is powered through the SIM socket, and the wallet module is powered through the SIM socket and the RFID antenna.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07865141&OS=07865141&RS=07865141
owner: Silicon Storage Technology, Inc.
number: 07865141
owner_city: Sunnyvale
owner_country: US
publication_date: 20070607
---
The present application is related to and claims the benefit of priority of the provisional application application Ser. No. 60 813 440 filed on Jun. 15 2006 entitled Method and apparatus for mobile wallet chip set and system of which the present application is a non provisional application thereof. The disclosure of the foregoing application is hereby incorporated by reference in its entirety including any appendices or attachments thereof for all purposes.

The present invention relates to a chipset for a mobile wallet system and more particularly to a chipset implemented into a SIM card in a communication terminal e.g. a mobile phone in communication with a contactless reader.

The mobile phone industry has been trying to implement mobile wallet functions into mobile phones for the last few years. The most well known is the i mode mobile wallet of NTT DoCoMo implemented by a Sony Felica contactless IC soldered onto the motherboard of NTT s 3G mobile phones. Other approaches include using Philips NFC Near Field Communication IC or Infra Red port. All these approaches have suffered from high entry cost because a new phone must be obtained to acquire the mobile wallet functions. It is more cost effective to implement mobile wallet functions on a SIM card which cost much less than purchasing a new phone.

Recent solution for the mobile wallet functions in the industry have been devised by utilizing existing dual interface smart card IC chip provided with both contact and contactless ports such as the Philips Combi chips. These IC chips have two major problems. First the Combi or dual interface IC chips are traditionally employed for banking cards specifying small non volatile memory typically EEPROM while the SIM cards need a much larger memory capacity which are beginning to be built by state of art flash memory technology. Second currently available dual interface IC chip can not have contact port CM and contactless port CL operating simultaneously. But this concurrent operation is required for a mobile wallet to work in SIM socket in mobile phones. Besides the conventional Combi chips are limited to a low speed CPU and a small non volatile memory because it has to operate under the low power limit imposed through the CL port. The above mentioned problems are primary issues for a mobile wallet module to work within a SIM socket in mobile phones.

There have been a few patent applications regarding mobile wallet applications for payment or ticketing such as U.S. Pat. No. 7 114 179 entitled Method and system for ordering loading and using access tickets describes a ticket system wherein tickets are downloaded into SIM card memory module and a contactless interface in mobile phone is used to send ticket to access controlled device. U.S. Pub. No. 2002 0177407 as illustrated in is a block diagram showing a configuration of a dual interface IC card for a portable telephone. This IC card comprises a memory for storing information of electronic tickets or service points a CPU Central Processing Unit for performing interface control with respect to the external and access control to the memory and the like. Furthermore the IC card is provided with an antenna a contactless type I F interface portion a physical contact and the like. The antenna performs transmission reception of data regarding use of an electronic ticket or the like with an external system that is a contactless reader not shown via a radio link R for IC card namely RFID and is intended to realize a contactless type interface. The contactless type I F portion provides an interface of data transmission reception using the antenna . On the other hand the contact is electrically connected with a contact not shown of a portable telephone set and intended to realize a contact type interface. In this way the IC card has both of the function as a contactless type IC card and the function as a contact type IC card. In other words it is just like typical dual interface smart cards that are commonly in use these days. U.S. Pub. No. 2002 0177407 basically describes the idea of the placement of a dual interface IC card into a mobile phone. It failed to address any of the technical difficulties that must be solved to make a real world implementation.

As discussed above the idea of SIM card added with contactless interface have been described many times while most of the prior efforts are vague conceptual designs. None of them reveal practical real world implementation let alone a mass produced solution that is achieved by the chipset in this invention. On account of the problem the prior art brought about there is a resulting need for a chipset to cope with the above mentioned problems. The present invention introduces an optimized chipset enabling immediate widespread usage by implementing the chipset having a wallet module in a SIM Subscriber Identity Module card that conforms to GSM11 11 form factor including a 2G GSM SIM card a 3G USIM Universal SIM card a CDMA Code Division Multiple Access RUIM Removable User Identity Module card a China PHS Personal Handy phone System SIM card or other mobile communication ID cards. Unlike the existing phone based solutions the present chipset provides a simple cost effective solution while is applicable to all kinds of mobile phones.

In light of the prior art limited by the above problems it is an object of the present invention to provide a chipset for applications in a mobile wallet system which is implemented into a SIM card.

In accordance with an aspect of the present invention a chipset is designed for a mobile wallet system in a communication terminal having a SIM socket and a RFID antenna in communication with a contactless reader. The chipset includes a wallet module and a controller module. The wallet module contains a contactless interface port coupled to the RFID antenna a serial port coupled to the controller module and a wallet memory for storing wallet applications including e purse balances electronic tickets and keys ID s etc. The controller module has a first serial port connected to the SIM socket of the communication terminal a second serial port coupled to the wallet module and a controller memory stored with SIM function software mobile wallet application software and software to control the wallet module. The controller module is powered through the SIM socket while the wallet module is powered through the SIM socket and the RFID antenna.

Preferably the wallet module further contains a first I O buffer receiving commands from the controller module a second I O buffer for holding the commands from the contactless reader a command arbitration module for selecting between the first I O buffer and the second I O buffer an authentication and encryption module for securing communication with the contactless reader and the controller module and a command execution module for performing various operations in accordance with the commands. All modules mentioned above are implemented in hardwired logic to achieve small chip size and low cost.

Preferably the wallet module further contains a by pass unit implemented in hardwired logic for decoding the commands from the contactless reader. The decoding decision is to route the commands to the second I O buffer for execution inside the wallet module or to the serial port of the wallet module for transmission to the controller module for command execution.

Preferably the wallet module includes the wallet memory having a capacity many times of a standard Mifare chip which is either 1 KB or 4 KB.

Preferably the wallet memory is divided into a plurality of banks. Each bank has a capacity of 1 KB or 4 KB corresponding to one Mifare chip.

Preferably the wallet module further includes a non volatile register which can be loaded with a bank index by the controller module and used for selecting an active bank. The active bank of the wallet memory is accessible by the contactless reader.

Preferably the wallet module as well as the controller module support standard contactless protocols. Certainly the mobile wallet system comprises mobile communication ID cards that conform to GSM11 11 standard form factor including a GSM SIM Subscriber Identity Module card a GSM USIM Universal SIM card a CDMA Code Division Multiple Access RUIM Removable User Identity Module card and a PHS Personal Handy phone System SIM card.

In accordance with a further aspect of the present invention the wallet module is not a dedicated hardwired logic implementation. Instead functions of the wallet module are implemented by software codes executed on a programmable controller. In this manner a standard off the shelf dual interface chip or a Combi chip can be utilized to implement the wallet module.

The present invention discloses a chipset for a mobile wallet system and the objects and advantages of the present invention will become more readily apparent to those ordinarily skilled in the art after reviewing the following detailed description. The present invention needs not be limited to the following embodiments.

Please refer to . It illustrates a preferred architecture of a chipset for a mobile wallet system in a mobile phone according to the present invention. As shown in the chipset in communication with a contactless reader contains a controller module and a wallet module in the case of a two chip chipset solution. Alternatively the controller module and the wallet module can be integrated into a single IC chip. The controller module has a contact CM port a serial I O port hereinafter referred to as SIO and a controller memory typically in the range of 64 KB to 1 MB for storing SIM function software mobile wallet application software and software for controlling the wallet module . The CM port normally a standard ISO 7816 UART interface which is coupled to a SIM socket not shown in the mobile phone. Likewise the wallet module has a SIO port a contactless CL port and a wallet memory to store wallet applications including account balance purses tickets keys etc. The interconnection between the controller module and the wallet module is accomplished by the SIO ports and which can be realized by ISO 7816 UART or SPI Serial Peripheral Interface or other similar serial I O channels while the CL port is coupled to a RFID antenna not shown for communication with a contactless reader .

An important aspect of the present invention is how the chipset modules are powered. The conventional Combi chip controller is powered by both a SIM socket of a mobile phone and an RFID antenna attached therewith while the controller module is powered through the SIM socket only which suggests that the controller module operate on the power supplied by mobile phone battery. The power supply from the phone battery is sufficient to support the power consumption requirement for a large memory 1 MB likely and a high performance controller containing 32 bit CPU needed for state of art SIM software. The controller of conventional Combi chip must be limited to low speed 8 bit CPU and small memory because it has to work under extremely low power supplied by the RFID antenna. For better results the wallet module is powered through the SIM socket and the RFID antenna. Besides the wallet module can communicate with the contactless reader even when the SIM socket is not powered i.e. the mobile phone is turned off or runs out of battery. This is an important usage factor because the mobile wallet module must be usable even when the mobile phone battery runs out or the controller module doesn t function. A further advantage is that the RFID antenna current drain is quite low since it only needs to supply power to the wallet module . Accordingly much longer reading distance from contactless reader is made possible in contactless applications.

The wallet memory of the wallet module may have a capacity ranging from 1 KB to 4 KB consisting of sectors of 64 bytes for storing wallet applications. Typically memory capacity and data storage format of each sector is made the same as that defined in the Mifare chip which sets the industry standard for contactless smart card applications. Alternatively the wallet memory has a capacity of 16 KB to 64 KB so it can be further partitioned into 16 banks for example. Capacity of each bank corresponds to that of one Mifare chip. Therefore the wallet module can keep the data of 16 Mifare chips which may represent transit fare cards for 16 different cities. As illustrated a bank index register in the wallet module is stored with bank indexes written by the controller module to select an active bank out of the 16 banks and the selected bank can be accessed by the contactless reader . Values of the bank indexes within the bank index register are non volatile so as to persist if the phone power is not available.

In this embodiment the serial interconnection as described above enables command execution and data flow between the controller module and the wallet module to realize mobile wallet applications. The wallet memory where the wallet applications data are securely stored allows commands and data flow from the contactless reader the mobile phone and mobile network through the controller module . For example in a transit fare card application an account is stored in the wallet memory of the wallet module . The contactless reader in a train station request access to the wallet module by way of the CL port to deduct train fare from the account stored in the wallet memory . The mobile wallet application software running on the controller module displays a set of menus on the phone screen. One menu is to display balance of the account which is obtained by the controller module by sending a command through the SIO ports and to retrieve the account balance out of the wallet module . Another menu may display recharge option wherein the controller module first use GSM network communication channel by way of the CM port to obtain authorization from a banking server to withdraw money from a bank account and the money is credited to the account in the wallet memory by sending an Add command to the wallet module .

Please refer to . It illustrates an optimized chipset in communication with a contactless reader according to the present invention. The chipset includes a controller module and a wallet module in communication with a contactless reader . The controller module has a CM port coupled to a SIM socket of a mobile phone a SIO for communicating with the wallet module and a controller memory stored with SIM function software mobile wallet application software and software to control the wallet module . The wallet module is a dual interface module equipped with a SIO port and a CL port that support industry standard contactless protocols transmitted via interfaces like the Mifare ISO 14443 type A Felica ISO 14443 type B and the like. The protocols are transmitted by means of APDU Application Protocol Data Unit or data command packet. A by pass unit is provided to route the packet oriented protocols or command packets from the SIO and the CL port . The commands from the SIO port are always delivered to a CM I O buffer while commands received from the CL port are sent to a CL I O buffer when the commands are intended for execution inside the wallet module.

The core of the wallet module is a WPU Wallet Processing Unit . The WPU includes a command arbitrator to select the commands between the CM I O buffer and the CL I O buffer an authentication encryption unit for authenticating and encrypting the selected commands to secure communication a command execution unit that executes a set of commands that operate on wallet applications data purse ticket or keys kept in a wallet memory and a bank index register stored with bank indexes written by the controller module . Typically a set of commands specific to the standard contactless protocols are defined for command execution of the WPU or Mifare chip including read write increment decrement and the like. In this embodiment hardwired logic is utilized to implement operations described above so as to achieve a smallest chip size low cost and low power consumption.

Whenever an incoming command from the CL port is not included in the defined set of commands for the WPU the command is routed to the controller module by the by pass unit through the SIO port for command execution. Otherwise the incoming command is executed in the WPU . The by pass unit features allowing new applications with new commands to be installed on the contactless reader . A corresponding new wallet application program can be downloaded into the controller module to process these new commands sent from the contactless reader . Therefore the set of commands is made extensible by the by pass unit .

In practice the controller module sends the wallet module the defined command set specific to the contactless protocols coming from the contactless reader through the CL port . These commands provide encryption and authentication supports for securing the communication between the controller module and the wallet module . Any attack by probing the commands transmission of these two modules therebetween are made useless. A further advantage is that having both the SIO and CL ports running the same command set allows one circuit in WPU to execute commands from both ports and greatly reduce the circuit size. Therefore the controller module behaves like the contactless reader by communicating to the wallet module with the set of commands specific to the contactless protocol from the contactless reader . Namely the controller module sends the same contactless protocol commands via APDU packets to the wallet module as the contactless reader sending these APDU packets through the air with ISO 14443 physical layer modulation protocol. The APDUs are sent from the controller module by way of SIO to the SIO port . The SIO can be a standard ISO7816 smart card UART Universal Asynchronous Receiver Transmitter port or simply a serial I O channel like SPI. Alternatively the SIO can be substituted with an on chip PIO parallel I O port for APDU transmission in case that the controller module and the wallet module are on one single chip. The novel feature is that the contactless protocol APDUs are now transmitted by way of contact mode port by the controller module . In other words the controller module behaves like the contactless reader and the wallet module actually works with two readers one is the contactless reader and the other is the controller module .

Philips Mifare chip is applied in the majority of today s transit fare cards and has a 1 KB non volatile memory divided into 16 sectors of 64 bytes each for storing wallet application associated information. Many applications may occupy several sectors which leads to sector usage conflicts between different applications. illustrates a bank switching architecture for keeping multiple wallets with conflicting sector usage. A large non volatile memory is provided for the wallet module . The large non volatile memory has a capacity capable of holding the wallet applications data of multiple standard wallet chips such as the standard 1 KB or 4 KB Mifare chip. The large non volatile memory is divided into several banks 16 banks for instance. A single bank s capacity equals to the entire memory capacity of a standard wallet chip. Namely each bank represents a single transit fare card as implemented in a standard Mifare chip. Under control of the controller module in one of the 16 banks is selected as an active bank while the others are inactive. The active bank receives commands from the command execution unit and the data therein is accessed or updated. The bank selection can be accomplished via I O pins not shown on the wallet module or the bank index register stored with bank indexes. Value of the bank indexes is written by the controller module and is non volatile so as to persist whenever the phone is off.

Many Mifare based applications with conflicting sector assignments can co exist in the present chipset. The multiple bank features can be very useful in real life. For example a mobile wallet user may keep several often visited cities transit fare cards in his mobile phone which is equipped with the present chipset. He can select the fare card for the city which he has just arrived. The controller module writes value of the bank index corresponding to the selected city fare card into the bank index register .

Please refer to . It illustrates an alternative embodiment of the present invention if the optimized wallet module illustrated in is not available. In this embodiment a controller module and a conventional Combi chip or a dual interface smart card chip that executes functions of the wallet module by means of software are incorporated to implement the present invention. Similarly the controller module has a CM port coupled to a SIM socket not shown in a mobile phone a SIO communicating with the Combi chip and a controller memory . The Combi chip includes a SIO port and a CL port coupled to a contactless reader a programmable controller for running controller software codes to operate the Combi chip and a non volatile memory divided into a first area for storing wallet applications that is equivalent to the wallet memory in the wallet module and a second area for storing the controller software codes. However the programmable controller built in the Combi chip is rather high in both power consumption and IC cost. The controller module connects to the Combi chip by the SIO which is typically a ISO 7816 UART. All units in the wallet module of such as the authentication encryption unit and the command execution unit are now implemented by the controller software codes running on the programmable controller . Meanwhile the controller module now communicates with the Combi chip using an API Application Programming Interface that is layered on top of ISO14443 or Mifare APDU processing software running within the programmable controller . The APDUs transmitted on the SIO port through the SIO are designed for the API and are no longer in accordance with standard contactless protocols like ISO14443 or Mifare chip.

Please refer to . It illustrates the chipset of residing on a SIM card according to the present invention. The controller module serves as a GSM U SIM controller and thus resides within a SIM card including a GSM SIM Subscriber Identity Module card a GSM USIM Universal SIM card a CDMA Code Division Multiple Access RUIM Removable User Identity Module card a PHS Personal Handy phone System SIM card or other mobile communication ID cards that conform to GSM 11 11 standard form factor. The wallet module resides on the same SIM card as illustrated. The CL port of the wallet module connects to a connector on the SIM card where an RFID antenna is attached. The antenna constructed by a FPC Flexible Printed Circuit Board is preferred. The advantage is the low entry cost for a mobile phone user to use mobile wallet functions by replacing a SIM card instead of obtaining a new mobile phone. It is to be noted that the SIM card shown in represents a new kind of SIM card construction that contains 2 chips and connects to the antenna constructed by FPC.

In conclusion the present invention has great advantages over the prior arts. The concept of SIM card added with contactless interface that are vaguely described in quite many prior arts is now fully realized by the present invention. The chipset allows a practical implementation of mobile wallet system into a low cost SIM card. To enjoy the convenience brought by the mobile wallet system users only need to pay for a new mobile wallet SIM card instead of a costly new mobile phone.

While the invention has been described in terms of what is presently considered to be the most practical and preferred embodiments it is to be understood that the invention needs not be limited to the disclosed embodiments. On the contrary it is intended to cover various modifications and similar arrangements included within the spirit and scope of the appended claims which are to be accorded with the broadest interpretation so as to encompass all such modifications and similar structures.

