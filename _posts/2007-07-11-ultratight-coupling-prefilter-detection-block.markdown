---

title: Ultratight coupling prefilter detection block
abstract: An observation lock detector block receives I&Q correlations and generates error measurement vectors, each including phase, frequency, code, pseudorange, and covariance residual estimates, and generates validity indicator and confidence indicator vectors, one of which error measurement vectors is an output as a selected error measurement vector with a respective validity indicator and confidence indicator vector, both of which selected vectors are communicated to a navigation solution processor in a ultratightly coupled navigation system for providing improved estimations of a navigation solution, the indicators indicating the usefulness of measurement errors, the prefilter detector block comprising discriminators, sequential filters, observation lock detectors and a measurement selector for selecting measurement vector based on phase, frequency, and code discriminations, the measurement errors being residual estimates that are indicated as valid or invalid for dynamic propagation of the residuals in a navigation receiver for improved performance, especially in low signal-to-noise environments, such as, for use in an ultratight GPS navigation system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08027413&OS=08027413&RS=08027413
owner: The Aerospace Corporation
number: 08027413
owner_city: El Segundo
owner_country: US
publication_date: 20070711
---
The invention was made with Government support under contract No. FA8802 04 C 0001 by the Department of the Air Force. The Government has certain rights in the invention.

The invention relates to the field of ultratight navigation systems. More particularly the present invention is related to GPS ultratight coupling navigation receivers.

Navigation systems are increasing dependency upon the global positioning system GPS . The navigation receiver should be able to withstand intentional or unintentional signal interference with robust signal acquisition and tracking. For this reason inertial navigation systems have been coupled to GPS signal tracking and acquisition systems for improved signal tracking and acquisition of the received signal. Inertial navigation systems INS have an inertial measurement unit IMU for processing inertial measurements. Coupling navigation data with the GPS signal tracking and acquisition system improves signal tracking and acquisition. When the inertial measurements of a navigation processor are used with a GPS signal tracking and acquisition system the combined system is said to be coupled. The tightly coupled GPS and INS system uses validated pseudorange and pseudorange rate measurements from the GPS receiver instead of the processed position and velocity measurements. In addition inertial measurement unit data is usually used to assist the receiver tracking loops and enable more noise filtering than would be possible without tracking loop aiding.

The tightly coupled systems have been used with validated pseudorange and pseudorange rate measurements. More recently ultratight GPS and INS coupling has been proposed which drives all signals from the INS navigation solution for a period of time and then examines all signals with respect to the error of the navigation solution. Ultratight receivers do not attempt to control code replicas for exact code phase alignment with the incoming signal but merely seek to observe the deviation of the incoming signal from locally generated replicas and feed that deviation information back to the code replica generators. Ultratight coupling has shown to be more robust in the presence of noise. Ultratight coupling does not require that the replica code track or lock onto the incoming signal. Ultratight coupling systems have been disclosed in U.S. Pat. No. 6 516 021. Observation lock detectors have been developed to extend the concept of lock detection to ultratightly coupled systems. The observation lock detectors enables error measurements to be validated before applying the error measurement to the navigation state estimate and provides a metric of system performance.

All GPS receivers whether uncoupled loosely coupled tightly coupled or ultratightly coupled correlate inphase and quadrature early E prompt P and late L GPS signal replicas with the incoming GPS signal resulting in early prompt and late quadrature correlations that are denoted as I Q I Q I Q. These quadrature correlations have a nonlinear relationship to the difference between each replica code or carrier phase and that of the incoming received signal. The quadrature correlations are therefore used to determine the difference in the replicas code and carrier phase and that of the incoming signal. The difference between the replica code or carrier phase and that of the incoming signal is used to refine the estimate of the navigation state solution because the code and carrier phase of the incoming signal are related to the true range from the receiver to the transmitting satellite as the code and carrier phase of the replicas are related to the estimated range from the receiver to the satellite.

In ultratightly coupled receivers a prefilter is typically a sequential filter that filters the quadrature correlation outputs to estimate one or more quantities such as a pseudorange error pseudorange error rate dot over a pseudorange error acceleration umlaut over carrier phase error a carrier frequency error carrier phase acceleration error a total electron content error TEC a total electron content error rate TEC as well as a measurement covariance matrix M. The output of the prefilter is received by a lock detector. When the estimates are valid then the estimates are forwarded to the navigation state estimator as measurements for determining the navigation solution.

A plurality of nonlinear transforms of the quadrature correlation outputs called discriminators are often used in tracking loop systems. Three types of discriminators are commonly used carrier phase discriminators carrier frequency discriminators and code discriminators. The carrier phase discriminators may simply be the quadrature correlation outputs or a product of the quadrature correlation outputs which results in the data bits being stripped off. The carrier phase discriminators provide the most information but the carrier phase discriminators are also the most nonlinear so that carrier phase information may not be easily extracted by a sequential filter. When all of the epoch information can be extracted from the carrier phase discriminators by the sequential filter there is no need to use the other carrier frequency discriminators or the code discriminators. The phase discriminators contain the most epoch information of received signal epoch timing. The carrier frequency discriminator s functions of the correlator outputs possess no carrier phase information but do contain carrier frequency information. The carrier frequency discriminators do not provide as much epoch information as the carrier phase discriminator. However the carrier frequency discriminator provides information that is more readily extracted by a sequential filter. Sequential filter processing of epoch timing information from carrier frequency discriminators is less accurate than a sequential filter processing of epoch timing information from carrier phase discriminators but the sequential filter processing of epoch timing information from carrier frequency discriminators is more robust. The code discriminators provide the least epoch information but that epoch information provided is the most easily extracted by a sequential filter. A sequential filter processing of epoch timing information from the code discriminators is the most robust but less accurate than sequential filters processing of epoch timing information from the carrier phase discriminators or the carrier frequency discriminators. Existing conventional tracking loop systems use multiple discriminators in conjunction with lock detectors to ensure that the most accurate epoch timing information is being processed only when valid. The less accurate discriminators are used only when the epoch information from the carrier phase discriminators cannot be reliably extracted. Multiple sequential prefilters have been proposed to solve the multipath problem. However each of the sequential filters employed corresponds to a different multipath assumption. Parallel sequential prefilters have been used. Each of the parallel sequential prefilters have a different assumed noise level and apply the prefilters to the same I Q correlations. As such existing systems use a signal discriminator as input to the sequential filters. Consequently existing navigation systems do not ensure that the most accurate and reliable epoch timing information is being extracted validated and used to compute the navigation solution. These and other disadvantages are solved or reduced by the present invention.

An object of the invention is to provide a navigation system using multiple prefilters and observation lock detectors.

Another object of the invention is to provide an ultratight navigation system using multiple prefilters and observation lock detectors.

Another object of the invention is to provide an ultratight navigation system using multiple prefilters and observation lock detectors for providing a measurement error vector.

Yet another object of the invention is to provide an ultratight navigation system using multiple prefilters and observation lock detectors for providing a measurement error vector and a lock indictor and confidence vector.

Still another object of the invention is to provide a navigation system using multiple prefilters and observation lock detectors for providing a measurement error vector and a lock indicator and confidence vector where the lock indicator and confidence vectors indicates accuracy of measurements in the measurement error vector.

The invention is directed to a system receiving GPS signals and uses an ultra tight system with multiple prefilters operating in parallel with observation lock detectors and a single measurement selector. A prefilter detection block provides a measurement error vector of errors and confidence indicators for the measurement errors in the error vector. The measurement selector selects the measurement errors for the prefilter and observation lock detector providing the most reliable measurement errors from all of the multiple prefilters as indicated by the lock indicator and confidence vector. The measurement errors and indicators are used by the system to provide a robust reliable system output. In the case of a GPS navigation processor the system provides the most reliable position and navigation solution. These and other advantages will become more apparent in the detailed description of the preferred embodiment.

An embodiment of the invention is described with reference to the figures using reference designations as shown in the figures. Referring to a global positioning system GPS inertial navigation system includes an ultratight navigation system receiving GPS signals and inertial measurement unit samples from a sensor assembly . The ultratight navigation system provides position and velocity data to a control and display unit . The navigation system functions as a GPS inertial navigation system tracking GPS signals from a plurality of in view satellites not shown. The sensor assembly includes an antenna for receiving received GPS signals and communicating the received GPS signals communicated to the navigation system . The sensor assembly also includes an inertial measurement unit IMU providing the IMU samples that are also communicated to the ultratight navigation system . In the preferred form the IMU may be a microelectromechanical system MEMS IMU embedded in the antenna .

The ultratight navigation system includes a downconverter for frequency downconversion of the GPS signals using a reference oscillator providing a finternal frequency reference. The finternal frequency reference is fed into a timer for generating a reference clock signal. The system further includes an analog to digital A D converter communicating for converting the downconverted GPS signals into digitized GPS samples. The GPS samples are communicated to a navigation processor and to a noise estimator . The noise estimator generates an estimated signal to noise ratio SNR estimate and an estimated amplitude A. The noise estimator communicates the estimates SNR and A to the navigation processor . The navigation processor receives the reference clock signal from the timer for computing a navigation solution. The navigation processor also receives the IMU samples from the IMU . The navigation processor uses an internal frequency reference ffrom the reference oscillator as well as the reference clock signal from the timer in determining the navigation solution. The navigation processor provides the position and velocity data as a navigation solution to a control and display unit .

Referring to and more particularly to the ultratight navigation system includes a navigation processor receiving the digitized GPS samples in a GPS channel . Preferably there is a channel for each GPS satellite in view. The GPS samples are communicated to mixers and for providing demodulated inphase Iand quadrature Qsignals as demodulated quadrature signals respectively using cos and sin demodulation signals from a carrier numerically controlled oscillator NCO driven by the foscillator reference clock signal . The cos and sin demodulation signals are replica carrier signals for carrier demodulating the received GPS samples . The Iand Qdemodulated quadrature signals are received by a correlator . The correlator also receives early E prompt P and late L code replica signals from a chipping code generator . The code generator receives a chipping code clocking signal from a code clock NCO .

The correlator may operate at 50.0 Hz. The correlator provides inphase and quadrature early prompt and late I Q I Q I and Qquadrature correlation signals for a GPS satellite channel . There will be correlator outputs for channels one through N. As such the correlator outputs from a specific correlator output are denoted I Q I Q I and Qchannel correlations. Likewise the output of any block in the diagram can be modified by an additional subscript to denote the output of a specific channel. When the additional subscript is missing the statement applies to all output of the corresponding block of every channel. Thus the correlation outputs for an arbitrary correlator are denoted by I Q I Q I and Qcorrelations. These correlation outputs are communicated to a prefilter detection block . The prefilter detection block also receives the SNR and A noise estimates from the noise estimator . The I Q I Q I and Qcorrelations may be communicated at 50.0 Hertz to the prefilter detection block having a 1.0 Hertz output. The output of the prefilter detection block includes measurement errors lock validity indicators and confidence indicators that are communicated to a navigation state estimator . The time interval T between outputs of the prefilter detection block is referred to as an epoch time interval.

The navigation state estimator receives the measurement errors and indicators from the prefilter detection block of every channel and in turn repetitively computes estimates of the position and velocity in state vector SV and outputs P V position and velocity data communicated to the control and display unit . The V and IMU samples are also communicated to the navigation state estimator . The navigation state estimator uses the IMU samples to propagate the state vector SV that includes the position and velocity estimates P V. At the end of each of the one second major cycles also called an epoch the navigation state estimator updates the state vector SV based upon the measurement errors and indicators from the prefilter detection block from each channel and the IMU samples from the IMU . The IMU samples are repetitively generated for example one hundred times a second and include the differential velocity samples V and the differential attitude samples that are communicated to navigation state estimator . The P V position and velocity data is communicated to the 100 Hz pseudorange and pseudorange rate calculator of every channel that in turn provides a pseudorange rate estimate to the carrier NCO . The 100 Hz pseudorange and pseudorange rate calculator also provides a pseudorange and pseudorange rate estimates to the code NCO that is clocked by the clock reference f. The pseudorange and pseudorange rate calculator also receives calculated GPS satellite position and velocity data P V from a 100 Hz GPS satellite position and velocity calculator . The calculator also receives user clock error estimates CEE from the navigation state estimator . The satellite P V data references the GPS satellite calculated position and velocity. The clock error estimates CEE include a clock phase error and clock frequency error that is the time derivative of the clock phase error. The calculated pseudorange estimate is equal to the geometric line of sight range to a satellite adjusted by the clock phase error estimates CEE and certain signal propagation compensation terms such as the nominal ionosphere and troposphere delays. The pseudorange rate estimate is equal to the relative geometric velocity estimate to the satellite from the user antenna plus the clock frequency error estimate. The 100 Hz GPS satellite position and velocity calculator is driven by the reference clock from the timer . The calculator receives demodulated ephemeris data from an ephemeris demodulator . The ephemeris demodulator generates the ephemeris data preferably from the correlations and otherwise GPS samples .

The correlation process of the correlator is based upon the early E prompt P and late L code replicas generated by the code generator and upon the carrier replica generated by the carrier NCO . As the pseudorange estimates and pseudorange rate estimates from the calculator are refreshed during each one hundred hertz cycle the replica carrier cos and sin signals from the NCO and the early E prompt P and late L code replicas are adjusted. The correlator operating at 50.0 Hz for example enables conventional early prompt and late correlations by providing the early prompt and late I Q quadrature correlations to the prefilter detection block as I Q I Q I and Qcorrelations. The I Q quadrature correlations are used to estimate the residual estimates vector. The carrier and code phase of the replica signals as compared to the received GPS samples have offsets that is phases also known as phase errors.

Referring to and and more particularly to the prefilter detection block receives correlations and noise estimates and provides and M error measurements and a lock indicator and confidence vector comprised of phase frequency and code indicators and measures of the confidence of the phase frequency and code validity indicators called phase frequency and code confidences respectively.

The indicator vector includes a phase lock validity indicator PLI a phase lock confidence indicator PLC a frequency lock validity indicator FLI a frequency lock confidence indicator FLC a code lock validity indicator CLI and a code lock confidence indicator CLC. The measurement selector selects one of the indicator vectors from the respective observation lock detectors and and provides an output lock indicator and confidence vector also including the phase lock validity indicator PLI phase lock confidence indicator PLC frequency lock validity indicator FLI frequency lock confidence indicator FLC a code lock validity indicator CLI and the code lock confidence indicator CLC. The measurement selector also selects and transmits the measurement error vector from the sequential filter which feeds the observation lock detector whose lock indicator and confidence vector was selected.

The prefilter detection block includes a plurality of discriminators including a phase discriminator a frequency discriminator and a code discriminator . Each of the discriminators and receive the correlations and generate respective discriminations D D and D. The phase discriminator is preferably an identity function where the phase discriminations Dare the same as the I Q correlations . The discriminations D D and Dare respectively communicated to a first sequential filter a second sequential filter and a third sequential filter . The first sequential filter receives D D and Das inputs. The second sequential filter receives D and Das inputs and the third sequential filter receives Das input. Each sequential filter and provide respective measurement error vectors to the respective observations lock detectors and . The sequential filters and generate measurement errors provided as a measurement error vector . More specifically the sequential filters and compute the pseudorange error the pseudorange rate error dot over the pseudorange acceleration error umlaut over as well as the carrier phase error the carrier frequency error and the carrier phase acceleration error . The pseudorange error rate dot over is the first derivative time rate of the change of the pseudorange error . The pseudorange error acceleration umlaut over is the second derivative time rate of change of the pseudorange error . The prefilter detection block also computes a measurement covariance matrix M indicating the uncertainties in the residual estimates vector for a number of samples m over a major cycle epoch time T.

In addition to the lock indicator and confidence vector The prefilter detection block outputs the measurement error vector comprising and M. The measurement error vector is received by a navigation state estimator that may have a one second major cycle time period between epochs. In the preferred form the first sequential filter provides a measurement error vector comprising and M. In the preferred form the second sequential filter provides a measurement error vector comprising and M. In the preferred form the third sequential filter provides a and N measurement vector. The measurement selector selects one of the measurement error vectors from the filters and and outputs the selected measurement error vector as an output measurement error vector . The measurement vector from the first sequential filter receives the correlations as Ddiscriminations and provides a full measurement error vector and M.

The carrier phase and frequency errors and code phase errors are used to estimate the measurement error vector including the carrier phase error the carrier frequency error the carrier phase acceleration error that indicates the code phase error the pseudorange error and the measurement covariance matrix M from the prefilter detection block . In operation the prefilter detection block examines the estimates and validity of the output of sequential filters and to determine when any of the measurement error vector outputs should be forwarded to the navigation state estimator . In the case of the first sequential filter the measurement error vector is complete having all of the and M error measurements because phase errors relate to frequency and code errors. In the case of the second sequential filter the phase is a null value and the covariance vector M has the row and column corresponding to the variance of filled with a high uncertainty value so that phase measurement error is referenced as uncertain and the covariances of other estimates with are set to zero so that no inference about can be derived from the estimates of other quantities. That is in the preferred form the measurement vector from the second sequential filter includes a meaningless null phase value with covariance matrix M filled in a respective location with an ultrahigh uncertainty value to render the null phase value uncertain because phase discrimination is lost during frequency discrimination. The third sequential filter provides a null phase value and a null carrier phase acceleration error value of the measurement error vector with a covariance matrix M filled in respective locations with the ultrahigh uncertainly value to render the phase value and the carrier phase acceleration error value uncertain because phase discrimination is lost during code discrimination and the frequency discrimination is exceedingly noisy and practically useless. The covariance matrix M also has zeros placed in the non diagonal elements of the rows and columns corresponding to the and states. Consequently no inference about and can be drawn from elements of the measurement error vector which have lower uncertainties.

In addition to ultrahigh certainty values in the covariance matrix M of the measurement errors the validity and confidence indicators are used to further indicate the ambiguity of the measurement errors. By way of example the carrier phase validity indicator PLI has a value of 1 when the carrier phase error is considered valid and has a value of 0 when invalid. The prefilter detection block outputs the phase validity confidence PLC that takes a value between 0 and 1 indicating a confidence level of PLI. The prefilter detection block also outputs the carrier frequency validity indicator FLI that has a value of 1 when the carrier frequency error is valid and has a value of 0 when invalid. The prefilter detection block also outputs a carrier frequency confidence indicator FLC. The prefilter detection block also outputs a code validity indicator CLI that has a value of 1 when the pseudorange error estimate is valid and a value of 0 when invalid. The prefilter detection block also outputs a code confidence indicator CLC. For the confidences PLC FLC and CLC an output of 0 corresponds to no confidence and an output of 1 corresponds to certainty. For the validity indicators PLI FLI and CLI an output of 1 indicates a valid lock and an output of 0 indicates an invalid lock. The navigation state estimator receives a lock indicator and confidence vector comprising PLI PLC FLI FLC CLI CLC indicators and receives the measurement error vector comprising and M as well as the IMU samples for generating the navigation solution comprising position and velocity P V.

The navigation state estimator receives the indicator vector including the PLI PLC FLI FLC CLI and CLC indicators from the prefilter detection block along with the prefilter residual estimates vector as measurement error. The estimator also receives the covariance matrix M from the measurement prefilter detection block for propagating the CEE and estimated SV outputs. The navigation state estimator can be a conventional Kalman filter that is modified to process the measurement error vectors conditioned upon the validity and confidence indicators of the lock indicator and confidence vector . The carrier phase error measurement is processed when only PLI and PLC indicators indicate that the carrier phase error measurement is valid with at least a predetermined confidence. A carrier frequency error is processed when FLI and FLC indicators indicate that the carrier frequency error measurement is valid with at least a predetermined confidence. The pseudorange error is processed when the CLI and CLC indicators indicate that pseudorange error measurement is valid with at least a predetermined confidence. The code phase error is directly related to the pseudorange error . The clock estimates CEE and state vector SV outputs of the navigation state estimator are adjusted as the carrier phase error carrier frequency error and pseudorange error vary. When the indicators PLI FLI CLI PLC FLC and CLC indicate invalid or low confidence in the carrier phase error carrier frequency error and pseudorange error the CEE and SV are statically propagated without updates that is CEE and SV are propagated without updates. When the PLI PLC FLI FLC CLI and CLC indicators indicate validity and high confidence in the carrier phase error carrier frequency error and pseudorange error the CEE and SV outputs from the navigation state estimator are dynamically propagated using updates of the carrier phase error carrier frequency error and pseudorange error measurements .

In the preferred form the dynamic and static propagation of the residuals and CEE and SV outputs by the navigation state estimator occurs based upon the validity and confidence PLI PLC FLI FLC CLI and CLC of the lock and confidence vector by predetermined criteria. When the indicators PLI and PLC for carrier phase error indicators PLI and PLC are valid with confidence then the CEE and SV outputs are dynamically propagated using carrier phase error carrier frequency error and pseudorange error residual estimates. When the PLI and PLC indicators for the carrier phase error are invalid and FLI and FLC indicators for the carrier frequency error are valid with confidence the CEE and SV outputs are dynamically propagated using the carrier frequency error and pseudorange error residual estimates. When the PLI and PLC indicators for the carrier phase error is invalid and the FLI and FLC indicators for the carrier frequency error are invalid and the indicators CLI and CLC for the code phase are valid with confidence the CEE and SV outputs are dynamically propagated using the pseudorange range error residual estimate. When the indicators are invalid for the carrier phase error the carrier frequency and code phase the CEE and SV outputs are statically propagated without updates using the carrier phase error the carrier frequency error and pseudorange error residual estimates. In this manner the navigation state estimator dynamically propagates the CEE and SV outputs for adjusting tracking of the code phase and carrier phase when the residual estimates are valid with confidence and the navigation state estimator statically propagates the CEE and SV outputs for maintaining tracking of the code phase and carrier phase when the residual estimates are invalid. As such the navigation processor tracks with dynamic updates to the CEE and SV and consequently the carrier phase and code phase only when the residual estimates are valid. The SV output may contain an estimated TEC and a position and velocity estimate. The decision to process the residual estimates and by the navigation state estimator is done as in conventional tightly coupled receivers that use outputs from conventional lock detectors to determine when to process the pseudorange range error carrier phase error and carrier frequency error residual estimates.

The discriminators provide discriminations used to determine the measurement errors. In the case of the phase discriminator the I Q correlations are to discriminate phase measurement errors where D k are I Q correlations . The frequency discriminator receives the I Q correlations as inputs and transforms the I Q correlations into frequency discriminations D k I k 1 Q k I k Q k 1 . The code discriminator receives the I Q correlations as inputs and transforms the I Q correlations into code discriminations D k I k Q k I k Q k .

The first sequential filter receives the phase discriminations Dfrom phase discriminator passing the correlations from the correlator receives the frequency discriminations Dfrom the frequency discriminator and receives the code discriminations from the code discriminator and then produces phase measurement error vector comprising the carrier phase error the carrier frequency error the carrier phase acceleration error the pseudorange error and measurement covariance matrix M. The first observation lock detector computes a first lock indicator and confidence vector comprising a carrier phase validity indicator PLI a carrier phase confidence indicator PLC a carrier frequency validity indicator FLI a carrier frequency confidence indicator FLC a code phase validity indicator CLI and a code phase confidence indicator CLC. The first observation lock detector outputs a first lock indicator and confidence vector to the measurement selector . The first observation lock detector receives the phase measurement error vector from first sequential filter along with the SNR and an A amplitude noise estimates from the noise estimator and the quadrature correlation signals .

The second sequential filter receives as inputs the frequency discriminations Dfrom the frequency discriminator generator and the code discrimination Dfrom the code discriminator . The second sequential filter then produces frequency measurement error vector comprising the carrier phase error the carrier frequency error the carrier phase acceleration error the pseudorange error and measurement covariance matrix M. The second observation lock detector receives the frequency measurement error vector from second sequential filter along with the SNR and A noise estimates from the noise estimator and along with the quadrature correlation signals . The second observation lock detector outputs a second lock indicator and confidence vector to the measurement selector . The second sequential filter preferably does not compute the carrier phase error of the frequency measurement error vector. The second sequential filter sets the carrier phase error to zero. The second sequential filter fills diagonal elements of the covariance matrix M element corresponding to the variance of the carrier phase error to the large predetermined ultrahigh uncertainty value. Other elements in the row and column of the covariance matrix corresponding to the carrier phase error are set to zero.

The third sequential filter receives as inputs the code discriminations Dfrom the code discriminator and produces a code measurement error vector comprising the carrier phase error the carrier frequency error the carrier phase acceleration error the pseudorange error and measurement covariance matrix M. The third sequential filter does not compute the carrier phase error or the carrier phase acceleration error but sets and both equal to zero. The diagonal element of the covariance matrix M corresponding to the carrier phase error is set to a first large predetermined ultrahigh uncertainty value. The diagonal element of the covariance matrix M corresponding to the carrier phase acceleration error is set to a second large predetermined value. Other elements of M in the rows and columns corresponding to the carrier phase error and the carrier phase acceleration error are set to zero. The carrier frequency error produced by the third sequential filter is not based upon carrier measurements but is based on the code phase error rate and the fact that the code and carrier phases of the signal are generated coherently both at the satellite and the replica. The variance associated with the carrier frequency error will be much greater than that of the first or second sequential filter for the case where a good carrier frequency or carrier phase measurement is available. The third observation lock detector receives code measurement error vector from the third sequential filter along with the SNR and A noise estimates from the noise estimator and along with the quadrature correlation signals . The third observation lock detector provides a third lock indicator and confidence vector comprising a carrier phase validity indicator PLI a carrier phase confidence indicator PLC a carrier frequency validity indicator FLI a carrier frequency confidence indicator FLC a code phase validity indicator CLI and a code phase confidence indicator CLC. The third observation lock detector outputs a third lock indicator and confidence vector to the measurement selector .

The measurement selector receives as inputs the first lock indicator and confidence vector one from the first observation lock detector a phase measurement error vector and phase measurement error covariance matrix from the first sequential filter . The measurement selector also receives as inputs the second lock indicator and confidence vector from the second observation lock detector and the frequency measurement error vector and frequency error covariance matrix from the second sequential filter . The measurement selector also receives as inputs the third lock indicator and confidence vector from the third observation lock detector and the code measurement error vector and code error covariance matrix from the third sequential filter . The measurement selector outputs one of the phase frequency or code measurement error vectors and outputs a respective one of the first second or third lock indicator and confidence vectors . The selection of the phase frequency and code measurement error vector and the selection of the first second or third indicator and confidence vector can be had by logical processing and rapid threshold determinations for the selection.

When PLC from first observation lock detector exceeds a predetermined first threshold then the phase measurement error vector output from the measurement selector is equal to the values of M from phase measurement error vector from the first sequential filter . The measurement selector also outputs the first lock indicator and confidence vector which equals lock indicator and confidence vector from the first lock detector . This first lock indicator and confidence vector comprises the six indicators PLI PLC FLI FLC CLI CLC.

When the PLC of the first lock indicator and confidence vector from the first observation lock detector is less than the predetermined first threshold and the FLC indicator of the second lock indicator and confidence vector is greater than a predetermined second threshold then the measurement selector outputs the frequency measurement error vector with values of M that are equal to that of frequency measurement error vector one from the second sequential filter . Under these conditions the measurement selector also outputs a lock indicator and confidence vector comprised of the terms PLI PLC FLI FLC CLI CLC. The values of PLI PLC FLI FLC CLI CLC are those from the second lock indicator and confidence vector from the second observation lock detector .

When the PLC term of lock indicator and confidence vector one is less than the predetermined first threshold and the FLC indicator from second lock indicator and confidence vector is less than the predetermined second threshold then the measurement selector outputs a measurement error vector comprised of the terms M . The values of the terms in the measurement error vector are equal to the values of the code measurement error vector that is outputted from the third sequential filter . Under these same conditions the measurement selector also outputs the third lock detector and confidence vector comprising the PLI PLC FLI FLC CLI CLC indicators. The indicators of the lock detector and confidence vector output from the measurement selector is equal to the third lock detector and confidence vector from the third observation lock detector .

Referring to and and more particularly to the first observation lock detector second observation lock detector and third observation lock detector can be made identical to each other. The observation lock detectors and receive a measurement error vector and M for generating indicator vectors. A observation lock detector includes a I Q maximizer a rotation matrices generator an I Q transformer a carrier phase lock detector a carrier frequency lock detector and a code lock detector

The I Q maximizer that receives the measure error vector as a residual estimate vector including M from a sequential filter receives the SNR and A noise estimates from the noise estimator and receives the I Q correlations from the correlator for generating Iand Qmaximized quadrature vector. Iand Qmaximized quadrature vector is generated by combining weighted sums of the I I and Icorrelations into a maximized inphase vector Iand by combining weighted sums of Q Q and Qcorrelations into a quadrature maximized vector Q for each sample time t. The weights W W and Ware chosen so that the Iand Qmaximized quadrature signals have the maximum SNR for each sample time t. By forming Iand Qmaximized quadrature signals the maximizer is diminishing the effect of signal power loss during correlation when the prompt inphase signal Iis no longer aligned with the peak of the autocorrelation function of the spreading code. The I Q maximizer also computes the average signal to noise ratio of Iand Qmaximized quadrature vector by providing the modified SNRsignal as well as the average signal amplitude Aof the Iand Qmaximized quadrature signals. The I Q maximizer outputs Iand Qmaximized quadrature vector and as well as scalar modified noise estimates SNRand A.

The rotation matrices generator receives the residual estimates vector including and generates a rotational matrix array R. The rotational matrix array R corresponds to rotating in reverse an amount equal to the instantaneous carrier phase error also called the carrier phase offset angle t at each sample time t in the epoch T. The carrier phase offset angle t is estimated at each sample time using the value of the estimated measurement error residuals along with the time between samples. The rotation matrices generator operates concurrently with the I Q maximizer .

The I Q transformer receives the rotational matrix array R from the rotation matrices generator and receives the Iand Qmaximized signals from the I Q maximizer for rotating in reverse the maximized vector Iand Qan amount equal to the carrier phase offset angle t at each sample time t in the epoch T for generating the transformed quadrature vector denoted by I Q. the I Q transformer premultiplies a column vector containing I t and Q t maximized quadrature signals by a rotation matrix R t to produce I t and Q t transformed quadrature signals. The I Q transformer then combines the I t and Q t transformed quadrature signals for each sample time t to produce Iand Qtransformed vectors. The Iand Qor transformed vector and the modified noise estimates SNRand Aare then communicated to conventional lock detectors and .

The conventional lock detectors include the carrier phase output lock detector providing the PLI and PLC indicators the carrier frequency lock detector providing the FLI and FLC indicators and a code lock output detector providing the CLI and CLC indicators. The output lock detectors and provide a PLI PLC FLI FLC CLI and CLC indicator vector indicating the validity and confidence of the carrier phase error carrier frequency error and code phase that is related to the pseudorange error .

The carrier phase lock detector is a conventional carrier phase lock detector which receives as input the Iand Qtransformed quadrature vector and the modified noise estimates SNRand A. The carrier phase lock detector outputs an indicator PLI that is 1 when the carrier phase is in lock and 0 when not in lock. The carrier phase lock detector outputs the indicator PLC that takes a value between 0 and 1 expressing the confidence in the correctness of the value of indicator PLI. The carrier frequency lock detector is a conventional carrier frequency lock detector that receives as input the Iand Qtransformed quadrature vector and the modified noise estimates SNRand A.

The carrier frequency lock detector outputs the indicator FLI that is 1 when the carrier frequency is in lock and 0 when not in lock. The carrier frequency lock detector outputs the indicator FLC that takes a value between 0 and 1 indicating the confidence in the correctness of the value of indicator FLI. The code lock detector is a conventional code lock detector that receives as input the Iand Qtransformed vector and the modified noise signal SNRand A. The code lock detector outputs the indicator CLI that is 1 when the code is in lock and 0 when not in lock. The code lock detector outputs the indicator CLC that takes a value between 0 and 1 expressing the confidence in the correctness of the value of the indicator CLI.

Referring to and more particularly to and the I Q maximizer includes a code offset calculator receiving the residual estimates vector M from one of the sequential filters and . The code offset calculator computes an estimate of the code phase offset t for each sample time t where t C T t T t with C c 2 fwhere c and C are constants and c is the speed of light and fis the carrier frequency that is equal to the reference f. The code phase offset vector containing the estimated code phase offset for all sample times in the epoch is given by the code phase offset vector . The code phase offset vector is the output of the code offset calculator .

The I Q maximizer also includes a buffer that receives early prompt and late I Q quadrature correlations for an epoch time T and combines the correlations into a buffered Iand Qvector containing all the early prompt and late I Q quadrature correlations for the entire epoch. Individual quadrature correlations I t and Q t are buffered as the Iand Qbuffered vector. The Iand Qvector containing all the early prompt and late I Q quadrature correlations for the entire epoch T are the outputs of the buffer .

The I Q maximizer also includes a look up table operator that receives the code phase offset vector and looks up the early prompt and late weights W t W t and W t respectively that combine the early prompt and late I t and Q t correlations to maximize the signal to noise ratio at each correlation at time t. The I Q maximizer look up table is used by the look up table operator to determine the weights W W and W respective for early prompt and late I Q correlations. The look up table operator also calculates a degradation factor X t that indicates the fraction of signal amplitude lost when the prompt replica is aligned in time with the autocorrelation peak of the code used. The look up table operator uses the look up table for determining the degradation factor. The look up table operator outputs vectors X W W and Wthat contain the degradation factor X and W weights for every sample time t in the epoch T.

The I Q maximizer also includes a SNR maximizer that receives the weights W W and Wweight vectors from the look up table operator and the Iand Qvectors from the buffer and performs a weighted sum of the early prompt and late correlations for each sample time t to produce the maximized signals I t and Q t . The individual samples are then stored in vectors denoted by Iand Q which the SNR maximizer then outputs. The vectors Iand Q are also outputs of the I Q maximizer . The I Q maximizer also includes a noise modifier which receives the degradation factor vector X and the signal to noise ratio SNR and the amplitude A as inputs and outputs the modified signal to noise ratio SNRand the modified amplitude A. The modified signal to noise ratio SNRand the modified amplitude Aare also outputs of the I Q maximizer where SNR SNR A Aand A A N X t and where N is the number of samples in an epoch.

Referring to all of the Figures and more particularly to the rotation matrices generator includes an angle calculator receiving the residual estimates vector containing from one of the sequential filters and . The angle calculator computes an estimate of the carrier phase offset angle t for each sample time t. A carrier phase offset angle vector containing the estimated carrier phase offset angles t for all sample times t in the epoch T is an output of the angle calculator where t T t T t . The rotation matrices generator also includes a rotation calculator that receives the carrier offset vector as an input. For each sample time t rotation calculator generates a rotation matrix R t which corresponds to a rotation designed to reverse the effect of the estimate of the carrier phase offset t . The rotation matrices R t are grouped together in the rotational matrix array R as an output of the rotation calculator as well as the rotation matrices generator . The I Q transformer receives the rotation matrices R t from the rotation matrices generator and the IMAX QMAX maximized quadrature signals from the I Q maximizer and provides the Iand Qquadrature transformed signals using a matrix wise transformation equation.

In operation the observation lock detectors and determine the validity and confidences of the lock indicator and confidence vector from residual error estimates for the carrier phase error carrier frequency error carrier phase error acceleration and pseudorange error . These indicators are preferably used by the navigation state estimator in the navigation processor so that the invalid residual estimates are not used to dynamically propagate navigation signals such as clock error estimates CEE and other corrections to the state vector SV that are used to adjust the carrier phase and code phase during coherent carrier demodulation and code despreading of the samples . The observation lock detectors and detect invalid residual estimates from the sequential filters and so that the navigation state estimator does not use residual estimates. The observation detectors and deweight the residual estimates with low validity and confidence levels so that the residual estimates are effectively declared invalid. These validity and confidence indicators can be used as a measurement of performance of an ultratightly coupled navigation system. The observation lock detectors and can be used to determine the validity of measurement error vector of the received I Q quadrature correlations .

In the rotator the carrier phase error is a carrier phase error at a time t at the end of an epoch T when T t. The carrier phase offset angle t is the carrier phase error at any time t. That is the carrier phase offset angle t equals the carrier phase error at the time t in the epoch. When t T then the carrier phase offset angle T is equal to the carrier phase error . Each matrix R t of the rotational array R is defined by respective times t within the epoch. As such the rotational array R indicates the carrier phase offset angle t at a point in the epoch. The matrix R T corresponds to a rotation designed to offset the carrier phase offset angle T which is equal to the carrier phase error .

In the maximizer the code phase error is determined by the code offset calculator for looking up the weights W and degradation vector X by the look up table operator . The look up table is used to determine the weights W and vector X from code phase offset . The SNR maximizer then generates the maximized vector Iand Q from the buffered quadrature correlations I Q. The Iand Qmaximized quadrature correlation vector has a maximized SNR at each time t. Concurrently the noise amplitude A is modified into the modified amplitude Ausing the degradation vector X. The modified amplitude Arepresents the degraded amplitude of the I Q quadrature correlations . The modified SRNis the SNR of the Iand Qmaximized vector that is averaged over the epoch. The modified amplitude Ais the average amplitude of Iand Q over the epoch. Rotating Iand Qmaximized quadrature correlation vector by the rotational array R removes the carrier phase offset over time t. The Iand Qtransformed quadrature correlation vector includes maximized I t and Q t quadrature correlations having the carrier phase offset angle t rotated out so that the Iinphase maximized vector is maximized and Qquadrature maximized vector is minimized.

During precise prompt correlations by the correlator the prompt correlations have a peak prompt SNR. When there is a code phase offset between the prompt replica code of the code generator and the spread spectrum code of the Iand Qcarrier demodulated signals the prompt correlation amplitude level is degraded from the peak prompt SNR. The modified SNRand amplitude Aare used by the detectors and to account for the amplitude and Signal to Noise ratio loss due to the prompt code replica not being aligned with the code phase of the Iand Qcarrier demodulated signals

When all of the residual estimates are accurate that is valid with high confidence the Iinphase transformed quadrature correlation vector contains all of the signal power and the Qquadrature transformed vector contains almost no signal power. When the Iinphase transformed quadrature correlation vector contains almost all of the signal power and the noise has not overwhelmed the signal the carrier phase output lock detectors and provide valid and confident indicators PLI and PLC the carrier frequency output lock detector provides valid and confident indicators FLI and FLC and the code phase output lock detector provides valid and confident indicators CLI and CLC. When the noise is not insurmountably greater than the signal and the carrier phase residual estimate is not accurate and the carrier frequency residual estimate is accurate and the pseudorange error residual estimate is accurate and when the Iinphase transformed quadrature correlation vector and the Qquadrature transformed quadrature correlation vector both contain roughly constant signal power having a sum greater than a predetermined power value that is dependent upon SNRand A the carrier phase output lock detector provides invalid or unconfident indicators PLI and PLC the carrier frequency output lock detector provides valid and confident indicators FLI and FLC and the code phase output lock detector provides valid and confident indicators CLI and CLC.

When the noise is not insurmountably greater than the signal and the carrier phase and carrier frequency residual estimates are inaccurate and the pseudorange error residual estimate is accurate. When the sum of the power of Iinphase transformed quadrature correlation vector and the Qtransformed quadrature correlation vector is above the predetermined power value the carrier phase output lock detector and provides invalid and unconfident indicators PLI and PLC the carrier frequency output lock detector provides invalid and unconfident indicators FLI and FLC and the code phase output lock detector provides valid and confident indicators CLI and CLC.

When all of the residual estimates and are inaccurate the carrier phase output lock detector provides invalid and unconfident indicators PLI and PLC the carrier frequency output lock detector provides invalid and unconfident indicators FLI and FLC and the code phase output lock detector provides invalid and unconfident indicators CLI and CLC.

The observation lock detectors and function to provide an operational indication vector for detecting invalid residuals. The observation lock detectors and generate a code phase offset and a carrier angle offset from the measurement error vectors from the filters and and from the correlations . The code phase offset is used to combine the early prompt and late correlations into the I Q maximized quadrature correlation vector for adjusting the I Q quadrature correlations for power alignment relative to code phase. The carrier angle offset vector then is used to rotate the Iand Qmaximized quadrature correlation vector to align signal power relative to carrier phase resulting in the Iand Qtransform vector that is the best estimate of what Iand Qquadrature correlations would have been if the replica had been corrected by the estimates of the error in the residual error estimate vector as determined by the measurement error vector from the filters and . The lock detectors and determined validity of the residuals of the measurement error vectors from the filters and for the received I Q quadrature correlations . In effect the observation lock detectors and function to provide indicators of the validity of the residual measurements in the measurement error vectors from the filters and and as such the observation lock detectors function to provide a performance metric of the desired correct operation of each of the sequential filters and that generate the measurement error vectors from the correlations .

It should now be apparent that various alternative implementations can be used. The I Q maximizer could be modified to select at each time the early prompt or late I Q quadrature correlations that the residual error estimate vector predicts have the greatest signal to noise ratio so that the modified amplitude estimate and SNR can be computed consistently. The I Q maximizer could be removed altogether and the prompt I Q quadrature correlations could be used instead. The lock indicators and can be used for indicating changes in the validity in the pseudorange error pseudorange rate dot over and pseudorange acceleration umlaut over instead of carrier phase error carrier frequency error and code phase offset . Also one or more of the lock detectors and can be removed yielding a reduced set of indicators. The observation lock detectors and could be applied to various types of spread spectrum signals such as the m code signal. The observation lock detector and can take inputs from additional correlators. The observation lock detectors and can take positioning signal transmitted from a satellite and having a carrier modulated by any chipping code that maybe an m code having an m code envelope.

The organization of the prefilter detection block can be changed using various filtering methods. Additional discriminators can be added or existing discriminators can be replaced augmented or deleted. More sequential filters operating on various combinations of discriminators can be added and the existing sequential filters can be kept or removed. The invention is directed to a combination of sequential filters and lock detectors offering selection of the best computed residuals for navigation state propagation. Those skilled in the art can make enhancements improvements and modifications to the invention and these enhancements improvements and modifications may nonetheless fall within the spirit and scope of the following claims.

