---

title: Methods, systems, and computer program products for transferring a message service payload between messaging entities
abstract: The subject matter described herein includes methods, systems, and computer program products for transferring a message service payload between messaging entities. According to one aspect, the subject matter described herein includes a method for intelligently processing a message service payload being transmitted between messaging entities. A messaging service message comprising a payload being transmitted from an N-generation messaging entity to an M-generation messaging entity is received at a core network, wherein N and M are integers. The payload is decoded to identify a service to be provided. An action is performed to facilitate the providing of the identified service.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08229480&OS=08229480&RS=08229480
owner: Tekelec, Inc.
number: 08229480
owner_city: Morrisville
owner_country: US
publication_date: 20070420
---
This application claims the benefit of U.S. Provisional Patent Application Ser. No. 60 793 453 filed Apr. 20 2006 the disclosure of which is incorporated herein by reference in its entirety.

The subject matter described herein relates to transmitting messages across a cellular network. More particularly the subject matter described herein relates to methods systems and computer program products for transferring a message service payload between messaging entities.

Cellular networks are conventionally developed and deployed using a homogenous network architecture and resource definitions. For example a second generation 2G CDMA network operator may only provide cell phones or similar mobile terminals conforming to the requirements defined for CDMA devices to customers. The operator may also limit deployed radio equipment mobile switching centers and core network call processing and routing servers to products that adhere to the functional specifications published for CDMA networks. Similarly a network operator offering third generation 3G wireless service may only provide 3G cell phones or mobile terminals to their customers and may only deploy network equipment that implements the functional requirements published for 3G networks. However either the 2G or 3G operator may find some commercial advantage in supporting a heterogeneous mobile network comprising multiple generations of terminals network equipment and services. For example one service that may be desirable to provide between different generation mobile networks is messaging service such as short messaging service. As used herein the term messaging service is intended to refer to any type of service that delivers non call media content between mobile terminals or between mobile terminals and fixed terminals. Examples of messaging service messages include SMS messages multi media messaging service MMS messages instant messages and the like.

One problem associated with providing messaging service between different generation mobile networks is that core network elements between different generation mobile networks typically provide end to end delivery services without processing message payloads. For example message service gateways that delivery message service messages between 2G and 3G networks typically provide end to end delivery services. However it may be desirable to provide enhanced services to 3G terminals that are defined for short message service IS 637 payloads implemented in 2G CDMA networks. For example one service parameter included in the IS 637 payload definition is an alert on delivery parameter which requests that the recipient be alerted e.g. through an audible tone or vibration of a handset when a message has been delivered. If the message is delivered from a 2G CDMA subscriber to a 2G CDMA subscriber by a CDMA message server the message will be delivered and the recipient will be alerted. However when the destination subscriber is a 3G subscriber or other non CDMA subscriber there is no standard way for the 3G nodes in the network to know that delivery alerting is being requested because such nodes are incapable of processing the IS 637 payload.

Another problem associated with providing services such as delivery alerting to 3G destinations is that there is no standard mechanism in SIP to encode requests for such services in message payloads. Thus even if a message is being sent between 3G terminals and the source terminal requests delivery alerting the destination terminal may not recognize the request for delivery alerting because the destination terminal does use the same payload encoding format as the source terminal. Thus the non standard payload encoding formats of 3G terminals prevent many services from being provided.

Another problem associated with delivering messages between different generation destinations relates to payload encoding. For example because message centers typically do not decode or identify the payload encoding type conventional solutions for delivering messages between different generation destinations require that the message centers convert messages into a common format such as the short message delivery point to point protocol SMDPP . For example a message may be converted from the originating format to an SMDPP format and then to a destination format. Requiring conversion to an intermediate protocol such as SMDPP for service message delivery increases message center complexity and can potentially delay message delivery.

Accordingly in light of these difficulties associated with providing message services between different generation destinations there exists a need for methods systems and computer program products for transferring a message service payload between different generation destinations.

The subject matter described herein includes methods systems and computer program products for transferring a message service payload between messaging entities. According to one aspect the subject matter described herein includes a method for intelligently processing a message service payload being transmitted between messaging entities. A messaging service message comprising a payload being transmitted from an N generation messaging entity to an M generation messaging entity is received at a core network wherein N and M are integers. The payload is decoded to identify a service to be provided. An action is performed to facilitate providing of the identified service. As used herein the term messaging entity refers to any device that is capable of sending and or receiving a message service message. For example a messaging entity may be a mobile terminal or a computer that is capable of sending and receiving message service messages. A messaging entity may also include a machine such as an ad server that is capable of sending message service messages but that may not be capable of receiving message service messages.

In one implementation N and M are equal to 3 so that a message is being transmitted between 3G messaging entities. However the payload encoding type of the source 3G messaging entities might be different from that of the destination 3G messaging entities. In this instance the payload encoding type of the source 3G messaging entity may be converted to a 2G encoding format such as IS 637. In one implementation the IS 637 encoded message may be transmitted to the destination the destination 3G messaging entity may be configured to process the IS 637 encoded destination and provide the identified service such as sending a message to the sender to indicate that the message was received. In an alternate implementation the payload of the message may be converted from the encoding format of the source to IS 637. A core network element may convert the IS 637 encoded payload format to the payload encoding format of the 3G destination. The 3G destination may receive the message decode the payload and provide the identified service.

According to another aspect the subject matter described herein includes a method for converting the format of a message service payload transmitted between different generation destinations. A message service payload defined according to an originating messaging entity is received at a core network. An originating payload encoding type and a destination payload encoding type are determined. It is then determined whether a difference exists between the originating payload encoding type and the destination payload encoding type. In response to detecting a difference between the originating payload encoding type and the destination payload encoding type the payload is converted from the originating payload encoding type to the destination payload encoding type.

According to yet another aspect the subject matter described herein includes a method for tunneling a 2G encoded short message service payload through a SIP core network. A message including a 2G encoded payload is received at a core network. The 2G encoded payload is encapsulated in a session initiation protocol SIP message frame and the SIP message frame including the 2G encoded payload is forwarded through the core network.

The subject matter described herein may be implemented using a computer program product comprising computer executable instructions embodied in a computer readable medium. Exemplary computer readable media suitable for implementing the subject matter described herein include chip memory devices disk memory devices programmable logic devices application specific integrated circuits and downloadable electrical signals. In addition a computer readable medium that implements the subject matter described herein may be distributed as represented by multiple physical devices and or computing platforms.

In view of the problems described above the subject matter described herein provides methods for methods systems and computer program products for transferring a message service payload between messaging entities. illustrates an exemplary hybrid 2G 3G cellular network environment enabled to transfer one or more message service messages between messaging entities according to an embodiment of the subject matter described herein. In hybrid network environment may contain three networks a 2G cellular network an IP multimedia subsystem IMS core including a plurality of session initiation protocol SIP servers and a 3G GPRS network .

2G cellular network may include a mobile terminal a base station controller BSC a mobile switching center MSC a short message peer to peer SMPP application and a 2G short message gateway SMG with an associated content server . Mobile terminal may be a cell phone personal digital assistant or other client device operable in a 2G cellular network. One or more message service messages may be transferred from mobile terminal through base station controller to mobile switching center . If network is a CDMA network that utilizes TIA EIA encoding standards the payload of the message service messages may be using the format described in TIA EIA IS 637 Short Message Services for Dual Mode Wideband Spread Spectrum Cellular Systems February 1998 the disclosure of which is incorporated herein by reference in its entirety. Mobile switching center may forward IS 637 message blocks to short message gateway encapsulated in one or more SS7 network message frames. As will be described in more detail below 2G short message gateway may tunnel the IS 637 encoded payload in an extended SIP message and transmit the extended SIP message over core network for processing and receiving enhanced services. Content server may deliver media content to 2G subscribers such as the user of 2G phone .

IMS core network may include an originating message server with an associated content server a terminating message server with an associated content server an IMS core resource server an IMS core network environment and a presence server . Message servers and may perform message service payload interpreting processing and tunneling tasks to provide advanced message services between different generation destinations such as 3G phone and 2G phone . Content servers and may provide message service content to be sent to different generation destinations. IMS core resource server may provide IP multimedia subsystem IMS services such as serving call session control function S CSCF interrogating call session control function I CSCF proxy call session control function P CSCF and home subscriber server HSS functions to establish sessions to and from IMS enabled devices. Presence server may collect and deliver presence information for subscribed to entities. As will be described in more detail below message servers and may query presence server to obtain message service payload encoding information for delivery message service messages between different generation destinations. In alternate implementations message servers may query a home subscriber server HSS or an E.164 number mapping ENUM server to determine the payload encoding type of an intended message recipient.

3G GPRS cellular network may include one or more mobile terminals a radio network controller RNC a serving GPRS support node SGSN a GPRS gateway support node GGSN and a GPRS IP network . One or more message service messages may be transferred from mobile terminal through RNC to SGSN in a SIP message frame. SGSN may provide a message gateway function for the one or more message service messages transferring them into the core IMS network through the GPRS IP network . GGSN may provide a message gateway for SIP message transfers to adjacent networks.

In addition to performing payload trancoding originating or terminating message service server or may also perform intelligent services based on information extracted from message service message payloads. For example message service message service selector may decode the message service message payload of a received message and forward the original message or a copy of the original message to message service message payload processor . Message service message payload processor may identify a service to be provided for the payload based on information extracted from the payload of the message service message. For example IS 637 encoded messages include a field that indicates that alert on message delivery service is requested for a message. If message service message payload processor encounters a message with such a field indicating that alert on message delivery is requested message service message payload processor may provide the service by creating an alert on message delivery format for inclusion in the outgoing message service message sent to the destination. Message service message payload processor may provide any service requested by one or more fields in a message service message payload. Examples of other services that may be provided based on IS 637 encoded payload include any of the following parameters listed in Table 1 below.

Message service message payload processor may decode any of the parameters listed in Table 1 and perform an action to facilitate the providing of the identified service. If the destination handset is an IS 637 handset message service message payload processor may simply ensure that the requested parameter is included in the outbound message service message. If the destination is not an IS 637 handset message service message payload processor may map the IS 637 parameter to the corresponding parameter in the outbound message. For example if the destination handset uses GSM encoding or SIP payload encoding message service message payload processor may map the IS 637 parameter to the corresponding GSM or SIP parameter. In one implementation message service message payload processor may encode the payload of a message in a format to facilitate providing of the identified service. For example message service message payload processor may encode the payload in IS 637 format for transmission through the core network. If the destination is IS 637 compatible the payload may be transmitted to the destination in IS 637 format. If the destination is not IS 637 compatible the payload may be converted from IS 637 to the encoding format of the destination.

Message service message payload tunneling function may tunnel outbound message service messages over a network. For example message service message payload tunneling function may encapsulate message service message payloads in SIP or extended SIP message frames. Exemplary SIP message formats for tunneling message service message payloads will be described in detail below.

Referring to at block a user may enter a message service message on an originating mobile terminal. The message may be entered via a keypad touch screen or other user interface associated with the originating mobile terminal. If the user is a subscriber in a 2G network 2G phone may be used to capture the message service message. If the user is a subscriber in a 3G network 3G phone may be used to capture the message.

At block the mobile terminal may encode the user s message for transfer. For example if the message service message originates on 2G phone the message service message may be encoded using IS 637 methods as defined for 2G message service message services. If the message service message originates on 3G phone the message block may be maintained in plaintext or other 3G compatible format.

At block the encoded message service message may be encapsulated for transfer to a local message service messaging gateway across the originating network. If the message service message originates on 2G phone the encoded block may be transferred to switching center and then placed in an SS7 message frame. If the message service message originates on 3G phone the message block may be placed in a SIP message frame at the mobile terminal.

At block the message service message in the originating network message frame may be transferred to an originating core network messaging gateway. For example the message service message originating at the 2G phone may be transferred to 2G short message gateway through mobile switching center . The message service message originated at the 3G phone may be transferred in the SIP network message frame to the 3G serving GPRS support node through radio network controller .

At block the originating core network messaging gateway may extract the message service message from the network message frame and encapsulate it in an extended SIP network message frame. For example 2G short message gateway may include resources to remove the IS 637 encoded message originating at 2G phone from the SS7 network message frame and place the IS 637 encoded message block into an extended SIP message frame for transfer across IMS core network . If the message service message originated at 3G phone it may already be included in a SIP message frame and may not require additional processing at SGSN . To avoid confusion the remaining steps in will be discussed for the 2G originating case and then for the 3G originating case.

For the 2G originating case at decision point originating network messaging gateway may determine if the message service message should be transferred directly to a terminating message gateway or if it should be transferred to an intermediary network message server for additional processing. For example 2G short message gateway may forward the IS 637 encoded message in a SIP network message frame to originating message server for additional route processing if the receiving mobile terminal is not located in the service provider s network. Gateway may also forward the message service message to originating message server if the message service message has to be converted from 2G IS 637 encoding to SIP or other format for a 3G mobile terminal . In another exemplary application 2G originating message gateway may forward an extended SIP network message frame comprising an IS 637 message block directly to a terminating message gateway to delivery to a receiving 2G mobile terminal. If the message service message is required to be forwarded to a network message server the process may proceed to block otherwise it may proceed to block . At block the extended SIP message frame comprising the message service message may be forwarded to a network message server for additional processing.

At decision point the network message server may determine if the message service message block in the SIP message frame needs to be transcoded in order to be decodable by the receiving mobile terminal. The term transcoding as used herein refers to the conversion of a message service message payload from one format to another format. Transcoding may include mapping map data in header fields associated with the message service payload from one format to another format and mapping the contents of any user data fields to the format expected by the destination. For example a message service message payload may require transcoding from an IS 637 encoding format to a SIP encoding format a SIP encoding format to an IS 637 encoding format a GSM encoding format to a SIP encoding format a text format to a GSM encoding format an IS 637 encoding format to a GSM encoding format or a GSM encoding format to an IS 637 encoding format. The determination as to whether a message service payload transcoding is required may be determined for example by obtaining the destination s message service payload encoding decoding method by querying a network node with knowledge of the destination s message service payload encoding decoding method. For example originating message server may query presence server an HSS or an ENUM server associated with IMS core resource or associated with the destination network to determine the destination s message service payload encoding decoding format. Once originating message server determines the message service payload encoding decoding format required at the destination originating message server may compare the message service payload encoding decoding format definition for the destination to the payload encoding decoding format for the message that is received for delivery. If the message service payload encoding decoding formats are the same then payload transcoding is not required and control proceeds to block . If the message service payload encoding decoding formats are not the same payload transcoding may be required. If transcoding is required control proceeds to block where the message service payload is converted to the payload encoding format of the receiving terminal. If transcoding is not required block is bypassed and control proceeds to block .

At block the message service message may be transferred to a terminating core network messaging gateway from either an originating core network messaging gateway or from an intermediary network messaging server. For example a message service message destined for 2G phone may be forwarded to SMG while a message service message destined for 3G phone may be forwarded to SGSN from IP core network through GPRS IP network .

At block the terminating core network messaging gateway may extract the message service message from the core network message frame.

At block the terminating core network messaging gateway may encapsulate the message service message in a terminating sub network message frame. For example 2G short message gateway may include resources to remove the IS 637 encoded message service message from the extended SIP network message frame and place the encoded message service message block into a SS7 message frame for transfer receiving mobile terminal . Similarly the terminating messaging gateway function in SGSN may receive a SIP message and forward the message to 3G phone .

At block the terminating core network messaging gateway may forward the message service message across the terminating network to the receiving mobile terminal. For example a message service message terminating at the 2G phone may be transferred in the SS7 network message frame from the 2G short message gateway to mobile switching center . Mobile switching center may then forward the message service message to mobile terminal through base station controller . A message service message terminating at 3G phone may be transferred in a SIP network message frame from the 3G SGSN through RAN .

At block the terminating mobile device may receive the message service message and decode the payload. The terminating mobile device may also implement procedures at block to validate the contents of the message service message and or the originator of the message service message.

At block the terminating mobile device may display the received message service message on a local graphical user interface for the receiving user to read.

For the 3G originating case returning to block it is determined whether the message should be forwarded to a network message server for additional processing. If SGSN determines that the message requires additional processing SGSN forwards the message to an originating message server for the 3G network where the additional processing is performed. For example terminating message server illustrated in may function as an originating message server for messages originating from 3G network . In blocks and the frame is processed at the network message server. For example as indicated by decision point it may be determined whether the message service payload encoding is to be converted. If the destination is a 3G destination and the 3G destination uses a different payload encoding format than that used by originating 3G phone the originating message server may convert the payload encoding type to the 3G payload encoding format of the destination or to a standard format recognized by the 3G destination. In one implementation 3G terminals may be configured to recognize IS 637 encoding so that they can receive all of the services that are standardized by IS 637. Accordingly in block for the 3G to 3G case the payload is converted to a format recognizable by the receiving mobile terminal. In yet another alternate implementation the payload may be converted to IS 637 and another core network node such as a terminating 3G message server may convert the payload to a format recognizable by the destination 3G mobile terminal.

In block the message is forwarded to a terminating message gateway. For the 3G to 3G case the terminating message gateway may be the gateway associated with the destination 3G network. In block the extended SIP network frame in which the message traversed the core network may be decomposed to extract the original SIP message. Block may be bypassed if the terminating SIP network uses the same SIP message format as the originating 3G network. In block the message is forwarded to the receiving mobile terminal. In block the receiving mobile terminal decodes the message service payload. If the payload is IS 637 encoded and the 3G terminal includes such decoding capabilities the 3G terminal may decode the payload and receive or provide any services requested by the IS 637 encoded payload. If the payload is encoded in the SIP encoding format of the receiving mobile terminal the receiving mobile terminal may simply decode the SIP encoded payload and receive or provide the identified services. In block the content in the message service payload intended for display to the user is displayed. Thus even when messages are transmitted between like generation terminals IS 637 may be used as a standard way to communicate services through the core network.

Request line may include a message type indication and a SIP destination address. The message type indication and the destination address may be of a format suitable for SIP network message processing.

Message header block may include a plurality of general message routing data fields including a SIP origination address a SIP destination address a message sequence number and or other suitable parameters for message processing and transfer across a SIP network. Information supplied in the routing data fields may be of a format suitable for SIP network message processing.

Message body may include a common presence for instant messaging CPIM header block and a payload block . CPIM header block may further include data fields with processing information for payload block and or a SIP origination node identifier. Information supplied in CPIM header block data fields may be of a format suitable for SIP network message processing.

Payload block may include a content length field a content type field a payload identifier field and a payload . Content length field may include a data element whose value may indicate the total number of bytes in the message block in a format suitable for SIP message processing. Content type field may include a character string indicating the general format of the content of payload block . For example content type field instantiations may comprise plaintext and MIME binary . Payload identifier may include a character string indicating a specific coding method used to generate the contents of message block . For example payload identifier instantiations may comprise plaintext and IS 637 . Message block may include the message service message block received encoded and encapsulated at the originating mobile terminal using procedures associated with blocks and .

An exemplary extended SIP network message frame containing a message service message payload originating at 2G mobile terminal may be comprised as follows 

Mobile terminal may receive and encode a message service message destined for receiving 2G mobile terminal according to procedures associated with blocks and of . The resultant IS 637 encoded message block may be transferred from mobile terminal through originating base station controller to originating mobile switching center . Mobile switching center may forward the IS 637 encoded message block in an SS7 network message frame to short message gateway .

Originating short message gateway may transfer the message block from the SS7 network message frame to an extended SIP network message frame . Content type field in extended SIP frame may be instantiated with the string MIME binary and payload identifier field may be instantiated with the string IS 637 . Other header fields in extended frame may be instantiated as required by resources in the IMS core sub system for message routing. Alternatively short message gateway may forward the received SS7 message including the IS 637 encoded payload originating message server for further processing.

Originating short message gateway may forward the extended SIP network message frame including the message service message payload either directly to terminating short messaging gateway or to originating message server . For example if the message service message from mobile terminal is to be delivered to receiving 2G mobile terminal in another service provider s network originating message server may be required to process the IS 637 payload to provide a message service function such as delivery alert service. In another exemplary application the extended SIP network message frame may be transferred directly to terminating short messaging gateway without further processing. Terminating short message gateway may receive extended SIP network message frame from IMS core network .

Terminating short message gateway may extract the message service message payload from extended SIP network message frame and encapsulate it in a SS7 network message frame. Short message gateway may then forward the SS7 network message frame including the message service message to payload terminating mobile switching center . Mobile switching center may then extract the message service message payload and forward it to receiving 2G mobile terminal through terminating base station controller . Receiving mobile terminal may decode and display the message service message using procedures associated with blocks and illustrated in .

SIP stack may implement all message transfer operations with external SIP network resources and may provide message encoding or de coding functions. For example stack may receive an extended SIP network message frame illustrated in from a SIP node across IMS core network . Stack may decode request line and message header to validate source and destination addresses and to implement any SIP protocol operations defined by the other fields in message header . Stack may also extract message body to be forwarded to SAP layer for additional processing. In another exemplary application stack may receive a message body from SAP layer to encapsulate in an extended SIP network message frame and transmit to a destination SIP node across IMS core network . Stack may insert the destination address or routing information in request line and message header before transmitting the frame.

SAP layer may manage a plurality of messaging queues for message service message traffic management. For example layer may receive one or more SIP message bodies forwarded from stack . Layer may further decompose the one or more message bodies and process the contents of CPIM header . Layer resources may then place the payload block onto a message queue directing the block to message processing instance or . In another exemplary application layer may receive a payload block from message processing instance or to be transmitted on the IMS core network . Layer resources may validate the structure of payload block and then assemble a message body comprising the payload block and CPIM header block . The assembled message body may then be transferred to SIP stack for final processing and transmission.

Message processing instances and may provide resources to operate on payload block and transfer the message service message to payload transcoding application using an interface provided by application programming interface . Message processing instance may include resources to operate on plaintext message blocks while message processing instance may include resources to operate on message blocks encoded using IS 637 methods as required for 2G mobile terminal operation. Message processing instance may include resources to support GSM encoding formats. For example message processing instance or may receive a payload block from SAP layer for additional processing. Message processing instance or may decompose payload block validate its contents and then forward payload to application through API . In another exemplary application message processing instance or may receive a transcoded message block from application through API to be transmitted on IMS core network . Message processing instance or may assemble a payload block comprising message block payload identifier content type field and content length field . The assembled payload block may be forwarded to service application point layer for further processing.

Payload transcoding application may provide procedures to implement payload transcoding operations. For example one procedure may convert a text or MIME payload in a SIP message from a 3G mobile terminal into an IS 637 encoded or a GSM encoded payload destined for a 2G mobile terminal. A different procedure may decode an IS 637 encoded payload from a 2G mobile terminal and convert the contents to a SIP encoded format suitable for a 3G mobile terminal to receive and display.

Application programming interface may provide a consistent set of resources for each message processing instance or to transfer message blocks to application for processing. API may also include resources to facilitate transfer of message blocks resulting from operation of application to the appropriate message processing instance or .

Originating 3G mobile terminal may receive from a user and encode a message service message destined for receiving 2G mobile terminal in a SIP network message frame according to procedures associated with blocks and . The resultant 3G encoded message may be transferred from mobile terminal through originating radio network controller to O SGSN . O SGSN may transfer the SIP network message frame to originating message server through GPRS IP network and IMS core network .

Originating message server may receive the SIP frame with the message service payload. Message server may decompose the received SIP message frame and pass the message service message through transcoder to encode the SIP encoded payload into an IS 637 payload suitable for receiving 2G mobile terminal . Message server may then encapsulate the encoded message service message block in an extended SIP network message frame instantiating content type field with the string MIME binary and instantiating payload identifier field with the string IS 637 . Message server may forward the resultant extended SIP network messaging frame to terminating short messaging gateway through IMS core network .

Terminating short messaging gateway may receive extended SIP network messaging frame from IMS core network . Gateway may decompose extended SIP frame extract the encoded message service message block encapsulate the message service message in a SS7 message frame and transfer the SS7 message frame to terminating mobile switching center . Mobile switching center may extract the message service message and forward it to receiving 2G mobile terminal through terminating base station controller . Receiving mobile terminal may decode and display the message service message using procedures associated with blocks and illustrated in .

Originating 2G mobile terminal may receive and encode a message service message destined for receiving 3G mobile terminal according to procedures associated with blocks and illustrated in . The resultant IS 637 encoded message block may be transferred from 2G mobile terminal through originating base station controller to originating mobile switching center . Mobile switching center may forward the encoded message block in an SS7 network message frame to originating short message gateway .

Originating short message gateway may transfer the message service message block from the SS7 network message frame to an extended SIP network message frame . Content type field in extended SIP frame may be instantiated with the string MIME binary and payload identifier field may be instantiated with the string IS 637 . Other header fields in extended frame may be instantiated as required by resources in the IMS core subsystem.

Originating short messaging gateway may forward the extended SIP network message frame to originating message server . Message server may receive extended SIP frame containing the encoded message service message payload from mobile terminal and decompose the extended SIP network message frame to extract the payload. Transcoder may convert the encoding type of the payload to that of 3G mobile terminal . Message server may then encapsulate the plaintext message service message in a SIP network message frame and forward the frame to terminating SGSN through IMS core network and GPRS IP network .

Terminating SSGN may receive the SIP network message frame including the message service message payload and may forward the SIP network message frame to receiving 3G mobile terminal through terminating radio network controller . Receiving 3G mobile terminal may decompose the SIP network message extract the message service message payload and display the payload using procedures associated with blocks and illustrated in .

As stated above one function that may be provided by a message server according to an embodiment of the subject matter described herein includes decoding a payload of a message service message determining a service to be applied to the message based on the payload and providing the service. illustrates exemplary messaging associated with providing alert on delivery service based on information in a message service message payload according to an embodiment of the subject matter described herein. Referring to MSC originates a message service message destined for receiving 3G mobile phone . The message service message may include an IS 637 payload. Originating short message gateway receives the message and encapsulates the IS 637 payload in a SIP frame. Originating short message gateway may forward the message to originating message server via core network . Originating message server may decode the IS 637 payload and determine that a service such as alert on delivery is required. If payload transcoding is required originating message server may insert data in the format and location in the payload expected by receiving terminal indicating that alert on delivery service is requested. Originating message server forwards the 3G encoded payload in a SIP frame to SGSN via core network and GPRS network . SGSN forwards the message to receiving 3G terminal via RNC .

Receiving 3G phone receives the message and decodes the payload. Receiving 3G phone may identify the indication in the message inserted by originating message server requesting alert on delivery and may generate the corresponding vibration or tone. Accordingly using the messages illustrated in a message payload can be decoded and used to identify and provide advanced services in hybrid telecommunications network environments.

SIP stack may implement all message transfer operations between the mobile terminal and a 3G serving GPRS support node through a radio network controller and may provide message encapsulation or decomposition functions. For example stack may receive an extended SIP network message frame containing a message service message from a 2G mobile terminal encoded in IS 637 format. Stack may decode SIP request line and message header to validate source and destination addresses and to implement any SIP protocol operations defined by the other fields in message header . Stack may also extract message body to be forwarded to service application point layer for additional processing. In another exemplary application stack may receive a message body from SAP layer to encapsulate in an extended SIP network message frame and transmit to a 2G mobile terminal. Stack may validate the destination address or routing information in request line and message header before transmitting the frame.

SAP layer may manage a plurality of messaging queues for message service message traffic management. For example layer may receive one or more SIP message bodies forwarded from stack . Layer may further decompose the message bodies and process the contents of CPIM header . Layer resources may then place the payload block onto a message queue directing the block to the proper message processing instance or . In another exemplary application layer may receive a payload block from message processing instance or to be transmitted to the receiving mobile terminal. Layer resources may validate the structure of payload block and then assemble a message body comprising the payload block and CPIM header block . The assembled message body may then be transferred to SIP stack for final processing and transmission.

Message processing instances and may provide resources to operate on payload block and transfer the message service message to one of a plurality of message client instances. Message processing instance may include resources to operate on message blocks encoded in SIP compatible formats while message processing instance may include resources to operate on message blocks encoded using IS 637 methods and message processing instance may include resources to support GSM encoding formats. For example processing instance may receive an IS 637 payload block from layer for additional processing and forwarding to IS 637 message client . Instance may decompose the payload validate its contents and then forward the payload to client through API . In another exemplary application processing instance may receive a SIP encoded message block from SIP message client application . Instance may assemble a payload block including a message block a payload identifier a content type field and a content length field as described above with respect to . The assembled payload block may be forwarded to SAP layer for further processing.

SIP message client and associated API may receive and process one or more payloads forwarded from message processing instance and may source one or more messages to message processing instance for encapsulation and delivery to a 3G mobile terminal or SIP network node.

IS 637 client and associated API may receive and process one or more IS 637 message blocks forwarded from message processing instance and may encode and source one or more message service message blocks to message processing instance for ultimate delivery to a 2G mobile terminal.

GSM protocol client and associated API may receive and process one or more message blocks forwarded from message processing and may encode and source one or more message blocks to message processing instance for delivery to a destination node.

At block core IMS network decodes the payload of the message and based on the payload identifies a service to be provided. For example a message service message received from 2G terminal may be decoded and processed by one or more message servers and or in cellular network to determine that a return receipt is to be provided to the originator of the message.

At block and action is performed to facilitate the providing of the identified service. The action may include encoding the payload in a format that facilitates the providing of the identified. For example originating message server may encode the payload in IS 637 format for transmission across core network . If the destination is a 2G messaging entity the IS 637 payload may be communicated to the 2G messaging entity. If the destination is a 3G messaging entity with IS 637 processing capabilities the IS 637 encoded payload may be communicated to the 3G messaging entity. If the destination is a 3G messaging entity without IS 637 processing capabilities the IS 637 encoded payload may be converted to the payload encoding format of the destination for example by terminating message service illustrated in .

In another example the action may include providing the identified service at the message server in the core network. For example the message server in the core network may decode the payload and identify that content based billing is required. In this instance the message server may generate a call detail record CDR for the message service message that identifies the content type. The CDR may be used by a billing system to bill the sending or receiving subscriber based on the identified content type. For example a subscriber may be charged more for sending images or audio files than for sending text.

At block the network message server detects an originating payload encoding type. For example originating message server may receive and process a SIP message frame comprising a message service message and may detect that the originating payload encoding type is SIP encoded text by examining the content type field and the payload identifier . In a second exemplary application originating message server may receive and process an extended SIP message frame comprising an IS 637 message service message and may detect that the originating payload encoding type is IS 637.

At block the network message server detects a destination payload encoding type. For example network message server may forward the destination identifier for the message service message to presence server to an HSS or to an ENUM server in order to determine the destination terminal type and associated message service message format.

At block the network message server determines whether a difference exists between the originating and destination payload encoding types. For example network message server may determine that the originating terminal encodes message service message payload using a SIP encoded text format while the destination terminal expects to receive an IS 637 message service message payload.

At block in response to detecting a difference between the originating payload encoding type and the destination payload encoding type the network message server converts the payload from the originating payload encoding type to the destination payload encoding type. For example the network message server receiving a message service message from a 3G terminal destined for a 2G terminal may detect a difference in message encoding formats and in response may pass the SIP encoded text message received from 3G terminal through transcoder to generate an IS 637 message service message that may be properly delivered to 2G terminal . In another exemplary application the network message server receiving a message service message from a 2G terminal destined for a 3G terminal may detect a difference in message encoding formats and in response may pass the IS 637 encoded message block received from 2G terminal through message transcoder to generate a SIP encoded version of the message service message to be delivered to 3G terminal .

At block the originating node encapsulates the IS 637 payload in a SIP message frame. For example an extended SIP frame may be constructed at short message gateway or message server . The message may include a request line message header and message body described above with respect to . Request line may include a message type indication for the message service message and the SIP destination address for a terminating short message gateway hosting destination 2G mobile terminal . Message header block may comprise a plurality of general message routing data fields including the SIP origination address for originating short message gateway the SIP address for terminating short message gateway a message sequence number and or other suitable parameters for message processing and transfer across a SIP network. Message body may comprise a CPIM header block including data fields with processing information for payload block and or a SIP origination node identifier and a payload block including content length field content type field payload identifier and payload . Content length field may identify the total number of bytes in the message block while content type field may include MIME binary and payload identifier may include IS 637 . Message block may include the IS 637 encoded message block received from originating 2G terminal .

At block the originating message server forwards the SIP message including the 2G encoded payload through a core network. For example originating message gateway may forward the extended SIP frame created at block to terminating short message gateway . Terminating message gateway may remove the IS 637 payload from the extended SIP frame and forward the IS 637 payload to terminating 2G mobile device through terminating mobile switching center and terminating base station controller . In another exemplary application originating short message gateway may forward the extended SIP frame comprising the IS 637 payload to originating message server . In response to receipt of the extended SIP frame message server may decode the IS 637 payload and may provide a service indicated in the payload such as alert or delivery for the message. Originating message server may encapsulate the IS 637 payload in another extended SIP message frame and forward the message frame to terminating short message gateway . Terminating short message gateway may remove the IS 637 payload from the extended SIP frame and forward the IS 637 payload to terminating 2G mobile device as described above.

It will be understood that various details of the subject matter described herein may be changed without departing from the scope of the subject matter described herein. Furthermore the foregoing description is for the purpose of illustration only and not for the purpose of limitation as the subject matter described herein is defined by the claims as set forth hereinafter.

