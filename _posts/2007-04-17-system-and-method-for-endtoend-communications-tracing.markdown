---

title: System and method for end-to-end communications tracing
abstract: A method for tracing communications includes receiving trace criteria from a first remote element and determining whether a call signaling message matches the trace criteria. The method includes attaching a trace tag to the call signaling message, if the call signaling message matches the trace criteria. The method further includes transmitting the call signaling message to a second remote element.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07778393&OS=07778393&RS=07778393
owner: Cisco Technlogy, Inc.
number: 07778393
owner_city: San Jose
owner_country: US
publication_date: 20070417
---
This application is a continuation of U.S. application Ser. No. 10 888 158 filed Jul. 9 2004 and entitled System and Method for End To End Communications Tracing which is a continuation of U.S. patent application Ser. No. 10 868 982 filed Jun. 15 2004 entitled System and Method for End to End Communications Tracing. 

This invention relates in general to telecommunications and more particularly to a system and method for diagnostic call tracing.

Modern communication networks often employ highly distributed control functions that utilize a variety of signaling protocols. Diverse distributed networks may allow for greater scalability and flexibility in providing communication services. Protocol diversity and decentralized signaling architectures however complicate troubleshooting of configuration errors software bugs and hardware faults. Call logging and other forms of reporting may be used to identify and locate problems within a network

Within a particular network however multiple problems may exist concurrently. Furthermore the integration of various administrative domains within the network such as intra enterprise inter enterprise and service provider domains with differing troubleshooting requirements may create difficulties in implementing a single uniform procedure for call reporting. Additionally unnecessary call tracing and reporting may impair debugging by obscuring useful information and may degrade call processing by utilizing valuable network resources.

In accordance with the present invention the disadvantages and problems associated with telephony filtering have been substantially reduced or eliminated. In particular a method and system are provided for communicating a tracing status of a call to a plurality of nodes and of collecting tracing information from the nodes.

In accordance with one embodiment of the present invention a method for tracing communications includes receiving trace criteria from a first remote element and determining whether a call signaling message matches the trace criteria. The method includes attaching a trace tag to the call signaling message if the call signaling message matches the trace criteria. The method further includes transmitting the call signaling message to a second remote element.

In accordance with another embodiment of the present invention a method for tracing communications includes receiving a call signaling message and determining whether the call signaling message includes a trace tag. The method further includes transmitting a trace report to a remote element if the call signaling message includes a trace tag.

Technical advantages of certain embodiments of the present invention include an improved method of communicating requests for tracing services and propagating tracing services reports in a distributed multi protocol network. Other technical advantages of certain embodiments of the present invention include the ability to correlate captured information on a per call basis to facilitate analysis to tailor filtering criteria to limit unnecessary reporting and to optimize the type of information that is reported for filtered calls.

Other technical advantages of the present invention will be readily apparent to one skilled in the art from the following figures descriptions and claims. Moreover while specific advantages have been enumerated above various embodiments may include all some or none of the enumerated advantages.

By providing an effective process for propagating trace tag along a path associated with call signaling message communication system may enable end to end session tracing in a highly distributed multi protocol environment. In particular embodiments communication system may provide detailed control of tracing and reporting performed by tracing nodes and as a result may limit performance degradation and network load resulting from the tracing and reporting. Additionally by facilitating the tunneling of trace trigger requests and trace reports within control signal messages particular embodiments of communication system may provide a method for tracing and reporting that can operate despite the presence of nodes that do not support the described trace request messages or trace reporting functionality.

Endpoints may be any combination of hardware software and or encoded logic that provides communication services to a user. For example endpoints may include a telephone a computer running telephony software a video monitor a camera or any other communication hardware software and or encoded logic that supports the communication of packets of media or frames using communication system . In a particular embodiment endpoints represent Internet Protocol IP telephones. Endpoints may also include unattended or automated systems gateways other intermediate components or other devices that can establish media sessions. Although illustrates a particular number and configuration of endpoints communication system contemplates any number or arrangement of such components to support communications of media.

Tracing nodes and nodes couple to other tracing nodes and or nodes and are capable of creating transmission paths to route calls between endpoints . More specifically tracing nodes and nodes may be capable of receiving call signaling messages and performing call setup and other call control functions based on call signaling message . Tracing nodes are additionally capable of tracing call signaling messages associated with calls transmitted on communication system propagating trace tags received from management node or extracted from trace trigger requests to other tracing nodes and reporting information related to these calls to management node .

Nodes may lack the capability to respond to tracing requests to modify call signaling messages and or to perform reporting. Although for the purposes of illustrating particular capabilities of tracing nodes operating in mixed systems illustrates an embodiment of communication system that includes nodes incapable of providing the described tracing and reporting functionality a particular embodiment of communication system may include none one or multiple nodes . Alternatively any or all telephony nodes in a particular embodiment of communication system may represent tracing nodes .

Management node facilitates interaction between an administrator or a management device and tracing nodes . Management node generates trace trigger requests based on input from a user or other management device and provides tracing information to the user or management device based on tracing reports collected from tracing nodes . If communication system is configured to respond to requests from a human administrator or other user management node may include user interface components such as a keyboard mouse and or monitor to facilitate interaction between the user and management node .

In general tracing nodes nodes and management node may include any combination of network components gatekeepers media gateway controllers softswitches IP PBXs call managers SIP proxy servers routers bridges hubs switches gateways endpoints telephony interfaces IP interfaces digital signal processors protocols voice routing modules or call control modules and or any other suitable hardware software or embedded logic implementing any number of communication protocols that allow for the exchange of data in communication system . Although this description focuses for the purpose of illustration on particular embodiments of communication system that propagate trace tag on the call control layer alternative embodiments of communication system may propagate trace tag on the bearer control layer the application layer device control layer and or the media inside bearer layer.

In a particular embodiment tracing nodes nodes and management node may represent Voice over IP VoIP components. As noted above management node may include user interface components such as a keyboard mouse and or monitor to allow a user to interact with management node . Additionally in a particular embodiment management node may represent non telephony components such as servers networked personal computers PCs or any other suitable computing device.

In operation tracing node determines a trace status of a call signaling message passing through trace node . Call signaling message may represent any appropriate signaling message associated with a call established or a call to be established on communication system . The call may represent any suitable communication session dialog and or other suitable form of connection and may include audio and or video and or animation and or holography signals data or messages transmitted through voice devices text chat web sessions facsimile instant messaging e mail or any other type of digital communication. In the illustrated embodiment the call represents a voice call communicated using Voice over IP VoIP protocol.

Call signaling message may represent any suitable form of control message or signal corresponding to a signaling protocol supported by one or more elements of communication system and generated as part of the call. As noted above call signaling message may represent a signaling message transmitted on the call control layer the application layer and or the bearer layer. For example if call signaling messages represent messages communicated on the call control layer call signaling message may specifically represent a Session Initiation Protocol SIP an H.323 a Media Gateway Control Protocol MGCP Skinny Client Control Protocol SCCP Signaling Connection Control Part SCCP Bearer Independent Call Control BICC Narrowband Signaling Syntax NSS format message or any other suitable form of call control layer message. If call signaling messages represent messages communicated on the application layer call signaling message may represent a Java Telephony Application Programming Interface JTAPI Telephony Application Programming Interface TAPI Java APIs for Integrated Networks JAIN Parlay Intelligent Network Application Protocol INAP Advanced Intelligent Network AIN message or any other suitable form of application layer message. If call signaling messages represent messages communicated on the bearer layer call signaling message may represent a Resource Reservation Protocol RSVP or Real time Transport Control Protocol RTCP message or any other suitable form of bearer layer message.

Prior to initiation of the call or at any other appropriate point during operation management node in a particular embodiment of communication system activates the tracing functionality of communication system by transmitting a trace activation message to one or more tracing nodes . Trace activation message may represent any suitable message or signal by which management node may activate tracing functionality in tracing nodes . Management node may transmit trace activation message to all tracing nodes in communication system to a single tracing node to be propagated to other tracing nodes or to particular tracing nodes configured to receive trace activation messages depending on the configuration and characteristics of communication system . In an alternative embodiment of communication system tracing functionality in tracing nodes are activated by default. In such an embodiment management node may request tracing without previously activating tracing functionality of tracing nodes .

Once tracing functionality has been activated on communication system management node may transmit a trace trigger request to one or more tracing nodes . Trace trigger request may represent any suitable message or signal by which management node may indicate to tracing nodes a desire to trace calls matching specified criteria. In a particular embodiment trace trigger request represents an extensible Markup Language XML message. illustrates in greater detail the contents of trace trigger request according to a particular embodiment.

Trace trigger request may include a trace tag that identifies information to be reported and a destination address for trace reports such as the address for a particular management node . Trace tag may represent an XML object or data structured in any other appropriate format compatible with the signaling protocol of call control message housing trace tag . Trace tag may also include a recursive reference to trace trigger request for tunneling the trace request through nodes . illustrates in greater detail the contents of trace tag according to a particular embodiment.

Upon receiving trace trigger request a particular tracing node may configure itself to trace calls with call signaling messages matching call trace criteria included in trace trigger request and report any requested signaling and diagnostic information to the specified destination address of the management node . Additionally particular tracing node may configure tracing node to modify signaling messages possibly spanning two or more signaling protocols to propagate trace tag to other tracing nodes . The operation of a particular embodiment of tracing node is described in greater detail with respect to .

As a result tracing node having received trace tag directly by the initial trace request or by some signaling protocol with other components of communication system may begin logging information requested by trace tag pertaining to the call. At appropriate times tracing node may generate trace reports that include some or all of the logged information and transmit trace reports to management node designated by trace tag . Report may be conveyed on one of multiple protocol paths connecting tracing nodes to management node . Tracing node may continue tracing reporting and modifying call signaling messages indefinitely. As described below trace trigger request may additionally include parameters that describe a termination condition for trace trigger request and tracing node may terminate tracing reporting and modifying if and when the termination condition is satisfied. Furthermore particular embodiments of communication system may be configured to allow for deactivation of the tracing functionality by transmitting a trace deactivation message not shown to one or more tracing nodes . The trace deactivation message may represent any suitable message or signal by which management node may deactivate tracing functionality in tracing nodes . Management node may transmit the trace deactivation message to all tracing nodes in communication system to a single tracing node or to one or more tracing nodes configured to receive trace deactivation messages depending on the configuration and characteristics of communication system .

Thus particular embodiments of communication system may provide cost flexible scalable and cost effective methods for call tracing. Furthermore because trace tag can be tunneled as objects or parameters in conventional signaling protocols and because communication system contemplates tunneling of trace trigger requests elements of communication system can be integrated with existing communication systems and operate in conjunction with components that are not configured to provide the described tracing functionality. Additionally because trace tag includes multiple parameters defining such criteria as starts times time to live values and branch counters communication system provides administrators with a very flexible system that can be configured to minimize unnecessary network loads and processing delays and to maximize the effectiveness of information generated during tracing.

User interface facilitates interaction between an administrator or management device of communication system . As indicated above if communication system is configured to operate with a human administrator user interface may include components to allow the administrator to interact with management node such as a keyboard mouse monitor printer or any other components appropriate to allow the administrator to input information into management node or receive information from management node .

Alternatively if mobile station is configured to operate with an automated management device user interface may include components for interacting with the management device such as a network interface data port or other appropriate components. In general user interface receives trace parameters from the administrator or management device and transmits trace parameters to management module . Additionally user interface displays information received in trace reports to the administrator or transmits data from trace reports to the management device.

Management module receives trace parameters from user interface and generates trace trigger request from trace parameters . illustrates in greater detail the contents of trace trigger request according to a particular embodiment. Management module then transmits trace trigger request to one or more tracing nodes . Collection module interfaces with tracing nodes and receives trace report from tracing nodes . Collection module transmits trace reports to analysis module . Analysis module correlates trace reports received from collection module and formats trace reports for presentation to user interface .

User interface management module collection module and analysis module may include any appropriate combination of components including hardware and or software suitable for providing the described functionality. Additionally the functionality described for any one or more of user interface management module collection module and analysis module may be provided by shared or physically integrated components or by the same component or group of components.

In a particular embodiment management node includes a computing element such as a microprocessor and user interface management module collection module and analysis module each represent in part or in whole software processes running on the computing element. As a result in such an embodiment the computing element may provide some or all of the functionality described for each of user interface management module collection module and analysis module . Furthermore for the purposes of the description below communication between the various modules may represent passing of values from one software process hosted by the computing element to another software process also hosted by the same computing element.

Memory stores computer instructions for the modules of management node trace parameters input at user interface trace reports received by collection module or any other appropriate information used by management node during operation. Memory may comprise any collection and arrangement of volatile or non volatile local or remote devices suitable for storing data such as for example random access memory RAM devices read only memory ROM devices magnetic storage devices optical storage devices or any other suitable data storage devices.

In operation an administrator or management device of communication system indicates to management node a desire to trace calls by providing management node with trace parameters . Trace parameters may represent any appropriate information describing the trace services requested such as control protocols to be traced time constraints on the tracing and or any other suitable parameters for the trace. The administrator or management device may provide trace parameters to management node in any appropriate way. For example the administrator may type trace parameters into management node using a keyboard of user interface direct management node to access stored trace parameters from memory indicate to management node an external storage device on which trace parameters are stored and or provide trace parameters to management node in any other suitable manner.

In response to receiving trace parameters management module generates a trace trigger request that includes trace parameters . Trace trigger request also includes trace tag . Trace tag is used by tracing nodes to mark call signaling messages to be traced. Trace tag additionally describes information to be included in trace reports sent to management node as a result of trace trigger request . illustrate the contents of trace trigger request and trace tag in greater detail.

Management module then transmits trace trigger request to one or more tracing nodes . Depending on the configuration of communication system management module may transmit trace trigger request to a single predetermined tracing node all tracing nodes in communication system or one or more tracing nodes determined in any appropriate manner. For example communication system may include a number of communication subsystems operated by various entities or service providers. Particular tracing nodes in communication system may represent peripheral nodes demarcating a boundary of a particular communication subsystem such as gateways connecting a particular entity s network to a larger multi entity network and management module may transmit trace trigger request to all such boundary nodes in the subsystem.

As a result of receiving trace trigger request the receiving tracing node or tracing nodes begin tracing call signaling messages received by that tracing node or those tracing nodes based on information included in trace trigger request . Operation of tracing node according to a particular embodiment is described in greater detail with respect to . One or more tracing nodes may also begin transmitting trace reports that include tag specified information pertaining to tagged calls to a particular management node designated by trace tag .

Collection module receives trace reports transmitted to management node by tracing nodes . Collection module may format filter or consolidate trace reports received by management node in any appropriate manner and may then transmit trace reports to analysis module or may store trace reports in memory for later use by analysis module or other components of management node . The contents of trace reports received from various tracing nodes may be correlated on a call by call or a trace request by trace request basis by evaluation of a call identifier and request identifier stamped into the logged signaling and diagnostic information.

At an appropriate time analysis module receives from collection module or retrieves from memory one or more trace reports . Analysis module may additionally process trace reports which may include aggregating filtering formatting and or processing trace reports in any other suitable manner. Analysis module then provides trace report or portions of trace reports to the administrator in any appropriate manner. Analysis module may display trace reports on a monitor of user interface transmit to administrator an email or other message containing trace reports output trace reports to the management device through a network connection with the management device or provide trace reports to the administrator or management device in any other suitable manner.

Trace criteria provide information that describes to tracing nodes the tracing services requested. In the illustrated embodiment trace criteria include trace protocol type trace message type trace parameter criteria trace sub parameter criteria trace event trigger trace start time trace stop time trace counter and frequency indicator . In a particular embodiment trace criteria represents an XML element and trace protocol type trace message type trace parameter criteria trace sub parameter criteria trace event trigger trace start time trace stop time trace counter and frequency indicator represent XML sub elements.

Trace criteria may specify to tracing nodes calls to be traced. For example in the illustrated embodiment protocol type identifies one or more signaling protocols such as SIP H.323 MGCP SCCP Skinny Client Control Protocol or Signaling Connection Control Part BICC or NSS to be evaluated by tracing nodes . Trace message type specifies particular types of call signaling messages to be evaluated within the identified signaling protocol or protocols. Trace parameter criteria identifies a specific parameter or header and a value for that parameter or header and instructs tracing nodes to trace calls with the specified value for the specified header or parameter. Trace sub parameter criteria identifies a specific sub parameter and a value for that sub parameter and instructs tracing nodes to trace calls with the specified value for the specified sub header.

Additionally trace criteria may describe to tracing nodes other conditions or parameters of the tracing services requested. For example in the illustrated embodiment trace event trigger defines an event or condition such as the detection of a particular type of alarm or the storage in call context of a specific destination address falling within a range address trigger that should initiate the requested tracing services. Trace criteria also may specify a node type. Tracing node may begin performing the tracing described by trace criteria once the event specified by trace event trigger has occurred. Trace start time and trace stop time specify a start and stop time over which tracing nodes should perform the tracing. Trace counter specifies a total number of calls that should be traced before tracing nodes terminate the tracing services associated with trace trigger request . Frequency indicator specifies a value N which tracing node may use to determine the frequency of call tracing. For example tracing node may trace only every Nth call in order to implement sampling.

Trace tag may include any information to facilitate the propagation of tracing information. The illustrated embodiment of trace tag includes a unique identifier and a trace scope parameters that identify the associated trace trigger request and describe the constraints of that trace trigger request . Additionally in particular embodiments tracing node may incorporate the original trace trigger request in trace tag when attaching trace tag to call signaling messages . Furthermore a particular tracing node may incorporate trace report to transmit trace report to a tracing node that can transmit trace report to management node . As a result under certain circumstances trace tag in a particular embodiment may include trace trigger request field and or trace report field . To control the distance downstream that trace tag is propagated trace tag may also include a time to live parameter .

Unique identifier may represent any combination of information that allows tracing nodes management node and or other components of communication system to uniquely identify the trace trigger request associated with trace tag and or the particular management node that generated trace tag . Unique identifier may include additional information to allow management node to distinguish between trace tag generated as a result of the same trace trigger request . In the illustrated embodiment unique identifier includes a call identifier a problem identifier a request time a requester identifier a requestor domain name and a trace sequence number .

Call identifier represents a unique identifier for the traced information associated with a given call. A particular trace report specific to a given call may include call identifier to identify the call that triggered trace report . Call identifier may be added to trace tag when tracing node attaches trace tag to call signaling message . If multiple calls meet trace criteria call identifier may enable management node to sort the multiple trace reports received in response to a single trace trigger request . Problem identifier identifies the trace trigger request that originally included trace tag . A particular trace trigger request may include multiple sets of trace criteria and problem identifier can be used to identify all of the call traces associated with a given trace trigger request . Request time identifies the time at which the trace trigger request was generated and allows management node or other components to search or sort trace tags based on the time trace trigger request was created.

Requestor identifier and requester domain name identify the particular management node that generated trace trigger request . Requestor domain name specifies a fully qualified domain name FQDN for the requesting management node and requester identifier provides a unique identifier for management node within the network associated with the FQDN. Trace sequence number identifies a number of branches trace trigger request has taken in traveling the path and or specific tracing nodes through which trace trigger request has propagated. Additionally trace sequence number may be incremented to show the branching of trace trigger request through the topology. For example if management node transmits trace trigger request to multiple tracing nodes management node may include a different initial value for trace sequence number in each trace trigger request . More specifically management node in this example may transmit trace trigger requests to three tracing nodes and may include an initial trace sequence number of 1000 2000 and 3000 in the particular trace trigger requests sent respectively to a first second and third tracing node . Downstream tracing nodes may then increment these trace sequence numbers for example to 1001 2001 and 3001 respectively . Thus when management node subsequently receives trace reports containing these trace sequence numbers management node may be able to determine how far trace tag propagated from a particular tracing node .

As a result of the described elements in particular embodiments unique identifier may be problem unique distinguishing between trace trigger requests call unique distinguishing between multiple calls traced as a result of the same trace trigger request temporally unique allowing for temporal scoping of views and spatially unique distinguishing between requesting management nodes .

Trace scope parameters include information defining the scope of the requested tracing services. In general trace scope parameters may specify the parameters of the requested tracing services in any appropriate manner. In the illustrated embodiment trace scope parameters includes protocol stain report protocol report zone report level and report target . Protocol stain specifies the protocols for which call signaling messages are tagged by tracing nodes . Report protocol identifies the protocols for which tracing node will report call signaling messages that are tagged and or call signaling messages matching trace criteria . As a result tracing node may receive tagged call signaling messages on one layer and report on call signaling messages received on other layers. For example tracing node may receive a tagged call control message on the call control layer such as a SIP message that includes trace tag with report protocol that identifies a device control protocol such as MGCP for which call signaling messages should be reported. Tracing node may then generate trace reports for MGCP call control messages received by tracing node .

Additionally depending on the configuration of tracing node and or the contents of a particular trace trigger request tracing node may tag all one or any suitable subset of call signaling messages of the protocol specified by protocol stain for a call matching trace criteria . For example for a particular call with call signaling messages that match trace criteria tracing node may tag all call signaling messages that match the protocol of protocol stain . For another call with call signaling messages that match trace criteria tracing node may tag only the first call signaling message of the specified protocol that tracing node receives for that call. Tracing node may determine which matching call signaling messages to tag based on information in trace trigger request the configuration of tracing node or any other appropriate considerations. Similarly tracing node may generate reports for all one or any appropriate subset of call signaling message of the protocol specified by report protocol that match trace criteria or contain trace tag . Tracing node may determine which call signaling messages to report based on information in trace trigger request the configuration of tracing node or any other appropriate considerations.

Report zone describes particular zones of communication system which are requested to report. Report level specifies a level of detail requested for trace report . Report target specifies a particular management node to which trace reports are to be transmitted. As a result in a particular embodiment of communication system that includes multiple management nodes a first management node may transmit trace trigger request that includes report target specifying a second management node to receive trace reports .

As noted above trace trigger request and or trace report may be incorporated into trace tag to allow tracing node to propagate information from trace trigger request or to transmit trace report to a tracing node configured to report to management node . In the illustrated embodiment trace tag includes trace trigger request field . Trace trigger request field may include trace trigger request portions of trace trigger request a pointer to trace trigger request or a link such as a uniform resource location URL to a location where the rest of the trace trigger request can be downloaded or any other information describing trace trigger request . Tracing node may also include a particular trace report portions of trace report a pointer to trace report or a link to a location where trace report can be downloaded or may reference trace report in any other appropriate manner or any other information that describes trace report . Additionally because multiple tracing nodes may modify trace tag as the associated call signaling message traverse communication system trace report field may incorporate or reference for example through links one or more trace reports generated by one or more different tracing nodes .

Trace tag may also include time to live parameter . Management node may request that trace tag only be propagated a certain distance downstream. Time to live parameter may define the number of hops that trace tag should be propagated. The Time to live parameter may be decremented at each tracing node or node . Tracing nodes may then remove trace tag from call signaling messages once time to live parameter reaches zero. Alternatively time to live parameter may be incremented at each tracing node or node . Tracing nodes may then remove trace tag from call signaling messages once time to live parameter reaches a predetermined maximum.

Management interface module receives trace activation messages and trace trigger requests from management node that initiate tracing services. Call control module receives call signaling messages from neighboring tracing nodes and nodes and transmits call signaling messages to the next node downstream in the path of that particular call signaling messages . Filter module identifies call signaling messages received by call control module that match trace criteria. Tagging module modifies call signaling messages identified by filter module by adding trace tag . Reporting module reports the receipt of a tagged call signaling message to management node . Erasing module eliminates trace tags from appropriate call signaling messages .

Management interface module call control module filter module tagging module reporting module and erasing module may each include any combination of components including hardware and or software suitable for providing the described functionality. Additionally the functionality described for any one or more of management interface module call control module filter module tagging module reporting module and erasing module may be provided by shared or physically integrated components or by the same component or group of components. In a particular embodiment tracing node includes a computing element such as a microprocessor and management interface module call control module filter module tagging module reporting module and erasing module each represent in part or in whole software processes running on the computing element. As a result in such an embodiment the computing element may provide some or all of the functionality described for each of management interface module call control module filter module tagging module reporting module and erasing module . Furthermore for the purposes of the description below communication between the various modules may represent passing of values from one software process hosted by the computing element to another software process also hosted by the same computing element.

Memory stores computer instructions for the functional modules of tracing node trace criteria for filtering call signaling messages trace tag for tagging call signaling messages trace reports to be transmitted to management node or another tracing node or any other appropriate information used by tracing node during operation. In particular embodiments memory may also represent portions or all of a buffer used to store information regarding a state of tracing node and previous states of tracing node . Memory may comprise any collection and arrangement of volatile or non volatile local or remote devices suitable for storing data such as for example random access memory RAM devices read only memory ROM devices magnetic storage devices optical storage devices or any other suitable data storage devices.

In operation tracing node receives trigger activation message from management node . Tracing node activates tracing functionality of tracing node in response to receipt of trigger activation message . As part of activating tracing functionality tracing node begins monitoring for receipt of trace trigger requests by management interface module and tagged call signaling messages by call control module . As discussed above in particular embodiments tracing node may be configured in such a manner that tracing functionality is activated by default. In such an embodiment tracing node may monitor for trace trigger requests or tagged call signaling messages regardless of whether tracing node has received trace activation message .

Once tracing functionality has been activated whether activated in response to trace activation message or based on a default configuration management interface module begins monitoring for trace trigger requests and any call signaling message containing trace tag . When management interface module receives trace trigger request management interface module extracts trace criteria and trace tag from trace trigger request . Management interface module transmits trace criteria to filter module and trace tag to tagging module . Filter module and tagging module store trace criteria and trace tag respectively in memory .

When call control module receives call signaling message call control module forwards call signaling message to filter module . In particular embodiments filter module filters call signaling messages by determining based on parameter values and other characteristics of call signaling message whether call signaling message matches trace criteria . For the purposes of this description filter module may determine whether call signaling message matches trace criteria by determining whether parameters values headers characteristics properties or attributes of call signaling message are equal to equivalent to inclusive of a subset of comparable to within a range specified by or otherwise match in any other appropriate manner one or more of trace criteria . A match may occur either immediately when node receives a message or after node processes the message via mechanisms such as address translation.

In alternative embodiments only particular tracing nodes are designated to perform filtering and only those tracing nodes compare received call signaling messages to stored trace criteria . Other tracing node may check only for the presence of trace tag in call signaling messages as described below. For example communication system may include one or more ingress tracing nodes on the boundary of communication system and other communication systems or networks. To limit redundant processing communication system may be configured so that only these ingress tracing nodes filter and tag call signaling messages . Tracing nodes on the interior of communication system may be configured to only check for the presence of trace tags in call signaling messages and report trace tags to management node . The remainder of this description however assumes that tracing node is configured to filter tag and report.

If the received call signaling message matches trace criteria filter module sends call signaling message to tagging module . If tracing node has received multiple trace trigger requests filter module may be configured to compare call signaling messages to multiple sets of trace criteria . If so filter module may forward the matching trace criteria with call signaling messages or otherwise indicate to tagging module the trace trigger request of the matching trace criteria .

Tagging module receives call signaling message and identifies a particular trace tag stored in memory that is associated with the matching trace criteria . Tagging module then tags call signaling messages by attaching the identified trace tag to call signaling message . For the purposes of this description attaching any type of information to a message may represent appending the information to the message embedding the information within the message incorporating a link to the information in the message generating a new message that includes information from the original message and the information to be attached or associating the information with the message in any other appropriate manner.

Tagging module then forwards the tagged call signaling message or a copy of the tagged call signaling message to reporting module . Tagging module may also then return call signaling message directly to call control module or to filter module which then forwards call signaling message to call control module .

Reporting module receives the tagged call signaling message and generates trace report based on call signaling message . Trace report identifies the particular trace tag included in the tagged call signaling message that triggered generation of trace report additional information describing the state of tracing node and or information describing how call signaling message was processed by tracing node . Additionally in particular embodiments reporting module may access buffer that stores information pertaining to previous states of tracing node and may include this information in trace report . below illustrates the contents of trace report in greater detail. In a particular embodiment reporting module then transmits trace report to management node .

In alternative embodiments tracing node may not be configured to transmit trace reports to management node . In such an embodiment tracing node may instead forward trace report to tagging module or another component of tracing node . Tagging module or the appropriate component may then attach trace report to call signaling message for tunneling to other tracing nodes with report transmitting capabilities.

Returning to the operation of filter module if instead call signaling message does not match trace criteria filter module determines whether call signaling message contains trace tag . If call signaling message contains trace tag filter module transmits a copy of call signaling message to reporting module . Reporting module receives call signaling message and generates trace report based on call signaling message . below illustrates the contents of trace report in greater detail.

Additionally if call signaling message contains trace tag filtering module may also determine that under appropriate circumstances removal of trace tag is appropriate. For example if tracing node is located on the boundary of a particular subsystem tracing node may be configured to prevent trace tag from propagating to nodes and tracing node external to the subsystem. If the removal of trace tag is appropriate tracing node transmits call signaling message to erasing module . Erasing module eliminates trace tag from call signaling message and transmits call signaling message either directly to call control module or back to filtering module for subsequent transmission to call control module .

After tracing node has completed any trace related processing of call signaling message filtering module transmits call signaling message to call control module . Call control module performs any appropriate processing on call control module including any telephony related processing appropriate based on the protocol and message type of call signaling message . Call control module then transmits call signaling message to the next downstream tracing node or node .

As noted above particular embodiments of tracing node may not be configured to receive trace trigger requests from management node . Additionally in particular embodiments tracing node may be configured to receive trace trigger requests in call signaling messages . Thus particular embodiments of tracing nodes that are configured to receive trace trigger requests directly from management node may also be configured to attach received trace trigger requests to call signaling messages to propagate the received trace trigger requests downstream. Downstream tracing nodes may be able to extract trace trigger requests from received call signaling messages .

Thus particular embodiments of tracing node may perform additional processing of call signaling messages . Tracing nodes that are operable to receive trace trigger requests directly from management node may attach trace trigger request to call signaling messages before transmitting call signaling messages to downstream tracing nodes . Any suitable module of tracing node may perform this processing in any appropriate manner. For example tagging module may incorporate trace trigger request to trace tag when attaching trace tag to call signaling messages . Furthermore tracing nodes may be configured to check for trace trigger requests in received call signaling messages . If trace trigger request is identified in a particular call signaling message call signaling message may be transmitted to filter module . Filter module may then extract trace criteria from call signaling message as described above.

In a particular embodiment use of tagging may increase the vulnerability of communication system to distributed denial of service DDoS attacks because tagging may expose network topology. As a result tracing node may additionally perform a number of tasks related to system security. For example tracing node may strip trace tags from call signaling messages received from non trusted sources. Tracing node may also encrypt trace reports transmitted to management node and may be configured to receive encrypted trace trigger requests from management node to ensure confidentiality. Moreover tracing node may perform encryption based authentication of call signaling messages received by tracing node . In general tracing node may perform any appropriate steps to increase security of communication system in conjunction with performing the described tracing services.

As a result particular embodiments of tracing node may provide flexible tracing services. Additionally particular embodiments may provide a method of receiving and propagating tracing information that allows for integration of tracing node with non compatible components within communication system . Additionally particular embodiments may offer additional features that limit the possibility of unauthorized parties exploiting trace tag to compromise system security.

Source address identifies the tracing node that represents the source tracing node that generated trace report . Source address may include any form of address or other identifier suitable for use based on the configuration and characteristics of communication system . In a particular embodiment source address specifies a platform sub system and module that generated trace report . Additionally in particular embodiments of communication system particular tracing nodes may not support the transmission of trace reports to management node . As a result these tracing node may instead attach trace reports to call signaling messages to tunnel trace reports to tracing nodes that do support transmission to management node . Thus source address may not identify the tracing node from which management node received trace report but instead the tracing node that initially generates trace report .

Timestamp identifies the time at which trace report was generated. Timestamp may identify the time as an absolute measure or as a time value relative to some reference time. For example in a particular embodiment timestamp may identify the time of generation relative to the time when trace trigger request was issued.

As noted above trace report may provide information pertaining to the state of the reporting tracing node of other components in communication system or of the traced call signaling message . For example in a particular embodiment trace report includes trace tag field signaling message field and context data . Trace tag field includes a copy of the particular trace tag that triggered trace report portions of that trace tag a pointer to trace tag or a link to a location where trace tag may be downloaded or may incorporate into trace tag field in any other appropriate manner information from the relevant trace tag .

Signaling message fields may comprise a trace of call signaling messages received by tracing node that are of the protocol or protocols specified by trace tag . Each signaling message field may include a copy of a matching call signaling message portions of that call signaling message a pointer to that call signaling message or a link to a location where that call signaling message may be downloaded or may incorporate into trace tag field in any other appropriate manner information from the relevant call signaling message . Additionally signaling message field may include call signaling message or information from call signaling message in the form in which call signaling message is received output to downstream tracing nodes or transmitted to ancillary components such as a media processing server for service. Thus trace report may or may not reflect changes to call signaling message made by the reporting tracing node depending on the configuration of communication system and or the parameters of trace trigger request .

Context data may describe a state of tracing node when tracing node received call signaling messages or a log of multiple states of tracing node before or after receipt of call signaling messages . For example context data may describe a sub component that processed call signaling message whether the processing was successful and or any exception handling of call signaling message . Context data may describe alarms events state changes logged records and or session detail records associated with the relevant trace tag . The amount of detail included in context data may be determined by report level of trace tag that triggered trace report . Additionally as described above with respect to tracing node may include a circular buffer that allows tracing node to store and report information about the state of tracing node prior to receipt of the relevant call signaling message . As a result context data may also include information describing a prior state of tracing node .

Although and illustrate respectively contents of trace trigger request trace tag and trace report as utilized by a particular embodiment of communication system communication system may be configured to use any suitable form of trace trigger request trace tag and trace report containing information appropriate for the operation of that particular embodiment of communication system and structured in any appropriate manner. For example although the above description illustrates an embodiment of tracing node that tunnels trace trigger request and trace report as fields within trace tag in a particular embodiment of communication system tracing node may attach to trace trigger request trace tag and trace report to call signaling message as separate fields or data objects of call signaling message . As another example tracing node may attach a single data object to call signaling message that includes a separate field containing trace trigger request trace tag and trace report .

At step tracing node receives trace activation message . In response to trace activation message tracing node activates tracing functionality of tracing node at step . At step tracing node determines whether tracing node has received trace trigger request . If not the process continues at step . If tracing node has received trace trigger request tracing node extracts trace tag and trace criteria from trace trigger request and stores trace tag and trace criteria for subsequent use at step .

Tracing node then begins tracing calls by comparing call signaling messages to trace criteria and tagging matching call signaling messages with trace tag at step . This process is illustrated in greater detail in . At step tracing node determines whether trace criteria stored by tracing node has expired. If trace criteria has not expired tracing node continues matching call signaling messages to trace criteria returning to step .

If trace criteria has expired tracing node determines whether tracing node has received a trace deactivation message at step . If tracing node has not received a trace deactivation message the process returns to step . If tracing node has received a deactivation message tracing node deactivates tracing functionality of tracing node at step .

At step tracing node receives call signaling message . At step tracing node performs appropriate call control functions. At step tracing node determines whether call signaling message matches trace criteria . If call signaling message does not match trace criteria tracing node proceeds to step .

If call signaling message does match trace criteria tracing node determines whether to pass trace criteria to one or more downstream tracing node at step . If tracing node decides to pass trace criteria to one or more downstream tracing node tracing node attaches trace criteria to trace tag at step .

At step tracing node generates trace report . At step tracing node determines whether tracing node is configured to transmit trace report directly to management node . If so tracing node transmits trace report to management node at step . If not tracing node attaches trace report to trace tag at step .

At step tracing node determines whether to attach trace tag to call signaling message . A particular embodiment of tracing node may be configured to only report on call signaling messages that match trace criteria and not to tag matching call signaling messages . If tracing node decides to tag call signaling message tracing node attaches trace tag to call signaling message at step .

At step tracing node may perform additional call control functions with respect to call signaling message . At step tracing node then transmits call signaling message to downstream tracing node .

Although the present invention has been described with several embodiments a myriad of changes variations alterations transformations and modifications may be suggested to one skilled in the art and it is intended that the present invention encompass such changes variations alterations transformations and modifications as fall within the scope of the appended claims. For example many protocols support an informational type of signal. A particular embodiment of tracing node may be configured to propagate trace trigger request and trace report as a no op information signal in order to send trace trigger request and trace report independently of the protocol s normal signaling.

