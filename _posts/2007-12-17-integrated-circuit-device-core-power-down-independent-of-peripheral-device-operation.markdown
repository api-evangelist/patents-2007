---

title: Integrated circuit device core power down independent of peripheral device operation
abstract: In an integrated circuit device, a circuit for maintaining asserted values on an input output pin of the device when a functional block of the device is placed in a sleep mode. The circuit includes an interface for coupling a functional block of a processor to an input and output pin and an output storage element coupled to the interface for storing a current value of the input output pin. The circuit further includes a sleep mode enable for controlling the output storage element to store the current value of the input output pin prior to the functional block being entering a sleep mode and cause the current value of the input output pin to remain asserted after the functional block is in sleep mode. The sleep mode enable is also to deactivate the storage element when the sleep mode is exited.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08327173&OS=08327173&RS=08327173
owner: Nvidia Corporation
number: 08327173
owner_city: Santa Clara
owner_country: US
publication_date: 20071217
---
One of the important features of integrated circuits deigned for portable applications is their ability to efficiently utilize the limited capacity of the battery power source. Typical applications include cellular telephones and personal digital assistants PDAs which might have a Lithium ion battery or two AAA alkaline batteries as the power source. Users have come to expect as much as three to four weeks of standby operation using these devices. Standby operation refers to the situation where the cellular phone handheld device etc. is powered on but not being actively used e.g. actively involved in a call . Generally is estimated that that the integrated circuits providing the functionality of the device is only performing useful work approximately 2 of the time while the device is in standby mode.

Removing the power supply from selected circuits of a device during standby is a technique employed by designers for battery powered applications. The technique is generally applied only to circuit blocks outside of the central processing unit CPU . A primary reason for not applying this technique to CPUs has been the difficulty in being able to retain the current processor state information necessary to continue execution after coming out of the standby mode. One solution for this limitation involves saving the current processor state information to external storage mechanisms e.g. such as flash memory a hard disk drive etc. . In such a case there is the overhead required in transferring the state to and from the external storage mechanism. Even if the battery powered device had a hard disk drive and many don t the time consuming state transfer would not meet the real time response requirements of the application when the device needs to wake up to respond to a new event.

Other issues are presented when the functionality of a device is implemented by a system on a chip SOC integrated circuit. For example when the core of a system on a chip CPU is temporarily powered down e.g. deep sleep mode some of the outputs that connect to assorted peripherals e.g. LCD display SPI interface SDIO Hard disk etc. should be held in an idle state to avoid having to reprogram the peripheral or lose existing context in the peripheral. This causes a problem since some peripherals need particular values to be set at their inputs which are connected to the outputs of the SOC to hold a safely inactive state. For example if a device is connected to a SOC that is clocked on the falling edge of a clock signal and the SOC is powered down with that signal as a logic 1 but the power down state is a logic 0 e.g. ground it will cause a spurious clock on that signal.

This problem is further exacerbated by the heavy use of pin muxing or sharing in which a single pin can have multiple functions in different designs by different customers. In one design a pin may be set to act as part of an SPI interface that wants to be held low when in sleep mode while the same pin in another design perhaps by a different customer may be used as a UART pin which would need to be held high when the CPU is put to deep sleep mode. While pin muxing provides a way to put more features in each chip and allows the chip to be more suitable for a wide range of designs it precludes knowing exactly at IC design time what each pin will be used for. A more flexible method of configuring the power down states is needed.

One solution to this problem would be to have a software defined register for each pin that drives the pin to any one of the allowed number of states such as Input output 0 output 1 output Hi Z open drain etc. This is a workable solution but has a problem that since normally the signals that control these functions come from the core of the CPU they will not be present when the core is powered down in deep sleep mode. To overcome this a second set of registers on the SOC will have to be in the special power domain.

The special power domain is configured to always have power on AO even in the deep sleep mode. The special power domain allows the state information of these IO pads to be preserved. However the big problem is that it requires multiple signals from the portion of the chip that is in the special power domain to each pad this can cause traces to be required. For example with 300 signal pads and 3 wires per pad as many as 900 traces have to be routed on the integrated circuit die which is a large number at the top level of an integrated circuit die layout. These pad control signals must also be powered by the AO rail which complicates the distribution of this AO rail or the routing of these pad control signals. Standard interrupt mechanism from the peripheral should result in an answer from the processor whatever is it s current state e.g. active or standby . The benefits of a low power strategy cannot be fully realized if this mechanism is not transparent to the external environment.

Thus what is needed is a solution for powering down a CPU for reduced standby power consumption while retaining the integrity of the operating state. What is further needed is a solution for powering down the CPU without imposing burdensome trace routing requirements on the integrated circuit die layout.

Embodiments of the present invention provides a method and system for powering down an integrated circuit device for reduced standby power consumption while retaining the integrity of the operating state. Embodiments of the present invention further provide a solution for powering down the integrated circuit device without imposing burdensome trace watering requirements on the integrated circuit die layout.

In one embodiment the present invention is implemented as a circuit for maintaining asserted values on an input output pin e.g. pad etc. of an integrated circuit device when one or more functional blocks of the device are placed in a sleep mode. The circuit includes an interface for coupling a functional block of a processor to an input and output pin and an output storage element coupled to the interface for storing a current value e.g. logical one logical zero etc. of the input output pin. The circuit further includes a sleep mode enable for controlling the output storage element to store the current value of the input output pin. The current value e.g. as generated by the functional block is stored prior to the functional block entering a sleep mode. The output storage element causes the current value of the input output pin to remain asserted after the functional block is in sleep mode. The sleep mode enable is also configured to deactivate the storage element when the sleep mode is exited thereby allowing the input output pin to resume being driven by the awakened functional block. In one embodiment the deactivation is performed independently among the different functional blocks. The integrated circuit device can be a CPU central processor unit a system on a chip and embedded computer system or the like. The input output pin can be coupled to a peripheral device e.g. display screen USB interface etc. for providing functionality to a user.

In this manner the signal state of the input output pins can be maintained as one or more functional blocks of the integrated circuit device are powered down. Upon exit from sleep mode e.g. wake up the input output pins can resume being driven by the one or more functional blocks. Additionally this capability is provided without requiring the routing of multiple signals from a special power domain to the input output pin which greatly reduces signal trace routing requirements. For example embodiments of the present invention enabled a wake up when one of a designated set of inputs transitions state. This allows the integrated circuit device to use the same pins that are used to recognize events during normal operation as wake pins to transition the device out of deep sleep.

In one embodiment different voltage rails are provided to accommodate the different peripheral voltages. For example a camera can work at one voltage while a WiFi chipset within the camera is working at another voltage. Waking up from the standard signal of a peripheral e.g. such as an interrupt avoids creating additional pads just for this function which would require a specific voltage choice and voltage translators on the board. So some few selected pads are used as a generic input in the processor active mode but as a wake up in the processor standby mode thus at the correct voltage.

Reference will now be made in detail to the preferred embodiments of the present invention examples of which are illustrated in the accompanying drawings. While the invention will be described in conjunction with the preferred embodiments it will be understood that they are not intended to limit the invention to these embodiments. On the contrary the invention is intended to cover alternatives modifications and equivalents which may be included within the spirit and scope of the invention as defined by the appended claims. Furthermore in the following detailed description of embodiments of the present invention numerous specific details are set forth in order to provide a thorough understanding of the present invention. However it will be recognized by one of ordinary skill in the art that the present invention may be practiced without these specific details. In other instances well known methods procedures components and circuits have not been described in detail as not to unnecessarily obscure aspects of the embodiments of the present invention.

Some portions of the detailed descriptions which follow are presented in terms of procedures steps logic blocks processing and other symbolic representations of operations on data bits within a computer memory. These descriptions and representations are the means used by those skilled in the data processing arts to most effectively convey the substance of their work to others skilled in the art. A procedure computer executed step logic block process etc. is here and generally conceived to be a self consistent sequence of steps or instructions leading to a desired result. The steps are those requiring physical manipulations of physical quantities. Usually though not necessarily these quantities take the form of electrical or magnetic signals capable of being stored transferred combined compared and otherwise manipulated in a computer system. It has proven convenient at times principally for reasons of common usage to refer to these signals as bits values elements symbols characters terms numbers or the like.

It should be borne in mind however that all of these and similar terms are to be associated with the appropriate physical quantities and are merely convenient labels applied to these quantities. Unless specifically stated otherwise as apparent from the following discussions it is appreciated that throughout the present invention discussions utilizing terms such as processing or accessing or executing or storing or rendering or the like refer to the action and processes of a computer system e.g. computer system of or similar electronic computing device that manipulates and transforms data represented as physical electronic quantities within the computer system s registers and memories into other data similarly represented as physical quantities within the computer system memories or registers or other such information storage transmission or display devices.

System can be implemented as a programmable system on a chip integrated circuit device where for example the CPU memory and GPU are fabricated as a single integrated circuit die with the display being coupled as a peripheral device. Similarly the system can be implemented as an embedded computer system within for example a handheld device e.g. PDA cell phone etc. . Alternatively system can be implemented as for example a desktop computer system or server computer system having a powerful general purpose CPU coupled to a dedicated graphics rendering GPU . In such an embodiment components can be included that add peripheral buses specialized graphics memory IO devices and the like. Similarly system can be implemented a set top video game console device such as for example the Xbox available from Microsoft Corporation of Redmond Wash. or the PlayStation3 available from Sony Computer Entertainment Corporation of Tokyo Japan.

Embodiments of the present invention implement a method and system for powering down an integrated circuit device for reduced standby power consumption while retaining the integrity of the operating state. Embodiments of the present invention enable the reliable powering down and waking up of the integrated circuit device without imposing burdensome trace routing requirements on the integrated circuit die layout.

In the embodiment the flexible pin configuration component is the interface that enables the multiple functions provided and implemented by the multiple functional blocks to share a limited number of input output pins. For example in one embodiment via the interface provided by the flexible pin configuration component the multiple functional blocks can share a single input output pin to deliver their functionality to the peripheral devices which may themselves also be sharing the single input output pin.

It should be noted that processor can be used to implement a central processor unit such as for example CPU of or a GPU such as the GPU of . The processor can also be part of a programmable system on a chip device. Similarly the processor can be used to implement an integrated circuit device where the functions of a CPU and the functions of a GPU are combined.

The power domain provides a mechanism for waking up the processor from a sleep mode. For example in one embodiment the power domain is configured to consistently have power applied to its constituent circuits. For example the constituent circuits of the power domain can be configured to receive a clock signal in an uninterrupted manner so that it can execute sequential state machine logic instructions etc. while the rest of the processor is powered down. This can allow for example an internal state machine within the power domain to detect wake event signals the signals indicating a wake up from the sleep mode. For example in one embodiment the wake event signals are detected by the AO block e.g. AO functional block . This block is on the AO rail. The one or more of the functional blocks that normally process the events are powered down. Once power is returned the functional blocks can process the event and resume normal operation.

In accordance with embodiments of the present invention the one or more input output pins between the flexible pin configuration component and the peripheral devices will have their state reliably maintained even though the functional blocks of the processor are powered down. The state will be maintained such that the entry and exit from sleep mode will be completely transparent to the peripheral devices .

In one embodiment different voltage rails are provided to accommodate the different peripheral voltages. For example a camera can work at one voltage while a WiFi chipset within the camera is working at another voltage. Waking up from the standard signal of a peripheral e.g. such as an interrupt avoids creating additional pads just for this function which would require a specific voltage choice and voltage translators on the board. So some few selected pads are used as a generic input in the processor active mode but as a wake up in the processor standby mode thus at the correct voltage. While some parts of the processor are powered off in standby the system should be able to power them up again automatically after detecting a wake up event. In one embodiment this is done by a hardware control circuit on the AO voltage rail e.g. AO functional block .

In normal operation the selected function drives the output via the output multiplexer as described above. The output of the multiplexer is coupled to the input output pin via a multiplexer and the buffer as shown. Similarly in normal operation the output enable turns on the buffer via the multiplexer as shown. During sleep mode a sleep mode enable in conjunction with a capture signal causes the storage element and the storage element to store the current value e.g. logical one logical zero etc. of the output multiplexer and the current value of the output enable signal e.g. the output enable multiplexer as described above . This causes the input output pin to be driven by the output of the storage element which would be the previously stored current value from the multiplexer . Thus after sleep mode entry the functional blocks driving the inputs of the multiplexer can be inactive. Additionally in the embodiment the output enable signal itself can be inactive since its value is stored within the storage element . Upon exit from sleep mode the sleep mode enable causes the input output pin to resume being driven by the multiplexer thereby deactivating the storage element and .

With respect to the input enable the input enable has its current value saved by the storage element in accordance with the capture signal and the sleep mode enable . Thus the input enable can control the input buffer even though the functional block that generates the input enable signal is in sleep mode. The input routes signals from the input output pin to be shared by the appropriate functional blocks.

Thus embodiments of the present invention limit the use of a central register to store state data for the input output pins of the device. Embodiment of the present invention utilize storage element as described above to enable each pad or input output pin to recall it s last state. For example when the software executing on the chip wishes to put the chip in deep sleep mode it simply cleanly tells each interface e.g. UART SPI HDD USB etc. to enter it s inactive state if it is not already there and then asserts a HW signal e.g. sleep mode enable to each of the pads to capture their current value e.g. input output 0 output 1 hi Z open drain etc. and hold that value without the core of the chip being awake. Once this is done the core can safely be powered down into a deep sleep mode. It should be noted that the constituent logic for performing the state retention function is comparatively small and is located near each signal input output pin. Thus very few top level signals are required to clock these storage elements as these signals can be shared for all affected input output pins and don t need to be point to point routed from the always on the core e.g. core of thereby minimizing trace routing requirements. The entry and exit for sleep mode is transparent to the peripheral devices. From an external devices point of view nothing has happened. The external devices do not know the CPU has gone to deep sleep as their inputs are not affected at all.

It should be noted that in one embodiment the system is configured such that the output enable is not used to exit the sleep mode. In such a configuration a separate control register can be utilized to disable the sleep mode on an interface by interface basis. The use of separate control registers to disable the sleep mode provides an advantage in that there can be less impact on signal timing.

The embodiment shows a case where multiple capture components are used to capture signals around the integrated circuit device for different selected interfaces. This enables an application where the integrated circuit device can unlock just a single selected interface or group of interfaces. be useful in applications such as where only the LCD needs to wake up to update the time on the display without needing to wake up all other interfaces. This aspect is illustrated in where the capture components are part of a first interface Capture A and the Components are part of a second interface Capture B. also shows how to connect multiple pads with this feature to avoid routing a large number of signals around the integrated circuit die with the input output and I O enable signals for each to component being as illustrated in .

In one embodiment the de assertion to re assertion of the output enable signal for each capture component would switch each output from driving the latched idle state to the value driven from the core once software had reinitialized the peripheral controller to match the idle state. This is necessary for interfaces where the reset state of the controller may not match the idle sate.

The foregoing descriptions of specific embodiments of the present invention have been presented for purposes of illustration and description. They are not intended to be exhaustive or to limit the invention to the precise forms disclosed and many modifications and variations are possible in light of the above teaching. The embodiments were chosen and described in order to best explain the principles of the invention and its practical application to thereby enable others skilled in the art to best utilize the invention and various embodiments with various modifications as are suited to the particular use contemplated. It is intended that the scope of the invention be defined by the claims appended hereto and their equivalents.

