---

title: Nonlinear motor control techniques
abstract: The present invention provides a torque loop control method for servomotors utilizing discontinuous pulse width modulation that incorporates measuring the power factor in real time. Also included is a sine wave generator for software-based spectrum analysis.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07629764&OS=07629764&RS=07629764
owner: BAE Systems Land & Armaments L.P.
number: 07629764
owner_city: Arlington
owner_country: US
publication_date: 20070205
---
The present application claims the benefit of U.S. Provisional Application No. 60 764 869 filed Feb. 3 2006 which is incorporated herein in its entirety by reference.

The invention was made by an agency of the U.S. Government or under a contract with an agency of the U.S. Government. The name of the U.S. Government agency is the U.S. Army and the Government contract number is DAAE 30 92 C 1112.

The present invention relates in general to control of a servomotor and more particularly to nonlinear techniques for controlling a motor at high speeds.

AC synchronous motors and brushless DC motors are controlled through commutation of solid state switching devices connected to their stator windings. These motors can be of the permanent magnet PM type in which permanent magnets are used on the rotor instead of rotor windings. Permanent magnet synchronous motors PMSM are widely used in motion controls electric vehicles and industrial turbo generators ITG .

For demanding servo applications having a well tuned torque loop in an electric motor drive that works optimally under a variety of operating points is highly desirable. In a multi axis servo application suboptimal torque loop performance on any axis at any time can adversely affect servo performance in terms of adequately achieving the required velocity response and steady state behavior.

Tuning the torque loop in an electric motor drive can be a labor intensive exercise that involves expensive equipment and often tuning techniques involve tuning for a particular operating point. However due to the nonlinear dynamics of the cross coupling terms in the voltage machine equations optimal tuning at one operating point can be very suboptimal for a different operating point. For example the majority of control schemes in industry utilize conventional PI control. These controllers typically have only one set of gains and are optimized for a single operating point. Operation at any other point tends to be sub optimal. Since these controllers are based on non linear three phase motor equations their robustness and performance declines with changes in current speed and inductance. Thus with conventional techniques one is left with a situation where performance and adequate stability margins are not guaranteed across the entire torque versus speed curve for a particular motor. Therefore there is a need for a system that tunes high speed motors with wide operating ranges.

Servomotor applications typically require that the servomotor be capable of operating at various speeds. Motors can be driven by placing a pulse width modulated PWM inverter and PWM controller between the servomotor and the voltage source. Ideally one would like to choose a PWM switching frequency as high as possible. However certain parameters put a constraint on just how high the switching frequency can be obtained. There are a number of factors that influence the selection of the PWM switching frequency in three phase inverters. Among these factors are 

One of the constraints in choosing the frequency is the processing capability of the computing element of the motor drive. The processor quite simply has a finite limit in how fast it can generate a control output. Another constraint is the switching losses. It is well known that switching losses are linearly proportional to the switching frequency. Depending on the switching elements selected in the inverter design this can have significant impact on inverter efficiency which affects the design of the heat sink and vehicle cooling system sizing. Selection of an appropriate control algorithm with an appropriate PWM switching frequency can add important benefits toward minimizing this impact. There is a sizeable body of research in the technical community that has been focused on developing control algorithms that can lower switching losses and analyzing and comparing these control schemes to determine their impact on switching losses.

To solve the problem one would like to set up a set of circumstances where the time spent on tuning the torque loop can be minimized while at the same time the techniques guarantee stability margins and performance requirements that hold across the entire torque versus speed curve for the motor under test. This is a complex problem that requires the following multi layered strategy in order to solve. Thus there is a need to 

 1 Develop compensation for parameters that can change as a function of some known variable. It is known that motor torque constant for example changes as a function of current. By compensating for varying parameters in a well behaved manner they can be treated as constants for practical purposes and this simplifies the problem to a certain degree to set the stage for the next layer in the strategy.

 2 Develop a means whereby the control technique can decompose the operating regions into manageable partitions and the control system automatically adjusts its parameters according to which region it is operating in.

 3 Develop a set of performance enhancement techniques that can be implemented as needed to further improve performance. These techniques would further enhance torque loop response time minimize current ripple and improve torque output for a given motor size.

 4 Develop a tool in firmware that can verify the performance enhancements and stability margins without the need for expensive equipment.

To have good dynamic response for a permanent magnet synchronous motor PMSM the controller should be able to control the torque component of the inverter output current to the motor based on the rotor position. The present invention is a method for producing a well tuned torque loop in an electric motor drive that works optimally under a variety of operating points. Therefore it is a primary objective of this invention to provide a torque versus speed curve partitioning and linearization multi input multi output control technique. The torque versus speed curve is partitioned into regions of a predefined speed width. An operating point is selected in the middle of each region. In the voltage machine equations speed is considered constant with respect to the current dynamics around this operating point for the entire width of each region. Standard linear multi input multi output control techniques are used to find the optimal control gains for each region. A lookup table with current and speed indices determine which region the motor is operating in and an algorithm chooses the appropriate controller corresponding to that region.

It is further an objective of this invention to provide a technique for compensating for motor torque constant as a function of current. The technique uses a lookup table that characterizes the motor torque constant nonlinear behavior as a function of current. The current controller can then compensate for the change in flux that is a result from the changing motor torque constant.

It is further an objective of this invention to provide a technique using standard C libraries or Simulink models coded into C code to generate a sine wave that can be created with programmable frequency amplitude and outputs. The sine wave generator can be interfaced and embedded anywhere within the control algorithms to inject sine waves and programmed to inject a frequency sweep over a pre selected frequency range. Data is collected and logged in real time on the processor card and then transferred and stored in a buffer on a standard PC. The data can be processed or plotted using tools such as Matlab or Excel. This software based spectrum analyzer takes the place of expensive hardware based spectrum analyzers and makes troubleshooting and tuning out in the field less costly and cumbersome.

It is further an objective of this invention to provide a new scheme that decomposes the feedback signals to the fundamental and harmonic components through fast Fourier transform s FFT s or wavelet transforms. Standard d q current control has limitations in bandwidth in that it has precise control of the fundamental but not of the harmonics which act as time varying current commands. Here the fundamental and its harmonic components are transformed into multiple d q reference frames where its respective controllers perform the control for each of those components. Once the output control signals are computed they are muxxed together into three phase control output signals that are converted into PWM voltage input.

The motor is intended to be driven from a sinusoidal time varying voltage source thus the stator windings are sinusoidally wound. A shaft sensor is used to shape the voltage waveform incrementally as the rotor position changes. This contrasts with a trapezoidal permanent magnet motor in which the winding are driven with a trapezoidal voltage waveshapes and the shaft sensor only detects 60 electrical sectors.

The PMSM utilizes a control system design specified in this document that performs a reference transformation between the time varying frame of reference and a non time varying rotor frame of reference. This allows the motor to be controlled in a manner similar to a DC servo motor and it increases the closed loop performance as compared to a time varying control system.

As illustrated in the purpose of the torque loop algorithm is to determine the appropriate voltages to apply to the permanent magnet synchronous motor given a torque command and current and shaft position feedback. The normal processing sequence is 

 3 Calculate the reverse transformation to convert measured currents and resolver inputs to d and q axis currents I referenced to the rotor. These values are the feedback values for the torque controller .

 5 Calculate the forward transformation to convert the d and q axis command voltages V to stator reference frame and axis command voltages V .

and s is the Laplacian differential operator. Equations 1 and 2 do not contain a term for iron losses. For integral kW servo motors iron losses can normally be neglected for dynamic performance. Note also that 1 and 2 contain a cross coupling term with regard to and i. The corresponding torque equation for the motor is 

Equations 1 and 2 are non linear as a function of speed due to the state to state multiplication of current and speed. When operated open loop the PMSM machine equations can be represented as Equation 4 Equation 5 These equations can be linearized about a small region of the operating point. Let x i x v u v u v Equation 6 The linearized state equations are

One method to determine the appropriate gain for each newly defined region is to use traditional gain scheduling. Gain scheduling adjusts the proportional gain discretely according to the schedule where the schedule is determined in the particular linearized torque speed region by ad hoc tuning. This method works better than conventional PI control but is still sub optimal even when tuned to operate in the linearized operating region because the gains are fixed within each region. A second disadvantage to gain scheduling is that the plant dynamics must change slowly as each region is transitioned. If the dynamics change too fast the abrupt changes which can create instability issues.

The control strategy of using a multiple input multiple output MIMO linear quadratic Gaussian LQG controller for each region provides distinct advantages over gain scheduling since the calculation can be computed by solving the Ricatti equation for each speed region. provides an example of an LQG controller with an integrator . For this type of controller the control law and estimator are designed separately in accordance to the Seperation Principle. For this segmented linearized regional partitioning scheme each region has its own unique controller optimized for performance. Instead of using a fixed PI gain according to a schedule weights on the cost function are scheduled. The controller minimizes the cost function and calculates the optimal gains and estimates by solving a pair of Ricatti equations. Each region s controller can then trade off performance for robustness if needed by performing loop transfer recovery if needed. Loop transfer recovery is accomplished by increasing the spectral density of the fictitious noise disturbance at the control output until acceptable robustness properties are obtained. A new controller is designed with these properties that is suboptimal in terms of performance at the cost of increased robustness.

The linear state space equations for the plant can be represented as Equation 8 and Equation 9 where x t is a state variable u t is the input y t is the output w t is the disturbance input m t is the measurement and v t is the measurement noise . A B B and Care the state space matrices.

The optimal plant estimator using LQG control is a Kalman filter Equation 12 where G is the Kalman gain. The gains K and G are solved by simultaneously solving the pair of Ricatti equations for the controller and the plant.

The gains are used in closed loop equations of the plant controller and estimator to form the LQG controller . The result is an optimal controller in terms of performance in the presence of white noise disturbances. However since the controller is not optimal in terms of robustness to all disturbances loop transfer recovery must be performed. This concept of optimal control can be extended from single input single output control SISO to multi input multi output control MIMO using matrix algebra. In the case of the current controller for a PMSM motor the inputs are i iand and the outputs are vand v. A unique MIMO current controller can be designed to operate in each operating region of the linearized plant following standard design procedures for designing optimal MIMO LQG controllers.

In order to ensure a smooth transition from one controller to the next as the regions are traversed the region sizes as defined by that define the operating regions must be small enough to minimize the abrupt disturbance due to the change in plant dynamics. On the other hand the region size must be large enough to keep the processing and memory requirements manageable. Since the gains are not fixed they will adjust themselves to the new plant dynamics in a smoother fashion as compared to a fixed gain response.

In addition to linearizing portions of the torques versus speed curve standard d q current control has limitations in bandwidth in that it has precise control of the fundamental but not of the harmonics which act as control modes that are uncontrollable. Thus there is an opportunity to exploit more performance out of a PMSM if these control modes could be reached. This control scheme decomposes the current measurement into its spectral components asserts control over specific components and reintegrates the control outputs into one control output.

Specifically the fundamental and its harmonic components are transformed into the d q reference frame where its respective controllers perform the control for each of those components. Once the output control signals are computed they are muxxed together into three phase control output signals that are converted into PWM voltage input. The entire control scheme is shown in .

As illustrated in the feedback current measurement which has been converted from an analog signal into a digital signal is decomposed into select harmonic components via Fast Fourier Transforms FFTs . The harmonic components are transformed into the dq reference frame via reverse transformation and summed with T. Separate MIMO based current controllers are designed to assert control authority over each harmonic component. Once the control outputs have been calculated the components are transformed back into the abc rotating reference frame via forward transformation . The components are then combined into one control output which is in the form of a voltage command to the inverter .

DPWM Discontinuous Pulse Width Modulation with Power Factor Correction can further improve control performance of the servo motor. DPWM can reduce switching losses by injecting harmonics called the zero sequence into a conventional sinusoidal voltage command waveform in such a way that for a finite period of time there are no switching events. For example the total power losses for a switched mode inverter can be decomposed at the device level and at the operational level. At the operational level there will be loss contributions due to when the switching components are in the on state. The on state can be defined as the state at which the switching devices are continuously conducting. These losses are known as the conduction losses. During the time that the switching devices are in the process of switching there is a finite period of time where there is conduction and voltage drop due to the fact that the switching devices cannot be turned on or off instantaneously. The losses that occur during this switching state are known as the switching losses. shows an illustration of typical switching losses . Switching losses can be calculated according to the equation

The use of Space Vector PWM can reduce these switching losses. Space vector modulation increases the linear output of the inverter by a factor of 2 square root over 3 . This is accomplished by forming special non sinusoidal line to neutral voltages that sum to a line to line voltage that exceeds linear modulation. Because of the increased voltage the currents will be lower for a given power level. There is also going to be fewer switching events that will occur due to the higher modulation index that is a result of the higher duty cycle voltage commands. Thus with Space Vector PWM there will be lower conduction losses and switching losses compared to conventional linear modulation schemes.

Space Vector modulation divides the and planes into six space vector sectors represented by Roman numerals as shown in . also shows the switching states that correspond to the following stationary reference frame voltage vectors 

An algorithm can be used to determine the space vector sector based upon the location of voltage command vector. illustrates how vector V forms an angle relative to the zero reference for the voltage command vector . The space vector angle that is utilized by the algorithm is a relative space vector angle referenced by a space vector sector boundary. Each of the six space vector sectors are offset by 60 relative. Since only the assumed reference frame basis and the voltage command vector is known the sector is inferred through the indirect knowledge of the space vector angle.

One embodiment of an algorithm that determines space vector sectors is defined by the following pseudo code 

Referring to the space vector pulse pattern illustrated in and using space vector sector as an example the switching times are where 

Because is not known the terms sin 60 and sin must be determined by another method. To avoid using a trigonometric function the fact that the individual voltage command components are essentially the sine and cosine component with respect to the shaft position s sine and cosine component is used. Now a vector rotation is just necessary to compute sin 60 and sin . Substituting in the above relationship 

Expanding using a trigonometric arrangement and realizing that for which we have already computed sin and cos 

DPWM can reduce switching losses over Space Vector PWM by up to 50 . The DPWM algorithm accomplishes this by injecting harmonics called the zero sequence into a conventional sinusoidal voltage command waveform in such a way that for a finite period of time there are no switching events. The voltage command is clamped to either the positive or negative rail of the DC bus during this period. This lull in switching events for each phase is timed such that one of the three phases will be in this non switching mode at anyone time.

For DPWM assume vector control and that the forward conversion transformation has occurred such that the orthogonal 2phase rotor referenced voltage vector Vdq is transformed to an orthogonal 2phase electrical winding referenced rotating voltage vector V utilizing the forward Park transformation. Using simple linear modulation this modulation scheme transforms the orthogonal stationary voltage commands V and V to the 3 phase stationary voltage commands by using an inverse of the Reverse Transformations.

Then a maximum magnitude test is applied to the phase shifted command voltages. The zero sequence is then added to the voltage commands before the shifting occurred and this becomes the new command voltage where the voltage command that had the maximum amplitude has its voltage command clamped such to the positive or negative DC bus rail such that no switching events occur until another voltage has the maximum magnitude. shows the resulting PWM command waveforms after the zero sequence has been applied.

From the waveforms the clamping of the voltage to the positive and negative rails can be seen. There are also jagged peaks that occur at or around the midpoint of the voltage commands. These are caused by the zero sequence that is generated using equation 13 above. When the zero sequence is added to the sinusoidal voltage command the waveform in is the result. This may become more clear by referring to which shows the sinusoidal voltage command the zero sequence and the PWM command voltage after the zero sequence is added. Note that the line to line voltage with respect to phase A and B is sinusoidal.

In one embodiment of this invention the DPWM algorithm is applied to a 3 phase PMSM. The algorithm is then modified such that power factor is measured in real time and the control parameter is adjusted to optimize the reduction in switching losses. The DPWM algorithm transforms the voltages from 2 phase voltages in the rotating reference frame to 3 phase harmonically modified sinusoidal voltages 120 degrees apart from one another. It accomplishes this by using a linear transformation to transform from a b voltages to 3 phase abc voltages. It then shifts all three voltages by and applies a maximum amplitude test to determine which phase voltage is injected with the harmonic waveform that clamps the voltage command to the positive or negative rail of the DC bus.

A unique feature of this DPWM control is that the power factor is estimated directly from the measured current from a current sensor and the commanded timer value. The timer value is shifted and rescaled to a voltage value that is normalized with respect to the maximum allowable phase voltage. The current measurement is normalized with respect to the maximum allowable current rating of the amplifier or the motor whichever is lowest. Both signals are filtered through a low pass filter of the same order so each output produces smooth sinusoidal waveforms with the same relative timer values with respect to each signal. The power factor is then calculated based on the stored timer values. Then the power factor value is fed into the DPWM algorithm where the harmonic injection point in the sinusoidal phase voltage command is adjusted based on this power factor value. Thus the entire algorithm insures based on the quality of the power factor estimate that the center of the voltage clamping occurs at the optimal point which is relative to the peak of the respective phase current.

The present invention thus provides a method for reducing inverter switching losses through the implementation of a DPWM algorithm. The algorithm has the added feature of maximizing the reduction of switching losses by estimating the power factor in real time from the measured current and commanded voltage so that the harmonic injection signal occurs at the optimal time. It is envisioned that the optimal time is where the center of the voltage clamp in the harmonic injection lines up with the peak of the measured current.

The present invention further includes a built in frequency response generator. Using standard C libraries or Simulink models coded into C code a sine wave generator can be created with programmable frequency amplitude and outputs. The sine wave generator can be interfaced and embedded anywhere within the control algorithms to inject sine waves and programmed to inject a frequency sweep over a pre selected frequency range. Data is collected and logged in real time on the processor card and then transferred and stored in a buffer on a standard PC. The data can be processed or plotted using tools such as Matlab or Excel. This software based spectrum analyzer takes the place of expensive hardware based spectrum analyzers and makes troubleshooting and tuning out in the field less costly and cumbersome.

As illustrated in a servo motor controller is interfaced to the PC hardware via a communications interface such as GBe Gigabit Ethernet for example. The frequency generation parameters and mode is user selectable on a Graphical User Interface GUI on a conventional PC. From the GUI the user can issue a command to begin the frequency sweep. Within the servo motor controller is embedded software that contains the application software that implements the control loops . Also contained in the embedded software is the support structure for executing the frequency response commands. This support structure contains the inputs outputs and a software based sine wave generator that operates based on the commands from the user. By selecting the appropriate mode the embedded software injects the sine wave signal to the appropriate input and data is sent out to the corresponding output. The data is logged in real time as the sweep is executing and it is sent across the communications interface back to the PC where the data is stored in a database . The database has an interface to Matlab which processes the data. The processed data then appears on the GUI and because it is catalogued and stored in a database it can be retrieved for future analysis.

Various modifications and alterations to this invention will become apparent to those skilled in the art without departing from the scope and spirit of this invention. It should be understood that this invention is not intended to be unduly limited by the illustrative embodiments and examples set forth herein and that such examples and embodiments are presented by way of example only with the scope of the invention intended to be limited only by the claims set forth herein.

