---

title: IMS diameter router with load balancing
abstract: A Diameter router is presented for performing load balancing and initial Diameter message routing in an IMS network, where clients in network elements are provisioned with the address of the router and send an initial Diameter request message for a given session to the router. The router selects a server based at least partially on a type of IMS message session, application services, subscriber information, or billing information, and sends a relayed initial Diameter request message to the selected server. The selected server sends an initial Diameter response to the router which then forwards a relayed initial response to the client. Thereafter, the client and the selected server send messages directly to each other for the remainder of the session.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08468267&OS=08468267&RS=08468267
owner: Alcatel Lucent
number: 08468267
owner_city: Paris
owner_country: FR
publication_date: 20071201
---
This application is a national stage entry of international application number PCT US2007 086203 having international filing date of Dec. 1 2007 which was published in English the entirety of which is hereby incorporated by reference as if fully set forth herein.

This invention relates generally to the field of telecommunication systems and more particularly to IMS routers and methods for load balancing in an IMS subsystem.

Diameter is a protocol described in RFC 3588 and has been used in 3GPP IMS IP Multimedia Subsystem standards to provide an Authentication Authorization and Accounting AAA framework for applications such as network access or IP mobility and has found many new applications in IP networks since the introduction of IMS concepts. In an IMS network Diameter servers hosts can implement various functions including without limitation Application Server AS Policy Decision Function PDF Resource Admission Control Subsystem RACS AAA Home Subscriber Server HSS Call Control Function CCF Charging Data Function CDF and Online Charging System OCS . A Diameter server moreover can be implemented as a single network element NE or as multiple network elements e.g. a server cluster . In addition any network element of an IMS network or other legacy or 2G networks can support Diameter clients which interface with the Diameter server s using the Diameter protocol. It is desirable to control or regulate Diameter message traffic flow in an IMS network so as to facilitate optimal system performance and reliability including NE availability and geographical redundancy. Moreover it is desirable to balance the load and traffic among the Diameter servers and clients. Conventional IMS networks sometimes include TCP IP load balance switches LBS that monitor the traffic and load among network elements to determine traffic directions based on current network element load status and on the number and size of messages. However the Diameter protocol is an application based Application Programming Interface API built on a network layer above TCP IP and thus Diameter traffic control and load balancing cannot be achieved using conventional TCP IP load balance switches. For example a TCP IP layer LBS monitors the loading of IP sockets in the network whereas Diameter load balance issues are unrelated to individual socket loads since one socket may contain multiple Diameter protocol dialogs for multiple applications.

A limited Diameter routing solution is described in U.S. Pat. No. 7 170 982 to Li et al. with respect to AAA the entirety of which is hereby incorporated by reference. This router routes an accounting request and response message to an account server for serving calls by a particular subscriber because subscriber data resides in a particular server. When a subscriber originates a call the account request is transmitted to the Diameter router that determines which account server serves that subscriber and forwards the account request message to selected account server. This router however does not address overall Diameter load balancing and traffic control in IMS networks. Other soft switch approaches such as the Lucent Control Platform LCP Lucent Session Manager Lucent Soft Switch operate to direct Diameter messages for IMS network elements to HSS or CCF Diameter Servers but this load balance mechanism simply chooses the Uniform Resource Identifier URI of a destination host to distribute Diameter request messages evenly and randomly and therefore does not perform effective traffic management and load balancing. Thus there remains a need for improved methods and apparatus to balance Diameter protocol loading and manage traffic in IMS networks.

The following is a summary of one or more aspects of the invention to facilitate a basic understanding thereof wherein this summary is not an extensive overview of the invention and is intended neither to identify certain elements of the invention nor to delineate the scope of the invention. Rather the primary purpose of the summary is to present some concepts of the invention in a simplified form prior to the more detailed description that is presented hereinafter. The various aspects of the present disclosure relate to a Diameter router with network load balancing capability that can advantageously distribute Diameter traffic to Diameter servers based on types of IMS message sessions application services subscriber information billing information etc. The Diameter router address is provisioned in clients of the network elements and the clients send initial Diameter request messages for a given session to the router. The router selects a server based at least partially on a type of IMS message session application services subscriber information or billing information and sends a relayed initial Diameter request message to the selected server. The server in turn sends an initial Diameter response back to the router which then forwards a relayed initial response to the client. The client and the selected server in one implementation send subsequent request and response messages directly to each other for the remainder of the session. Alternatively the subsequent session messages can be sent through the Diameter router.

In accordance with one or more aspects of the disclosure a router is provided for receiving and relaying initial Diameter session request and response messages from clients and servers in an IMS network. The router comprises a load balancing component which receives initial Diameter request messages and relays initial Diameter request messages to a selected server in the network based on at least one routing policy as well as a routing policy engine or component that selects a network server for routing of a given initial Diameter request message based at least partially on a type of IMS message session application services subscriber information or billing information.

In a further aspects of the disclosure the routing policy component may include a Diameter reference of points component operative to distinguish Diameter Cx Sh Rf Ro Go and Gq request messages and to identify suitable host servers in the network capable of providing services associated with the initial Diameter request message and wherein the routing policy component selects a server for routing a given initial Diameter request message from the identified suitable host servers. In accordance with other aspects of the disclosure the policy component may include a traffic and load analysis component that dynamically monitors traffic load and an alive status of the servers where the routing policy component selects a server for routing a given initial Diameter request message based at least partially on the traffic load and alive status of the servers.

In yet another aspect of the disclosure the routing policy component includes a call session subscriber information component that operates to identify servers that are associated with a subscriber corresponding to the initial Diameter request message based at least partially on a subscriber UE type a directory number a service type or a charging account type of the initial Diameter request message wherein the server is selected for routing a given initial Diameter request message from the identified host servers.

Other aspects of the disclosure provide that the routing policy component includes a home or visit network component that determines whether a new call session is from a home or visited network with the policy component selecting a server for routing a given initial Diameter request message based at least partially on whether the call session is from a home or visited network. In another aspect the policy component includes an accounting information component that parses accounting information including an IMS Charging ID in received Diameter request messages where the routing policy component selects a server for routing a given initial Diameter request message based at least partially on whether the accounting information.

In accordance with further aspects of the disclosure routing policy component may include a network element types component to identify a network element type of the requesting client based on the received Diameter request message where the routing policy component selects a server for routing a given initial Diameter request message based at least partially on the identified network element type. Another aspect provides that the policy component has an application service types component that operates to identify application and service types from received initial Diameter request messages in which case the session server is selected based at least in part on identified application and service types.

Still further aspects of the disclosure provide that the load balancing component is operative to insert a destination host address corresponding to the selected server and a destination realm corresponding to the router into a relayed initial Diameter request message and to send the relayed initial Diameter request message to the selected server. In addition the load balancing component can be operative to receive an initial Diameter response message from the selected server and to send a relayed initial Diameter response message to the requesting client.

The router moreover may be operative to access update and maintain a shared memory with a second router in the network in accordance with yet other aspects of the disclosure.

Other aspects of the disclosure are directed to a communications system that comprises a plurality of network elements coupled to an IMS network and individually comprising one or more Diameter clients as well as a plurality of Diameter servers operatively coupled with the network where the servers are configured to perform one or more services requested by the clients. The system further includes a Diameter router operatively coupled with the network which is comprised of a load balancing component and a routing policy component. The load balancing component receives initial Diameter request messages and relays these to a selected server based on at least one routing policy and the routing policy component selects a server for routing of a given initial Diameter request message based at least partially on a type of IMS message session application services subscriber information or billing information. In further aspects of the disclosure the system also includes a second router coupled with the network where the routers access update and maintain a shared memory and wherein one of the routers may be configured as a primary Diameter router and the other is configured as a secondary Diameter router.

Still other aspects provide that the load balancing component is operative to insert a destination host address corresponding to the selected server and a destination realm corresponding to the router into a relayed initial Diameter request message and to send the relayed initial Diameter request message to the selected server and the server operates to receive the relayed request message to copy the address of the router into a destination host field of an initial Diameter response message and to send the Diameter response message to the router. The router in this case is further operative to receive the initial Diameter response message from the selected server and to send a relayed initial Diameter response message to the requesting client and the client operates to receive the relayed initial Diameter response message to copy the selected server address from the destination host field of the relayed initial Diameter response message and to send subsequent Diameter messages for a current session directly to the selected server. Alternatively the client and selected server may send the subsequent session messages through the Diameter router.

Still other aspects of the disclosure provide a method for routing Diameter messages for a Diameter session in an IMS network. The method comprises a client sending an initial Diameter request message to a Diameter router in an IMS network and the router selecting a server based at least partially on a type of IMS message session application services subscriber information or billing information and sending a relayed initial Diameter request message to the selected server. The method may further comprise at the Diameter router inserting a destination host address corresponding to the selected server and a destination realm corresponding to the router into the relayed initial Diameter request message as well as receiving the relayed request message at the selected server copying the address of the router into a destination host field of an initial Diameter response message and sending the Diameter response message to the router. In addition the method may include receiving the initial Diameter response message at the router sending a relayed initial Diameter response message to the requesting client as well as the client receiving the relayed initial Diameter response message copying the selected server address from the destination host field of the relayed initial Diameter response message and sending subsequent Diameter messages for a current session through the router or directly to the selected server.

Referring now to the figures several embodiments or implementations of the various aspects of the present disclosure are hereinafter illustrated and described in conjunction with the drawings wherein like reference numerals are used to refer to like elements.

Referring initially to an exemplary IMS network or system is illustrated for supporting various telecommunications services. The network includes one or more IMS network elements wherein only two such elements and are illustrated in the figure so as not to obscure the various aspects of the disclosure and where the network includes various other elements normally associated with an IMS network. The elements can be implemented in any suitable form of hardware software firmware logic or combinations thereof and may be constructed as a single component such as a server etc. or may be implemented in distributed fashion across two or more components operatively associated with the IMS network in accordance with the disclosure. As shown in moreover the network elements may individually comprise one or more Diameter clients such as applications or other components implemented in the network elements . In the illustrated example exemplary Diameter clients and of a first network element as well as clients and of a second network element although the various load balancing and routing aspects of the present disclosure can be implemented in association with any number and combination of clients and network elements in an IMS network .

The network further includes one or more Diameter server clusters wherein the illustrated server cluster includes three exemplary Diameter servers hosts and . In practice the servers of the cluster implement services related to telecommunications and thus provides various hardware and or software network elements including call session control functions CSCF Home Subscriber Server HSS Global Roaming Application Server GRAS media gateway MGW and media gateway control function MGCF border gateway control function BGCF multimedia resource function processor MRFP media resource function control MRFC etc. in order to manage call sessions and provide packet switching for multimedia communications e.g. text messages packetized voice communications etc. within the network and other IMS network functions where user equipment not shown may be operatively connected to the IMS network via a radio access network RAN that provides subscriber or visitor access including radio base stations and control and concentration nodes not shown . Data or bearer paths in the network carry or relay the communication traffic and or user information intended to be transmitted from one device to another and control paths transfer associated signaling and or control commands or messages to and between appropriate network elements and or entities in the IMS network such that call sessions are properly managed and routed using call control and signaling functionality via the CSCF BGCF MGCF MRFC and GRAS and bearer paths interfacing via MRFP and MGW to provide and support interconnectivity to external networks and or subsystems such as packet data subsystems a public data network PDN and public switched telephone public land mobile networks PSTN PLMN that may be operatively coupled with the media gateway.

In operation a CSCF supports and controls multimedia sessions in which the MGCF and or the MRFC are invited to call sessions to provide the bearer paths as needed for a call session whereby the CSCF thus provides incoming call gateway ICGW call control function CCF serving profile database SPD and address handling AH functions. The ICGW function operates as a session entry point and routes incoming calls and the CCF executes call setup termination and state event management and interacts with the MGCF for calls to or from the PSTN PLMN and with the BGCF for calls to the PSTN PLMN to determine the appropriate MGCF to use. In addition the CCF function controls the MRFP via the MRFC where the MRFC interprets information or signals coming from the CSCF and controls the MFRP accordingly in order to support conferencing and other multi party services. The CCF implements subscriber registrations and may also provide service trigger mechanisms to the GRAS or other application server to invoke services provided thereby. The CCF function moreover operates to report call events for billing auditing intercept or other purposes and may query the address handling functionality to ascertain whether a requested outgoing communication is allowed given the current subscription. The serving profile database function interacts with the HSS to receive and cache user profile information including an indication of whether a given user equipment is a multimode device wherein the address handling functionality includes address analysis translation modification when appropriate and or mapping.

The MGW operates as an interface for bearer path transfer between the network and other networks e.g. PSTN not shown and provides resources for translation and encoding transcoding compression packetizing depacketizing etc. with respect to bearer path traffic. The MGW also interacts with the MGCF which in turn interprets signaling from the CSCF and controls the MGW accordingly for resource allocation bearer path control and payload processing. The MGCF communicates with the CSCF to control the call state for media channels on one or more media gateways and also performs conversions between legacy and 3G UMTS CDMA network call control protocols. In addition the MRFC manages media stream resources in the MRI P which also acts as a bearer path interface between the network and external networks and or subsystems while providing conferencing multiple party communications or other media services with respect to the gateway. The HSS maintains subscriber and system related data user profiles locations etc. along with memory resources to provide for user identification through numbering and addressing information user security information including network access control information for authentication and authorization user location information for user registration and locating as well as user profiles including indications of dual mode functionality and identification of the services subscribed to and other service specific information.

Referring now to in accordance with the present disclosure the network includes one or more Diameter routers wherein two such routers and are shown in for illustrative purposes although any number of such routers may be provided in accordance with the present disclosure. The Diameter routers operate as a proxy for a first pair of Diameter messages in a given session with the remaining session Diameter messages being either communicated between the requesting Diameter client or and the selected host server or directly without the proxy of Diameter router so as to diversify traffic congestion in Diameter router or alternatively the subsequent Diameter session messages are sent through the router . Moreover the router performs load balancing with respect to the servers of the cluster through section of the server that will handle a given session where the router can select from any number of available and suitable equipped Diameter servers and may implement any sort of load balancing algorithm or scheme in accordance with the present disclosure.

For a given session in which one of the clients requires the services of one of the host servers in the cluster the appropriate server is selected by the router and the client and selected server initially exchange messages with the router . As shown in the exemplary router includes a load balancing component and a routing policy component which can be software hardware logic etc. or combinations thereof by which the router determines which host servers and or is capable of providing the requested service and selects one of the servers for the session. The routing policy component comprises a Diameter reference points component a traffic and load analysis component a call session subscriber information component a home or visited network component an accounting information component an IMS network element types component and an application service types component .

In operation the Diameter router selects the destination host to which the Diameter requesting message will be relayed and the router executes a policy management function via component based on load balancing conditions and other policies by which the present disclosure facilitates improved operation compared with conventional TCP IP and Diameter routing solutions. shows an example Diameter session in which a first client of the first IMS network element in requires a service that can be handled by any of the host Diameter servers in the Diameter server cluster . In a first pair of Diameter messages of the session in one embodiment the client sends a first Diameter request message with a destination realm indicating the diameter router e.g. diameter.com but without a destination host address. The Diameter router acting as a proxy performs policy management and selection of one of the destination host servers host server in this example. The router then routes the message to the selected Diameter host including a destination realm diameter.com and a host address e.g. diameter 1.com in this example that indicates the selected server . The Diameter host server receives the relayed request message and copies the destination realm and host addresses diameter.com and diameter 1.com from the message into the origin realm and host address fields of the corresponding Diameter response message and sends this message to the Diameter router . The router in turn relays the response message to the requesting client in the first network element

Once the client receives the first Diameter response message via the router the client will recognize the origin realm and origin host fields and accordingly send the subsequent Diameter messages associated with the session directly to the selected Diameter host server thereby bypassing the Diameter router for the remainder of the session. In this regard the client copies the origin realm and host addresses from received first Diameter response message into the destination realm and host address fields of the subsequent session messages . The host server in turn responds with messages directly to the client for the remainder of the session. In addition the load balancing component of the Diameter router dynamically monitors the traffic flows to each Diameter host server and adjusts the destination of initial Diameter request messages for each session based on the monitored traffic flow and other routing policy considerations so as to facilitate Diameter load balancing among the nodes of the IMS network . In an alternate embodiment the subsequent session messages etc. for the session are again routed through the Diameter router which remains acting as a proxy for the entire session or at least a portion thereof beyond the initial request and response messaging .

As noted above the Diameter router performs the load balancing and routing operations in accordance with a plurality of policy considerations via one or more of the components . As depicted in the major routing policies include the Diameter reference of points component that operates to distinguish the nature of Diameter request messages and the suitable host servers therefor including without limitation Cx Sh Rf Ro Go Gq etc. in selecting the Diameter host server to which a given request will be routed. For example Rf type requests will be routed to a server that provides CCF or CDF functionality whereas Ro messages will be routed to servers configured to support OCS functions and Cx or Sh messages will be selectively routed to HSS configured servers .

Another routing policy is implemented via the traffic and load analysis component which the router employs to dynamically monitor the traffic load e.g. queued messages of each of the host servers as well as the alive status at each host . By this analysis the router can advantageously refrain from sending new Diameter request messages to a given host if it is currently overloaded or down despite being configured to support the requested service associated with a given request message.

In addition the routing policy component includes a call session subscriber information component that preferably includes a subscriber to host mapping table or which is operatively coupled to access and external subscriber to host mapping table. The router will check the mapping table to identify the routing destination host that is associated with a given subscriber for example such that a Diameter request message with subscriber having a prepaid account associated with a specific OCS will be routed to the host that implements that specific OCS. The mapping table may also specify primary and secondary host server names and addresses to provide for alternate host selection and message forwarding if the primary host server is down or unavailable. In this manner the Diameter router can support intelligent routing and load balancing in consideration of service requests that are subscriber specific for instance where the subscriber information can include subscriber UE type directory number service type charging account type etc.

The home or visit network component operates to determine whether a new call session is from a home or visited network and to selectively determine the routing destination host server accordingly. In this regard there may be different configurations depending upon whether a call and accordingly the initial request message from a visited network should be routed to a home network server or to a visited network server based on call types and other network configuration factors. For instance where a caller roams to and initiates a call in a visited network the terminating S CSCF will query the visit network HSS via Sh and will send charging information to the home CCF via Rf.

The router also includes an accounting information component with which the router parses accounting information in the Diameter request message to determine any charging related routing. Thus for online charging the initiating request message can be relayed to a server providing the OCS functions whereas for offline charging the request message can instead be routed to a host server that provides CCF or CDF functions. In this regard a given IMS network element or node may send many Diameter messages with a unique IMS Charging ID ICID which is used to correlate Charging Data Records CDRs generated at the CCF CDF for an IMS call. As part of the Diameter load balancing feature the Diameter router will check the ICID Attribute Value Pair AVP from the Diameter request messages and route all messages with the same ICID to a host server implementing a single CCF or CDF so that the selected host can generate CDR files for a given call in the same place or even correlate all CDRs with same ICID into one consolidated CDR. In this respect consolidation of all CDRs into a single CDR is facilitated by the disclosed router by selective routing to the same server whereas otherwise it is extremely difficult or impossible to consolidate charging information or CDRs if charging messages for these are not all routed to the same charging host whereby the present disclosure provides this additional advantage over conventional routers and load balancing schemes.

The IMS network element types component operates to differentiate NE types based on the received requesting Diameter message such that the routing can be selected according to the network element type. In this manner the Diameter router can facilitate the routing of request messages from a given network element to the same destination host server handling other sessions for clients of that network element if the host has sufficient network element data to process the request message.

The Diameter router further includes an application service types component that distinguishes application and service types from the received initial Diameter request messages in determining the routing destination. For example a Diameter request message for calling card service policy management application can thus be routed to a server supporting Calling Card Application Server CCAS rather than to a server that implements a Policy Decision Function PDF . The routing policy component may also include other components to provide for routing decisions based on other criteria such as media or host change during the call geographical distribution time day week considerations etc.

Thus the Diameter router provides advanced load balancing and policy components to implement traffic management and load balancing in the IMS network to an extent not achievable with conventional techniques and also to facilitate other network operation improvements not contemplated previously. Moreover as shown in one or more additional Diameter routers may be provided in the IMS network so as to provide redundancy or load sharing of the proxy and routing functions described herein and also to provide a backup if the first or primary Diameter router is overloaded unavailable or inoperative. In this respect the network elements may be provisioned with a primary Diameter router address and a secondary or backup Diameter router address whereby the routers can function as Diameter message proxies even in networks having high traffic loads.

The Diameter router thus provides a routing policy engine or component that performs Diameter destination host selection based on one or more components of an advanced set of routing criteria which may be provisioned and stored in a database within or outside the Diameter router and the router dynamically conducts traffic analysis and host alive monitoring on each Diameter host . Upon receiving a Diameter request message from a client the router executes the policy engine to select a destination host as described above fills the Destination host AVP with the address of the selected host in the requesting message and delivers the request message to the selected host. If the primary selected host is down or unavailable the router proceeds to try a secondary e.g. next available host by updating the Destination host AVP with the next selected host address. Once the router receives the first response message from the selected host the router relays the response to the client without changing the origin and destination host information.

In conjunction with the provision of the Diameter router as described above the network elements and the clients thereof and the host servers of the IMS system are enhanced in the present disclosure. Thus for a first embodiment the Diameter host servers are preferably configured to differentiate between a received request message is an initial first Diameter message of a new session such as a request message in start or event and other messages such as a message in interim with media change or host change during a call. The servers in the first embodiment are further configured to send responses to the initial messages to the Diameter router and to respond directly to non initial request messages. In responding to initial or first Diameter request messages the servers are configured to copy address of Destination realm and Destination host AVPs from the received requesting message into the Origin realm and Origin host AVPs in the response message which is then sent back to the Diameter router . For non initial messages the servers copy the address of Destination realm and Destination host AVPs in the requesting message into Origin realm and Origin host AVPs in the response message and send the response directly to the requesting client . In a second embodiment the servers are configured to continue sending the subsequent Diameter response messages to the router which continues to act as a proxy for the client and selected server for a given session.

The Diameter clients moreover are provisioned with the address of the Diameter router and also optionally provisioned with the address of a secondary or backup Diameter Router in . When the client sends an initial Diameter request message e.g. message in the example of the message is constructed to include the Diameter router s address in the Destination realm AVP field of the message since the router operates as a proxy for intelligent routing of the initial Diameter messages in the IMS network . In the first embodiment moreover when the clients receive a first response message for a given session the clients are configured to direct remaining Diameter request messages for that session directly to the host server selected by the router to thereby alleviate the traffic load on the router itself. In this regard the clients copy the Origin realm and Origin host AVPs from the first response message into the Destination realm and Destination host AVPs in the subsequent Diameter request messages which are then directly sent to the selected host server . Other IP routers within the IMS system moreover are preferably configured as a default to route any Diameter request messages to the Diameter router if the Destination host AVP thereof is empty. In the second embodiment the clients of the network elements continue to send request messages for all or a prt of the remainder of a given session to the router .

At in the router receives the request message from the client and parses the AVPs in the message. The router selects input data from the AVPs and executes the routing policy component or engine to determine the destination host . The routing policy component identifies the selected host server server in this example based on one some or all of the selection criteria components populates the Destination host AVP with the selected host address diameter1.com and relays the request message to the selected host server .

The selected server receives the relayed request message at identifies this as a first requesting message in a call session copies diameterhost.com in Destination realm and diameterhost1.com in Destination host AVPs of the requesting message into the Origin realm and Origin host AVP fields of the response message and sends the response message to the Diameter router . At the router receives the response message and relays the response message to the requesting client without changes to Origin realm and Origin host AVPs.

As shown in the requesting client receives the first response at and copies diameter1.com of the Origin realm as well as diameter1.com of the Origin host AVP fields in the response message into the Destination realm and Destination host AVP fields in the next and subsequent request messages and then sends the next request message directly to the selected host server . The server receives the next request message and copies diameter1.com in Destination realm and diameter1 .com in Destination host AVPs in the requesting message into Origin realm and Origin host AVPs in the next response message and returns this directly to the client . Thereafter as shown in the client and the server directly exchange further Diameter messages etc. as part of the session without further intervention by the Diameter router . As noted above in a second embodiment the requesting client and the selected server continue to send and receive messages e.g. messages in via the router for all or part of the rest of the session beyond the initial request and response messages .

To further illustrate the exemplary routing and load balancing aspects of the disclosure the following describes an example routing of a Diameter Rf dialog session in an IMS network in which a client in a first network element e.g. client in above desires charging services from a CCF server in the network. This client initiates a Diameter Rf dialog by constructing a Diameter Rf ACR start request message accounting request with the Destination realm AVP indicating charging.com . This allows the network to direct the ACR message to the Diameter router e.g. router described above . Upon receipt of the ACR message the Diameter router parses the AVPs in the message selects input data from the AVPs and executes the policy engine e.g. routing policy component in above to determine the appropriate destination host server in this example . With the host selected the router populates the Destination host AVP of the request message with the selected host address in this example ccf1.charging.com for the selected host server that can provide the requested CCF function and the router relays the ACR request message start to the selected host CCF server .

The host CCF receives the relayed request message from the router and identifies it as a first requesting message in the call. Accordingly the host copies charging.com in the Destination realm AVP field and ccf1.charging.com in the Destination host AVP field of the ACR message into the Origin realm and Origin host AVP fields in an Account Answer ACA response message start and returns the ACA message to the Diameter router . The router then relays the ACA response message back to the requesting IMS network element client without changing the Origin realm or Origin host AVPs. The client receives the first ACA response message and copies charging.com in Origin realm AVP and ccf1.charging.com in the Origin host AVP of the received ACA message into Destination realm and Destination host AVPs in a subsequent ACR message e.g. ACR interim or stop and sends this message directly to the CCF host . Upon receiving the ACR message from the client the host CCF copies charging.com in the Destination realm APV and ccf.1.charging.com in the Destination host AVP of the ACR message into Origin realm and Origin host AVPs in the response ACA message and returns the response message directly to the client in the IMS network element

Further in this example a client of a second IMS network element initiates a different Diameter Rf dialog by constructing an accounting request ACR message start filling the Destination realm AVP of the message with charging.com to allow the network to direct the ACR message to the Diameter router . The Router in turn receives the ACR start message from the client parses and selects input data from the AVPs in the message and executes the routing policy component to determine the destination host. In this case since there is an identical ICID sent from the client in the first network element as determined using the accounting information component the routing policy component selects the same CCF host for this second session. Accordingly the router fills the Destination host AVP with ccf1.charging.com to indicate that the server has been selected for the second session and relays the ACR message start to CCF server . The server receives the request message identifies it as a first requesting message in the call copies charging.com in Destination realm and ccf1.charging.com in Destination host AVPs in the ACR message into the Origin realm and Origin host AVPs in the corresponding ACA response message start and returns the ACA message to the Diameter router

The router relays the ACA message to the client in the second network element without changing the Origin realm and Origin host AVPs. The client receives the first response and copies charging.com in the Origin realm AVP and ccf1.charging.com in Origin host AVP thereof into the Destination realm and Destination host AVPs of the next ACR message interim or stop of the session and sends this directly to the CCF server . The server receives the ACR message and copies charging.com in the Destination realm APV and ccf.1.charging.com in the Destination host AVP of the received message into the Origin realm and Origin host AVPs in the responsive ACA message and returns the response message directly to the Diameter client of the second network element The router thus advantageously facilitates online charging by checking the ICID AVP from the Diameter request messages and routing all messages with the same ICID to a host server implementing a single CCF or CDF. In this manner the selected host server can correlate all CDRs with same ICID into one consolidated CDR. For example accounting messages in one call session could be routed to a single server as in the above example so that the server can aggregate and correlate multiple CDRs from different network elements and into one consolidate CDR which is much easier to be converted and processed by a downstream billing system. Thus the routing policy component can advantageously determine situations in which it is desirable to route all Diameter messages of one call or session even if from different network elements or different clients to the same server .

The disclosure thus contemplates an enhanced Diameter router with network load balance capability that distributes Diameter traffic to servers that are selected based on types of IMS message sessions application services subscriber information billing information etc. The Diameter load balancing moreover may be applied to all Diameter clients and servers in the IMS network whereas previous routing solutions were only applicable to certain services e.g. AAA service routers . In this regard the Diameter servers hosts supported for intelligent routing by the router may include without limitation Application Server AS Policy Decision Function PDF Resource Admission Control Subsystem RACS AAA HSS CCF CDF and OCS which themselves may be unitary network elements or which may be implemented in distributed fashion across multiple network elements such as in the cluster shown in .

The Diameter router moreover takes into account the current loading and status of a given server in determining whether that server will be selected to support a given new session in the network . In this regard if the primary destination host is down or unavailable the Diameter router will alter the routing destination to a secondary or next available destination host accordingly. By the provision of this intelligent Diameter router the IMS network is provided with enhanced Diameter load balance capability to distribute Diameter message traffic according to many authentication accounting and service based criteria by which the load balancing can be done based on the types of IMS message sessions application services subscriber information billing information current server loading etc.

Furthermore additional Diameter routers may be advantageously employed in order to provide redundancy or load sharing of the proxy and routing functions of the router as shown in above. Thus a second router can serve as a backup if the first or primary Diameter router is overloaded unavailable or inoperative or two or more Diameter routers may be concurrently operated in the network with the clients being provisioned to use either router as a primary routing proxy where the routers advantageously share memory access to facilitate coordinated routing decisions e.g. the router and may cooperatively share update and maintain a shared memory with accounting information and other data . In this respect the network elements may be provisioned with a primary Diameter router address and a secondary or backup Diameter router address whereby the routers can function as Diameter message proxies even if networks having high traffic loads.

While the invention has been illustrated and described with respect to one or more exemplary implementations or embodiments equivalent alterations and modifications will occur to others skilled in the art upon reading and understanding this specification and the annexed drawings. In particular regard to the various functions performed by the above described components assemblies devices systems circuits and the like the terms including a reference to a means used to describe such components are intended to correspond unless otherwise indicated to any component which performs the specified function of the described component i.e. that is functionally equivalent even though not structurally equivalent to the disclosed structure which performs the function in the herein illustrated exemplary implementations of the invention. In addition although a particular feature of the invention may have been disclosed with respect to only one of several implementations such feature may be combined with one or more other features of the other implementations as may be desired and advantageous for any given or particular application.

Also to the extent that the terms including includes having has with or variants thereof are used in the detailed description and or in the claims such terms are intended to be inclusive in a manner similar to the term comprising .

